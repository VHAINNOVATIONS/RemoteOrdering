KIDS Distribution saved on Oct 17, 2016@11:28:26
remote spke kids
**KIDS**:ZZTEST 1.0^

**INSTALL NAME**
ZZTEST 1.0
"BLD",19,0)
ZZTEST 1.0^MOBILE SCHEDULING APPLICATIONS^0^3161017^y
"BLD",19,1,0)
^^1^1^3161017^^
"BLD",19,1,1,0)
Remote ordering spoke KIDS BUILD
"BLD",19,4,0)
^9.64PA^^
"BLD",19,6.3)
21
"BLD",19,"INID")
^n
"BLD",19,"INIT")

"BLD",19,"KRN",0)
^9.67PA^779.2^20
"BLD",19,"KRN",.4,0)
.4
"BLD",19,"KRN",.401,0)
.401
"BLD",19,"KRN",.402,0)
.402
"BLD",19,"KRN",.403,0)
.403
"BLD",19,"KRN",.5,0)
.5
"BLD",19,"KRN",.84,0)
.84
"BLD",19,"KRN",3.6,0)
3.6
"BLD",19,"KRN",3.8,0)
3.8
"BLD",19,"KRN",9.2,0)
9.2
"BLD",19,"KRN",9.8,0)
9.8
"BLD",19,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",19,"KRN",9.8,"NM",1,0)
AHMLDOS^^0^B22419185
"BLD",19,"KRN",9.8,"NM",2,0)
AHMLDOS1^^0^B158045468
"BLD",19,"KRN",9.8,"NM",3,0)
AHMLDOLO^^0^B23245430
"BLD",19,"KRN",9.8,"NM",4,0)
AHMLDORO^^0^B67442195
"BLD",19,"KRN",9.8,"NM",5,0)
AHMLDOP1^^0^B117690250
"BLD",19,"KRN",9.8,"NM",6,0)
AHMLDOP2^^0^B169259843
"BLD",19,"KRN",9.8,"NM","B","AHMLDOLO",3)

"BLD",19,"KRN",9.8,"NM","B","AHMLDOP1",5)

"BLD",19,"KRN",9.8,"NM","B","AHMLDOP2",6)

"BLD",19,"KRN",9.8,"NM","B","AHMLDORO",4)

"BLD",19,"KRN",9.8,"NM","B","AHMLDOS",1)

"BLD",19,"KRN",9.8,"NM","B","AHMLDOS1",2)

"BLD",19,"KRN",19,0)
19
"BLD",19,"KRN",19,"NM",0)
^9.68A^^0
"BLD",19,"KRN",19.1,0)
19.1
"BLD",19,"KRN",101,0)
101
"BLD",19,"KRN",101,"NM",0)
^9.68A^20^20
"BLD",19,"KRN",101,"NM",1,0)
LA7V 500 ORM-O01 EVENT^^0
"BLD",19,"KRN",101,"NM",2,0)
LA7V 500 ORM-O01 SUBS^^0
"BLD",19,"KRN",101,"NM",3,0)
LA7V REMOTE ORM-O01 EVENT^^0
"BLD",19,"KRN",101,"NM",4,0)
LA7V REMOTE ORM-O01 SUBS^^0
"BLD",19,"KRN",101,"NM",5,0)
RA 500 ORM-O01 EVENT^^0
"BLD",19,"KRN",101,"NM",6,0)
RA 500 ORM-O01 SUBS^^0
"BLD",19,"KRN",101,"NM",7,0)
RA CANCEL REMOTE EVENT^^0
"BLD",19,"KRN",101,"NM",8,0)
RA CANCEL REMOTE SUBS^^0
"BLD",19,"KRN",101,"NM",9,0)
RA EVSEND CPRS^^0
"BLD",19,"KRN",101,"NM",10,0)
RA EVSEND RMTE^^0
"BLD",19,"KRN",101,"NM",11,0)
RA EXAMINED REMOTE EVENT^^0
"BLD",19,"KRN",101,"NM",12,0)
RA EXAMINED REMOTE SUBS^^0
"BLD",19,"KRN",101,"NM",13,0)
RA REG RMTE EVENT^^0
"BLD",19,"KRN",101,"NM",14,0)
RA REG RMTE SUBS^^0
"BLD",19,"KRN",101,"NM",15,0)
RA REMOTE DC EVENT^^0
"BLD",19,"KRN",101,"NM",16,0)
RA REMOTE DC SUBS^^0
"BLD",19,"KRN",101,"NM",17,0)
RA REMOTE ORM-O01 EVENT^^0
"BLD",19,"KRN",101,"NM",18,0)
RA REMOTE ORM-O01 SUBS^^0
"BLD",19,"KRN",101,"NM",19,0)
RA RPT RMTE EVENT^^0
"BLD",19,"KRN",101,"NM",20,0)
RA RPT RMTE SUBS^^0
"BLD",19,"KRN",101,"NM","B","LA7V 500 ORM-O01 EVENT",1)

"BLD",19,"KRN",101,"NM","B","LA7V 500 ORM-O01 SUBS",2)

"BLD",19,"KRN",101,"NM","B","LA7V REMOTE ORM-O01 EVENT",3)

"BLD",19,"KRN",101,"NM","B","LA7V REMOTE ORM-O01 SUBS",4)

"BLD",19,"KRN",101,"NM","B","RA 500 ORM-O01 EVENT",5)

"BLD",19,"KRN",101,"NM","B","RA 500 ORM-O01 SUBS",6)

"BLD",19,"KRN",101,"NM","B","RA CANCEL REMOTE EVENT",7)

"BLD",19,"KRN",101,"NM","B","RA CANCEL REMOTE SUBS",8)

"BLD",19,"KRN",101,"NM","B","RA EVSEND CPRS",9)

"BLD",19,"KRN",101,"NM","B","RA EVSEND RMTE",10)

"BLD",19,"KRN",101,"NM","B","RA EXAMINED REMOTE EVENT",11)

"BLD",19,"KRN",101,"NM","B","RA EXAMINED REMOTE SUBS",12)

"BLD",19,"KRN",101,"NM","B","RA REG RMTE EVENT",13)

"BLD",19,"KRN",101,"NM","B","RA REG RMTE SUBS",14)

"BLD",19,"KRN",101,"NM","B","RA REMOTE DC EVENT",15)

"BLD",19,"KRN",101,"NM","B","RA REMOTE DC SUBS",16)

"BLD",19,"KRN",101,"NM","B","RA REMOTE ORM-O01 EVENT",17)

"BLD",19,"KRN",101,"NM","B","RA REMOTE ORM-O01 SUBS",18)

"BLD",19,"KRN",101,"NM","B","RA RPT RMTE EVENT",19)

"BLD",19,"KRN",101,"NM","B","RA RPT RMTE SUBS",20)

"BLD",19,"KRN",409.61,0)
409.61
"BLD",19,"KRN",771,0)
771
"BLD",19,"KRN",771,"NM",0)
^9.68A^6^6
"BLD",19,"KRN",771,"NM",1,0)
LA7V 500 CLIENT^^0
"BLD",19,"KRN",771,"NM",2,0)
LA7V 565 CLIENT^^0
"BLD",19,"KRN",771,"NM",3,0)
RA 500 CLIENT^^0
"BLD",19,"KRN",771,"NM",4,0)
RA 565 CLIENT^^0
"BLD",19,"KRN",771,"NM",5,0)
RA HOST 500^^0
"BLD",19,"KRN",771,"NM",6,0)
RA HOST 565^^0
"BLD",19,"KRN",771,"NM","B","LA7V 500 CLIENT",1)

"BLD",19,"KRN",771,"NM","B","LA7V 565 CLIENT",2)

"BLD",19,"KRN",771,"NM","B","RA 500 CLIENT",3)

"BLD",19,"KRN",771,"NM","B","RA 565 CLIENT",4)

"BLD",19,"KRN",771,"NM","B","RA HOST 500",5)

"BLD",19,"KRN",771,"NM","B","RA HOST 565",6)

"BLD",19,"KRN",779.2,0)
779.2
"BLD",19,"KRN",870,0)
870
"BLD",19,"KRN",870,"NM",0)
^9.68A^2^2
"BLD",19,"KRN",870,"NM",1,0)
SPOKE1^^0
"BLD",19,"KRN",870,"NM",2,0)
LA7RMTE1^^0
"BLD",19,"KRN",870,"NM","B","LA7RMTE1",2)

"BLD",19,"KRN",870,"NM","B","SPOKE1",1)

"BLD",19,"KRN",8989.51,0)
8989.51
"BLD",19,"KRN",8989.52,0)
8989.52
"BLD",19,"KRN",8994,0)
8994
"BLD",19,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",19,"KRN","B",.4,.4)

"BLD",19,"KRN","B",.401,.401)

"BLD",19,"KRN","B",.402,.402)

"BLD",19,"KRN","B",.403,.403)

"BLD",19,"KRN","B",.5,.5)

"BLD",19,"KRN","B",.84,.84)

"BLD",19,"KRN","B",3.6,3.6)

"BLD",19,"KRN","B",3.8,3.8)

"BLD",19,"KRN","B",9.2,9.2)

"BLD",19,"KRN","B",9.8,9.8)

"BLD",19,"KRN","B",19,19)

"BLD",19,"KRN","B",19.1,19.1)

"BLD",19,"KRN","B",101,101)

"BLD",19,"KRN","B",409.61,409.61)

"BLD",19,"KRN","B",771,771)

"BLD",19,"KRN","B",779.2,779.2)

"BLD",19,"KRN","B",870,870)

"BLD",19,"KRN","B",8989.51,8989.51)

"BLD",19,"KRN","B",8989.52,8989.52)

"BLD",19,"KRN","B",8994,8994)

"BLD",19,"QUES",0)
^9.62^^
"BLD",19,"REQB",0)
^9.611^^
"KRN",101,6177,-1)
0^3
"KRN",101,6177,0)
LA7V REMOTE ORM-O01 EVENT^INCOMING FROM VISTA HUB^^E^^^^^^^^
"KRN",101,6177,99)
63964,50290
"KRN",101,6177,770)
LA7V HOST 500^^ORM^O01^49^^^AL^NE^2.4^
"KRN",101,6177,775,0)
^101.0775PA^1^1
"KRN",101,6177,775,1,0)
6178
"KRN",101,6177,775,1,"^")
LA7V REMOTE ORM-O01 SUBS
"KRN",101,6178,-1)
0^4
"KRN",101,6178,0)
LA7V REMOTE ORM-O01 SUBS^RECEIVE REMOTE ORDERS FROM VISTA^^S^^^^^^^^
"KRN",101,6178,99)
63964,50530
"KRN",101,6178,770)
^LA7V 565 CLIENT^^O01^^^^AL^NE^2.4^ACK
"KRN",101,6178,771)
D EN^AHMLDOS
"KRN",101,6178,773)
0^0^0
"KRN",101,6178,774)

"KRN",101,6181,-1)
0^1
"KRN",101,6181,0)
LA7V 500 ORM-O01 EVENT^SPOKE TO HUB MESSAGES^^E^^^^^^^^
"KRN",101,6181,99)
63977,37177
"KRN",101,6181,770)
LA7V HOST 565^^ORM^O01^^^^NE^NE^2.4^
"KRN",101,6181,773)
1^1^0
"KRN",101,6181,775,0)
^101.0775PA^1^1
"KRN",101,6181,775,1,0)
6182
"KRN",101,6181,775,1,"^")
LA7V 500 ORM-O01 SUBS
"KRN",101,6182,-1)
0^2
"KRN",101,6182,0)
LA7V 500 ORM-O01 SUBS^SPOKE TO HUB SUBSCRIBER^^S^^^^^^^^
"KRN",101,6182,99)
63977,37351
"KRN",101,6182,770)
^LA7V 500 CLIENT^^^^^LA7RMTE1^NE^NE^2.4^
"KRN",101,6182,773)
1^1^0
"KRN",101,6185,-1)
0^17
"KRN",101,6185,0)
RA REMOTE ORM-O01 EVENT^INCOMING RAD^^E^^^^^^^^
"KRN",101,6185,99)
64037,42810
"KRN",101,6185,770)
RA HOST 500^^ORM^O01^49^^^AL^NE^2.4^
"KRN",101,6185,775,0)
^101.0775PA^1^1
"KRN",101,6185,775,1,0)
6186
"KRN",101,6185,775,1,"^")
RA REMOTE ORM-O01 SUBS
"KRN",101,6186,-1)
0^18
"KRN",101,6186,0)
RA REMOTE ORM-O01 SUBS^RECEIVE REMOTE ORDER SUB^^S^^^^^^^^
"KRN",101,6186,99)
64037,42901
"KRN",101,6186,770)
^RA 565 CLIENT^^O01^^^^AL^NE^2.4^ACK
"KRN",101,6186,771)
D EN^AHMLDOS
"KRN",101,6186,773)
0^0^0
"KRN",101,6187,-1)
0^13
"KRN",101,6187,0)
RA REG RMTE EVENT^RAD SPOKE TO HUB^^E^^^^^^^^
"KRN",101,6187,20)
D EN^RARMTOUT
"KRN",101,6187,99)
64056,41395
"KRN",101,6187,770)
RA HOST 565^^ORM^O01^^^^NE^NE^2.4^
"KRN",101,6187,773)
1^1^0
"KRN",101,6187,775,0)
^101.0775PA^1^1
"KRN",101,6187,775,1,0)
6188
"KRN",101,6187,775,1,"^")
RA REG RMTE SUBS
"KRN",101,6188,-1)
0^14
"KRN",101,6188,0)
RA REG RMTE SUBS^SPOKE TO HUB RAD^^S^^^^^^^^
"KRN",101,6188,99)
64056,41539
"KRN",101,6188,770)
^RA 500 CLIENT^^^^^LA7RMTE1^NE^NE^2.4^
"KRN",101,6188,771)
Q
"KRN",101,6188,773)
1^1^0
"KRN",101,6189,-1)
0^20
"KRN",101,6189,0)
RA RPT RMTE SUBS^SPOKE TO HUB RESULTS^^S^^^^^^^^
"KRN",101,6189,99)
64058,35224
"KRN",101,6189,770)
^RA 500 CLIENT^^O01^^^LA7RMTE1^NE^NE^2.4^ACK
"KRN",101,6189,771)
Q
"KRN",101,6189,773)
1^1^0
"KRN",101,6190,-1)
0^19
"KRN",101,6190,0)
RA RPT RMTE EVENT^RAD RESULTS TO HUB^^E^^^^^^^^
"KRN",101,6190,20)
D EN^RARMTOUT
"KRN",101,6190,99)
64058,35317
"KRN",101,6190,770)
RA HOST 565^^ORM^O01^49^^^NE^NE^2.4^
"KRN",101,6190,773)
1^1^0
"KRN",101,6190,775,0)
^101.0775PA^1^1
"KRN",101,6190,775,1,0)
6189
"KRN",101,6190,775,1,"^")
RA RPT RMTE SUBS
"KRN",101,6191,-1)
0^10
"KRN",101,6191,0)
RA EVSEND RMTE^RAD OERR => VISTA^^A^^^^^^^^
"KRN",101,6191,15)
K HLA("HLS")
"KRN",101,6191,20)
I $G(REMOTE)'=1 D EN1^AHMLDORO(.XQORMSG)
"KRN",101,6191,99)
64061,51758
"KRN",101,6192,-1)
0^6
"KRN",101,6192,0)
RA 500 ORM-O01 SUBS^SPOKE TO HUB RAD^^S^^^^^^^^
"KRN",101,6192,99)
64063,66396
"KRN",101,6192,770)
^RA 500 CLIENT^^^^^LA7RMTE1^NE^NE^2.4^
"KRN",101,6192,773)
1^1^0
"KRN",101,6193,-1)
0^5
"KRN",101,6193,0)
RA 500 ORM-O01 EVENT^SPOKE TO HUB RAD^^E^^^^^^^^
"KRN",101,6193,99)
64063,66472
"KRN",101,6193,770)
RA HOST 565^^ORM^O01^^^^NE^NE^2.4^
"KRN",101,6193,773)
1^1^0
"KRN",101,6193,775,0)
^101.0775PA^1^1
"KRN",101,6193,775,1,0)
6192
"KRN",101,6193,775,1,"^")
RA 500 ORM-O01 SUBS
"KRN",101,6194,-1)
0^9
"KRN",101,6194,0)
RA EVSEND CPRS^SPOKE TO HUB ARRIVALS^^A^^^^^^^^
"KRN",101,6194,15)
K HLA("HLS")
"KRN",101,6194,20)
I $G(REMOTE)'=1 D EN1^AHMLDORO(.XQORMSG)
"KRN",101,6194,99)
64080,42541
"KRN",101,6195,-1)
0^7
"KRN",101,6195,0)
RA CANCEL REMOTE EVENT^^^E^^^^^^^^
"KRN",101,6195,20)
D EN^RARMTOUT
"KRN",101,6195,770)
RA HOST 565^^ORM^O01^49^^^NE^NE^2.4^
"KRN",101,6195,772)
Q
"KRN",101,6195,773)
1^1^0
"KRN",101,6195,775,0)
^101.0775PA^1^1
"KRN",101,6195,775,1,0)
6196
"KRN",101,6195,775,1,"^")
RA CANCEL REMOTE SUBS
"KRN",101,6196,-1)
0^8
"KRN",101,6196,0)
RA CANCEL REMOTE SUBS^^^S^^^^^^^^
"KRN",101,6196,770)
^RA 500 CLIENT^^O01^^^LA7RMTE1^NE^NE^2.4^ACK
"KRN",101,6196,771)
Q
"KRN",101,6196,773)
1^1^0
"KRN",101,6197,-1)
0^15
"KRN",101,6197,0)
RA REMOTE DC EVENT^CPRS DC AT SPOKE^^E^^^^^^^^
"KRN",101,6197,99)
64081,53999
"KRN",101,6197,770)
RA HOST 565^^ORM^O01^49^^^NE^NE^2.4^
"KRN",101,6197,771)

"KRN",101,6197,772)
Q
"KRN",101,6197,773)
1^1^0
"KRN",101,6197,775,0)
^101.0775PA^1^1
"KRN",101,6197,775,1,0)
6198
"KRN",101,6197,775,1,"^")
RA REMOTE DC SUBS
"KRN",101,6198,-1)
0^16
"KRN",101,6198,0)
RA REMOTE DC SUBS^SPOKE CPRS DC^^S^^^^^^^^
"KRN",101,6198,99)
64081,54086
"KRN",101,6198,770)
^RA 500 CLIENT^^O01^^^LA7RMTE1^NE^NE^2.4^ACK
"KRN",101,6198,771)
Q
"KRN",101,6198,772)

"KRN",101,6198,773)
1^1^0
"KRN",101,6198,775,0)
^101.0775PA^^0
"KRN",101,6199,-1)
0^12
"KRN",101,6199,0)
RA EXAMINED REMOTE SUBS^SPOKE TO HUB EXAMINED^^S^^^^^^^^
"KRN",101,6199,99)
64082,32317
"KRN",101,6199,770)
^RA 500 CLIENT^^O01^^^LA7RMTE1^NE^NE^2.4^ACK
"KRN",101,6199,771)
Q
"KRN",101,6199,773)
1^1^0
"KRN",101,6200,-1)
0^11
"KRN",101,6200,0)
RA EXAMINED REMOTE EVENT^SPOKE TO HUB^^E^^^^^^^^
"KRN",101,6200,20)
D EN^RARMTOUT
"KRN",101,6200,99)
64082,32411
"KRN",101,6200,770)
RA HOST 565^^ORM^O01^49^^^NE^NE^2.4^
"KRN",101,6200,772)

"KRN",101,6200,773)
1^1^0
"KRN",101,6200,775,0)
^101.0775PA^1^1
"KRN",101,6200,775,1,0)
6199
"KRN",101,6200,775,1,"^")
RA EXAMINED REMOTE SUBS
"KRN",771,244,-1)
0^2
"KRN",771,244,0)
LA7V 565 CLIENT^a^565^^^^USA
"KRN",771,244,"EC")
^~\&
"KRN",771,244,"FS")
|
"KRN",771,246,-1)
0^1
"KRN",771,246,0)
LA7V 500 CLIENT^a^500^^^^USA
"KRN",771,246,"EC")
^~\&
"KRN",771,246,"FS")
|
"KRN",771,248,-1)
0^5
"KRN",771,248,0)
RA HOST 500^a^^^^^USA
"KRN",771,248,"EC")
^~\&
"KRN",771,248,"FS")
|
"KRN",771,249,-1)
0^4
"KRN",771,249,0)
RA 565 CLIENT^a^565^^^^USA
"KRN",771,249,"EC")
^~\&
"KRN",771,249,"FS")
|
"KRN",771,251,-1)
0^3
"KRN",771,251,0)
RA 500 CLIENT^a^500^^^^USA
"KRN",771,251,"EC")
^~\&
"KRN",771,251,"FS")
|
"KRN",771,252,-1)
0^6
"KRN",771,252,0)
RA HOST 565^a^565^^^^USA
"KRN",771,252,"EC")
^~\&
"KRN",771,252,"FS")
|
"KRN",870,147,-1)
0^2
"KRN",870,147,0)
LA7RMTE1^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,147,200)
^^^^^11^28
"KRN",870,147,400)
54.243.51.253^5026^C^N^^^^5026^
"KRN",870,148,-1)
0^1
"KRN",870,148,0)
SPOKE1^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,148,3,0)
^870.02^1^1^3160308^^^^
"KRN",870,148,3,1,0)
Remote Ordering project Spoke 1
"KRN",870,148,200)
^5^245^10^60^^^^^I
"KRN",870,148,400)
54.157.56.194^5026^S^Y^^^^5027^
"MBREQ")
0
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",576,-1)
1^1
"PKG",576,0)
MOBILE SCHEDULING APPLICATIONS^MBAA^MOBILE SCHEDULING APPLICATIONS SUITE
"PKG",576,5)
OIT-PD
"PKG",576,7)
^^I
"PKG",576,22,0)
^9.49I^1^1
"PKG",576,22,1,0)
1.0^3161017^3140314^1
"PKG",576,22,1,1,0)
^^1^1^3161017
"PKG",576,22,1,1,1,0)
Remote ordering spoke KIDS BUILD
"PKG",576,"DEV")
MHED/PD
"PKG",576,"VERSION")
1.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","AHMLDOLO")
0^3^B23245430
"RTN","AHMLDOLO",1,0)
AHMLDOLO ;SAIC/TCK - REMOT~E ORDERING ; 10/17/16 8:36am
"RTN","AHMLDOLO",2,0)
 ;;1.0;REMOTE ORDERING;;DEC 28, 2015;Build 21
"RTN","AHMLDOLO",3,0)
 Q
"RTN","AHMLDOLO",4,0)
 ;
"RTN","AHMLDOLO",5,0)
EN(MSG1,MSG2) ;Pass in message from VistA or CPRS
"RTN","AHMLDOLO",6,0)
 N HLA,PROT,PR,REC,FLG S (CHK,FLG)=0
"RTN","AHMLDOLO",7,0)
 Q:$G(REMOTE)=1
"RTN","AHMLDOLO",8,0)
 M XQORMSG=MSG2
"RTN","AHMLDOLO",9,0)
 I $D(MSG1)>1 M REC=XQORMSG M ^TMP=REC D GENMSG(.REC)
"RTN","AHMLDOLO",10,0)
 I $G(MSG2)'="" I $G(ORAPMSG)'="" M REC=@ORAPMSG D GENMSG(.REC)
"RTN","AHMLDOLO",11,0)
 I $G(MSG2)'="",$G(XQORMSG)'="" M REC=@XQORMSG D GENMSG(.REC)
"RTN","AHMLDOLO",12,0)
 I $G(MSG1)["TMP" M REC=@XQORMSG D GENMSG(.REC)
"RTN","AHMLDOLO",13,0)
 I $G(MSG)["TMP" M REC=@MSG D GENMSG(.REC)
"RTN","AHMLDOLO",14,0)
 K MSG,MSG1,REC,CHK,FLG,ODC,AP,VFGL,STOP,CHG,MSGTYP,MSGNDE
"RTN","AHMLDOLO",15,0)
 Q
"RTN","AHMLDOLO",16,0)
 ;
"RTN","AHMLDOLO",17,0)
GENMSG(REC) ;
"RTN","AHMLDOLO",18,0)
 S (CCDE,ZCNT,CDE)="",(CHK,FLG,ODC,AP,VFLG,STOP,CHG)=0,D1="|",D2="^"
"RTN","AHMLDOLO",19,0)
 F  S ZCNT=$O(REC(ZCNT)) Q:ZCNT=""  D  Q:FLG=2
"RTN","AHMLDOLO",20,0)
 .S MSGNDE=REC(ZCNT),MSGTYP=$P(MSGNDE,"|"),CCDE=$P(MSGNDE,"|",2)
"RTN","AHMLDOLO",21,0)
 .Q:MSGTYP=""
"RTN","AHMLDOLO",22,0)
 .Q:$G(CCDE)=""&(MSGTYP'="NTE")
"RTN","AHMLDOLO",23,0)
 .S TYP="LAB"
"RTN","AHMLDOLO",24,0)
 .;I MSGTYP="MSH" S TYP=$P(MSGNDE,"|",3),TYP=$E(TYP,1,3)
"RTN","AHMLDOLO",25,0)
 .;I TYP="" S TYP="LAB"
"RTN","AHMLDOLO",26,0)
 .;I TYP'="",TYP'["LAB" S TYP="LAB"
"RTN","AHMLDOLO",27,0)
 .I MSGTYP="ORC" D  Q:FLG
"RTN","AHMLDOLO",28,0)
 ..S ORN=$P(MSGNDE,"|",3),OR=+ORN
"RTN","AHMLDOLO",29,0)
 ..I CCDE="NA" S FLG=2 Q
"RTN","AHMLDOLO",30,0)
 ..I CCDE="SN" S FLG=2 Q
"RTN","AHMLDOLO",31,0)
 ..I CCDE="NW" S FLG=2 Q
"RTN","AHMLDOLO",32,0)
 ..I CCDE="OC" S FLG=1
"RTN","AHMLDOLO",33,0)
 ..I CCDE="CA" S FLG=1
"RTN","AHMLDOLO",34,0)
 ..I CCDE="DC",$P(MSGNDE,"|",4) S FLG=1
"RTN","AHMLDOLO",35,0)
 ..;I CCDE="DC",$P(MSGNDE,"|",4)'["RA" S TYP="LAB",FLG=1
"RTN","AHMLDOLO",36,0)
 ..I CCDE="SC" S CDE="SC",FLG=1
"RTN","AHMLDOLO",37,0)
 ..I CCDE="RE" S CDE="RE",FLG=1
"RTN","AHMLDOLO",38,0)
 ..S ORN=$P(MSGNDE,"|",3),OR=+ORN
"RTN","AHMLDOLO",39,0)
 ..S $P(REC(ZCNT),"|",14)=565
"RTN","AHMLDOLO",40,0)
 ..I $G(OR)>0,$D(^XTMP(TYP,"B")),$D(^XTMP(TYP,"B",OR)) S ORIFN=^XTMP(TYP,"B",OR)
"RTN","AHMLDOLO",41,0)
 ..I $G(ORIFN)>0 S ORIFN=ORIFN_";1^OR",$P(REC(ZCNT),"|",3)=ORIFN
"RTN","AHMLDOLO",42,0)
 .I MSGTYP="OBR" D
"RTN","AHMLDOLO",43,0)
 ..Q:CDE'="SC"
"RTN","AHMLDOLO",44,0)
 ..S CDE=""
"RTN","AHMLDOLO",45,0)
 ..S ACC=$P(REC(ZCNT),"|",21)
"RTN","AHMLDOLO",46,0)
 ..S LRTST=$P($P(REC(ZCNT),D1,5),D2,4)
"RTN","AHMLDOLO",47,0)
 ..D GTUID(.UID,ZCNT,LRTST,OR)
"RTN","AHMLDOLO",48,0)
 ..I $G(UID)="" S FLG=2 Q
"RTN","AHMLDOLO",49,0)
 .I MSGTYP="OBX" D
"RTN","AHMLDOLO",50,0)
 ..I $P(REC(ZCNT),"|",9)["HH" S $P(REC(ZCNT),"|",9)="H*"
"RTN","AHMLDOLO",51,0)
 ..I $P(REC(ZCNT),"|",9)["LL" S $P(REC(ZCNT),"|",9)="L*"
"RTN","AHMLDOLO",52,0)
 .I MSGTYP="NTE" D FIXNTE(.REC,ZCNT)
"RTN","AHMLDOLO",53,0)
 I $G(FLG)=1 D
"RTN","AHMLDOLO",54,0)
 .Q:$G(ORN)'>0
"RTN","AHMLDOLO",55,0)
 .Q:'FLG
"RTN","AHMLDOLO",56,0)
 .Q:FLG=2
"RTN","AHMLDOLO",57,0)
 .D GTNME(.REC)
"RTN","AHMLDOLO",58,0)
 .I $G(ORIFN)[";" S ORIFN=+ORIFN
"RTN","AHMLDOLO",59,0)
 .I $G(ORDERID)>0,ORDERID[";" S ORIFN=+ORDERID
"RTN","AHMLDOLO",60,0)
 .D GTREM(.PROT,OR,TYP)
"RTN","AHMLDOLO",61,0)
 .M HLA("HLS")=REC K HLA("HLS",1) D GENERATE^HLMA($O(^ORD(101,"B",PROT,0)),"LM",1,.HLREST,"",.HLP) S FLG=3
"RTN","AHMLDOLO",62,0)
 Q
"RTN","AHMLDOLO",63,0)
 ;
"RTN","AHMLDOLO",64,0)
FIXNTE(REC,ZCNT) ;
"RTN","AHMLDOLO",65,0)
 N CNT,INDX
"RTN","AHMLDOLO",66,0)
 S INDX="",CNT=ZCNT,AMEND=0
"RTN","AHMLDOLO",67,0)
 F  S INDX=$O(REC(ZCNT,INDX)) Q:INDX=""  D
"RTN","AHMLDOLO",68,0)
 .Q:$G(INDX)'>0
"RTN","AHMLDOLO",69,0)
 .;I INDX<TOT K REC(ZCNT,INDX)
"RTN","AHMLDOLO",70,0)
 .S TXT=REC(ZCNT,INDX)
"RTN","AHMLDOLO",71,0)
 .I TXT["reported" S AMEND=1
"RTN","AHMLDOLO",72,0)
 .I TXT["Ordering" K REC(ZCNT,INDX) Q
"RTN","AHMLDOLO",73,0)
 .I $E(TXT,1)=" " K REC(ZCNT,INDX) Q
"RTN","AHMLDOLO",74,0)
 .I TXT["Report" K REC(ZCNT,INDX) Q
"RTN","AHMLDOLO",75,0)
 .I TXT["Performing" K REC(ZCNT,INDX) Q
"RTN","AHMLDOLO",76,0)
 .I $E(TXT,1,4)="" K REC(ZCNT,INDX) Q
"RTN","AHMLDOLO",77,0)
 .I $E(TXT,1,5)["NP" S REC(ZCNT)=REC(ZCNT)_TXT K REC(ZCNT,INDX)
"RTN","AHMLDOLO",78,0)
 I AMEND D
"RTN","AHMLDOLO",79,0)
 .;S TOT=$O(REC(ZCNT,9999),-2)
"RTN","AHMLDOLO",80,0)
 .;I TOT>2 S TOT=TOT-1
"RTN","AHMLDOLO",81,0)
 .S INDX="",CNT=ZCNT
"RTN","AHMLDOLO",82,0)
 .F  S INDX=$O(REC(ZCNT,INDX)) Q:INDX=""  D
"RTN","AHMLDOLO",83,0)
 ..Q:$G(INDX)'>0
"RTN","AHMLDOLO",84,0)
 ..;I INDX<TOT K REC(ZCNT,INDX) Q
"RTN","AHMLDOLO",85,0)
 ..S TXT=REC(ZCNT,INDX),N=$G(N)+1
"RTN","AHMLDOLO",86,0)
 ..Q:$G(TXT)=""
"RTN","AHMLDOLO",87,0)
 ..S CNT=$G(CNT)+1
"RTN","AHMLDOLO",88,0)
 ..S REC(CNT)="NTE|"_N_"|L|"_TXT K REC(ZCNT,INDX)
"RTN","AHMLDOLO",89,0)
 S I=$P(REC(ZCNT),"|")
"RTN","AHMLDOLO",90,0)
 Q:I'="NTE"
"RTN","AHMLDOLO",91,0)
 ;I $P(REC(ZCNT),"|",2)="" K REC(ZCNT)
"RTN","AHMLDOLO",92,0)
 Q
"RTN","AHMLDOLO",93,0)
 ;
"RTN","AHMLDOLO",94,0)
GTUID(UID,ZCNT,LRTST,OR) ;
"RTN","AHMLDOLO",95,0)
 S LRDATA=^OR(100,OR,4)
"RTN","AHMLDOLO",96,0)
 S LRORD=$P(LRDATA,";"),LRODT=$P(LRDATA,";",2),LRSN=$P(LRDATA,";",3)
"RTN","AHMLDOLO",97,0)
 S LRSND="",LRSND=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRTST,LRSND))
"RTN","AHMLDOLO",98,0)
 I '$D(^LRO(69,LRODT,1,LRSN,2,LRSND,.3)) S UID=0 Q
"RTN","AHMLDOLO",99,0)
 S UID=^LRO(69,LRODT,1,LRSN,2,LRSND,.3)
"RTN","AHMLDOLO",100,0)
 S $P(REC(ZCNT),"|",21)=UID,$P(REC(ZCNT),"|",22)=UID
"RTN","AHMLDOLO",101,0)
 Q
"RTN","AHMLDOLO",102,0)
GTNME(REC) ;
"RTN","AHMLDOLO",103,0)
 N CNT,MSGNDE,MSGTYP,TYP
"RTN","AHMLDOLO",104,0)
 S (MSGNDE,MSGTYP)="",CNT=0
"RTN","AHMLDOLO",105,0)
 F  S CNT=$O(REC(CNT)) Q:CNT=""  D
"RTN","AHMLDOLO",106,0)
 .S MSGNDE=REC(CNT)
"RTN","AHMLDOLO",107,0)
 .Q:$G(MSGNDE)=""
"RTN","AHMLDOLO",108,0)
 .S MSGTYP=$P(MSGNDE,"|"),CCDE=$P(MSGNDE,"|",2)
"RTN","AHMLDOLO",109,0)
 .I MSGTYP="MSH" D
"RTN","AHMLDOLO",110,0)
 ..S TYP=$P(MSGNDE,"|",3)
"RTN","AHMLDOLO",111,0)
 .I MSGTYP="ORC" D
"RTN","AHMLDOLO",112,0)
 ..S USR=+$P(MSGNDE,"|",11)
"RTN","AHMLDOLO",113,0)
 ..S PROV=+$P(MSGNDE,"|",13)
"RTN","AHMLDOLO",114,0)
 ..I USR'=PROV S USR=PROV
"RTN","AHMLDOLO",115,0)
 ..S USRNME=$$GET1^DIQ(200,USR,.01,"I")
"RTN","AHMLDOLO",116,0)
 ..S PROVNME=$$GET1^DIQ(200,PROV,.01,"I")
"RTN","AHMLDOLO",117,0)
 ..I $G(USRNME)'="" S $P(REC(CNT),"|",11)=USR_"^"_USRNME
"RTN","AHMLDOLO",118,0)
 ..I $G(PROVNME)'="" S $P(REC(CNT),"|",13)=PROV_"^"_PROVNME
"RTN","AHMLDOLO",119,0)
 Q
"RTN","AHMLDOLO",120,0)
 ;
"RTN","AHMLDOLO",121,0)
GTREM(PROT,OR,TYP) ;
"RTN","AHMLDOLO",122,0)
 N FAC,REM
"RTN","AHMLDOLO",123,0)
 S PROT=0
"RTN","AHMLDOLO",124,0)
 Q:$G(OR)'>0
"RTN","AHMLDOLO",125,0)
 Q:'$D(^OR(100,OR,4.5,"ID"))
"RTN","AHMLDOLO",126,0)
 Q:'$D(^OR(100,OR,4.5,"ID","Location"))
"RTN","AHMLDOLO",127,0)
 S IFN="",IFN=$O(^OR(100,OR,4.5,"ID","Location",IFN))
"RTN","AHMLDOLO",128,0)
 S FAC=^OR(100,OR,4.5,IFN,1)
"RTN","AHMLDOLO",129,0)
 S REM="",REM=$O(^DIC(4,"B",FAC,REM))
"RTN","AHMLDOLO",130,0)
 S REM=500
"RTN","AHMLDOLO",131,0)
 ;S PROT="LA7V "_REM_" ORM-O01 EVENT"
"RTN","AHMLDOLO",132,0)
 I TYP["LAB" S PROT="LA7V "_REM_" ORM-O01 EVENT"
"RTN","AHMLDOLO",133,0)
 I TYP["RAD" S PROT="RA "_REM_" ORM-O01 EVENT"
"RTN","AHMLDOLO",134,0)
 ;REMOVE STAION ID FROM 8 NODE
"RTN","AHMLDOLO",135,0)
 Q
"RTN","AHMLDOLO",136,0)
 ;
"RTN","AHMLDOLO",137,0)
GTDOM(R) ;
"RTN","AHMLDOLO",138,0)
 N NME,INST,CNT
"RTN","AHMLDOLO",139,0)
 S (DOM,INST,R)="",CNT=0
"RTN","AHMLDOLO",140,0)
 Q:'$D(^DIC(4,"E"))
"RTN","AHMLDOLO",141,0)
 S INST="" F  S INST=$O(^DIC(4,"E",INST)) Q:INST=""  D
"RTN","AHMLDOLO",142,0)
 .;Q:$G(DOM)'>0
"RTN","AHMLDOLO",143,0)
 .;S DOM=$$GET1^DIQ(4.2,DOM,.01,"E")
"RTN","AHMLDOLO",144,0)
 .S NME=$$GET1^DIQ(4,INST,.01,"E")
"RTN","AHMLDOLO",145,0)
 .S CNT=$G(CNT)+1
"RTN","AHMLDOLO",146,0)
 .S R(CNT)=INST_"^"_NME
"RTN","AHMLDOLO",147,0)
 Q
"RTN","AHMLDOP1")
0^5^B117690250
"RTN","AHMLDOP1",1,0)
AHMLDOP1 ;LEIDOS/TCK - REMOTE ORDERING - REMOTE LAB/RAD ORDERS BY LOCATION ; 10/17/16 8:39am
"RTN","AHMLDOP1",2,0)
 ;;1.0;REMOTE ORDERS;;OCT 1,2016;Build 21
"RTN","AHMLDOP1",3,0)
 ;
"RTN","AHMLDOP1",4,0)
 Q
"RTN","AHMLDOP1",5,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",6,0)
LAB ; Entry point for Remote Laboratory Orders by Location.
"RTN","AHMLDOP1",7,0)
 ;
"RTN","AHMLDOP1",8,0)
 S LRT=2
"RTN","AHMLDOP1",9,0)
 ;
"RTN","AHMLDOP1",10,0)
 D INIT,GDT:'LREND,LOC:'LREND,DETAIL:'LREND,GDV:'LREND,RUN:'LREND,STOP
"RTN","AHMLDOP1",11,0)
 ;
"RTN","AHMLDOP1",12,0)
 Q
"RTN","AHMLDOP1",13,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",14,0)
RAD ; Entry point for Remote Radiology Orders by Location.
"RTN","AHMLDOP1",15,0)
 ;
"RTN","AHMLDOP1",16,0)
 S LRT=1
"RTN","AHMLDOP1",17,0)
 ;
"RTN","AHMLDOP1",18,0)
 D INIT,GDT:'LREND,LOC:'LREND,DETAIL:'LREND,GDV:'LREND,RUN:'LREND,STOP
"RTN","AHMLDOP1",19,0)
 ;
"RTN","AHMLDOP1",20,0)
 Q
"RTN","AHMLDOP1",21,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",22,0)
TAT ; Entry point for Turnaround Time for Remote Lab Orders report.
"RTN","AHMLDOP1",23,0)
 ;
"RTN","AHMLDOP1",24,0)
 S LRT="2A"
"RTN","AHMLDOP1",25,0)
 ;
"RTN","AHMLDOP1",26,0)
 D INIT,GDT:'LREND,LOC:'LREND,DETAIL:'LREND,GDV:'LREND,RUN:'LREND,STOP
"RTN","AHMLDOP1",27,0)
 ;
"RTN","AHMLDOP1",28,0)
 Q
"RTN","AHMLDOP1",29,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",30,0)
INIT ; Initialize common variables.
"RTN","AHMLDOP1",31,0)
 ;
"RTN","AHMLDOP1",32,0)
 S U="^",B="|",S=";"
"RTN","AHMLDOP1",33,0)
 S LREND=0,LRSDT="TODAY",LREDT="T-7"
"RTN","AHMLDOP1",34,0)
 I LRT="2A" W !,"Turnaround Time for Remote Lab Orders" Q
"RTN","AHMLDOP1",35,0)
 W !,"REMOTE ORDERS - Remote ",$S(LRT=1:"Radiology",1:"Lab")
"RTN","AHMLDOP1",36,0)
 W " Orders by Location"
"RTN","AHMLDOP1",37,0)
 ;
"RTN","AHMLDOP1",38,0)
 Q
"RTN","AHMLDOP1",39,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",40,0)
RUN ; Run the report either queued or in person.
"RTN","AHMLDOP1",41,0)
 ;
"RTN","AHMLDOP1",42,0)
 K ^TMP("LR",$J),^TMP("LRX",$J),^TMP("TAT",$J)
"RTN","AHMLDOP1",43,0)
 S:$D(ZTQUEUED) ZTREQ="@" U IO
"RTN","AHMLDOP1",44,0)
 S (LRPAG,LREND)=0
"RTN","AHMLDOP1",45,0)
 D:'LREND START
"RTN","AHMLDOP1",46,0)
 D:$D(ZTQUEUED) STOP
"RTN","AHMLDOP1",47,0)
 ;
"RTN","AHMLDOP1",48,0)
 Q
"RTN","AHMLDOP1",49,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",50,0)
STOP ; End and cleanup.
"RTN","AHMLDOP1",51,0)
 ;
"RTN","AHMLDOP1",52,0)
 I ($E(IOST,1,2)="C-") D WAIT
"RTN","AHMLDOP1",53,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","AHMLDOP1",54,0)
 K ^TMP("LR",$J),^TMP("LRX",$J),^TMP("TAT",$J)
"RTN","AHMLDOP1",55,0)
 K %DT,B,DATA1,DD,DM,DSTR,DTOUT,DUOUT,DY,LRDET,LREDT,LREND,LRLOC
"RTN","AHMLDOP1",56,0)
 K LRPAG,LRSDT,LRT,OR,PLOC,POP,S,X,Y,ZTDESC,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE
"RTN","AHMLDOP1",57,0)
 ;
"RTN","AHMLDOP1",58,0)
 Q
"RTN","AHMLDOP1",59,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",60,0)
GDT ; Get dates (start and end).
"RTN","AHMLDOP1",61,0)
 ;
"RTN","AHMLDOP1",62,0)
 I LRSDT?1.7N S Y=LRSDT D DD^LRX S LRSDT=Y
"RTN","AHMLDOP1",63,0)
 I LREDT?1.7N S Y=LREDT D DD^LRX S LREDT=Y
"RTN","AHMLDOP1",64,0)
 S %DT("A")="Enter START date: ",%DT("B")=LRSDT,%DT="AET"
"RTN","AHMLDOP1",65,0)
 D ^%DT S LREND=Y<1 Q:LREND
"RTN","AHMLDOP1",66,0)
 S LRSDT=Y
"RTN","AHMLDOP1",67,0)
 S %DT("A")="Enter END date: ",%DT("B")=LREDT
"RTN","AHMLDOP1",68,0)
 D ^%DT S LREND=Y<1 Q:LREND
"RTN","AHMLDOP1",69,0)
 S LREDT=Y
"RTN","AHMLDOP1",70,0)
 S:LREDT>LRSDT X=LREDT,LREDT=LRSDT,LRSDT=X
"RTN","AHMLDOP1",71,0)
 ;
"RTN","AHMLDOP1",72,0)
 Q
"RTN","AHMLDOP1",73,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",74,0)
GDV ; Get output device.
"RTN","AHMLDOP1",75,0)
 ;
"RTN","AHMLDOP1",76,0)
 S %ZIS="Q" D ^%ZIS K %ZIS I POP S LREND=1 Q
"RTN","AHMLDOP1",77,0)
 I $D(IO("Q")) D
"RTN","AHMLDOP1",78,0)
 .K IO("Q")
"RTN","AHMLDOP1",79,0)
 .S LREND=1,ZTRTN="RUN^AHMLDOP1",ZTDESC="Lab Special Report"
"RTN","AHMLDOP1",80,0)
 .S ZTSAVE("LR*")=""
"RTN","AHMLDOP1",81,0)
 .D ^%ZTLOAD
"RTN","AHMLDOP1",82,0)
 ;
"RTN","AHMLDOP1",83,0)
 Q
"RTN","AHMLDOP1",84,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",85,0)
LOC ; Get the locations to run report for.  Default "ALL".
"RTN","AHMLDOP1",86,0)
 ;
"RTN","AHMLDOP1",87,0)
 N I,J,LOC
"RTN","AHMLDOP1",88,0)
 ;
"RTN","AHMLDOP1",89,0)
 I '$D(^DIC(4,"E")) D  Q
"RTN","AHMLDOP1",90,0)
 .S LRLOC=B_$$NAME^XUAF4($$KSP^XUPARAM("INST"))_B
"RTN","AHMLDOP1",91,0)
 .S LRLOC=B_^ZTMP("AHMLDOP1_LOCATION")_B   ;[temp until configuration complete then remove]
"RTN","AHMLDOP1",92,0)
 ;
"RTN","AHMLDOP1",93,0)
 K DIR
"RTN","AHMLDOP1",94,0)
 S DIR("B")="ALL",DIR("A")="Location",DIR(0)="S^1:ALL;",I=""
"RTN","AHMLDOP1",95,0)
 S LOC(1)="ALL",DIR("?")="Select Location"
"RTN","AHMLDOP1",96,0)
 ;
"RTN","AHMLDOP1",97,0)
 F J=2:1 S I=$O(^DIC(4,"E",I)) Q:I=""  D
"RTN","AHMLDOP1",98,0)
 .S LOC=$$GET1^DIQ(4,I,.01),LOC(J)=LOC
"RTN","AHMLDOP1",99,0)
 .S DIR(0)=DIR(0)_J_":"_$$GET1^DIQ(4,I,.01)_";",LOC(J)=LOC
"RTN","AHMLDOP1",100,0)
 ;
"RTN","AHMLDOP1",101,0)
 D ^DIR
"RTN","AHMLDOP1",102,0)
 S:($D(DUOUT))!($D(DTOUT)) LREND=1
"RTN","AHMLDOP1",103,0)
 I 'LREND D
"RTN","AHMLDOP1",104,0)
 .I LOC(Y)'="ALL" D  Q
"RTN","AHMLDOP1",105,0)
 ..S LRLOC=B_LOC(Y)_B
"RTN","AHMLDOP1",106,0)
 .S I="",LRLOC=B
"RTN","AHMLDOP1",107,0)
 .F  S I=$O(^DIC(4,"E",I)) Q:I=""  S LRLOC=LRLOC_$$GET1^DIQ(4,I,.01)_B
"RTN","AHMLDOP1",108,0)
 ;
"RTN","AHMLDOP1",109,0)
 Q
"RTN","AHMLDOP1",110,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",111,0)
DETAIL ; Include detail?  (1=yes, 0=no).  Default "NO".
"RTN","AHMLDOP1",112,0)
 ;
"RTN","AHMLDOP1",113,0)
 K DIR
"RTN","AHMLDOP1",114,0)
 S DIR("B")="NO",DIR("A")="Include a Detailed Report?",DIR(0)="S^1:NO;2:YES"
"RTN","AHMLDOP1",115,0)
 ;
"RTN","AHMLDOP1",116,0)
 D ^DIR
"RTN","AHMLDOP1",117,0)
 S:($D(DUOUT))!($D(DTOUT)) LREND=1 S:'LREND LRDET=Y-1 Q
"RTN","AHMLDOP1",118,0)
 ;
"RTN","AHMLDOP1",119,0)
 Q
"RTN","AHMLDOP1",120,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",121,0)
START ; Produce report looping through OR(100 data.
"RTN","AHMLDOP1",122,0)
 ;
"RTN","AHMLDOP1",123,0)
 ;   Input: LRSDT - Start date
"RTN","AHMLDOP1",124,0)
 ;          LREDT - End date
"RTN","AHMLDOP1",125,0)
 ;          LRLOC - Location(s) [|loc1|loc2|...]
"RTN","AHMLDOP1",126,0)
 ;          LRDET - Detail      [0=No, 1=Yes]
"RTN","AHMLDOP1",127,0)
 ;
"RTN","AHMLDOP1",128,0)
 ;  Output: Report.
"RTN","AHMLDOP1",129,0)
 ;
"RTN","AHMLDOP1",130,0)
 N ABREV,CDATE,COLDT,CPT,D0,DATA,IPROC,ITYPE,LOC,LRDT,LRDT1,ODATE,OR,OR1
"RTN","AHMLDOP1",131,0)
 N PNAME,PROV,RDATE,RPTDT,STATUS,TAT,TEST,TMP,TNAME
"RTN","AHMLDOP1",132,0)
 ;
"RTN","AHMLDOP1",133,0)
 S LRDT=(LREDT-1)+.999999,LRDT1=LRSDT+.999999
"RTN","AHMLDOP1",134,0)
 ;
"RTN","AHMLDOP1",135,0)
 F  S LRDT=$O(^OR(100,"AF",LRDT)) Q:LRDT=""!(LRDT>LRDT1)  D
"RTN","AHMLDOP1",136,0)
 .S OR="" F  S OR=$O(^OR(100,"AF",LRDT,OR)) Q:OR=""  D
"RTN","AHMLDOP1",137,0)
 ..I +$P($G(^OR(100,OR,0)),U,5)'=+LRT Q           ;not a lab/rad test
"RTN","AHMLDOP1",138,0)
 ..I '$D(^OR(100,OR,4.5)) Q
"RTN","AHMLDOP1",139,0)
 ..S OR1="" F  S OR1=$O(^OR(100,OR,4.5,OR1)) Q:OR1=""  D
"RTN","AHMLDOP1",140,0)
 ...S DATA=$G(^OR(100,OR,4.5,OR1,0))
"RTN","AHMLDOP1",141,0)
 ...I $P(DATA,U,4)'="Location" Q
"RTN","AHMLDOP1",142,0)
 ...S LOC=$G(^OR(100,OR,4.5,OR1,1)) Q:LOC=""
"RTN","AHMLDOP1",143,0)
 ...I LRLOC'[(B_LOC_B) Q
"RTN","AHMLDOP1",144,0)
 ...I $D(^TMP("LR",$J,LOC,OR)) Q
"RTN","AHMLDOP1",145,0)
 ...S TEST=$G(^OR(100,OR,4.5,1,1))                ;test
"RTN","AHMLDOP1",146,0)
 ...S ODATE=$$DATE($$FMTE^XLFDT(LRDT))            ;order date/time
"RTN","AHMLDOP1",147,0)
 ...S PROV=$$GET1^DIQ(100,OR,1)                   ;provider
"RTN","AHMLDOP1",148,0)
 ...S PNAME=$$GET1^DIQ(100,OR,.02)                ;patient name
"RTN","AHMLDOP1",149,0)
 ...S TNAME=$$GET1^DIQ(101.43,TEST,.01)           ;test/procedure name
"RTN","AHMLDOP1",150,0)
 ...S D0=+$$GET1^DIQ(101.43,TEST,2,"I")           ;D0 rad/nuc #71 file
"RTN","AHMLDOP1",151,0)
 ...S (ABREV,CPT,ITYPE,IPROC,TMP)=""
"RTN","AHMLDOP1",152,0)
 ...I D0]"" D
"RTN","AHMLDOP1",153,0)
 ....S CPT=$$GET1^DIQ(71,D0,9)                    ;CPT code
"RTN","AHMLDOP1",154,0)
 ....S ITYPE=$$GET1^DIQ(71,D0,12)                 ;Imaging type
"RTN","AHMLDOP1",155,0)
 ....I ITYPE]"" S TMP=$O(^RA(79.2,"B",ITYPE,""))
"RTN","AHMLDOP1",156,0)
 ....I TMP]"" S ABREV=$$GET1^DIQ(79.2,TMP,3)      ;Imaging type abbrev
"RTN","AHMLDOP1",157,0)
 ....S IPROC=$$GET1^DIQ(71,D0,.01)                ;Imaging procedure
"RTN","AHMLDOP1",158,0)
 ...S STATUS=$$GET1^DIQ(100,OR,5)                 ;status
"RTN","AHMLDOP1",159,0)
 ...I LRT="2A",$E(STATUS,1)'="C" Q                ;only complete for TAT
"RTN","AHMLDOP1",160,0)
 ...I STATUS="UNRELEASED" Q                       ;no unreleased
"RTN","AHMLDOP1",161,0)
 ...S CDATE=$P($$GET1^DIQ(100,OR,33),S,2,3)       ;collect date/time
"RTN","AHMLDOP1",162,0)
 ...S COLDT=CDATE
"RTN","AHMLDOP1",163,0)
 ...I CDATE]"",$P(CDATE,S)]"",$P(CDATE,S,2)]"" D
"RTN","AHMLDOP1",164,0)
 ....S CDATE=$P($G(^LRO(69,$P(CDATE,S),1,$P(CDATE,S,2),1)),U)
"RTN","AHMLDOP1",165,0)
 ....S COLDT=CDATE
"RTN","AHMLDOP1",166,0)
 ....S CDATE=$$DATE($$FMTE^XLFDT(CDATE))
"RTN","AHMLDOP1",167,0)
 ...S RPTDT=$$GET1^DIQ(100,OR,22,"I")             ;report date/time internal
"RTN","AHMLDOP1",168,0)
 ...I LRT="2A",COLDT="" Q                         ;tat must have collect
"RTN","AHMLDOP1",169,0)
 ...S TAT="" I LRT="2A" D                         ;turnaround time (minutes)
"RTN","AHMLDOP1",170,0)
 ....S TAT=$TR($J($$FMDIFF^XLFDT(RPTDT,COLDT,2)/60,50,0)," ","")
"RTN","AHMLDOP1",171,0)
 ...S RDATE=$$DATE($$GET1^DIQ(100,OR,22,"E"))     ;report date/time
"RTN","AHMLDOP1",172,0)
 ...I LRT="2A",RDATE="" Q                         ;must have rpt date for tat
"RTN","AHMLDOP1",173,0)
 ...I LRT=1 D
"RTN","AHMLDOP1",174,0)
 ....S TMP=ODATE_B_PROV_B_PNAME_B_CPT             ;rad order detail
"RTN","AHMLDOP1",175,0)
 ....S TMP=TMP_B_ITYPE_B_IPROC_B_$E(STATUS,1)
"RTN","AHMLDOP1",176,0)
 ...I +LRT=2 D
"RTN","AHMLDOP1",177,0)
 ....S TMP=ODATE_B_PROV_B_PNAME_B_TNAME           ;lab order detail
"RTN","AHMLDOP1",178,0)
 ....S TMP=TMP_B_$E(STATUS,1)_B_CDATE_B_RDATE
"RTN","AHMLDOP1",179,0)
 ....S TMP=TMP_B_TAT
"RTN","AHMLDOP1",180,0)
 ...I LRT=1,ITYPE]"",ABREV]"" D
"RTN","AHMLDOP1",181,0)
 ....S ^TMP("LRX",$J,ITYPE)=ABREV                 ;Image type abrev
"RTN","AHMLDOP1",182,0)
 ...S ^TMP("LR",$J)=$G(^TMP("LR",$J))+1           ;grand total
"RTN","AHMLDOP1",183,0)
 ...S ^TMP("LR",$J,LOC)=$G(^TMP("LR",$J,LOC))+1   ;location total
"RTN","AHMLDOP1",184,0)
 ...S ^TMP("LR",$J,LOC,OR)=TMP                    ;order detail
"RTN","AHMLDOP1",185,0)
 ...S ^TMP("TAT",$J,LOC)=$G(^TMP("TAT",$J,LOC))+TAT   ;tat location total
"RTN","AHMLDOP1",186,0)
 ...S ^TMP("TAT",$J)=$G(^TMP("TAT",$J))+TAT       ;tat grand total
"RTN","AHMLDOP1",187,0)
 ;
"RTN","AHMLDOP1",188,0)
 D HDR
"RTN","AHMLDOP1",189,0)
 I 'LRDET Q
"RTN","AHMLDOP1",190,0)
 ;
"RTN","AHMLDOP1",191,0)
 S (LOC,OR,PLOC)=""
"RTN","AHMLDOP1",192,0)
 F  S LOC=$O(^TMP("LR",$J,LOC)) Q:LOC=""  D  Q:LREND
"RTN","AHMLDOP1",193,0)
 .I LOC'=PLOC S PLOC=LOC D SHDR
"RTN","AHMLDOP1",194,0)
 .F  S OR=$O(^TMP("LR",$J,LOC,OR)) Q:OR=""  D  Q:LREND
"RTN","AHMLDOP1",195,0)
 ..S DATA=^TMP("LR",$J,LOC,OR)
"RTN","AHMLDOP1",196,0)
 ..I $Y+2>IOSL D WAIT Q:LREND  D:$E(IOST,1,2)'="C-" HDR D SHDR
"RTN","AHMLDOP1",197,0)
 ..I LRT=1 D
"RTN","AHMLDOP1",198,0)
 ...S TMP=$P(DATA,B,5)
"RTN","AHMLDOP1",199,0)
 ...I TMP]"",$G(^TMP("LRX",$J,TMP))]"" S TMP=^TMP("LRX",$J,TMP)
"RTN","AHMLDOP1",200,0)
 ...W !,$P($P(DATA,B),"@")
"RTN","AHMLDOP1",201,0)
 ...W ?10,$E($P(DATA,B,2),1,14),?26,$E($P(DATA,B,3),1,14)
"RTN","AHMLDOP1",202,0)
 ...W ?42,$E($P(DATA,B,4),1,14),?49,$E(TMP,1,11)
"RTN","AHMLDOP1",203,0)
 ...W ?55,$E($P(DATA,B,6),1,21),?77,$P(DATA,B,7)
"RTN","AHMLDOP1",204,0)
 ...W ! I $P(DATA,B)]"" W " @",$P($P(DATA,B),"@",2)
"RTN","AHMLDOP1",205,0)
 ...W ?10,$E($P(DATA,B,2),15,28),?26,$E($P(DATA,B,3),15,28)
"RTN","AHMLDOP1",206,0)
 ...W ?42,$E($P(DATA,B,4),15,28),?49,$E(TMP,12,22)
"RTN","AHMLDOP1",207,0)
 ...W ?55,$E($P(DATA,B,6),22,42)
"RTN","AHMLDOP1",208,0)
 ..I LRT=2 D
"RTN","AHMLDOP1",209,0)
 ...W !,$P($P(DATA,B),"@"),?10,$E($P(DATA,B,2),1,14)
"RTN","AHMLDOP1",210,0)
 ...W ?26,$E($P(DATA,B,3),1,14),?42,$E($P(DATA,B,4),1,14)
"RTN","AHMLDOP1",211,0)
 ...W ?58,$P(DATA,B,5),?62,$P($P(DATA,B,6),"@")
"RTN","AHMLDOP1",212,0)
 ...W ?72 I $P(DATA,B,5)'="D" W $P($P(DATA,B,7),"@")
"RTN","AHMLDOP1",213,0)
 ...W ! I $P(DATA,B)]"" W " @",$P($P(DATA,B),"@",2)
"RTN","AHMLDOP1",214,0)
 ...W ?10,$E($P(DATA,B,2),15,28),?26,$E($P(DATA,B,3),15,28)
"RTN","AHMLDOP1",215,0)
 ...W ?42,$E($P(DATA,B,4),15,28)
"RTN","AHMLDOP1",216,0)
 ...W ?62 I $P(DATA,B,6)]"" W " @",$P($P(DATA,B,6),"@",2)
"RTN","AHMLDOP1",217,0)
 ...W ?72 I $P(DATA,B,5)'="D",$P(DATA,B,7)]"" D
"RTN","AHMLDOP1",218,0)
 ....W " @",$P($P(DATA,B,7),"@",2)
"RTN","AHMLDOP1",219,0)
 ..I LRT="2A" D
"RTN","AHMLDOP1",220,0)
 ...W !,$P($P(DATA,B),"@"),?9,$E($P(DATA,B,2),1,14)
"RTN","AHMLDOP1",221,0)
 ...W ?24,$E($P(DATA,B,3),1,14),?39,$E($P(DATA,B,4),1,14)
"RTN","AHMLDOP1",222,0)
 ...W ?54,$P(DATA,B,5),?57,$P($P(DATA,B,6),"@")
"RTN","AHMLDOP1",223,0)
 ...W ?66 I $P(DATA,B,5)'="D" W $P($P(DATA,B,7),"@")
"RTN","AHMLDOP1",224,0)
 ...W ?75,$P(DATA,B,8)
"RTN","AHMLDOP1",225,0)
 ...W ! I $P(DATA,B)]"" W " @",$P($P(DATA,B),"@",2)
"RTN","AHMLDOP1",226,0)
 ...W ?9,$E($P(DATA,B,2),15,28),?24,$E($P(DATA,B,3),15,28)
"RTN","AHMLDOP1",227,0)
 ...W ?39,$E($P(DATA,B,4),15,28)
"RTN","AHMLDOP1",228,0)
 ...W ?57 I $P(DATA,B,6)]"" W " @",$P($P(DATA,B,6),"@",2)
"RTN","AHMLDOP1",229,0)
 ...W ?66 I $P(DATA,B,5)'="D",$P(DATA,B,7)]"" D
"RTN","AHMLDOP1",230,0)
 ....W " @",$P($P(DATA,B,7),"@",2)
"RTN","AHMLDOP1",231,0)
 ;
"RTN","AHMLDOP1",232,0)
 Q
"RTN","AHMLDOP1",233,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",234,0)
HDR ; Print header and totals by location.
"RTN","AHMLDOP1",235,0)
 ;
"RTN","AHMLDOP1",236,0)
 N L,TC,TM,TTC,TTM
"RTN","AHMLDOP1",237,0)
 ;
"RTN","AHMLDOP1",238,0)
 S LRPAG=LRPAG+1
"RTN","AHMLDOP1",239,0)
 ;
"RTN","AHMLDOP1",240,0)
 I LRT'="2A" D
"RTN","AHMLDOP1",241,0)
 .W ?$S(LRT=1:22,1:24),"Remote ",$S(LRT=1:"Radiology",1:"Lab")
"RTN","AHMLDOP1",242,0)
 .W " Orders by Location"
"RTN","AHMLDOP1",243,0)
 I LRT="2A" W ?21,"Turnaround Time for Remote Lab Orders"
"RTN","AHMLDOP1",244,0)
 W ?73,"Page ",LRPAG
"RTN","AHMLDOP1",245,0)
 W !?23,"From ",$$FMTE^XLFDT(LREDT)," to ",$$FMTE^XLFDT(LRSDT)
"RTN","AHMLDOP1",246,0)
 W !?22,"Date Printed: ",$$FMTE^XLFDT($$NOW^XLFDT),!
"RTN","AHMLDOP1",247,0)
 ;
"RTN","AHMLDOP1",248,0)
 I LRT="2A" D  Q
"RTN","AHMLDOP1",249,0)
 .W !?5,"Location",?25,"# of Tests",?40,"Total Time",?60,"Average Time"
"RTN","AHMLDOP1",250,0)
 .W !?5,$TR($J("",68)," ","-")
"RTN","AHMLDOP1",251,0)
 .S L="",(TTC,TTM)=0
"RTN","AHMLDOP1",252,0)
 .F  S L=$O(^TMP("LR",$J,L)) Q:L=""  D  Q:LREND
"RTN","AHMLDOP1",253,0)
 ..S TC=^TMP("LR",$J,L),TM=^TMP("TAT",$J,L)
"RTN","AHMLDOP1",254,0)
 ..S TTC=TTC+TC,TTM=TTM+TM
"RTN","AHMLDOP1",255,0)
 ..W !?5,$J(L,15),$TR($J(TC,10)," ","."),?40,TM,?60,$J(TM/TC,10,2)
"RTN","AHMLDOP1",256,0)
 .W !?5,$TR($J("",68)," ","-")
"RTN","AHMLDOP1",257,0)
 .W !?5,$J("Totals",15),$TR($J(TTC,10)," ","."),?40,TTM,?60
"RTN","AHMLDOP1",258,0)
 .W $S(TTC=0:0,1:$J(TTM/TTC,10,2)),!
"RTN","AHMLDOP1",259,0)
 ;
"RTN","AHMLDOP1",260,0)
 S L=""
"RTN","AHMLDOP1",261,0)
 F  S L=$O(^TMP("LR",$J,L)) Q:L=""  D  Q:LREND
"RTN","AHMLDOP1",262,0)
 .W !?5,$J(L,15),$TR($J(^TMP("LR",$J,L),10)," ",".")
"RTN","AHMLDOP1",263,0)
 W !?5,$TR($J("",26)," ","-")
"RTN","AHMLDOP1",264,0)
 W !?5,$J("Total",15),$TR($J(+$G(^TMP("LR",$J)),10)," ","."),!
"RTN","AHMLDOP1",265,0)
 ;
"RTN","AHMLDOP1",266,0)
 Q
"RTN","AHMLDOP1",267,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",268,0)
SHDR ; Print sub header.
"RTN","AHMLDOP1",269,0)
 ;
"RTN","AHMLDOP1",270,0)
 I $Y+6>IOSL D WAIT Q:LREND  D:$E(IOST,1,2)'="C-" HDR W !
"RTN","AHMLDOP1",271,0)
 ;
"RTN","AHMLDOP1",272,0)
 W !!,"==> Performing Location: ",LOC,!
"RTN","AHMLDOP1",273,0)
 I LRT=1 D                                       ;rad sub header
"RTN","AHMLDOP1",274,0)
 .W !,"Order",?10,"Provider",?26,"Patient"
"RTN","AHMLDOP1",275,0)
 .W ?42,"CPT",?49,"Type",?55,"Image Procedure",?77,"St"
"RTN","AHMLDOP1",276,0)
 .W !,$TR($J("",8)," ","-"),?10,$TR($J("",14)," ","-")
"RTN","AHMLDOP1",277,0)
 .W ?26,$TR($J("",14)," ","-"),?42,$TR($J("",5)," ","-")
"RTN","AHMLDOP1",278,0)
 .W ?49,$TR($J("",4)," ","-"),?55,$TR($J("",20)," ","-")
"RTN","AHMLDOP1",279,0)
 .W ?77,$TR($J("",3)," ","-")
"RTN","AHMLDOP1",280,0)
 ;
"RTN","AHMLDOP1",281,0)
 I LRT=2 D                                       ;lab sub header
"RTN","AHMLDOP1",282,0)
 .W !,"Order",?10,"Provider",?26,"Patient",?42
"RTN","AHMLDOP1",283,0)
 .W "Test",?58,"St",?62,"Collect",?72,"Report"
"RTN","AHMLDOP1",284,0)
 .W !,$TR($J("",8)," ","-"),?10,$TR($J("",14)," ","-")
"RTN","AHMLDOP1",285,0)
 .W ?26,$TR($J("",14)," ","-"),?42,$TR($J("",14)," ","-")
"RTN","AHMLDOP1",286,0)
 .W ?58,$TR($J("",3)," ","-"),?62,$TR($J("",8)," ","-")
"RTN","AHMLDOP1",287,0)
 .W ?72,$TR($J("",8)," ","-")
"RTN","AHMLDOP1",288,0)
 ;
"RTN","AHMLDOP1",289,0)
 I LRT="2A" D                                       ;lab sub header
"RTN","AHMLDOP1",290,0)
 .W !,"Order",?9,"Provider",?24,"Patient",?39
"RTN","AHMLDOP1",291,0)
 .W "Test",?54,"St",?57,"Collect",?66,"Report",?75,"TAT"
"RTN","AHMLDOP1",292,0)
 .W !,$TR($J("",8)," ","-"),?9,$TR($J("",14)," ","-")
"RTN","AHMLDOP1",293,0)
 .W ?24,$TR($J("",14)," ","-"),?39,$TR($J("",14)," ","-")
"RTN","AHMLDOP1",294,0)
 .W ?54,$TR($J("",3)," ","-"),?57,$TR($J("",8)," ","-")
"RTN","AHMLDOP1",295,0)
 .W ?66,$TR($J("",8)," ","-"),?75,$TR($J("",5)," ","-")
"RTN","AHMLDOP1",296,0)
 ;
"RTN","AHMLDOP1",297,0)
 Q
"RTN","AHMLDOP1",298,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",299,0)
DATE(DATE) ; Convert mmm dd, yyyy@hh:mm to mm/dd/yyyy@hh:mm
"RTN","AHMLDOP1",300,0)
 ;
"RTN","AHMLDOP1",301,0)
 N DD,DM,DSTR,DY,LOWER,TM,UPPER
"RTN","AHMLDOP1",302,0)
 ;
"RTN","AHMLDOP1",303,0)
 I $G(DATE)="" Q ""
"RTN","AHMLDOP1",304,0)
 ;
"RTN","AHMLDOP1",305,0)
 S LOWER="abcdefghijklmnopqrstuvwxyz"
"RTN","AHMLDOP1",306,0)
 S UPPER="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","AHMLDOP1",307,0)
 S DSTR("JAN")="01",DSTR("FEB")="02",DSTR("MAR")="03",DSTR("APR")="04"
"RTN","AHMLDOP1",308,0)
 S DSTR("MAY")="05",DSTR("JUN")="06",DSTR("JUL")="07",DSTR("AUG")="08"
"RTN","AHMLDOP1",309,0)
 S DSTR("SEP")="09",DSTR("OCT")=10,DSTR("NOV")=11,DSTR("DEC")=12
"RTN","AHMLDOP1",310,0)
 ;
"RTN","AHMLDOP1",311,0)
 S DM=$TR($P(DATE," "),LOWER,UPPER),DD=$P($P(DATE," ",2),",")
"RTN","AHMLDOP1",312,0)
 S DY=$E($P($P(DATE," ",3),"@"),3,4),TM=$P($P(DATE,"@",2),":",1,2)
"RTN","AHMLDOP1",313,0)
 ;
"RTN","AHMLDOP1",314,0)
 Q DSTR(DM)_"/"_DD_"/"_DY_"@"_TM
"RTN","AHMLDOP1",315,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP1",316,0)
WAIT ; Pause for page breaks.
"RTN","AHMLDOP1",317,0)
 ;
"RTN","AHMLDOP1",318,0)
 K DIR
"RTN","AHMLDOP1",319,0)
 S DIR(0)="E"
"RTN","AHMLDOP1",320,0)
 D ^DIR
"RTN","AHMLDOP1",321,0)
 S:($D(DUOUT))!($D(DTOUT)) LREND=1
"RTN","AHMLDOP1",322,0)
 S $Y=1
"RTN","AHMLDOP1",323,0)
 ;
"RTN","AHMLDOP1",324,0)
 Q
"RTN","AHMLDOP2")
0^6^B169259843
"RTN","AHMLDOP2",1,0)
AHMLDOP2 ;LEIDOS/TCK - REMOTE ORDERING - REMOTE LAB/RAD ORDERS BY TEST/IMAGE ; 10/17/16 8:40am
"RTN","AHMLDOP2",2,0)
 ;;1.0;REMOTE ORDERS;;OCT 1,2016;Build 21
"RTN","AHMLDOP2",3,0)
 ;
"RTN","AHMLDOP2",4,0)
 Q
"RTN","AHMLDOP2",5,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",6,0)
LAB ; Entry point for Remote Laboratory Orders by Test Name.
"RTN","AHMLDOP2",7,0)
 ;
"RTN","AHMLDOP2",8,0)
 S LRT=2,XREF="AF"
"RTN","AHMLDOP2",9,0)
 ;
"RTN","AHMLDOP2",10,0)
 D INIT,GDT:'LREND,TEST:'LREND,LOC:'LREND,DETAIL:'LREND
"RTN","AHMLDOP2",11,0)
 D GDV:'LREND,RUN:'LREND,STOP
"RTN","AHMLDOP2",12,0)
 ;
"RTN","AHMLDOP2",13,0)
 Q
"RTN","AHMLDOP2",14,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",15,0)
RAD ; Entry point for Remote Radiology Orders by Image Type.
"RTN","AHMLDOP2",16,0)
 ;
"RTN","AHMLDOP2",17,0)
 S LRT=1,XREF="AF"
"RTN","AHMLDOP2",18,0)
 ;
"RTN","AHMLDOP2",19,0)
 D INIT,GDT:'LREND,IMAGE:'LREND,LOC:'LREND,DETAIL:'LREND
"RTN","AHMLDOP2",20,0)
 D GDV:'LREND,RUN:'LREND,STOP
"RTN","AHMLDOP2",21,0)
 ;
"RTN","AHMLDOP2",22,0)
 Q
"RTN","AHMLDOP2",23,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",24,0)
RADC ; Entry point for Remote Radiology Orders by CPT Code.
"RTN","AHMLDOP2",25,0)
 ;
"RTN","AHMLDOP2",26,0)
 S LRT="1A",XREF="AF"
"RTN","AHMLDOP2",27,0)
 ;
"RTN","AHMLDOP2",28,0)
 D INIT,GDT:'LREND,CPT:'LREND,LOC:'LREND,DETAIL:'LREND
"RTN","AHMLDOP2",29,0)
 D GDV:'LREND,RUN:'LREND,STOP
"RTN","AHMLDOP2",30,0)
 ;
"RTN","AHMLDOP2",31,0)
 Q
"RTN","AHMLDOP2",32,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",33,0)
RADCR ; Entry point for Remote Radiology Orders by CPT Code and RVU.
"RTN","AHMLDOP2",34,0)
 ;
"RTN","AHMLDOP2",35,0)
 S LRT="1B",XREF="AF",LRTEST="*"
"RTN","AHMLDOP2",36,0)
 ;
"RTN","AHMLDOP2",37,0)
 D INIT,GDT:'LREND,LOC:'LREND,DETAIL:'LREND,GDV:'LREND,RUN:'LREND,STOP
"RTN","AHMLDOP2",38,0)
 ;
"RTN","AHMLDOP2",39,0)
 Q
"RTN","AHMLDOP2",40,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",41,0)
INIT ; Initialize common variables.
"RTN","AHMLDOP2",42,0)
 ;
"RTN","AHMLDOP2",43,0)
 S U="^",B="|",S=";"
"RTN","AHMLDOP2",44,0)
 S LREND=0,LRSDT="TODAY",LREDT="T-7"
"RTN","AHMLDOP2",45,0)
 W !,"REMOTE ORDERS - Remote ",$S(LRT=1:"Radiology",1:"Lab")
"RTN","AHMLDOP2",46,0)
 W " Orders by "_$S(LRT=2:"Test Name",LRT=1:"Imaging Type",1:"CPT Code")
"RTN","AHMLDOP2",47,0)
 I LRT="1B" W " and wRVU"
"RTN","AHMLDOP2",48,0)
 ;
"RTN","AHMLDOP2",49,0)
 Q
"RTN","AHMLDOP2",50,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",51,0)
RUN ; Run the report either queued or in person.
"RTN","AHMLDOP2",52,0)
 ;
"RTN","AHMLDOP2",53,0)
 K ^TMP("LR",$J)
"RTN","AHMLDOP2",54,0)
 S:$D(ZTQUEUED) ZTREQ="@" U IO
"RTN","AHMLDOP2",55,0)
 S (LRPAG,LREND)=0
"RTN","AHMLDOP2",56,0)
 D:'LREND START
"RTN","AHMLDOP2",57,0)
 D:$D(ZTQUEUED) STOP
"RTN","AHMLDOP2",58,0)
 ;
"RTN","AHMLDOP2",59,0)
 Q
"RTN","AHMLDOP2",60,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",61,0)
STOP ; End and cleanup.
"RTN","AHMLDOP2",62,0)
 ;
"RTN","AHMLDOP2",63,0)
 I ($E(IOST,1,2)="C-") D WAIT
"RTN","AHMLDOP2",64,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","AHMLDOP2",65,0)
 K ^TMP("LR",$J),^TMP("LRTEST",$J),^TMP("LRX",$J),^TMP("LRCPT",$J)
"RTN","AHMLDOP2",66,0)
 K %DT,B,DATA1,DD,DM,DSTR,DTOUT,DUOUT,DY
"RTN","AHMLDOP2",67,0)
 K LRDET,LREDT,LREND,LRLOC,LRPAG,LRSDT,LRTEST
"RTN","AHMLDOP2",68,0)
 K OR,PLOC,POP,S,X,XREF,Y,ZTDESC,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE
"RTN","AHMLDOP2",69,0)
 ;
"RTN","AHMLDOP2",70,0)
 Q
"RTN","AHMLDOP2",71,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",72,0)
GDT ; Get dates (start and end).
"RTN","AHMLDOP2",73,0)
 ;
"RTN","AHMLDOP2",74,0)
 I LRSDT?1.7N S Y=LRSDT D DD^LRX S LRSDT=Y
"RTN","AHMLDOP2",75,0)
 I LREDT?1.7N S Y=LREDT D DD^LRX S LREDT=Y
"RTN","AHMLDOP2",76,0)
 S %DT("A")="Enter START date: ",%DT("B")=LRSDT,%DT="AET"
"RTN","AHMLDOP2",77,0)
 D ^%DT S LREND=Y<1 Q:LREND
"RTN","AHMLDOP2",78,0)
 S LRSDT=Y
"RTN","AHMLDOP2",79,0)
 S %DT("A")="Enter END date: ",%DT("B")=LREDT
"RTN","AHMLDOP2",80,0)
 D ^%DT S LREND=Y<1 Q:LREND
"RTN","AHMLDOP2",81,0)
 S LREDT=Y
"RTN","AHMLDOP2",82,0)
 S:LREDT>LRSDT X=LREDT,LREDT=LRSDT,LRSDT=X
"RTN","AHMLDOP2",83,0)
 ;
"RTN","AHMLDOP2",84,0)
 Q
"RTN","AHMLDOP2",85,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",86,0)
GDV ; Get output device.
"RTN","AHMLDOP2",87,0)
 ;
"RTN","AHMLDOP2",88,0)
 S %ZIS="Q" D ^%ZIS K %ZIS I POP S LREND=1 Q
"RTN","AHMLDOP2",89,0)
 I $D(IO("Q")) D
"RTN","AHMLDOP2",90,0)
 .K IO("Q")
"RTN","AHMLDOP2",91,0)
 .S LREND=1,ZTRTN="RUN^AHMLDOP2",ZTDESC="Lab Special Report"
"RTN","AHMLDOP2",92,0)
 .S ZTSAVE("LR*")=""
"RTN","AHMLDOP2",93,0)
 .D ^%ZTLOAD
"RTN","AHMLDOP2",94,0)
 ;
"RTN","AHMLDOP2",95,0)
 Q
"RTN","AHMLDOP2",96,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",97,0)
LOC ; Get the locations to run report for.  Default "ALL".
"RTN","AHMLDOP2",98,0)
 ;
"RTN","AHMLDOP2",99,0)
 N I,J,LOC
"RTN","AHMLDOP2",100,0)
 ;
"RTN","AHMLDOP2",101,0)
 I '$D(^DIC(4,"E")) D  Q
"RTN","AHMLDOP2",102,0)
 .S LRLOC=B_$$NAME^XUAF4($$KSP^XUPARAM("INST"))_B
"RTN","AHMLDOP2",103,0)
 .S LRLOC=B_^ZTMP("AHMLDOP1_LOCATION")_B   ;[temp until configuration complete then remove]
"RTN","AHMLDOP2",104,0)
 ;
"RTN","AHMLDOP2",105,0)
 K DIR
"RTN","AHMLDOP2",106,0)
 S DIR("B")="ALL",DIR("A")="Location",DIR(0)="S^1:ALL;",I=""
"RTN","AHMLDOP2",107,0)
 S LOC(1)="ALL",DIR("?")="Select Location"
"RTN","AHMLDOP2",108,0)
 ;
"RTN","AHMLDOP2",109,0)
 F J=2:1 S I=$O(^DIC(4,"E",I)) Q:I=""  D
"RTN","AHMLDOP2",110,0)
 .S LOC=$$GET1^DIQ(4,I,.01),LOC(J)=LOC
"RTN","AHMLDOP2",111,0)
 .S DIR(0)=DIR(0)_J_":"_$$GET1^DIQ(4,I,.01)_";",LOC(J)=LOC
"RTN","AHMLDOP2",112,0)
 ;
"RTN","AHMLDOP2",113,0)
 D ^DIR
"RTN","AHMLDOP2",114,0)
 S:($D(DUOUT))!($D(DTOUT)) LREND=1
"RTN","AHMLDOP2",115,0)
 I 'LREND D
"RTN","AHMLDOP2",116,0)
 .I LOC(Y)'="ALL" D  Q
"RTN","AHMLDOP2",117,0)
 ..S LRLOC=B_LOC(Y)_B
"RTN","AHMLDOP2",118,0)
 .S I="",LRLOC=B
"RTN","AHMLDOP2",119,0)
 .F  S I=$O(^DIC(4,"E",I)) Q:I=""  S LRLOC=LRLOC_$$GET1^DIQ(4,I,.01)_B
"RTN","AHMLDOP2",120,0)
 ;
"RTN","AHMLDOP2",121,0)
 Q
"RTN","AHMLDOP2",122,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",123,0)
TEST ; Prompt for lab test(s) to be included (<Return> for all).
"RTN","AHMLDOP2",124,0)
 ;
"RTN","AHMLDOP2",125,0)
 N STOP
"RTN","AHMLDOP2",126,0)
 ;
"RTN","AHMLDOP2",127,0)
 K DIC,^TMP("LRTEST",$J)
"RTN","AHMLDOP2",128,0)
 W !!,"Press <Enter> at LABORATORY TEST NAME Prompt to select All Tests",!
"RTN","AHMLDOP2",129,0)
 S DIC="^LAB(60,",DIC(0)="AEMOQ",STOP=0
"RTN","AHMLDOP2",130,0)
 S DIC("S")="I $P(^(0),U,4)[""CH"",""BO""[$P(^(0),U,3)"
"RTN","AHMLDOP2",131,0)
 ;
"RTN","AHMLDOP2",132,0)
 F  D  Q:STOP!(LREND)
"RTN","AHMLDOP2",133,0)
 .D ^DIC
"RTN","AHMLDOP2",134,0)
 .I X["^" S LREND=1 Q
"RTN","AHMLDOP2",135,0)
 .I Y>0 S ^TMP("LRTEST",$J,$P(Y,U,2))=""
"RTN","AHMLDOP2",136,0)
 .I Y<0 S STOP=1 Q
"RTN","AHMLDOP2",137,0)
 ;
"RTN","AHMLDOP2",138,0)
 I '$D(^TMP("LRTEST",$J)) S LRTEST="*" W "ALL Tests Selected"
"RTN","AHMLDOP2",139,0)
 E  S LRTEST=""
"RTN","AHMLDOP2",140,0)
 ;
"RTN","AHMLDOP2",141,0)
 Q
"RTN","AHMLDOP2",142,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",143,0)
IMAGE ; Prompt for rad image type(s) to be included (<Return> for all).
"RTN","AHMLDOP2",144,0)
 ;
"RTN","AHMLDOP2",145,0)
 N STOP
"RTN","AHMLDOP2",146,0)
 ;
"RTN","AHMLDOP2",147,0)
 K DIC,^TMP("LRTEST",$J)
"RTN","AHMLDOP2",148,0)
 W !!,"Press <Enter> at IMAGE TYPE Prompt to select All Tests",!
"RTN","AHMLDOP2",149,0)
 S DIC="^RA(79.2,",DIC(0)="AEMOQ",STOP=0,DIC("A")="IMAGE TYPE: "
"RTN","AHMLDOP2",150,0)
 ;
"RTN","AHMLDOP2",151,0)
 F  D  Q:STOP!(LREND)
"RTN","AHMLDOP2",152,0)
 .D ^DIC
"RTN","AHMLDOP2",153,0)
 .I X["^" S LREND=1 Q
"RTN","AHMLDOP2",154,0)
 .I Y>0 S ^TMP("LRTEST",$J,$P(Y,U,2))=""
"RTN","AHMLDOP2",155,0)
 .I Y<0 S STOP=1 Q
"RTN","AHMLDOP2",156,0)
 ;
"RTN","AHMLDOP2",157,0)
 I '$D(^TMP("LRTEST",$J)) S LRTEST="*" W "ALL Image Types Selected"
"RTN","AHMLDOP2",158,0)
 E  S LRTEST=""
"RTN","AHMLDOP2",159,0)
 ;
"RTN","AHMLDOP2",160,0)
 Q
"RTN","AHMLDOP2",161,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",162,0)
CPT ; Prompt for CPT Code(s) to be included (<Return> for all).
"RTN","AHMLDOP2",163,0)
 ;
"RTN","AHMLDOP2",164,0)
 N STOP
"RTN","AHMLDOP2",165,0)
 ;
"RTN","AHMLDOP2",166,0)
 K DIC,^TMP("LRCPT",$J)
"RTN","AHMLDOP2",167,0)
 W !!,"Press <Enter> at CPT CODE Prompt to select All Tests",!
"RTN","AHMLDOP2",168,0)
 S DIC="^ICPT(",DIC(0)="AEMOQ",STOP=0,DIC("A")="CPT CODE: "
"RTN","AHMLDOP2",169,0)
 ;
"RTN","AHMLDOP2",170,0)
 F  D  Q:STOP!(LREND)
"RTN","AHMLDOP2",171,0)
 .D ^DIC
"RTN","AHMLDOP2",172,0)
 .I X["^" S LREND=1 Q
"RTN","AHMLDOP2",173,0)
 .I Y>0 S ^TMP("LRCPT",$J,$P(Y,U,2))=""
"RTN","AHMLDOP2",174,0)
 .I Y<0 S STOP=1 Q
"RTN","AHMLDOP2",175,0)
 ;
"RTN","AHMLDOP2",176,0)
 I '$D(^TMP("LRCPT",$J)) S LRTEST="*" W "ALL CPT Codes Selected"
"RTN","AHMLDOP2",177,0)
 E  S LRTEST=""
"RTN","AHMLDOP2",178,0)
 ;
"RTN","AHMLDOP2",179,0)
 Q
"RTN","AHMLDOP2",180,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",181,0)
DETAIL ; Include detail?  (1=yes, 0=no).  Default "NO".
"RTN","AHMLDOP2",182,0)
 ;
"RTN","AHMLDOP2",183,0)
 K DIR
"RTN","AHMLDOP2",184,0)
 S DIR("B")="NO",DIR("A")="Include a Detailed Report?",DIR(0)="S^1:NO;2:YES"
"RTN","AHMLDOP2",185,0)
 ;
"RTN","AHMLDOP2",186,0)
 D ^DIR
"RTN","AHMLDOP2",187,0)
 S:($D(DUOUT))!($D(DTOUT)) LREND=1 S:'LREND LRDET=Y-1 Q
"RTN","AHMLDOP2",188,0)
 ;
"RTN","AHMLDOP2",189,0)
 Q
"RTN","AHMLDOP2",190,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",191,0)
START ; Produce report looping through OR(100 data.
"RTN","AHMLDOP2",192,0)
 ;
"RTN","AHMLDOP2",193,0)
 ;   Input: LRSDT - Start date
"RTN","AHMLDOP2",194,0)
 ;          LREDT - End date
"RTN","AHMLDOP2",195,0)
 ;          LRLOC - Location(s) [|loc1|loc2|...]
"RTN","AHMLDOP2",196,0)
 ;          LRDET - Detail      [0=No, 1=Yes]
"RTN","AHMLDOP2",197,0)
 ;
"RTN","AHMLDOP2",198,0)
 ;  Output: Report.
"RTN","AHMLDOP2",199,0)
 ;
"RTN","AHMLDOP2",200,0)
 N ABREV,CDATE,CPT,D0,DATA,IPROC,ITYPE,LOC,LRDT,LRDT1,ODATE,OR,OR1
"RTN","AHMLDOP2",201,0)
 N PNAME,PROV,RDATE,STATUS,TEST,TMP,TNAME
"RTN","AHMLDOP2",202,0)
 ;
"RTN","AHMLDOP2",203,0)
 S LRDT=(LREDT-1)+.999999,LRDT1=LRSDT+.999999
"RTN","AHMLDOP2",204,0)
 ;
"RTN","AHMLDOP2",205,0)
 F  S LRDT=$O(^OR(100,XREF,LRDT)) Q:LRDT=""!(LRDT>LRDT1)  D
"RTN","AHMLDOP2",206,0)
 .S OR="" F  S OR=$O(^OR(100,XREF,LRDT,OR)) Q:OR=""  D
"RTN","AHMLDOP2",207,0)
 ..I +$P($G(^OR(100,OR,0)),U,5)'=+LRT Q           ;not a lab/rad test
"RTN","AHMLDOP2",208,0)
 ..I '$D(^OR(100,OR,4.5)) Q
"RTN","AHMLDOP2",209,0)
 ..S OR1="" F  S OR1=$O(^OR(100,OR,4.5,OR1)) Q:OR1=""  D
"RTN","AHMLDOP2",210,0)
 ...S DATA=$G(^OR(100,OR,4.5,OR1,0))
"RTN","AHMLDOP2",211,0)
 ...I $P(DATA,U,4)'="Location" Q
"RTN","AHMLDOP2",212,0)
 ...S LOC=$G(^OR(100,OR,4.5,OR1,1)) Q:LOC=""
"RTN","AHMLDOP2",213,0)
 ...I LRLOC'[(B_LOC_B) Q
"RTN","AHMLDOP2",214,0)
 ...I $D(^TMP("LR",$J,LOC,OR)) Q
"RTN","AHMLDOP2",215,0)
 ...S TEST=$G(^OR(100,OR,4.5,1,1))                ;test
"RTN","AHMLDOP2",216,0)
 ...S ODATE=$$DATE($$FMTE^XLFDT(LRDT))            ;order date/time
"RTN","AHMLDOP2",217,0)
 ...S PROV=$$GET1^DIQ(100,OR,1)                   ;provider
"RTN","AHMLDOP2",218,0)
 ...S PNAME=$$GET1^DIQ(100,OR,.02)                ;patient name
"RTN","AHMLDOP2",219,0)
 ...S TNAME=$$GET1^DIQ(101.43,TEST,.01)           ;test/procedure name
"RTN","AHMLDOP2",220,0)
 ...S D0=+$$GET1^DIQ(101.43,TEST,2,"I")           ;D0 rad/nuc #71 file
"RTN","AHMLDOP2",221,0)
 ...S (ABREV,CPT,ITYPE,IPROC,TMP)=""
"RTN","AHMLDOP2",222,0)
 ...I D0]"" D
"RTN","AHMLDOP2",223,0)
 ....S CPT=$$GET1^DIQ(71,D0,9)                    ;CPT code
"RTN","AHMLDOP2",224,0)
 ....S ITYPE=$$GET1^DIQ(71,D0,12)                 ;Imaging type
"RTN","AHMLDOP2",225,0)
 ....I ITYPE]"" S TMP=$O(^RA(79.2,"B",ITYPE,""))
"RTN","AHMLDOP2",226,0)
 ....I TMP]"" S ABREV=$$GET1^DIQ(79.2,TMP,3)      ;Imaging type abbrev
"RTN","AHMLDOP2",227,0)
 ....S IPROC=$$GET1^DIQ(71,D0,.01)                ;Imaging procedure
"RTN","AHMLDOP2",228,0)
 ...S STATUS=$$GET1^DIQ(100,OR,5)                 ;status
"RTN","AHMLDOP2",229,0)
 ...I STATUS="UNRELEASED" Q                       ;no unreleased
"RTN","AHMLDOP2",230,0)
 ...S CDATE=$P($$GET1^DIQ(100,OR,33),S,2,3)       ;collect date/time
"RTN","AHMLDOP2",231,0)
 ...I CDATE]"",$P(CDATE,S)]"",$P(CDATE,S,2)]"" D
"RTN","AHMLDOP2",232,0)
 ....S CDATE=$P($G(^LRO(69,$P(CDATE,S),1,$P(CDATE,S,2),1)),U)
"RTN","AHMLDOP2",233,0)
 ....S CDATE=$$DATE($$FMTE^XLFDT(CDATE))
"RTN","AHMLDOP2",234,0)
 ...S RDATE=$$DATE($$GET1^DIQ(100,OR,22,"E"))     ;report date/time
"RTN","AHMLDOP2",235,0)
 ...I LRT="1B",RDATE="" Q                         ;CPT wRVU only reported
"RTN","AHMLDOP2",236,0)
 ...I LRT="1B",$E(STATUS,1)="D" Q                 ;         and no deleted
"RTN","AHMLDOP2",237,0)
 ...I +LRT=1 D
"RTN","AHMLDOP2",238,0)
 ....S TMP=$S(LRT="1B":RDATE,1:ODATE)_B_PROV      ;rad order detail
"RTN","AHMLDOP2",239,0)
 ....S TMP=TMP_B_PNAME_B_CPT_B_ITYPE
"RTN","AHMLDOP2",240,0)
 ....S TMP=TMP_B_IPROC_B_$E(STATUS,1)
"RTN","AHMLDOP2",241,0)
 ....S TNAME=ITYPE
"RTN","AHMLDOP2",242,0)
 ...I LRT=2 D
"RTN","AHMLDOP2",243,0)
 ....S TMP=ODATE_B_PROV_B_PNAME_B_TNAME           ;lab report detail
"RTN","AHMLDOP2",244,0)
 ....S TMP=TMP_B_$E(STATUS,1)_B_CDATE_B_RDATE
"RTN","AHMLDOP2",245,0)
 ...I LRT'="1A",LRT'="1B",TNAME]"",$D(^TMP("LRTEST",$J,TNAME))!(LRTEST="*") D
"RTN","AHMLDOP2",246,0)
 ....S ^TMP("LRTEST",$J)=$I(^TMP("LRTEST",$J))              ;total
"RTN","AHMLDOP2",247,0)
 ....S ^TMP("LRTEST",$J,TNAME)=$I(^TMP("LRTEST",$J,TNAME))  ;total by test
"RTN","AHMLDOP2",248,0)
 ...I +LRT=1,TNAME]"",ABREV]"" D
"RTN","AHMLDOP2",249,0)
 ....S ^TMP("LRX",$J,TNAME)=ABREV                           ;Image type abrev
"RTN","AHMLDOP2",250,0)
 ...I LRT'="1A",LRT'="1B",TNAME]"",'$D(^TMP("LRTEST",$J,TNAME)),LRTEST'="*" Q   ;test not selected
"RTN","AHMLDOP2",251,0)
 ...I (LRT="1A"!(LRT="1B")),IPROC]"" S:CPT="" CPT="NONE" D
"RTN","AHMLDOP2",252,0)
 ....I LRTEST'="*",'$D(^TMP("LRCPT",$J,CPT)) Q
"RTN","AHMLDOP2",253,0)
 ....S ^TMP("LRTEST",$J)=$I(^TMP("LRTEST",$J))                      ;Total
"RTN","AHMLDOP2",254,0)
 ....S ^TMP("LRTEST",$J,CPT,IPROC)=$I(^TMP("LRTEST",$J,CPT,IPROC))  ;total by CPT
"RTN","AHMLDOP2",255,0)
 ...I LRT="1A",LRTEST'="*",CPT]"",'$D(^TMP("LRCPT",$J,CPT)) Q       ;not a CPT to total
"RTN","AHMLDOP2",256,0)
 ...I LRT="1A",CPT="",LRTEST'="*" Q
"RTN","AHMLDOP2",257,0)
 ...S ^TMP("LR",$J)=$G(^TMP("LR",$J))+1                     ;grand total
"RTN","AHMLDOP2",258,0)
 ...S ^TMP("LR",$J,LOC)=$G(^TMP("LR",$J,LOC))+1             ;location total
"RTN","AHMLDOP2",259,0)
 ...S ^TMP("LR",$J,LOC,OR)=TMP                              ;order detail
"RTN","AHMLDOP2",260,0)
 ;
"RTN","AHMLDOP2",261,0)
 I '$D(^TMP("LR",$J)) D  Q                                  ;nothing matching criteria
"RTN","AHMLDOP2",262,0)
 .W !!,"No data found matching prescribed criteria.",!
"RTN","AHMLDOP2",263,0)
 D HDR
"RTN","AHMLDOP2",264,0)
 I 'LRDET Q
"RTN","AHMLDOP2",265,0)
 ;
"RTN","AHMLDOP2",266,0)
 S (LOC,OR,PLOC)=""
"RTN","AHMLDOP2",267,0)
 F  S LOC=$O(^TMP("LR",$J,LOC)) Q:LOC=""  D  Q:LREND
"RTN","AHMLDOP2",268,0)
 .I LOC'=PLOC S PLOC=LOC D SHDR
"RTN","AHMLDOP2",269,0)
 .F  S OR=$O(^TMP("LR",$J,LOC,OR)) Q:OR=""  D  Q:LREND
"RTN","AHMLDOP2",270,0)
 ..S DATA=^TMP("LR",$J,LOC,OR)
"RTN","AHMLDOP2",271,0)
 ..I DATA="" Q
"RTN","AHMLDOP2",272,0)
 ..I $Y+2>IOSL D WAIT Q:LREND  D:$E(IOST,1,2)'="C-" HDR D SHDR
"RTN","AHMLDOP2",273,0)
 ..I +LRT=1 D
"RTN","AHMLDOP2",274,0)
 ...S TMP=$P(DATA,B,5)
"RTN","AHMLDOP2",275,0)
 ...I TMP]"",$G(^TMP("LRX",$J,TMP))]"" S TMP=^TMP("LRX",$J,TMP)
"RTN","AHMLDOP2",276,0)
 ...W !,$P($P(DATA,B),"@")
"RTN","AHMLDOP2",277,0)
 ...W ?10,$E($P(DATA,B,2),1,14),?26,$E($P(DATA,B,3),1,14)
"RTN","AHMLDOP2",278,0)
 ...W ?42,$E($P(DATA,B,4),1,14),?49,$E(TMP,1,11)
"RTN","AHMLDOP2",279,0)
 ...W ?55,$E($P(DATA,B,6),1,21),?77,$P(DATA,B,7)
"RTN","AHMLDOP2",280,0)
 ...W ! I $P(DATA,B)]"" W " @",$P($P(DATA,B),"@",2)
"RTN","AHMLDOP2",281,0)
 ...W ?10,$E($P(DATA,B,2),15,28),?26,$E($P(DATA,B,3),15,28)
"RTN","AHMLDOP2",282,0)
 ...W ?42,$E($P(DATA,B,4),15,28),?49,$E(TMP,12,22)
"RTN","AHMLDOP2",283,0)
 ...W ?55,$E($P(DATA,B,6),22,42)
"RTN","AHMLDOP2",284,0)
 ..I LRT=2 D
"RTN","AHMLDOP2",285,0)
 ...W !,$P($P(DATA,B),"@"),?10,$E($P(DATA,B,2),1,14)
"RTN","AHMLDOP2",286,0)
 ...W ?26,$E($P(DATA,B,3),1,14),?42,$E($P(DATA,B,4),1,14)
"RTN","AHMLDOP2",287,0)
 ...W ?58,$P(DATA,B,5),?62,$P($P(DATA,B,6),"@")
"RTN","AHMLDOP2",288,0)
 ...W ?72 I $P(DATA,B,5)'="D" W $P($P(DATA,B,7),"@")
"RTN","AHMLDOP2",289,0)
 ...W ! I $P(DATA,B)]"" W " @",$P($P(DATA,B),"@",2)
"RTN","AHMLDOP2",290,0)
 ...W ?10,$E($P(DATA,B,2),15,28),?26,$E($P(DATA,B,3),15,28)
"RTN","AHMLDOP2",291,0)
 ...W ?42,$E($P(DATA,B,4),15,28)
"RTN","AHMLDOP2",292,0)
 ...W ?62 I $P(DATA,B,6)]"" W " @",$P($P(DATA,B,6),"@",2)
"RTN","AHMLDOP2",293,0)
 ...W ?72 I $P(DATA,B,5)'="D",$P(DATA,B,7)]"" D
"RTN","AHMLDOP2",294,0)
 ....W " @",$P($P(DATA,B,7),"@",2)
"RTN","AHMLDOP2",295,0)
 ;
"RTN","AHMLDOP2",296,0)
 Q
"RTN","AHMLDOP2",297,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",298,0)
HDR ; Print header and totals by location.
"RTN","AHMLDOP2",299,0)
 ;
"RTN","AHMLDOP2",300,0)
 N EXAM,GTWRVU,L,NAME,TEXAM,TWRVU,WRVU
"RTN","AHMLDOP2",301,0)
 ;
"RTN","AHMLDOP2",302,0)
 S LRPAG=LRPAG+1
"RTN","AHMLDOP2",303,0)
 ;
"RTN","AHMLDOP2",304,0)
 W ?$S(LRT=2:24,LRT=1:20,LRT="1B":18,1:22),"Remote "
"RTN","AHMLDOP2",305,0)
 W $S(LRT=2:"Lab",1:"Radiology")," Orders by "
"RTN","AHMLDOP2",306,0)
 W $S(LRT=2:"Test Name",LRT=1:"Imaging Type",1:"CPT Code")
"RTN","AHMLDOP2",307,0)
 I LRT="1B" W " and wRVU"
"RTN","AHMLDOP2",308,0)
 W ?73,"Page ",LRPAG
"RTN","AHMLDOP2",309,0)
 W !?23,"From ",$$FMTE^XLFDT(LREDT)," to ",$$FMTE^XLFDT(LRSDT)
"RTN","AHMLDOP2",310,0)
 W !?22,"Date Printed: ",$$FMTE^XLFDT($$NOW^XLFDT),!
"RTN","AHMLDOP2",311,0)
 ;
"RTN","AHMLDOP2",312,0)
 I LRT="1A" D  Q
"RTN","AHMLDOP2",313,0)
 .W !?5,"CPT",?12,"Procedure",?50,"Total"
"RTN","AHMLDOP2",314,0)
 .W !?5,$TR($J("",65)," ","-")
"RTN","AHMLDOP2",315,0)
 .S (L,NAME)=""
"RTN","AHMLDOP2",316,0)
 .F  S L=$O(^TMP("LRTEST",$J,L)) Q:L=""  D  Q:LREND
"RTN","AHMLDOP2",317,0)
 ..F  S NAME=$O(^TMP("LRTEST",$J,L,NAME)) Q:NAME=""  D  Q:LREND
"RTN","AHMLDOP2",318,0)
 ...W !?5,L,?12,$E(NAME,1,37),?50,^TMP("LRTEST",$J,L,NAME)
"RTN","AHMLDOP2",319,0)
 .W !?5,$TR($J("",50)," ","-")
"RTN","AHMLDOP2",320,0)
 .W !?5,$J("Total",38),$TR($J(^TMP("LRTEST",$J),10)," ","."),!
"RTN","AHMLDOP2",321,0)
 ;
"RTN","AHMLDOP2",322,0)
 I LRT="1B" D  Q
"RTN","AHMLDOP2",323,0)
 .S (WRVU,TWRVU,GTWRVU,EXAM,GTEXAM)=0
"RTN","AHMLDOP2",324,0)
 .W !?58,"Total",?70,"Total"
"RTN","AHMLDOP2",325,0)
 .W !?5,"CPT",?12,"Procedure",?50,"wRVU",?58,"Exams",?70,"wRVU"
"RTN","AHMLDOP2",326,0)
 .W !?5,$TR($J("",70)," ","-")
"RTN","AHMLDOP2",327,0)
 .S (L,NAME)=""
"RTN","AHMLDOP2",328,0)
 .F  S L=$O(^TMP("LRTEST",$J,L)) Q:L=""  D  Q:LREND
"RTN","AHMLDOP2",329,0)
 ..F  S NAME=$O(^TMP("LRTEST",$J,L,NAME)) Q:NAME=""  D  Q:LREND
"RTN","AHMLDOP2",330,0)
 ...S WRVU=+$$RVU^FBRVU(L),EXAM=^TMP("LRTEST",$J,L,NAME)
"RTN","AHMLDOP2",331,0)
 ...S TWRVU=WRVU*EXAM,GTWRVU=GTWRVU+TWRVU,GTEXAM=GTEXAM+EXAM
"RTN","AHMLDOP2",332,0)
 ...W !?5,L,?12,$E(NAME,1,37),?50,WRVU,?58,EXAM,?70,TWRVU
"RTN","AHMLDOP2",333,0)
 .W !?5,$TR($J("",70)," ","-")
"RTN","AHMLDOP2",334,0)
 .W !?5,$J("Totals",40),?58,GTEXAM,?70,GTWRVU,!
"RTN","AHMLDOP2",335,0)
 ;
"RTN","AHMLDOP2",336,0)
 S L=""
"RTN","AHMLDOP2",337,0)
 F  S L=$O(^TMP("LRTEST",$J,L)) Q:L=""  D  Q:LREND
"RTN","AHMLDOP2",338,0)
 .I $G(^TMP("LRX",$J,L))]"" S NAME=^TMP("LRX",$J,L)
"RTN","AHMLDOP2",339,0)
 .E  S NAME=L
"RTN","AHMLDOP2",340,0)
 .W !?5,$J(NAME,$S(+LRT=1:15,1:35))
"RTN","AHMLDOP2",341,0)
 .W $TR($J(^TMP("LRTEST",$J,L),10)," ",".")
"RTN","AHMLDOP2",342,0)
 W !?5,$TR($J("",$S(+LRT=1:26,1:46))," ","-")
"RTN","AHMLDOP2",343,0)
 W !?5,$J("Total",$S(+LRT=1:15,1:35))
"RTN","AHMLDOP2",344,0)
 W $TR($J(+$G(^TMP("LRTEST",$J)),10)," ","."),!
"RTN","AHMLDOP2",345,0)
 ;
"RTN","AHMLDOP2",346,0)
 Q
"RTN","AHMLDOP2",347,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",348,0)
SHDR ; Print sub header.
"RTN","AHMLDOP2",349,0)
 ;
"RTN","AHMLDOP2",350,0)
 I $Y+6>IOSL D WAIT Q:LREND  D:$E(IOST,1,2)'="C-" HDR W !
"RTN","AHMLDOP2",351,0)
 ;
"RTN","AHMLDOP2",352,0)
 W !!,"==> Performing Location: ",LOC,!
"RTN","AHMLDOP2",353,0)
 I +LRT=1 D                                       ;rad sub header
"RTN","AHMLDOP2",354,0)
 .W !,$S(LRT="1B":"Report",1:"Order")
"RTN","AHMLDOP2",355,0)
 .W ?10,"Provider",?26,"Patient",?42,"CPT",?49,"Type"
"RTN","AHMLDOP2",356,0)
 .W ?55,"Image Procedure",?77,"St"
"RTN","AHMLDOP2",357,0)
 .W !,$TR($J("",8)," ","-"),?10,$TR($J("",14)," ","-")
"RTN","AHMLDOP2",358,0)
 .W ?26,$TR($J("",14)," ","-"),?42,$TR($J("",5)," ","-")
"RTN","AHMLDOP2",359,0)
 .W ?49,$TR($J("",4)," ","-"),?55,$TR($J("",20)," ","-")
"RTN","AHMLDOP2",360,0)
 .W ?77,$TR($J("",3)," ","-")
"RTN","AHMLDOP2",361,0)
 ;
"RTN","AHMLDOP2",362,0)
 I LRT=2 D                                       ;lab sub header
"RTN","AHMLDOP2",363,0)
 .W !,"Order",?10,"Provider",?26,"Patient",?42
"RTN","AHMLDOP2",364,0)
 .W "Test",?58,"St",?62,"Collect",?72,"Report"
"RTN","AHMLDOP2",365,0)
 .W !,$TR($J("",8)," ","-"),?10,$TR($J("",14)," ","-")
"RTN","AHMLDOP2",366,0)
 .W ?26,$TR($J("",14)," ","-"),?42,$TR($J("",14)," ","-")
"RTN","AHMLDOP2",367,0)
 .W ?58,$TR($J("",3)," ","-"),?62,$TR($J("",8)," ","-")
"RTN","AHMLDOP2",368,0)
 .W ?72,$TR($J("",8)," ","-")
"RTN","AHMLDOP2",369,0)
 ;
"RTN","AHMLDOP2",370,0)
 Q
"RTN","AHMLDOP2",371,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",372,0)
DATE(DATE) ; Convert mmm dd, yyyy@hh:mm to mm/dd/yyyy@hh:mm
"RTN","AHMLDOP2",373,0)
 ;
"RTN","AHMLDOP2",374,0)
 N DD,DM,DSTR,DY,LOWER,TM,UPPER
"RTN","AHMLDOP2",375,0)
 ;
"RTN","AHMLDOP2",376,0)
 I $G(DATE)="" Q ""
"RTN","AHMLDOP2",377,0)
 ;
"RTN","AHMLDOP2",378,0)
 S LOWER="abcdefghijklmnopqrstuvwxyz"
"RTN","AHMLDOP2",379,0)
 S UPPER="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","AHMLDOP2",380,0)
 S DSTR("JAN")="01",DSTR("FEB")="02",DSTR("MAR")="03",DSTR("APR")="04"
"RTN","AHMLDOP2",381,0)
 S DSTR("MAY")="05",DSTR("JUN")="06",DSTR("JUL")="07",DSTR("AUG")="08"
"RTN","AHMLDOP2",382,0)
 S DSTR("SEP")="09",DSTR("OCT")=10,DSTR("NOV")=11,DSTR("DEC")=12
"RTN","AHMLDOP2",383,0)
 ;
"RTN","AHMLDOP2",384,0)
 S DM=$TR($P(DATE," "),LOWER,UPPER),DD=$P($P(DATE," ",2),",")
"RTN","AHMLDOP2",385,0)
 S DY=$E($P($P(DATE," ",3),"@"),3,4),TM=$P($P(DATE,"@",2),":",1,2)
"RTN","AHMLDOP2",386,0)
 ;
"RTN","AHMLDOP2",387,0)
 Q DSTR(DM)_"/"_DD_"/"_DY_"@"_TM
"RTN","AHMLDOP2",388,0)
 ;---------------------------------------------------------------------
"RTN","AHMLDOP2",389,0)
WAIT ; Pause for page breaks.
"RTN","AHMLDOP2",390,0)
 ;
"RTN","AHMLDOP2",391,0)
 K DIR
"RTN","AHMLDOP2",392,0)
 S DIR(0)="E"
"RTN","AHMLDOP2",393,0)
 D ^DIR
"RTN","AHMLDOP2",394,0)
 S:($D(DUOUT))!($D(DTOUT)) LREND=1
"RTN","AHMLDOP2",395,0)
 S $Y=1
"RTN","AHMLDOP2",396,0)
 ;
"RTN","AHMLDOP2",397,0)
 Q
"RTN","AHMLDORO")
0^4^B67442195
"RTN","AHMLDORO",1,0)
AHMLDORO ;;LEIDOS/TCK - RQEMOTE ORDER - OUTGOING ; 10/17/16 10:26am
"RTN","AHMLDORO",2,0)
 ;;1.0;REMOTE ORDERS;;OCT 1,2016;Build 21
"RTN","AHMLDORO",3,0)
 ; Reference to UNESC^ORHLESC supported by IA #4922
"RTN","AHMLDORO",4,0)
 ;; TEST
"RTN","AHMLDORO",5,0)
 ;
"RTN","AHMLDORO",6,0)
 Q
"RTN","AHMLDORO",7,0)
 ;
"RTN","AHMLDORO",8,0)
 ; Order#  (ien for #100) to be set in ORC-2 & ORB-2
"RTN","AHMLDORO",9,0)
 ; add pregnancy segment if needed.
"RTN","AHMLDORO",10,0)
 ;
"RTN","AHMLDORO",11,0)
 ; 2752 - cancel exam & order and send back cancel reason in ORC16
"RTN","AHMLDORO",12,0)
 ; 4954 - insure OBR7 has timezone
"RTN","AHMLDORO",13,0)
 ; 4453/2722 - cancel exam but put order on HOLD, ORC/OBR fix
"RTN","AHMLDORO",14,0)
 ; 5204 - Parent/Child events, add B to OBR.25 for Cancels of some
"RTN","AHMLDORO",15,0)
 ;        child exams, also when results go out for a cancelled case 
"RTN","AHMLDORO",16,0)
EN1(MSG1,MSG2) ;
"RTN","AHMLDORO",17,0)
 ;
"RTN","AHMLDORO",18,0)
 N HLA,PROT,PR,REC,FLG S (CHK,FLG)=0
"RTN","AHMLDORO",19,0)
 Q:$G(REMOTE)=1
"RTN","AHMLDORO",20,0)
 I $D(MSG1)>1 M HLA("HLS")=MSG1
"RTN","AHMLDORO",21,0)
 I $G(MSG2)'="",$G(XQORMSG)'="" M HLA=@XQORMSG
"RTN","AHMLDORO",22,0)
 I $G(MSG1)["TMP" M HLA=@XQORMSG
"RTN","AHMLDORO",23,0)
 K MSG,MSG1,REC,CHK,FLG,ODC,AP,VFGL,STOP,CHG,MSGTYP,MSGNDE
"RTN","AHMLDORO",24,0)
 ;
"RTN","AHMLDORO",25,0)
EN ;
"RTN","AHMLDORO",26,0)
 Q:'$D(HLA)
"RTN","AHMLDORO",27,0)
 N QQ,RAIEN,ORST
"RTN","AHMLDORO",28,0)
 N HLFS S HLFS="|"
"RTN","AHMLDORO",29,0)
 N HLCS S HLCS="^"
"RTN","AHMLDORO",30,0)
 N RAOIEN,RPTIEN S RAOIEN=0,RPTIEN=""
"RTN","AHMLDORO",31,0)
 ;
"RTN","AHMLDORO",32,0)
 N ORDNB S ORDNB="" ; Order#; ien of ^OR(100
"RTN","AHMLDORO",33,0)
 N SEGARY D GETSEG
"RTN","AHMLDORO",34,0)
 N XCASE S XCASE=""
"RTN","AHMLDORO",35,0)
 ;
"RTN","AHMLDORO",36,0)
 D ORC
"RTN","AHMLDORO",37,0)
 I $G(ORC1)="DC" D  Q
"RTN","AHMLDORO",38,0)
 .D FIX,MSG Q
"RTN","AHMLDORO",39,0)
 Q:$G(ORC1)="DC"
"RTN","AHMLDORO",40,0)
 I ORDNB'="" D FIX G PREG ; Case 1
"RTN","AHMLDORO",41,0)
 D OBR I XCASE'="" D
"RTN","AHMLDORO",42,0)
 . S ORDNB=$$GETORD(XCASE) Q:'ORDNB
"RTN","AHMLDORO",43,0)
 . D FIX G EXIT ; Case 2&3
"RTN","AHMLDORO",44,0)
 ;
"RTN","AHMLDORO",45,0)
PREG ;  add preg obx segment if needed
"RTN","AHMLDORO",46,0)
 I RAOIEN D OBXPRG
"RTN","AHMLDORO",47,0)
 ;
"RTN","AHMLDORO",48,0)
EXIT ;
"RTN","AHMLDORO",49,0)
 D DBG1("END")
"RTN","AHMLDORO",50,0)
 Q
"RTN","AHMLDORO",51,0)
 ;
"RTN","AHMLDORO",52,0)
MSG ;
"RTN","AHMLDORO",53,0)
 S PROT="RA REMOTE DC EVENT"
"RTN","AHMLDORO",54,0)
 K HLA("HLS",1)
"RTN","AHMLDORO",55,0)
 D GENERATE^HLMA($O(^ORD(101,"B",PROT,0)),"LM",1,.HLREST,"",.HLP)
"RTN","AHMLDORO",56,0)
 Q
"RTN","AHMLDORO",57,0)
 ;
"RTN","AHMLDORO",58,0)
GETSEG ;
"RTN","AHMLDORO",59,0)
 N XI S XI=""
"RTN","AHMLDORO",60,0)
 N XSEG
"RTN","AHMLDORO",61,0)
 ;THERE IS A POSSIBLE ISSUE WITH DELIMETERS HERE
"RTN","AHMLDORO",62,0)
 ;THIS CODE IS NOT ABLE TO SEE THE XSEG PROPERLY
"RTN","AHMLDORO",63,0)
 ;FOR REG PATIENTS ESB MAY BE PULLING THE XCASE AND REPLACING
"RTN","AHMLDORO",64,0)
 ;
"RTN","AHMLDORO",65,0)
 FOR  S XI=$O(HLA("HLS",XI)) Q:'XI  S XSEG=$P(HLA("HLS",XI),HLFS,1) D
"RTN","AHMLDORO",66,0)
 . I XSEG="ORC" S SEGARY("ORC")=XI_"^"_$D(HLA("HLS",XI))
"RTN","AHMLDORO",67,0)
 . I XSEG="OBR" S SEGARY("OBR")=XI_"^"_$D(HLA("HLS",XI))
"RTN","AHMLDORO",68,0)
 Q
"RTN","AHMLDORO",69,0)
 ;
"RTN","AHMLDORO",70,0)
GETORD(XCASE) ; get Order# from Case#
"RTN","AHMLDORO",71,0)
 ;  XCASE= big Case#,
"RTN","AHMLDORO",72,0)
 N XEXAM ; exam line
"RTN","AHMLDORO",73,0)
 N XDFN  ; dfn
"RTN","AHMLDORO",74,0)
 N XDT   ; order date
"RTN","AHMLDORO",75,0)
 N XD2   ; 70.03 ien
"RTN","AHMLDORO",76,0)
 N X11   ; 11 piece of exam line;  ien of RAO(75.1
"RTN","AHMLDORO",77,0)
 ;
"RTN","AHMLDORO",78,0)
 ;S:$D(HLA("HLS",XI))=1 XCASE=$P(HLA("HLS",XI),"|",3)
"RTN","AHMLDORO",79,0)
 ;S:$D(HLA("HLS",XI))=11 XCASE=$P(HLA("HLS",XI,1),"|",2)
"RTN","AHMLDORO",80,0)
 S ORDNB=""
"RTN","AHMLDORO",81,0)
 ;
"RTN","AHMLDORO",82,0)
 S XDFN=$O(^RADPT("ADC",XCASE,"")) Q:'XDFN  D
"RTN","AHMLDORO",83,0)
 . S XDT=$O(^RADPT("ADC",XCASE,XDFN,"")) Q:XDT=""  D
"RTN","AHMLDORO",84,0)
 . . S XD2=$O(^RADPT("ADC",XCASE,XDFN,XDT,"")) Q:XD2=""
"RTN","AHMLDORO",85,0)
 . . S XEXAM=$G(^RADPT(XDFN,"DT",XDT,"P",XD2,0)) Q:XEXAM=""
"RTN","AHMLDORO",86,0)
 . . S EXMSTA=$P(XEXAM,"^",3)
"RTN","AHMLDORO",87,0)
 . . S CATEG=$P(XEXAM,"^",4)
"RTN","AHMLDORO",88,0)
 . . S WARD=$P(XEXAM,"^",6)
"RTN","AHMLDORO",89,0)
 . . S SERVICE=$P(XEXAM,"^",7)
"RTN","AHMLDORO",90,0)
 . . S RPTIEN=$P(XEXAM,"^",17)
"RTN","AHMLDORO",91,0)
 . . I +XEXAM=$P(XCASE,"-",2) S X11=$P(XEXAM,"^",11) S:X11'="" ORDNB=$P(^RAO(75.1,X11,0),"^",7),RAOIEN=X11
"RTN","AHMLDORO",92,0)
 I ORDNB["-" S ORDNB=0 Q
"RTN","AHMLDORO",93,0)
 I $G(RPTIEN)>0 D
"RTN","AHMLDORO",94,0)
 .Q:'$D(^RARPT(RPTIEN,"H"))
"RTN","AHMLDORO",95,0)
 .S STOP=$P(^RARPT(RPTIEN,"H",0),"^",3)
"RTN","AHMLDORO",96,0)
 .S INDX=0 F  S INDX=$O(^RARPT(RPTIEN,"H",INDX)) Q:INDX=""  D
"RTN","AHMLDORO",97,0)
 ..S HIST("TXT",INDX)=^RARPT(RPTIEN,"H",INDX,0)
"RTN","AHMLDORO",98,0)
 Q ORDNB
"RTN","AHMLDORO",99,0)
 ;
"RTN","AHMLDORO",100,0)
 ;====================================================================
"RTN","AHMLDORO",101,0)
 S:$D(HLA("HLS",XI))=1 $P(HLA("HLS",XI),"|",3)=XCASE_"^"_ORDNB
"RTN","AHMLDORO",102,0)
 S:$D(HLA("HLS",XI))=11 $P(HLA("HLS",XI,1),"|",2)=XCASE_"^"_ORDNB
"RTN","AHMLDORO",103,0)
 Q ORDNB
"RTN","AHMLDORO",104,0)
 ;
"RTN","AHMLDORO",105,0)
ORC ;
"RTN","AHMLDORO",106,0)
 Q:$G(SEGARY("ORC"))=""
"RTN","AHMLDORO",107,0)
 N XI,XD
"RTN","AHMLDORO",108,0)
 S XI=$P(SEGARY("ORC"),"^",1),XD=$P(SEGARY("ORC"),"^",2)
"RTN","AHMLDORO",109,0)
 I XD=1,$P(HLA("HLS",XI),HLFS,3)'="" S ORDNB=$P($P(HLA("HLS",XI),HLFS,3),";",1)
"RTN","AHMLDORO",110,0)
 I ORDNB'="" D
"RTN","AHMLDORO",111,0)
 .I '$D(^OR(100,ORDNB)) S $P(HLA("HLS",XI),HLFS,3)="",ORDNB=""
"RTN","AHMLDORO",112,0)
 S ORC1=$P(HLA("HLS",XI),HLFS,2)
"RTN","AHMLDORO",113,0)
 I $G(DUZ)'="" D
"RTN","AHMLDORO",114,0)
 .S USNM=$$GET1^DIQ(200,DUZ,.01,"E")
"RTN","AHMLDORO",115,0)
 .S USNM=$TR(USNM,",","^")
"RTN","AHMLDORO",116,0)
 .S $P(HLA("HLS",XI),HLFS,11)=DUZ_"^"_$G(USNM)
"RTN","AHMLDORO",117,0)
 .S PRVID=$P(HLA("HLS",XI),HLFS,13)
"RTN","AHMLDORO",118,0)
 .I PRVID'="" S PRVNME=$$GET1^DIQ(200,PRVID,.01,"E")
"RTN","AHMLDORO",119,0)
 .I $G(PRVNME)'="" S $P(HLA("HLS",XI),HLFS,13)=PRVID_"^"_$G(PRVNME)
"RTN","AHMLDORO",120,0)
 Q
"RTN","AHMLDORO",121,0)
 ;
"RTN","AHMLDORO",122,0)
OBR ;
"RTN","AHMLDORO",123,0)
 Q:'$D(SEGARY("OBR"))
"RTN","AHMLDORO",124,0)
 N XI,XD,XSEG
"RTN","AHMLDORO",125,0)
 N OBR2,OBR3
"RTN","AHMLDORO",126,0)
 S XI=$P($G(SEGARY("OBR")),"^",1),XD=$P(SEGARY("OBR"),"^",2)
"RTN","AHMLDORO",127,0)
 I XD=1 S XSEG=HLA("HLS",XI),OBR2=$P(XSEG,HLFS,3),OBR3=$P(XSEG,HLFS,4) S:OBR2'="" XCASE=OBR2 S:OBR2="" XCASE=$P(OBR3,HLCS,2)
"RTN","AHMLDORO",128,0)
 I XD=11 S XSEG=HLA("HLS",XI,1),OBR2=$P(XSEG,HLFS,2),OBR3=$P(XSEG,HLFS,3) S:OBR2'="" XCASE=OBR2 S:OBR2="" XCASE=$P(OBR3,HLCS,2)
"RTN","AHMLDORO",129,0)
 Q
"RTN","AHMLDORO",130,0)
 ;
"RTN","AHMLDORO",131,0)
FIX ; put ORDNB into ORC-2, OBR-2 and add Adittional clinical history
"RTN","AHMLDORO",132,0)
 N XI,XD,XSEG,TP,CNTR,ORST,SCNTR,OBRSEG,RAIEN,REAIEN,REASON,ORB7,OBRTZ
"RTN","AHMLDORO",133,0)
 N REQST,ORCTR,ORC
"RTN","AHMLDORO",134,0)
 S TYP="RAD"
"RTN","AHMLDORO",135,0)
 S CNTR="",DONE=0
"RTN","AHMLDORO",136,0)
 I $G(ORDNB)>0,$D(^XTMP(TYP,"B")),$D(^XTMP(TYP,"B",ORDNB)) S ORIFN=^XTMP(TYP,"B",ORDNB)
"RTN","AHMLDORO",137,0)
 F  S CNTR=$O(HLA("HLS",CNTR)) Q:CNTR=""  D
"RTN","AHMLDORO",138,0)
 .S TP=$P(HLA("HLS",CNTR),HLFS) D
"RTN","AHMLDORO",139,0)
 ..I TP="ORC" D    ;ORC segment mods
"RTN","AHMLDORO",140,0)
 ...M ORC=HLA("HLS",CNTR)
"RTN","AHMLDORO",141,0)
 ...S ORCTR=$P(HLA("HLS",CNTR),HLFS,2)
"RTN","AHMLDORO",142,0)
 ...;Get hub order number from cross ref
"RTN","AHMLDORO",143,0)
 ...I $G(ORIFN)>0 S $P(HLA("HLS",CNTR),HLFS,3)=ORIFN
"RTN","AHMLDORO",144,0)
 ...;  Check Cancel/Hold and get reason - 2752
"RTN","AHMLDORO",145,0)
 ...; get ien that points to file RAD/NUC MED ORDERS file #75.1
"RTN","AHMLDORO",146,0)
 ...S RAIEN=+$$GET1^DIQ(100,ORDNB,"PACKAGE REFERENCE","I")
"RTN","AHMLDORO",147,0)
 ...D:RAIEN ;Cancel/Hold Reason exists
"RTN","AHMLDORO",148,0)
 ....S REAIEN=$$GET1^DIQ(75.1,RAIEN,"REASON","I")
"RTN","AHMLDORO",149,0)
 ....S REASON=$$GET1^DIQ(75.1,RAIEN,"REASON")
"RTN","AHMLDORO",150,0)
 ....S REQST=$$GET1^DIQ(75.1,RAIEN,"REQUEST STATUS")   ;Sts, Hold?
"RTN","AHMLDORO",151,0)
 ....I $G(ORC1)'="DC" S $P(HLA("HLS",CNTR),HLFS,17)="X"_HLCS_HLCS_"99OR"_HLCS_REAIEN_HLCS_REASON
"RTN","AHMLDORO",152,0)
 ....;S $P(HLA("HLS",CNTR),HLFS,18)=$G(EXMSTA)_HLCS_$G(CATEG)_HLCS_$G(WARD)_HLCS_$G(SERVICE)
"RTN","AHMLDORO",153,0)
 ....D:REQST="HOLD"    ;4453 Sts=Hold
"RTN","AHMLDORO",154,0)
 .....S $P(HLA("HLS",CNTR),HLFS,2)="SC"        ;orc.1
"RTN","AHMLDORO",155,0)
 .....S $P(HLA("HLS",CNTR),HLFS,6)="IP"        ;orc.5
"RTN","AHMLDORO",156,0)
 ..I TP="OBR" D ;OBR segment mods
"RTN","AHMLDORO",157,0)
 ...S SCNTR=""
"RTN","AHMLDORO",158,0)
 ...F  S SCNTR=$O(HLA("HLS",CNTR,SCNTR)) Q:SCNTR=""  D
"RTN","AHMLDORO",159,0)
 ....S OBRSEG=HLA("HLS",CNTR),STRNG=HLA("HLS",CNTR,SCNTR)
"RTN","AHMLDORO",160,0)
 ....S OBRSEG=OBRSEG_STRNG,HLA("HLS",CNTR)=OBRSEG
"RTN","AHMLDORO",161,0)
 ....K HLA("HLS",CNTR,SCNTR)
"RTN","AHMLDORO",162,0)
 ...S $P(HLA("HLS",CNTR),HLFS,3)=ORIFN
"RTN","AHMLDORO",163,0)
 ...;CCR 5331 PUT TECHNOLOGIST ID IN OBR.34
"RTN","AHMLDORO",164,0)
 ...I $G(RADTI)'="" D
"RTN","AHMLDORO",165,0)
 ....I $O(^RADPT($G(RADFN),"DT",$G(RADTI),"P",$G(RACNI),"TC",0)) D
"RTN","AHMLDORO",166,0)
 .....S INDX=$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0),"^",3)
"RTN","AHMLDORO",167,0)
 .....Q:INDX'>0
"RTN","AHMLDORO",168,0)
 .....S RAIEN=INDX_","_RACNI_","_RADTI_","_RADFN_","
"RTN","AHMLDORO",169,0)
 .....S TECHID=$$GET1^DIQ(70.12,RAIEN,.01,"I")
"RTN","AHMLDORO",170,0)
 .....I $G(TECHID)>0 S $P(HLA("HLS",CNTR),HLFS,35)=TECHID
"RTN","AHMLDORO",171,0)
 ...I $G(TECHID)'>0 S $P(HLA("HLS",CNTR),HLFS,35)=DUZ
"RTN","AHMLDORO",172,0)
 ...S OBR7=$P(HLA("HLS",CNTR),HLFS,8)
"RTN","AHMLDORO",173,0)
 ...S OBR25=$P(HLA("HLS",CNTR),HLFS,26)
"RTN","AHMLDORO",174,0)
 ...I OBR25="" S $P(HLA("HLS",CNTR),HLFS,26)="I"
"RTN","AHMLDORO",175,0)
 ...S OBR25=$P(HLA("HLS",CNTR),HLFS,26)
"RTN","AHMLDORO",176,0)
 ...; Timezone missing, add it  4954
"RTN","AHMLDORO",177,0)
 ...D:$P(OBR7,"-",2)=""
"RTN","AHMLDORO",178,0)
 ....S OBRTZ=$P($$HLDATE^HLFNC($$NOW^XLFDT,"TS"),"-",2)
"RTN","AHMLDORO",179,0)
 ....S $P(OBR7,"-",2)=OBRTZ
"RTN","AHMLDORO",180,0)
 ....S $P(HLA("HLS",CNTR),HLFS,8)=OBR7
"RTN","AHMLDORO",181,0)
 ...; Hold Order event, set obr.25 = X  4453
"RTN","AHMLDORO",182,0)
 ...S:$G(REQST)="HOLD" $P(HLA("HLS",CNTR),HLFS,26)="X"
"RTN","AHMLDORO",183,0)
 ...; Set obr.25 = B to block transmissison to DoD, when cancel of
"RTN","AHMLDORO",184,0)
 ...; child and order still Active.     5204
"RTN","AHMLDORO",185,0)
 ...I $G(ORCTR)="CA",$G(REQST)="ACTIVE" S $P(HLA("HLS",CNTR),HLFS,26)="B"
"RTN","AHMLDORO",186,0)
 ...;
"RTN","AHMLDORO",187,0)
 ...; Check IF report/result type HL7 and is a cancelled case.  5204
"RTN","AHMLDORO",188,0)
 ...; If so, then this is a bad case, so ESB will need to block this.
"RTN","AHMLDORO",189,0)
 ...; Legacy RA code creates this message erroneously as they only
"RTN","AHMLDORO",190,0)
 ...; check for if the exam case belongs to a Printset (parent/child).
"RTN","AHMLDORO",191,0)
 ...;
"RTN","AHMLDORO",192,0)
 ...I '$D(ORC),OBR25="F" D
"RTN","AHMLDORO",193,0)
 ....S RDIENS=RACNI_","_RADTI_","_RADFN_","
"RTN","AHMLDORO",194,0)
 ....I $$GET1^DIQ(70.03,RDIENS,3)="CANCELLED" D
"RTN","AHMLDORO",195,0)
 .....S $P(HLA("HLS",CNTR),HLFS,26)="B"
"RTN","AHMLDORO",196,0)
 ..I TP="OBX",'DONE D
"RTN","AHMLDORO",197,0)
 ...Q:'$D(HIST)
"RTN","AHMLDORO",198,0)
 ...S XH=$O(HLA("HLS",999999999),-1)
"RTN","AHMLDORO",199,0)
 ...S I="" F  S I=$O(HIST("TXT",I)) Q:I=""  D
"RTN","AHMLDORO",200,0)
 ....S TXT=HIST("TXT",I)
"RTN","AHMLDORO",201,0)
 ....Q:$G(TXT)=""
"RTN","AHMLDORO",202,0)
 ....S XH=$G(XH)+1
"RTN","AHMLDORO",203,0)
 ....S HLA("HLS",XH)="OBX"_"|"_XH_"|"_"TX"_"|"_"H^HISTORY^L"_"||"_TXT
"RTN","AHMLDORO",204,0)
 ....S DONE=1
"RTN","AHMLDORO",205,0)
 S DONE=""
"RTN","AHMLDORO",206,0)
 ;
"RTN","AHMLDORO",207,0)
 Q
"RTN","AHMLDORO",208,0)
 ;
"RTN","AHMLDORO",209,0)
DBG1(X) ;
"RTN","AHMLDORO",210,0)
 ;N FIXCNT S FIXCNT=$G(^XXRHL("FIX"))+1,^XXRHL("FIX")=FIXCNT
"RTN","AHMLDORO",211,0)
 ;M ^XXRHL("FIX",FIXCNT)=HLA("HLS")
"RTN","AHMLDORO",212,0)
 ;S ^XXRHL("FIX",FIXCNT)=X
"RTN","AHMLDORO",213,0)
 Q
"RTN","AHMLDORO",214,0)
 ;
"RTN","AHMLDORO",215,0)
OBXPRG ;
"RTN","AHMLDORO",216,0)
 N X,X13
"RTN","AHMLDORO",217,0)
 N XN S XN=0
"RTN","AHMLDORO",218,0)
 N PRGSEG S PRGSEG=0
"RTN","AHMLDORO",219,0)
 S X13=$P(^RAO(75.1,RAOIEN,0),"^",13)
"RTN","AHMLDORO",220,0)
 Q:X13=""
"RTN","AHMLDORO",221,0)
 ;
"RTN","AHMLDORO",222,0)
 S:X13="y" X13="YES" S:X13="n" X13="NO" S:X13="u" X13="UNKNOWN"
"RTN","AHMLDORO",223,0)
 FOR  S XN=$O(HLA("HLS",XN)) Q:XN=""  D  Q:PRGSEG
"RTN","AHMLDORO",224,0)
 . S X=HLA("HLS",XN) Q:$P(X,HLFS,1)'="OBX"
"RTN","AHMLDORO",225,0)
 . I $P(X,HLFS,4)["PREGNANT" S PRGSEG=1 Q  ; already a OBX preg seg
"RTN","AHMLDORO",226,0)
 Q:PRGSEG  ; already a OBX preg seg
"RTN","AHMLDORO",227,0)
 S XN=$O(HLA("HLS",999999999999999),-1),XN=XN+1
"RTN","AHMLDORO",228,0)
 S HLA("HLS",XN)="OBX"_HLFS_HLFS_"TX"_HLFS_"2000.33"_HLCS_"PREGNANT"_HLCS_"AS4"_HLFS_HLFS_X13
"RTN","AHMLDORO",229,0)
 ;
"RTN","AHMLDORO",230,0)
 Q
"RTN","AHMLDORO",231,0)
 ;=====================================================================================================================
"RTN","AHMLDORO",232,0)
 ; NOTES:
"RTN","AHMLDORO",233,0)
 ;   The purpose of this routine is to adjust the HL7 message stored in HLA("HLS" before it is stored in ^HL(772
"RTN","AHMLDORO",234,0)
 ;     the MSH segment can't be altered her ( Not in HLA("HLS"
"RTN","AHMLDORO",235,0)
 ;
"RTN","AHMLDORO",236,0)
 ;
"RTN","AHMLDORO",237,0)
 ;    The Order# (ien for OR(100)  is to be stored in ORC-2 & ORB-2  ( except for ORU messages which do not have a ORC)
"RTN","AHMLDORO",238,0)
 ;       3 cases of finding Order#
"RTN","AHMLDORO",239,0)
 ;  1.  order generated by CPRS:  case# in ORC-2  e.g. ORC|NW|29080;1^OR ; take $P(ORC-2),";",1)
"RTN","AHMLDORO",240,0)
 ;  2.  for ORM messages generated by Vista Registration, Cancellation, or Examined.
"RTN","AHMLDORO",241,0)
 ;      Order# not is in message so must use case# in OBR-2 to find Order#  (Order#=$$GETORD(Case#))
"RTN","AHMLDORO",242,0)
 ;      OBR||031710-72|...  where case# is '031710-72'
"RTN","AHMLDORO",243,0)
 ;  3.  for ORU messages, no ORC segment, Case# in OBR-3 as  OBR|||6899682.8165-1^031710-72^L
"RTN","AHMLDORO",244,0)
 ;       Case#=$P($P(OBR-3),"^",2) AND Order#=$$GETORD(Case#)
"RTN","AHMLDORO",245,0)
 ;
"RTN","AHMLDORO",246,0)
 ;   HLA("HLS" structure for ORM-messages:
"RTN","AHMLDORO",247,0)
 ;
"RTN","AHMLDORO",248,0)
 ;     HLA("HLS",1)=PID segment
"RTN","AHMLDORO",249,0)
 ;     HLA("HLS",2)=ORC segment
"RTN","AHMLDORO",250,0)
 ;        if $L(OBR) < 245  :
"RTN","AHMLDORO",251,0)
 ;     HLA("HLS",3)=OBR segment  
"RTN","AHMLDORO",252,0)
 ;        if $L(OBR)> 245
"RTN","AHMLDORO",253,0)
 ;     HLA("HLS",3)="OBR|"
"RTN","AHMLDORO",254,0)
 ;     HLA("HLS",3,1)=$P(OBR,"|",2,99)
"RTN","AHMLDORO",255,0)
 ;     HLA("HLS",3,2)=$P(OBR,"|",100,9999)
"RTN","AHMLDORO",256,0)
 ;     HLA("HLS",4-n)=OBX segments
"RTN","AHMLDORO",257,0)
 ;
"RTN","AHMLDORO",258,0)
 ;   HLA("HLS" structure for ORM-messas:
"RTN","AHMLDOS")
0^1^B22419185
"RTN","AHMLDOS",1,0)
AHMLDOS ;;LEIDOS/TCK - REMOTE ORDER - INCOMING ; 10/17/16 8:32am
"RTN","AHMLDOS",2,0)
 ;;1.0;REMOTE ORDERS;;OCT 1,2016;Build 21
"RTN","AHMLDOS",3,0)
 ; Reference to UNESC^ORHLESC supported by IA #4922
"RTN","AHMLDOS",4,0)
 ;; TEST
"RTN","AHMLDOS",5,0)
 ;
"RTN","AHMLDOS",6,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS",7,0)
EN ; Entry point for INCOMING ORDERS FROM A HOST FACILITY
"RTN","AHMLDOS",8,0)
 ;
"RTN","AHMLDOS",9,0)
 ;    Input: HLMTIEN - ^HL(772,IEN
"RTN","AHMLDOS",10,0)
 ;
"RTN","AHMLDOS",11,0)
 ;   Output: None.
"RTN","AHMLDOS",12,0)
 ;
"RTN","AHMLDOS",13,0)
 N I
"RTN","AHMLDOS",14,0)
 S (I,TYPE)="",ACKERR=0
"RTN","AHMLDOS",15,0)
 ;
"RTN","AHMLDOS",16,0)
 I $G(HLMTIEN)'>0 Q
"RTN","AHMLDOS",17,0)
 ;
"RTN","AHMLDOS",18,0)
 S REMOTE=1
"RTN","AHMLDOS",19,0)
 S HLMA=$O(^HLMA("B",HLMTIEN,""))
"RTN","AHMLDOS",20,0)
 I $G(HLMA)'>0 Q
"RTN","AHMLDOS",21,0)
 ;
"RTN","AHMLDOS",22,0)
 I '$D(^HLMA(HLMA,0)) Q
"RTN","AHMLDOS",23,0)
 I '$D(^HLMA(HLMA,"MSH")) Q
"RTN","AHMLDOS",24,0)
 ;
"RTN","AHMLDOS",25,0)
 I $P(^HLMA(HLMA,"MSH",1,0),"|",3)["LA7V HOST" S TYPE="LAB"
"RTN","AHMLDOS",26,0)
 I $P(^HLMA(HLMA,"MSH",1,0),"|",3)["RA HOST" S TYPE="RAD"
"RTN","AHMLDOS",27,0)
 S LOC=+$P(^HLMA(HLMA,"MSH",1,0),"|",4)
"RTN","AHMLDOS",28,0)
 S I=0 F  S I=$O(^HL(772,HLMTIEN,"IN",I)) Q:I=""  D
"RTN","AHMLDOS",29,0)
  .S REC(I)=^HL(772,HLMTIEN,"IN",I,0)
"RTN","AHMLDOS",30,0)
 ;
"RTN","AHMLDOS",31,0)
 M ^TMP("POLICY")=REC
"RTN","AHMLDOS",32,0)
 ;Q
"RTN","AHMLDOS",33,0)
 Q:'$D(REC)
"RTN","AHMLDOS",34,0)
 ;
"RTN","AHMLDOS",35,0)
 D EN^AHMLDOS1(.REC,TYPE,LOC)
"RTN","AHMLDOS",36,0)
 ;
"RTN","AHMLDOS",37,0)
 I 'ACKERR D ACK(HLMA,HLMTIEN,"AA")
"RTN","AHMLDOS",38,0)
 ;
"RTN","AHMLDOS",39,0)
 Q
"RTN","AHMLDOS",40,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS",41,0)
ACK(HLMA,HLMTIEN,CODE,ERR) ; This sub-routine will handle the Application Errors
"RTN","AHMLDOS",42,0)
 ;                   (AE) or Rejects (AR) or Accepts (AA) back to the
"RTN","AHMLDOS",43,0)
 ;                   Hub (Ordering Lab).
"RTN","AHMLDOS",44,0)
 ;
"RTN","AHMLDOS",45,0)
 ;    Input:    HLMA - ^HLMA IEN                        [required]
"RTN","AHMLDOS",46,0)
 ;           HLMTIEN - ^HL(772 IEN                      [required]
"RTN","AHMLDOS",47,0)
 ;              CODE - AA=Accept, AE=Error, AR=Reject   [optional]
"RTN","AHMLDOS",48,0)
 ;               ERR - Error Text to be returned.       [optional]
"RTN","AHMLDOS",49,0)
 ;
"RTN","AHMLDOS",50,0)
 ;   Output: None.
"RTN","AHMLDOS",51,0)
 ;
"RTN","AHMLDOS",52,0)
 N HLEID,HLEIDS,MSA1,PROT,SLOC
"RTN","AHMLDOS",53,0)
 ;
"RTN","AHMLDOS",54,0)
 S MSA1=$G(CODE) S:$G(ERR)="" MSA1="AA"     ; acknowledgement code
"RTN","AHMLDOS",55,0)
 S SLOC=+$P(^HLMA(HLMA,"MSH",1,0),"|",4)    ; sending facility
"RTN","AHMLDOS",56,0)
 S PROT="LA7V "_SLOC_" ORM-O01 EVENT"       ; event prototcol
"RTN","AHMLDOS",57,0)
 S HLEID=$O(^ORD(101,"B",PROT,0))           ; event protocol IEN
"RTN","AHMLDOS",58,0)
 S HL("MID")=$P(^HLMA(HLMA,0),U,2)          ; Message Control ID
"RTN","AHMLDOS",59,0)
 S HLEIDS=$P(^HLMA(HLMA,0),U,8)             ; Subscriber Protocol
"RTN","AHMLDOS",60,0)
 ;
"RTN","AHMLDOS",61,0)
 S HLA("HLS",1)="MSA|"_MSA1_"|"_HL("MID")_$S($G(ERR)]"":"|"_ERR,1:"")
"RTN","AHMLDOS",62,0)
 ;
"RTN","AHMLDOS",63,0)
 D GENERATE^HLMA(HLEID,"LM",1,.RESULT,"",.HLP)
"RTN","AHMLDOS",64,0)
 ;
"RTN","AHMLDOS",65,0)
 Q
"RTN","AHMLDOS",66,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS",67,0)
TEST(LROROUT,HLMTIEN) ; HLMTIEN=IEN to ^HL(772
"RTN","AHMLDOS",68,0)
 D EN
"RTN","AHMLDOS",69,0)
 Q
"RTN","AHMLDOS",70,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS",71,0)
GTDOM(R) ; Get the list of performing labs from the "E" cross reference.
"RTN","AHMLDOS",72,0)
 ;
"RTN","AHMLDOS",73,0)
 N NME,INST,CNT
"RTN","AHMLDOS",74,0)
 S (DOM,INST,R)=""
"RTN","AHMLDOS",75,0)
 Q:'$D(^DIC(4,"E"))
"RTN","AHMLDOS",76,0)
 ;
"RTN","AHMLDOS",77,0)
 F  S INST=$O(^DIC(4,"E",INST)) Q:INST=""  D
"RTN","AHMLDOS",78,0)
  .S NME=$$GET1^DIQ(4,INST,.01,"E")
"RTN","AHMLDOS",79,0)
  .S CNT=$G(CNT)+1
"RTN","AHMLDOS",80,0)
  .S R(CNT)=INST_U_NME
"RTN","AHMLDOS",81,0)
 ;
"RTN","AHMLDOS",82,0)
 Q
"RTN","AHMLDOS",83,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS",84,0)
DC(REC,ORID,ORVP,ORNP,ORL,REASON,DCORIG,ISNEWORD) ;
"RTN","AHMLDOS",85,0)
 N FLG,FLAG,LRSEND,LRODT,LRSN,LRSEND,ORN,LRIEN,LRFILE,LRAA,LRAN,LRAD
"RTN","AHMLDOS",86,0)
 S (FLG,FLAG)=0,(LRAA,LRAN,LRAD)=""
"RTN","AHMLDOS",87,0)
 S (DCORIG,ISNEWORD)=0
"RTN","AHMLDOS",88,0)
 I $G(REASON)'?.N,$D(^ORD(100.03,"B",REASON)) D
"RTN","AHMLDOS",89,0)
 .S REASIEN="",REASIEN=$O(^ORD(100.03,"B",REASON,REASIEN))
"RTN","AHMLDOS",90,0)
 I $G(REASIEN)>0 S REASON=REASIEN
"RTN","AHMLDOS",91,0)
 I $G(REASON)?.N S REASIEN=REASON
"RTN","AHMLDOS",92,0)
 I $G(REASIEN)="" S REASIEN=6
"RTN","AHMLDOS",93,0)
 S ORDNUM=+ORID
"RTN","AHMLDOS",94,0)
 S FILE=100,ORIEN=ORDNUM_","
"RTN","AHMLDOS",95,0)
 I $$GET1^DIQ(FILE,ORIEN,31,"I") D  Q:FLG
"RTN","AHMLDOS",96,0)
 .I $$GET1^DIQ(FILE,ORIEN,5,"I")=1 S NDE=$O(^OR(100,ORDNUM,8,9999),-1),REC(1)=ORDNUM_";"_NDE_"^RS" S FLG=1 Q
"RTN","AHMLDOS",97,0)
 Q:FLG
"RTN","AHMLDOS",98,0)
 S STATUS=$$GET1^DIQ(100,ORDNUM_",",5,"I")
"RTN","AHMLDOS",99,0)
 S PTYPE=$$GET1^DIQ(100,ORDNUM_",",12)
"RTN","AHMLDOS",100,0)
 ;4900 send error msg for a Lab DC try for a completed order
"RTN","AHMLDOS",101,0)
 I STATUS=2&(PTYPE'["RAD") D  Q
"RTN","AHMLDOS",102,0)
 .S REC(1)="Warning: Not cancelled. Lab order is already completed."
"RTN","AHMLDOS",103,0)
 I PTYPE'["RAD" D
"RTN","AHMLDOS",104,0)
 .S LRFILE=100,LRIEN=ORDNUM_","
"RTN","AHMLDOS",105,0)
 .S LRDATA=$$GET1^DIQ(LRFILE,LRIEN,33,"I") I LRDATA="" Q
"RTN","AHMLDOS",106,0)
 .S LRORD=$P(LRDATA,";"),LRODT=$P(LRDATA,";",2),LRSND=$P(LRDATA,";",3)
"RTN","AHMLDOS",107,0)
 .Q:$G(LRORD)=""
"RTN","AHMLDOS",108,0)
 .Q:$G(LRODT)=""
"RTN","AHMLDOS",109,0)
 .Q:$G(LRSND)=""
"RTN","AHMLDOS",110,0)
 .I '$D(^LRO(69,LRODT,1,LRSND)) Q
"RTN","AHMLDOS",111,0)
 .I '$D(^LRO(69,LRODT,1,LRSND,2)) Q
"RTN","AHMLDOS",112,0)
 .S LRSEND=0 F  S LRSEND=$O(^LRO(69,LRODT,1,LRSND,2,LRSEND)) Q:LRSEND'?.N  D
"RTN","AHMLDOS",113,0)
 ..S ORN=$P(^LRO(69,LRODT,1,LRSND,2,LRSEND,0),U,7)
"RTN","AHMLDOS",114,0)
 ..I ORN=ORDNUM D
"RTN","AHMLDOS",115,0)
 ...S LRSN=LRSND,LRI=LRSEND,ORIFN=ORN
"RTN","AHMLDOS",116,0)
 ...S LRTEST=$P(^LRO(69,LRODT,1,LRSND,2,LRSEND,0),U)
"RTN","AHMLDOS",117,0)
 ...S LRSS=$$GET1^DIQ(60,LRTEST,4,"I")
"RTN","AHMLDOS",118,0)
 ...S LIEN=LRSN_","_LRODT_","
"RTN","AHMLDOS",119,0)
 ...S LRDFN=$$GET1^DIQ(69.01,LIEN,.01,"I")
"RTN","AHMLDOS",120,0)
 ...S PNM=$$GET1^DIQ(2,ORVP,.01,"I"),LRDPF=2
"RTN","AHMLDOS",121,0)
 ...S LRAA=$P(^LRO(69,LRODT,1,LRSND,2,LRSEND,0),U,4)
"RTN","AHMLDOS",122,0)
 ...S LRAD=$P(^LRO(69,LRODT,1,LRSND,2,LRSEND,0),U,3)
"RTN","AHMLDOS",123,0)
 ...S LRAN=$P(^LRO(69,LRODT,1,LRSND,2,LRSEND,0),U,5)
"RTN","AHMLDOS",124,0)
 .I LRAA'="",LRAD'="",LRAN'="" S FLAG=1
"RTN","AHMLDOS",125,0)
 I 'FLAG D
"RTN","AHMLDOS",126,0)
 .D DC^ORWDXA(.REC,ORID,ORNP,ORL,REASON,DCORIG,ISNEWORD)
"RTN","AHMLDOS",127,0)
 .D BLDSND^AHMLDOS1(.REC,.ORWREC)
"RTN","AHMLDOS",128,0)
 .K REC S ES="AA",ORWLST=""
"RTN","AHMLDOS",129,0)
 .D SEND^ORWDX(.ORWLST,ORVP,ORNP,ORL,ES,.ORWREC)
"RTN","AHMLDOS",130,0)
 .M REC=ORWLST K ORWLST
"RTN","AHMLDOS",131,0)
 .D UPDTOR(ORID)
"RTN","AHMLDOS",132,0)
 ;
"RTN","AHMLDOS",133,0)
 Q
"RTN","AHMLDOS",134,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS",135,0)
UPDTOR(ORID) ;
"RTN","AHMLDOS",136,0)
 S USR=$P(^OR(100,+ORID,8,2,0),"^",3)
"RTN","AHMLDOS",137,0)
 S $P(^OR(100,+ORID,8,2,0),"^",5)=USR
"RTN","AHMLDOS",138,0)
 S $P(^OR(100,+ORID,8,2,0),"^",13)=USR
"RTN","AHMLDOS",139,0)
 ;
"RTN","AHMLDOS",140,0)
 Q
"RTN","AHMLDOS1")
0^2^B158045468
"RTN","AHMLDOS1",1,0)
AHMLDOS1 ;LEIDOS/TCK; REMOTE ORDERING; 12/14/15 6:09pm ; 10/17/16 10:21am
"RTN","AHMLDOS1",2,0)
 ;;1.0;Remote orders;;JAN 1, 2016;Build 21
"RTN","AHMLDOS1",3,0)
 ;
"RTN","AHMLDOS1",4,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",5,0)
EN(REC,TYPE,LOC) ; Continuation of EN^AHMLDOS
"RTN","AHMLDOS1",6,0)
 ;
"RTN","AHMLDOS1",7,0)
 ;    Input:  REC - ^HL(772 data                     [required]
"RTN","AHMLDOS1",8,0)
 ;           TYPE - Order type (Lab, Imaging,...)    [required]
"RTN","AHMLDOS1",9,0)
 ;            LOC - Sending Facility                 [required]
"RTN","AHMLDOS1",10,0)
 ;
"RTN","AHMLDOS1",11,0)
 ;   Output: None.
"RTN","AHMLDOS1",12,0)
 ;
"RTN","AHMLDOS1",13,0)
 K ORD,OR,OLDOR,ORNUM
"RTN","AHMLDOS1",14,0)
 ;
"RTN","AHMLDOS1",15,0)
 Q:'$D(REC)
"RTN","AHMLDOS1",16,0)
 ;
"RTN","AHMLDOS1",17,0)
 S ACT=""
"RTN","AHMLDOS1",18,0)
 D ACTION(.REC,.ACT,.ORN)   ; get the Order Action and Ordering Lab Number
"RTN","AHMLDOS1",19,0)
 ;
"RTN","AHMLDOS1",20,0)
 I TYPE="LAB" D GTLDATA(.REC,.ORVP,.ORNP,.ORL,.DLG,.ORDG,.ORIT,.ORIFN,.OLDOR,TYPE,.REAS)
"RTN","AHMLDOS1",21,0)
 I ACKERR Q
"RTN","AHMLDOS1",22,0)
 ;
"RTN","AHMLDOS1",23,0)
 I TYPE="RAD" D GTRDATA(.REC,.ORVP,.ORNP,.ORL,.DLG,.ORDG,.ORIT,.ORIFN,.OLDOR,TYPE,.REAS)
"RTN","AHMLDOS1",24,0)
 I ACKERR Q
"RTN","AHMLDOS1",25,0)
 ;
"RTN","AHMLDOS1",26,0)
 I ACT="NW" D
"RTN","AHMLDOS1",27,0)
 .S PKG=$S(DLG="RA OERR EXAM":"RAD",DLG="LR OTHER LAB TESTS":"LAB")
"RTN","AHMLDOS1",28,0)
 .Q:'$D(REC)
"RTN","AHMLDOS1",29,0)
 .D @PKG
"RTN","AHMLDOS1",30,0)
 .I ACKERR Q
"RTN","AHMLDOS1",31,0)
 .;I $D(REC) D GTDATA(.REC,.ORVP,.ORNP,.ORL,.DLG,.ORDG,.ORIT,.ORIFN,TYPE)
"RTN","AHMLDOS1",32,0)
 .S (STS,REAS,ORUSR,ORTYP)=""
"RTN","AHMLDOS1",33,0)
 .I $D(REC) D SAVE^ORWDX(.REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,.ORDIALOG,STS,REAS,ORUSR,ORTYP)
"RTN","AHMLDOS1",34,0)
 .Q:'$D(REC)
"RTN","AHMLDOS1",35,0)
 .D BLDSND(.REC,.ORWREC,.ORNUM)
"RTN","AHMLDOS1",36,0)
 .Q:ERR
"RTN","AHMLDOS1",37,0)
 .S ES="AA"
"RTN","AHMLDOS1",38,0)
 .K REC
"RTN","AHMLDOS1",39,0)
 .D SEND^ORWDX(.ORWLST,ORVP,ORNP,ORL,ES,.ORWREC)
"RTN","AHMLDOS1",40,0)
 .M REC=ORWLST K ORWLST
"RTN","AHMLDOS1",41,0)
 .D UPDTOR(ORNUM,ORNP),BLDXRF(OLDOR,ORNUM)
"RTN","AHMLDOS1",42,0)
 .D CLNOR(ORNUM)
"RTN","AHMLDOS1",43,0)
 I ACKERR Q
"RTN","AHMLDOS1",44,0)
 I (ACT["OC")!(ACT["CA")!(ACT["DC") D
"RTN","AHMLDOS1",45,0)
 .Q:'$D(^XTMP(TYPE))
"RTN","AHMLDOS1",46,0)
 .I $D(^XTMP(TYPE,ORN)) S ORIFN=^XTMP(TYPE,ORN)
"RTN","AHMLDOS1",47,0)
 .Q:$G(ORIFN)'>0
"RTN","AHMLDOS1",48,0)
 .S ORID=$G(ORIFN),STAT=$G(STS),(DCORIG,ISNEWORD)=0
"RTN","AHMLDOS1",49,0)
 .I ORID'="" D
"RTN","AHMLDOS1",50,0)
 ..; GET ORDER LOCATION
"RTN","AHMLDOS1",51,0)
 ..S ORL=+$$GET1^DIQ(100,ORID,6,"I")
"RTN","AHMLDOS1",52,0)
 ..I ORID'[";" S ORID=ORID_";1"
"RTN","AHMLDOS1",53,0)
 ..D DC^AHMLDOS(.REC,ORID,ORVP,ORNP,ORL,REAS,DCORIG,ISNEWORD)
"RTN","AHMLDOS1",54,0)
 ;
"RTN","AHMLDOS1",55,0)
 Q
"RTN","AHMLDOS1",56,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",57,0)
CLNOR(ORNUM) ;
"RTN","AHMLDOS1",58,0)
 Q:$G(ORNUM)'>0
"RTN","AHMLDOS1",59,0)
 S ORNUM=+ORNUM,ORIFN=ORNUM
"RTN","AHMLDOS1",60,0)
 I $D(^OR(100,ORIFN,8,1,.1)) S N=$P(^OR(100,ORIFN,8,1,.1,0),"^",3)
"RTN","AHMLDOS1",61,0)
 Q:$G(N)'>1
"RTN","AHMLDOS1",62,0)
 S ST=^OR(100,ORIFN,8,1,.1,2,0),ST=$TR(ST," ","")
"RTN","AHMLDOS1",63,0)
 I ST[":" S ST=$P(ST,":",2)
"RTN","AHMLDOS1",64,0)
 I ST?.A D
"RTN","AHMLDOS1",65,0)
 .S $P(^OR(100,ORIFN,8,1,.1,0),"^",3)=N-1,$P(^OR(100,ORIFN,8,1,.1,0),"^",4)=N-1
"RTN","AHMLDOS1",66,0)
 .K ^OR(100,ORIFN,8,1,.1,2,0)
"RTN","AHMLDOS1",67,0)
 ;
"RTN","AHMLDOS1",68,0)
 Q
"RTN","AHMLDOS1",69,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",70,0)
UPDTOR(ORNUM,ORNP) ;
"RTN","AHMLDOS1",71,0)
 Q:$G(OR)'>0
"RTN","AHMLDOS1",72,0)
 S ORNUM=+ORNUM
"RTN","AHMLDOS1",73,0)
 S LRIENS=1_","_ORNUM_","
"RTN","AHMLDOS1",74,0)
 S LRFDA(1,100.008,LRIENS,13)=ORNP
"RTN","AHMLDOS1",75,0)
 D UPDATE^DIE("","LRFDA(1)","LRMSG")
"RTN","AHMLDOS1",76,0)
 ;S LRIEN="+1,"_+OR_","
"RTN","AHMLDOS1",77,0)
 ;S LRFDA(2,100.002,LRIEN,.01)=$G(OLDOR)
"RTN","AHMLDOS1",78,0)
 ;D UPDATE^DIE("","LRFDA(2)","LRMSG")
"RTN","AHMLDOS1",79,0)
 ;
"RTN","AHMLDOS1",80,0)
 Q
"RTN","AHMLDOS1",81,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",82,0)
BLDXRF(OLDOR,ORNUM) ;
"RTN","AHMLDOS1",83,0)
 I '$D(^XTMP(TYPE)) D SETZERO(TYPE)
"RTN","AHMLDOS1",84,0)
 Q:'$D(^XTMP(TYPE))
"RTN","AHMLDOS1",85,0)
 I $D(^XTMP(TYPE)) D
"RTN","AHMLDOS1",86,0)
 .S ^XTMP(TYPE,+OLDOR)=+ORNUM
"RTN","AHMLDOS1",87,0)
 .S ^XTMP(TYPE,"B",+ORNUM)=+OLDOR
"RTN","AHMLDOS1",88,0)
 .S ^XTMP(TYPE,"CNT")=$G(^XTMP(TYPE,"CNT"))+1
"RTN","AHMLDOS1",89,0)
 I '$D(^XTMP(TYPE)) D SETZERO(TYPE)
"RTN","AHMLDOS1",90,0)
 ;
"RTN","AHMLDOS1",91,0)
 Q
"RTN","AHMLDOS1",92,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",93,0)
SETZERO(TYPE) ;
"RTN","AHMLDOS1",94,0)
 D NOW^%DTC S X1=$P(%,".",1),X2=365,Y=X1 D C^%DTC
"RTN","AHMLDOS1",95,0)
 S ^XTMP(TYPE,0)=X_"^"_Y_" OR XREF FOR REMOTE ORDER"
"RTN","AHMLDOS1",96,0)
 S ^XTMP(TYPE,0,"CNT")=0
"RTN","AHMLDOS1",97,0)
 ;
"RTN","AHMLDOS1",98,0)
 Q
"RTN","AHMLDOS1",99,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",100,0)
ACTION(REC,ACT,ORN) ; Search for order segment, return ordering lab
"RTN","AHMLDOS1",101,0)
 ;                    number, and order action.
"RTN","AHMLDOS1",102,0)
 ;
"RTN","AHMLDOS1",103,0)
 ;    Input: REC - ^HL(772 data                     [required]
"RTN","AHMLDOS1",104,0)
 ;
"RTN","AHMLDOS1",105,0)
 ;   Output: ACT - Order Control (NW=New, CA=Cancel, DC=Discontinue,
"RTN","AHMLDOS1",106,0)
 ;                                HD=Hold, RL=Release/cancel previous
"RTN","AHMLDOS1",107,0)
 ;                                hold, XO=Change/Update)
"RTN","AHMLDOS1",108,0)
 ;           ORN - Ordering Lab Number
"RTN","AHMLDOS1",109,0)
 ;
"RTN","AHMLDOS1",110,0)
 N I,STOP
"RTN","AHMLDOS1",111,0)
 ;
"RTN","AHMLDOS1",112,0)
 S (ACT,I)="",STOP=0
"RTN","AHMLDOS1",113,0)
 ;
"RTN","AHMLDOS1",114,0)
 F  S I=$O(REC(I)) Q:I=""  D  Q:STOP
"RTN","AHMLDOS1",115,0)
  .I $P(REC(I),"|")="ORC" D            ; order segment
"RTN","AHMLDOS1",116,0)
   ..S ORN=+$P(REC(I),"|",3)           ; Ordering Lab Number
"RTN","AHMLDOS1",117,0)
   ..S ACT=$P(REC(I),"|",2)            ; Order Action
"RTN","AHMLDOS1",118,0)
   ..S STOP=1
"RTN","AHMLDOS1",119,0)
 ;
"RTN","AHMLDOS1",120,0)
 Q
"RTN","AHMLDOS1",121,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",122,0)
BLDSND(REC,ORWREC,ORNUM) ;
"RTN","AHMLDOS1",123,0)
 Q:'$D(REC(1))
"RTN","AHMLDOS1",124,0)
 S ORNUM=$P(REC(1),"^")
"RTN","AHMLDOS1",125,0)
 S ORNUM=$E(ORNUM,2,99)
"RTN","AHMLDOS1",126,0)
 S ORWREC(1)=ORNUM_"^"_1_"^"_1_"^"_"E"
"RTN","AHMLDOS1",127,0)
 ;
"RTN","AHMLDOS1",128,0)
 Q
"RTN","AHMLDOS1",129,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",130,0)
GTRDATA(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,OLDOR,TYPE,REAS) ;
"RTN","AHMLDOS1",131,0)
 ;
"RTN","AHMLDOS1",132,0)
 ;    Input: REC - ^HL(772 data                      [required]
"RTN","AHMLDOS1",133,0)
 ;           TYPE - Order type = RAD                 [required]
"RTN","AHMLDOS1",134,0)
 ;
"RTN","AHMLDOS1",135,0)
 ;    Output: None.
"RTN","AHMLDOS1",136,0)
 ;
"RTN","AHMLDOS1",137,0)
 N I,CNT
"RTN","AHMLDOS1",138,0)
 ;
"RTN","AHMLDOS1",139,0)
 S (ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN)=""
"RTN","AHMLDOS1",140,0)
 ;
"RTN","AHMLDOS1",141,0)
 S DLG="RA OERR EXAM"
"RTN","AHMLDOS1",142,0)
 S ORIT=$O(^ORD(101.41,"AB",DLG,0))
"RTN","AHMLDOS1",143,0)
 S ORDG=$O(^ORD(100.98,"B",TYPE,0))
"RTN","AHMLDOS1",144,0)
 S I="" F  S I=$O(REC(I)) Q:I=""  D  Q:$G(ACKERR)
"RTN","AHMLDOS1",145,0)
 .S MSGNDE=REC(I),MSGTYP=$P($G(MSGNDE),"|")
"RTN","AHMLDOS1",146,0)
 .Q:MSGTYP=""
"RTN","AHMLDOS1",147,0)
 .Q:MSGTYP["BHS"
"RTN","AHMLDOS1",148,0)
 .I MSGTYP["MSH",$P(MSGNDE,"|",9)="ORR" Q
"RTN","AHMLDOS1",149,0)
 .I MSGTYP["PID" D
"RTN","AHMLDOS1",150,0)
 ..S ORVP=$P(MSGNDE,"|",4),ORVPNME=$P(MSGNDE,"|",6)
"RTN","AHMLDOS1",151,0)
 ..I $D(^DPT("B",ORVPNME)) D
"RTN","AHMLDOS1",152,0)
 ...S ORVP="",ORVP=$O(^DPT("B",ORVPNME,ORVP))
"RTN","AHMLDOS1",153,0)
 .I MSGTYP["PV1" D
"RTN","AHMLDOS1",154,0)
 ..S ORL=$P(REC(I),"|",4)
"RTN","AHMLDOS1",155,0)
 ..S CAT=$P(REC(I),"|",3)
"RTN","AHMLDOS1",156,0)
 .I MSGTYP["ORC" D
"RTN","AHMLDOS1",157,0)
 ..S OLDOR=+$P(MSGNDE,"|",3)
"RTN","AHMLDOS1",158,0)
 ..S ORNPNME=$P($P(MSGNDE,"|",13),"^",2)
"RTN","AHMLDOS1",159,0)
 ..I $D(^VA(200,"B",ORNPNME)) D
"RTN","AHMLDOS1",160,0)
 ...S ORNP="",ORNP=$O(^VA(200,"B",ORNPNME,ORNP)),ORUSR=ORNP,DUZ=ORNP
"RTN","AHMLDOS1",161,0)
 ..S DTDSIRED=$P($P(MSGNDE,"|",8),"^",4)
"RTN","AHMLDOS1",162,0)
 ..S URG=$P($P(MSGNDE,"|",8),"^",6)
"RTN","AHMLDOS1",163,0)
 ..I $G(URG)'="" S URIEN="",URIEN=$O(^ORD(101.42,"C",URG,URIEN))
"RTN","AHMLDOS1",164,0)
 ..I $G(URIEN)'="" S URG=URIEN
"RTN","AHMLDOS1",165,0)
 ..S REAS=$P($P(MSGNDE,"|",17),"^",5)
"RTN","AHMLDOS1",166,0)
 .I MSGTYP["OBR" D  Q:ACKERR
"RTN","AHMLDOS1",167,0)
 ..S OBRNDE=REC(I)
"RTN","AHMLDOS1",168,0)
 ..S PROC=$P($P(OBRNDE,"|",5),"^",4),PROCNME=$P($P(OBRNDE,"|",5),"^",5)
"RTN","AHMLDOS1",169,0)
 ..I PROCNME="" D  S ACKERR=1 Q
"RTN","AHMLDOS1",170,0)
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","RAD PROCEDURE NOT FOUND")
"RTN","AHMLDOS1",171,0)
 ..S ISOL=$P(OBRNDE,"|",13) I ISOL'="" S ISOL=1
"RTN","AHMLDOS1",172,0)
 ..S PMOD=$P(OBRNDE,"|",19)
"RTN","AHMLDOS1",173,0)
 ..I $G(PMOD)'["~" D
"RTN","AHMLDOS1",174,0)
 ...S X=PMOD
"RTN","AHMLDOS1",175,0)
 ...Q:X=""
"RTN","AHMLDOS1",176,0)
 ...S PTR="",PTR=$O(^RAMIS(71.2,"B",X,PTR))
"RTN","AHMLDOS1",177,0)
 ...I PTR'="" S PMOD(1)=PTR
"RTN","AHMLDOS1",178,0)
 ..I $G(PMOD)["~" D
"RTN","AHMLDOS1",179,0)
 ...F III=1:1 S X=$P(PMOD,"~",III)  D  Q:X=""
"RTN","AHMLDOS1",180,0)
 ....Q:X=""
"RTN","AHMLDOS1",181,0)
 ....S PTR="",PTR=$O(^RAMIS(71.2,"B",X,PTR))
"RTN","AHMLDOS1",182,0)
 ....I PTR'="" S PMOD(III)=PTR
"RTN","AHMLDOS1",183,0)
 ..S MDE=$P(OBRNDE,"|",31),MDE=$E(MDE,1)
"RTN","AHMLDOS1",184,0)
 ..I REAS="" S REAS=$P($P(OBRNDE,"|",32),"^",2)
"RTN","AHMLDOS1",185,0)
 ..S LOC=565,LOCNME=$$GET1^DIQ(4,LOC,.01,"E")
"RTN","AHMLDOS1",186,0)
 ..S SBRQ=+$P(OBRNDE,"|",20)
"RTN","AHMLDOS1",187,0)
 .I MSGTYP["OBX" D  Q:ACKERR
"RTN","AHMLDOS1",188,0)
 ..S OBXNDE=REC(I)
"RTN","AHMLDOS1",189,0)
 ..S FLD=$P($P(OBXNDE,"|",4),"^",2)
"RTN","AHMLDOS1",190,0)
 ..I FLD["PRE-OP" D
"RTN","AHMLDOS1",191,0)
 ...S PREOP=$P(OBXNDE,"|",6),PREOP=$$HL7TFM^XLFDT(PREOP)
"RTN","AHMLDOS1",192,0)
 ..I FLD["PREG" D
"RTN","AHMLDOS1",193,0)
 ...S PREG=$P(OBXNDE,"|",6),PREG=$E(PREG,1)
"RTN","AHMLDOS1",194,0)
 ..I FLD["CLINICAL" D
"RTN","AHMLDOS1",195,0)
 ...I '$D(BCH) S CNT=1,BCH(CNT)=$P(OBXNDE,"|",6)
"RTN","AHMLDOS1",196,0)
 ...I $D(BCH) S CNT=$O(BCH(99),-1),CNT=$G(CNT)+1,BCH(CNT)=$P(OBXNDE,"|",6)
"RTN","AHMLDOS1",197,0)
 W !,"END OF GETRDATA"
"RTN","AHMLDOS1",198,0)
 ;
"RTN","AHMLDOS1",199,0)
 Q
"RTN","AHMLDOS1",200,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",201,0)
GTLDATA(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,OLDOR,TYPE,REAS) ;
"RTN","AHMLDOS1",202,0)
 ;
"RTN","AHMLDOS1",203,0)
 ;    Function: get lab data in HL7 MESSAGE
"RTN","AHMLDOS1",204,0)
 ;       Input:  REC - ^HL(772 data                     [required]
"RTN","AHMLDOS1",205,0)
 ;              TYPE - Order type = LAB                 [required]
"RTN","AHMLDOS1",206,0)
 ;
"RTN","AHMLDOS1",207,0)
 ;   Output: None.
"RTN","AHMLDOS1",208,0)
 ;
"RTN","AHMLDOS1",209,0)
 N I,CNT
"RTN","AHMLDOS1",210,0)
 ;
"RTN","AHMLDOS1",211,0)
 S (ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN)=""
"RTN","AHMLDOS1",212,0)
 ;
"RTN","AHMLDOS1",213,0)
 S DLG="LR OTHER LAB TESTS"
"RTN","AHMLDOS1",214,0)
 ;I TYPE="RAD" S DLG="RA OERR EXAM"
"RTN","AHMLDOS1",215,0)
 S ORIT=$O(^ORD(101.41,"AB",DLG,0))
"RTN","AHMLDOS1",216,0)
 S ORDG=$O(^ORD(100.98,"B",TYPE,0))
"RTN","AHMLDOS1",217,0)
 S I="" F  S I=$O(REC(I)) Q:I=""  D
"RTN","AHMLDOS1",218,0)
 .S MSGNDE=REC(I),MSGTYP=$P($G(MSGNDE),"|")
"RTN","AHMLDOS1",219,0)
 .Q:MSGTYP=""
"RTN","AHMLDOS1",220,0)
 .Q:MSGTYP["BHS"
"RTN","AHMLDOS1",221,0)
 .I MSGTYP["MSH",$P(MSGNDE,"|",9)="ORR" Q
"RTN","AHMLDOS1",222,0)
 .I MSGTYP["PID" D
"RTN","AHMLDOS1",223,0)
 ..S ORVP=$P(MSGNDE,"|",4),ORVPNME=$P(MSGNDE,"|",6)
"RTN","AHMLDOS1",224,0)
 ..I $D(^DPT("B",ORVPNME)) D
"RTN","AHMLDOS1",225,0)
 ...S ORVP="",ORVP=$O(^DPT("B",ORVPNME,ORVP))
"RTN","AHMLDOS1",226,0)
 .I MSGTYP["PV1" D
"RTN","AHMLDOS1",227,0)
 ..S ORL=$P(REC(I),"|",4)
"RTN","AHMLDOS1",228,0)
 .I MSGTYP["ORC" D
"RTN","AHMLDOS1",229,0)
 ..S OLDOR=+$P(MSGNDE,"|",3)
"RTN","AHMLDOS1",230,0)
 ..S ORNPNME=$P($P(MSGNDE,"|",13),"^",2)
"RTN","AHMLDOS1",231,0)
 ..I $D(^VA(200,"B",ORNPNME)) D
"RTN","AHMLDOS1",232,0)
 ...S ORNP="",ORNP=$O(^VA(200,"B",ORNPNME,ORNP)),DUZ=ORNP,ORUSR=ORNP
"RTN","AHMLDOS1",233,0)
 ..S COL=$P($P(MSGNDE,"|",8),"^",4)
"RTN","AHMLDOS1",234,0)
 ..S COL=$$HL7TFM^XLFDT(COL,"L")
"RTN","AHMLDOS1",235,0)
 ..;I $P(COL,".",2)="" S COL="TODAY"
"RTN","AHMLDOS1",236,0)
 ..S COLLECTIONDATETIME=COL
"RTN","AHMLDOS1",237,0)
 ..S START=COLLECTIONDATETIME
"RTN","AHMLDOS1",238,0)
 ..S REAS=$P($P(MSGNDE,"|",17),"^",4)
"RTN","AHMLDOS1",239,0)
 .I MSGTYP["OBR" D  Q:ACKERR
"RTN","AHMLDOS1",240,0)
 ..S OBRNDE=REC(I)
"RTN","AHMLDOS1",241,0)
 ..S TSTNDE=$P(OBRNDE,"|",5)
"RTN","AHMLDOS1",242,0)
 ..I TSTNDE'="" S TSTNME=$P(TSTNDE,"^",5)
"RTN","AHMLDOS1",243,0)
 ..I TSTNME="" D  S ACKERR=1 Q
"RTN","AHMLDOS1",244,0)
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","LAB TEST NOT FOUND")
"RTN","AHMLDOS1",245,0)
 ..I '$D(^LAB(60,"B",TSTNME)) D  S ACKERR=1 Q
"RTN","AHMLDOS1",246,0)
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","LAB TEST NOT FOUND")
"RTN","AHMLDOS1",247,0)
 ..S LABTEST="",LABTEST=$O(^LAB(60,"B",TSTNME,LABTEST))
"RTN","AHMLDOS1",248,0)
 ..I LABTEST="" D  S ACKERR=1 Q
"RTN","AHMLDOS1",249,0)
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","LAB TEST NOT FOUND")
"RTN","AHMLDOS1",250,0)
 ..S SAMPLE=$P(OBRNDE,"|",16),SAMPLE=+$P(SAMPLE,"^",4)
"RTN","AHMLDOS1",251,0)
 ..S SPECIMEN=$P(OBRNDE,"|",16),SPECIMEN=$P(SPECIMEN,";",4)
"RTN","AHMLDOS1",252,0)
 ..S COLLECTEDBY="SP",HOWOFTEN=28
"RTN","AHMLDOS1",253,0)
 ..S URG=$P($P(OBRNDE,"|",28),"^",6),URGENCY=$P(URG,";",2)
"RTN","AHMLDOS1",254,0)
 ..S LOC=565
"RTN","AHMLDOS1",255,0)
 ..S LOCNME=$$GET1^DIQ(4,LOC,.01,"E")
"RTN","AHMLDOS1",256,0)
 K OR,ORDT,ORD
"RTN","AHMLDOS1",257,0)
 ;
"RTN","AHMLDOS1",258,0)
 Q
"RTN","AHMLDOS1",259,0)
 ;--------------------------------------------------------------------
"RTN","AHMLDOS1",260,0)
RAD ;
"RTN","AHMLDOS1",261,0)
 N DA,NDE,TMP,CTYP,CTYPE,OI,JVORD,D,UR,HL,HO
"RTN","AHMLDOS1",262,0)
 S ERR=0,(OI,OR)=""
"RTN","AHMLDOS1",263,0)
 Q:$G(ORIT)'>0
"RTN","AHMLDOS1",264,0)
 K ORDIALOG D BLDARY(ORIT,.OR,.ORT)
"RTN","AHMLDOS1",265,0)
 K ORDIALOG
"RTN","AHMLDOS1",266,0)
 S VAL="" F  S VAL=$O(ORT(VAL)) Q:VAL=""!(ERR)  D  Q:ACKERR
"RTN","AHMLDOS1",267,0)
 .S (CTYP,CTYPE)=""
"RTN","AHMLDOS1",268,0)
 .S STRG=VAL
"RTN","AHMLDOS1",269,0)
 .I $TR(STRG," ")="PROCEDURE" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D  Q:ACKERR
"RTN","AHMLDOS1",270,0)
 ..Q:$G(PROC)'>0
"RTN","AHMLDOS1",271,0)
 ..S TEST=PROC_";99RAP"
"RTN","AHMLDOS1",272,0)
 ..D GETOINUM^ORWDCN32(.OI,TEST)
"RTN","AHMLDOS1",273,0)
 ..I $G(OI)="" D  S ACKERR=1 Q
"RTN","AHMLDOS1",274,0)
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Radiology order number is missing or invalid.")
"RTN","AHMLDOS1",275,0)
 ..;I $G(OI)="" S ERR=1,LSTN=LSTN+1,REC(LSTN)="Error: Radiology order number is missing or invalid." Q
"RTN","AHMLDOS1",276,0)
 ..S ORDIALOG(NN,1)=$G(OI)      D
"RTN","AHMLDOS1",277,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",278,0)
 .I $TR(STRG," ")="MODEOFTRANSPORT" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",279,0)
 ..S ORDIALOG(NN,1)=$G(MDE)
"RTN","AHMLDOS1",280,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",281,0)
 .I $TR(STRG," ")="DATEDESIRED" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",282,0)
 ..S DTDSIRED=$$HL7TFM^XLFDT(DTDSIRED)
"RTN","AHMLDOS1",283,0)
 ..S ORDIALOG(NN,1)=$G(DTDSIRED)
"RTN","AHMLDOS1",284,0)
 .I $TR(STRG," ")="REASONFORSTUDY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",285,0)
 ..S ORDIALOG(NN,1)=$G(REAS)
"RTN","AHMLDOS1",286,0)
 .I $TR(STRG," ")="PREGNANT" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",287,0)
 ..S ORDIALOG(NN,1)=$G(PREG)
"RTN","AHMLDOS1",288,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",289,0)
 .I $TR(STRG," ")="PRE-OPSCHEDULEDDATE/TIME" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",290,0)
 ..S ORDIALOG(NN,1)=$G(PREOP)
"RTN","AHMLDOS1",291,0)
 .I $TR(STRG," ")="CLINICALHISTORY" S NN="",NN=$O(ORT(STRG,"")) D
"RTN","AHMLDOS1",292,0)
 ..Q:'$D(BCH)
"RTN","AHMLDOS1",293,0)
 ..D BLDWP(NN,.BCH)
"RTN","AHMLDOS1",294,0)
 ..;S ORDIALOG(NN,1)=$G(BCH) D BLDWP(NN,BCH)
"RTN","AHMLDOS1",295,0)
 .I $TR(STRG," ")="SUBMITREQUESTTO" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",296,0)
 ..S ORDIALOG(NN,1)=$G(SBRQ)
"RTN","AHMLDOS1",297,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",298,0)
 .I $TR(STRG," ")="PROCEDUREMODIFIER" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",299,0)
 ..Q:'$D(PMOD(1))
"RTN","AHMLDOS1",300,0)
 ..S CNT="" F  S CNT=$O(PMOD(CNT)) Q:CNT=""  D
"RTN","AHMLDOS1",301,0)
 ...Q:$G(CNT)'>0
"RTN","AHMLDOS1",302,0)
 ...S ORDIALOG(NN,CNT)=$G(PMOD(CNT))
"RTN","AHMLDOS1",303,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",304,0)
 .I $TR(STRG," ")="CATEGORY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",305,0)
 ..S ORDIALOG(NN,1)=$G(CAT)
"RTN","AHMLDOS1",306,0)
 .I $TR(STRG," ")="URGENCY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",307,0)
 ..S ORDIALOG(NN,1)=$G(URG)
"RTN","AHMLDOS1",308,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",309,0)
 .I $TR(STRG," ")="ORDERINGLOCATION" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",310,0)
 ..S ORDIALOG(NN,1)=$G(ORL)
"RTN","AHMLDOS1",311,0)
 .I $TR(STRG," ")="APPROVINGRAD/NUCMEDPHYS" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",312,0)
 ..S ORDIALOG(NN,1)=$G(ORNP)
"RTN","AHMLDOS1",313,0)
  .I $TR(STRG," ")="ISPATIENTONISOLATIONPROCEDURES?" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",314,0)
 ..S ORDIALOG(NN,1)=$G(ISOL)
"RTN","AHMLDOS1",315,0)
 .I $TR(STRG," ")="LOCATION" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",316,0)
 ..S ORDIALOG(NN,1)=$G(LOCNME)
"RTN","AHMLDOS1",317,0)
 Q
"RTN","AHMLDOS1",318,0)
 ;
"RTN","AHMLDOS1",319,0)
LAB ;
"RTN","AHMLDOS1",320,0)
 N DA,NDE,TMP,CTYP,CTYPE,OI,JVORD,D,UR,HL,HO
"RTN","AHMLDOS1",321,0)
 S ERR=0,(OI,OR)=""
"RTN","AHMLDOS1",322,0)
 Q:$G(ORIT)'>0
"RTN","AHMLDOS1",323,0)
 K ORDIALOG D BLDARY(ORIT,.OR,.ORT)
"RTN","AHMLDOS1",324,0)
 K ORDIALOG ;M ORDIALOG=ORD K ORD
"RTN","AHMLDOS1",325,0)
 S VAL="" F  S VAL=$O(ORT(VAL)) Q:VAL=""!(ERR)  D  Q:ACKERR
"RTN","AHMLDOS1",326,0)
 .S (CTYP,CTYPE)=""
"RTN","AHMLDOS1",327,0)
 .S STRG=VAL
"RTN","AHMLDOS1",328,0)
 .I $TR(STRG," ")="LABTEST" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D  Q:ACKERR
"RTN","AHMLDOS1",329,0)
 ..Q:$G(LABTEST)'>0
"RTN","AHMLDOS1",330,0)
 ..S TST=LABTEST_";99LRT"
"RTN","AHMLDOS1",331,0)
 ..D GETOINUM^ORWDCN32(.OI,TST)
"RTN","AHMLDOS1",332,0)
 ..I $G(OI)="" D  S ACKERR=1 Q
"RTN","AHMLDOS1",333,0)
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Laboratory order number is missing or invalid.")
"RTN","AHMLDOS1",334,0)
 ..S ORDIALOG(NN,1)=$G(OI)
"RTN","AHMLDOS1",335,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",336,0)
 .I $TR(STRG," ")="COLLECTIONDATE/TIME" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",337,0)
 ..S ORDIALOG(NN,1)=$G(START)
"RTN","AHMLDOS1",338,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",339,0)
 .;I $TR(STRG," ")="COMMENTS" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",340,0)
 ..;S ORDIALOG(NN,1)=COMMENT I COMMENT'="" D BLDWP(NN,COMMENT)
"RTN","AHMLDOS1",341,0)
 .I $TR(STRG," ")="COLLECTEDBY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",342,0)
 ..S ORDIALOG(NN,1)="SP"
"RTN","AHMLDOS1",343,0)
 .I $TR(STRG," ")="HOWOFTEN" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",344,0)
 ..S ORDIALOG(NN,1)=28
"RTN","AHMLDOS1",345,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",346,0)
 .I $TR(STRG," ")="SPECIMEN" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",347,0)
 ..S ORDIALOG(NN,1)=SAMPLE
"RTN","AHMLDOS1",348,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",349,0)
 .I $TR(STRG," ")="COLLECTIONSAMPLE" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",350,0)
 ..S ORDIALOG(NN,1)=SPECIMEN
"RTN","AHMLDOS1",351,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",352,0)
 .I $TR(STRG," ")="URGENCY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",353,0)
 ..S ORDIALOG(NN,1)=$G(URGENCY)
"RTN","AHMLDOS1",354,0)
 ..K ORT(STRG)
"RTN","AHMLDOS1",355,0)
 .I $TR(STRG," ")="LOCATION" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D
"RTN","AHMLDOS1",356,0)
 ..S ORDIALOG(NN,1)=$G(LOCNME)
"RTN","AHMLDOS1",357,0)
 ;
"RTN","AHMLDOS1",358,0)
 Q
"RTN","AHMLDOS1",359,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",360,0)
BLDWP(NN,BCH) ;
"RTN","AHMLDOS1",361,0)
 N I
"RTN","AHMLDOS1",362,0)
 S CNT=99,CNT=$O(BCH(CNT),-1)
"RTN","AHMLDOS1",363,0)
 F I=1:1:CNT D
"RTN","AHMLDOS1",364,0)
 .S ORDIALOG("WP",NN,1,I,0)=$G(BCH(I))
"RTN","AHMLDOS1",365,0)
 S ORDIALOG(NN,1)="ORDIALOG(""WP"","_NN_",1)"
"RTN","AHMLDOS1",366,0)
 ;
"RTN","AHMLDOS1",367,0)
 Q
"RTN","AHMLDOS1",368,0)
 ;-----------------------------------------------------------------------
"RTN","AHMLDOS1",369,0)
BLDARY(ORIT,OR,ORT) ;
"RTN","AHMLDOS1",370,0)
 Q:$G(ORIT)'>0
"RTN","AHMLDOS1",371,0)
 N TXT,TMP,NM
"RTN","AHMLDOS1",372,0)
 D GETDLG^ORCD(ORIT)
"RTN","AHMLDOS1",373,0)
 S TXT="" F  S TXT=$O(ORDIALOG("B",TXT)) Q:TXT=""  D
"RTN","AHMLDOS1",374,0)
 .S TMP=$TR(TXT," "),ORDT("B",TMP)=ORDIALOG("B",TXT)
"RTN","AHMLDOS1",375,0)
 S TXT="" F  S TXT=$O(ORDT("B",TXT)) Q:TXT=""  D
"RTN","AHMLDOS1",376,0)
 .I $D(ORDT("B",$TR(TXT," "))) S NM=$P($G(ORDT("B",$TR(TXT," "))),U,2)
"RTN","AHMLDOS1",377,0)
 .S ORD(NM,1)="" S ORD(NM,1)=ORDT("B",TXT) S ORT(TXT,NM)="" S ORT(TXT,NM)=ORD(NM,1)
"RTN","AHMLDOS1",378,0)
 Q
"VER")
8.0^22.0
**END**
**END**
