{\rtf1\ansi\ansicpg1252\deff0\deflang1033{\fonttbl{\f0\fnil\fcharset0 Calibri;}}
{\*\generator Msftedit 5.41.21.2510;}\viewkind4\uc1\pard\sl240\slmult1\lang9\f0\fs22 KIDS Distribution saved on Feb 22, 2017@17:57:44\par
FIXED REPORT LOCATION\par
**KIDS**:AHMLDO*1.0*2^\par
\par
**INSTALL NAME**\par
AHMLDO*1.0*2\par
"BLD",9643,0)\par
AHMLDO*1.0*2^MOBILE SCHEDULING APPLICATIONS^0^3170222^y\par
"BLD",9643,1,0)\par
^^1^1^3161017^^\par
"BLD",9643,1,1,0)\par
Remote ordering spoke KIDS BUILD\par
"BLD",9643,4,0)\par
^9.64PA^^\par
"BLD",9643,6.3)\par
42\par
"BLD",9643,"INID")\par
^n\par
"BLD",9643,"INIT")\par
\par
"BLD",9643,"KRN",0)\par
^9.67PA^779.2^20\par
"BLD",9643,"KRN",.4,0)\par
.4\par
"BLD",9643,"KRN",.401,0)\par
.401\par
"BLD",9643,"KRN",.402,0)\par
.402\par
"BLD",9643,"KRN",.403,0)\par
.403\par
"BLD",9643,"KRN",.5,0)\par
.5\par
"BLD",9643,"KRN",.84,0)\par
.84\par
"BLD",9643,"KRN",3.6,0)\par
3.6\par
"BLD",9643,"KRN",3.8,0)\par
3.8\par
"BLD",9643,"KRN",9.2,0)\par
9.2\par
"BLD",9643,"KRN",9.8,0)\par
9.8\par
"BLD",9643,"KRN",9.8,"NM",0)\par
^9.68A^7^6\par
"BLD",9643,"KRN",9.8,"NM",1,0)\par
AHMLDOS^^0^B33133808\par
"BLD",9643,"KRN",9.8,"NM",2,0)\par
AHMLDOS1^^0^B244427349\par
"BLD",9643,"KRN",9.8,"NM",4,0)\par
AHMLDORO^^0^B98154804\par
"BLD",9643,"KRN",9.8,"NM",5,0)\par
AHMLDOP1^^0^B125247937\par
"BLD",9643,"KRN",9.8,"NM",6,0)\par
AHMLDOP2^^0^B176410274\par
"BLD",9643,"KRN",9.8,"NM",7,0)\par
AHMLDOL0^^0^B39982002\par
"BLD",9643,"KRN",9.8,"NM","B","AHMLDOL0",7)\par
\par
"BLD",9643,"KRN",9.8,"NM","B","AHMLDOP1",5)\par
\par
"BLD",9643,"KRN",9.8,"NM","B","AHMLDOP2",6)\par
\par
"BLD",9643,"KRN",9.8,"NM","B","AHMLDORO",4)\par
\par
"BLD",9643,"KRN",9.8,"NM","B","AHMLDOS",1)\par
\par
"BLD",9643,"KRN",9.8,"NM","B","AHMLDOS1",2)\par
\par
"BLD",9643,"KRN",19,0)\par
19\par
"BLD",9643,"KRN",19,"NM",0)\par
^9.68A^^0\par
"BLD",9643,"KRN",19.1,0)\par
19.1\par
"BLD",9643,"KRN",101,0)\par
101\par
"BLD",9643,"KRN",101,"NM",0)\par
^9.68A^40^27\par
"BLD",9643,"KRN",101,"NM",1,0)\par
AHMLDOL 500 ORM-O01 EVENT^^0\par
"BLD",9643,"KRN",101,"NM",2,0)\par
AHMLDOL 500 ORM-O01 SUBS^^0\par
"BLD",9643,"KRN",101,"NM",3,0)\par
AHMLDOL EVSEND CPRS^^0\par
"BLD",9643,"KRN",101,"NM",4,0)\par
AHMLDOL EVSEND REMOTE^^0\par
"BLD",9643,"KRN",101,"NM",5,0)\par
AHMLDOR 500 ORM-O01 EVENT^^0\par
"BLD",9643,"KRN",101,"NM",6,0)\par
AHMLDOR 500 ORM-O01 SUBS^^0\par
"BLD",9643,"KRN",101,"NM",15,0)\par
AHMLDOR REMOTE DC EVENT^^0\par
"BLD",9643,"KRN",101,"NM",16,0)\par
AHMLDOR REMOTE DC SUBS^^0\par
"BLD",9643,"KRN",101,"NM",17,0)\par
AHMLDOR EVSEND CPRS^^0\par
"BLD",9643,"KRN",101,"NM",18,0)\par
AHMLDOR EVSEND REMOTE^^0\par
"BLD",9643,"KRN",101,"NM",23,0)\par
AHMLDOR REG RMTE EVENT^^0\par
"BLD",9643,"KRN",101,"NM",24,0)\par
AHMLDOR REG RMTE SUBS^^0\par
"BLD",9643,"KRN",101,"NM",25,0)\par
AHMLDOR REG ORM SEND^^0\par
"BLD",9643,"KRN",101,"NM",26,0)\par
AHMLDOR CANCEL ORM SEND^^0\par
"BLD",9643,"KRN",101,"NM",27,0)\par
AHMLDOR RPT RMTE EVENT^^0\par
"BLD",9643,"KRN",101,"NM",28,0)\par
AHMLDOR RPT RMTE SUBS^^0\par
"BLD",9643,"KRN",101,"NM",30,0)\par
AHMLDOL REMOTE ORM-O01 EVENT^^0\par
"BLD",9643,"KRN",101,"NM",31,0)\par
AHMLDOL REMOTE ORM-O01 SUBS^^0\par
"BLD",9643,"KRN",101,"NM",32,0)\par
RA CANCEL 2.4^^2\par
"BLD",9643,"KRN",101,"NM",33,0)\par
RA REG 2.4^^2\par
"BLD",9643,"KRN",101,"NM",34,0)\par
RA RPT 2.4^^2\par
"BLD",9643,"KRN",101,"NM",35,0)\par
OR EVSEND RA^^2\par
"BLD",9643,"KRN",101,"NM",36,0)\par
OR EVSEND LRCH^^2\par
"BLD",9643,"KRN",101,"NM",37,0)\par
LR7O CH EVSEND OR^^2\par
"BLD",9643,"KRN",101,"NM",38,0)\par
AHMLDOR RPT ORU SEND^^0\par
"BLD",9643,"KRN",101,"NM",39,0)\par
AHMLDOR REMOTE ORM-O01 EVENT^^0\par
"BLD",9643,"KRN",101,"NM",40,0)\par
AHMLDOR REMOTE ORM-O01 SUBS^^0\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOL 500 ORM-O01 EVENT",1)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOL 500 ORM-O01 SUBS",2)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOL EVSEND CPRS",3)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOL EVSEND REMOTE",4)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOL REMOTE ORM-O01 EVENT",30)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOL REMOTE ORM-O01 SUBS",31)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR 500 ORM-O01 EVENT",5)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR 500 ORM-O01 SUBS",6)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR CANCEL ORM SEND",26)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR EVSEND CPRS",17)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR EVSEND REMOTE",18)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR REG ORM SEND",25)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR REG RMTE EVENT",23)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR REG RMTE SUBS",24)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR REMOTE DC EVENT",15)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR REMOTE DC SUBS",16)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR REMOTE ORM-O01 EVENT",39)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR REMOTE ORM-O01 SUBS",40)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR RPT ORU SEND",38)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR RPT RMTE EVENT",27)\par
\par
"BLD",9643,"KRN",101,"NM","B","AHMLDOR RPT RMTE SUBS",28)\par
\par
"BLD",9643,"KRN",101,"NM","B","LR7O CH EVSEND OR",37)\par
\par
"BLD",9643,"KRN",101,"NM","B","OR EVSEND LRCH",36)\par
\par
"BLD",9643,"KRN",101,"NM","B","OR EVSEND RA",35)\par
\par
"BLD",9643,"KRN",101,"NM","B","RA CANCEL 2.4",32)\par
\par
"BLD",9643,"KRN",101,"NM","B","RA REG 2.4",33)\par
\par
"BLD",9643,"KRN",101,"NM","B","RA RPT 2.4",34)\par
\par
"BLD",9643,"KRN",409.61,0)\par
409.61\par
"BLD",9643,"KRN",409.61,"NM",0)\par
^9.68A^^\par
"BLD",9643,"KRN",771,0)\par
771\par
"BLD",9643,"KRN",771,"NM",0)\par
^9.68A^8^8\par
"BLD",9643,"KRN",771,"NM",1,0)\par
AHMLDOL 500 CLIENT^^0\par
"BLD",9643,"KRN",771,"NM",2,0)\par
AHMLDOL 565 CLIENT^^0\par
"BLD",9643,"KRN",771,"NM",3,0)\par
AHMLDOR 500 CLIENT^^0\par
"BLD",9643,"KRN",771,"NM",4,0)\par
AHMLDOR 565 CLIENT^^0\par
"BLD",9643,"KRN",771,"NM",5,0)\par
AHMLDOR HOST 500^^0\par
"BLD",9643,"KRN",771,"NM",6,0)\par
AHMLDOR HOST 565^^0\par
"BLD",9643,"KRN",771,"NM",7,0)\par
AHMLDOL HOST 500^^0\par
"BLD",9643,"KRN",771,"NM",8,0)\par
AHMLDOL HOST 565^^0\par
"BLD",9643,"KRN",771,"NM","B","AHMLDOL 500 CLIENT",1)\par
\par
"BLD",9643,"KRN",771,"NM","B","AHMLDOL 565 CLIENT",2)\par
\par
"BLD",9643,"KRN",771,"NM","B","AHMLDOL HOST 500",7)\par
\par
"BLD",9643,"KRN",771,"NM","B","AHMLDOL HOST 565",8)\par
\par
"BLD",9643,"KRN",771,"NM","B","AHMLDOR 500 CLIENT",3)\par
\par
"BLD",9643,"KRN",771,"NM","B","AHMLDOR 565 CLIENT",4)\par
\par
"BLD",9643,"KRN",771,"NM","B","AHMLDOR HOST 500",5)\par
\par
"BLD",9643,"KRN",771,"NM","B","AHMLDOR HOST 565",6)\par
\par
"BLD",9643,"KRN",779.2,0)\par
779.2\par
"BLD",9643,"KRN",779.2,"NM",0)\par
^9.68A^^\par
"BLD",9643,"KRN",870,0)\par
870\par
"BLD",9643,"KRN",870,"NM",0)\par
^9.68A^2^2\par
"BLD",9643,"KRN",870,"NM",1,0)\par
AHMLDOS^^0\par
"BLD",9643,"KRN",870,"NM",2,0)\par
AHMLDO1^^0\par
"BLD",9643,"KRN",870,"NM","B","AHMLDO1",2)\par
\par
"BLD",9643,"KRN",870,"NM","B","AHMLDOS",1)\par
\par
"BLD",9643,"KRN",8989.51,0)\par
8989.51\par
"BLD",9643,"KRN",8989.51,"NM",0)\par
^9.68A^^\par
"BLD",9643,"KRN",8989.52,0)\par
8989.52\par
"BLD",9643,"KRN",8994,0)\par
8994\par
"BLD",9643,"KRN",8994,"NM",0)\par
^9.68A^^0\par
"BLD",9643,"KRN","B",.4,.4)\par
\par
"BLD",9643,"KRN","B",.401,.401)\par
\par
"BLD",9643,"KRN","B",.402,.402)\par
\par
"BLD",9643,"KRN","B",.403,.403)\par
\par
"BLD",9643,"KRN","B",.5,.5)\par
\par
"BLD",9643,"KRN","B",.84,.84)\par
\par
"BLD",9643,"KRN","B",3.6,3.6)\par
\par
"BLD",9643,"KRN","B",3.8,3.8)\par
\par
"BLD",9643,"KRN","B",9.2,9.2)\par
\par
"BLD",9643,"KRN","B",9.8,9.8)\par
\par
"BLD",9643,"KRN","B",19,19)\par
\par
"BLD",9643,"KRN","B",19.1,19.1)\par
\par
"BLD",9643,"KRN","B",101,101)\par
\par
"BLD",9643,"KRN","B",409.61,409.61)\par
\par
"BLD",9643,"KRN","B",771,771)\par
\par
"BLD",9643,"KRN","B",779.2,779.2)\par
\par
"BLD",9643,"KRN","B",870,870)\par
\par
"BLD",9643,"KRN","B",8989.51,8989.51)\par
\par
"BLD",9643,"KRN","B",8989.52,8989.52)\par
\par
"BLD",9643,"KRN","B",8994,8994)\par
\par
"BLD",9643,"QUES",0)\par
^9.62^^\par
"BLD",9643,"REQB",0)\par
^9.611^^\par
"KRN",101,3336,-1)\par
2^37\par
"KRN",101,3336,0)\par
LR7O CH EVSEND OR^LAB => OE/RR ORDER MESSAGE EVENT^^X^10000000231^^^^^^^\par
"KRN",101,3336,10,0)\par
^101.01PA^5^5\par
"KRN",101,3336,10,4,0)\par
6260^^^\par
"KRN",101,3336,10,4,"^")\par
AHMLDOL EVSEND CPRS\par
"KRN",101,3529,-1)\par
2^35\par
"KRN",101,3529,0)\par
OR EVSEND RA^OE/RR => RAD/NM MESSAGE EVENT^^X^10000000231^^^^^^^\par
"KRN",101,3529,10,0)\par
^101.01PA^5^5\par
"KRN",101,3529,10,5,0)\par
6269^^^\par
"KRN",101,3529,10,5,"^")\par
AHMLDOR EVSEND REMOTE\par
"KRN",101,3530,-1)\par
2^36\par
"KRN",101,3530,0)\par
OR EVSEND LRCH^OE/RR => LAB MESSAGE EVENT^^X^10000000231^^^^^^^\par
"KRN",101,3530,10,0)\par
^101.01PA^5^5\par
"KRN",101,3530,10,5,0)\par
6261^^^\par
"KRN",101,3530,10,5,"^")\par
AHMLDOL EVSEND REMOTE\par
"KRN",101,5895,-1)\par
2^33\par
"KRN",101,5895,0)\par
RA REG 2.4^Rad/Nuc Med exam registered (v2.4 HL7)^^E^10000000231^^^^^^^31\par
"KRN",101,5895,775,0)\par
^101.0775PA^2^1\par
"KRN",101,5895,775,2,0)\par
6275\par
"KRN",101,5895,775,2,"^")\par
AHMLDOR REG ORM SEND\par
"KRN",101,5897,-1)\par
2^32\par
"KRN",101,5897,0)\par
RA CANCEL 2.4^Rad/Nuc Med exam cancellation (v2.4 HL7)^^E^10000000231^^^^^^^31\par
"KRN",101,5897,775,0)\par
^101.0775PA^2^1\par
"KRN",101,5897,775,2,0)\par
6276\par
"KRN",101,5897,775,2,"^")\par
AHMLDOR CANCEL ORM SEND\par
"KRN",101,5898,-1)\par
2^34\par
"KRN",101,5898,0)\par
RA RPT 2.4^Rad/Nuc Med report released/verified (v2.4 HL7)^^E^10000000231^^^^^^^31\par
"KRN",101,5898,775,0)\par
^101.0775PA^2^1\par
"KRN",101,5898,775,2,0)\par
6277\par
"KRN",101,5898,775,2,"^")\par
AHMLDOR RPT ORU SEND\par
"KRN",101,6258,-1)\par
0^30\par
"KRN",101,6258,0)\par
AHMLDOL REMOTE ORM-O01 EVENT^INCOMING FROM VISTA HUB^^E^^^^^^^^\par
"KRN",101,6258,99)\par
64322,67064\par
"KRN",101,6258,770)\par
AHMLDOL HOST 500^^ORM^O01^49^^^AL^AL^2.4^\par
"KRN",101,6258,775,0)\par
^101.0775PA^1^1\par
"KRN",101,6258,775,1,0)\par
6259\par
"KRN",101,6258,775,1,"^")\par
AHMLDOL REMOTE ORM-O01 SUBS\par
"KRN",101,6259,-1)\par
0^31\par
"KRN",101,6259,0)\par
AHMLDOL REMOTE ORM-O01 SUBS^RECEIVE REMOTE ORDERS FROM VISTA^^S^^^^^^^^\par
"KRN",101,6259,99)\par
64322,67064\par
"KRN",101,6259,770)\par
^AHMLDOL 565 CLIENT^^O01^^^^AL^AL^2.4^ACK\par
"KRN",101,6259,771)\par
D EN^AHMLDOS\par
"KRN",101,6259,773)\par
0^0^0\par
"KRN",101,6259,774)\par
\par
"KRN",101,6260,-1)\par
0^3\par
"KRN",101,6260,0)\par
AHMLDOL EVSEND CPRS^VISTA TO CPRS^^A^^^^^^^^\par
"KRN",101,6260,15)\par
K HLA("HLS")\par
"KRN",101,6260,20)\par
I $G(REMOTE)'=1,$D(XQORMSG) D EN^AHMLDOL0("",.XQORMSG)\par
"KRN",101,6260,99)\par
64322,67064\par
"KRN",101,6261,-1)\par
0^4\par
"KRN",101,6261,0)\par
AHMLDOL EVSEND REMOTE^REMOTE ORDERING PROTOCOL^^A^^^^^^^^\par
"KRN",101,6261,15)\par
K HLA("HLS")\par
"KRN",101,6261,20)\par
I $G(REMOTE)'=1,$D(XQORMSG) D EN^AHMLDOL0(.XQORMSG)\par
"KRN",101,6261,99)\par
64322,67064\par
"KRN",101,6262,-1)\par
0^1\par
"KRN",101,6262,0)\par
AHMLDOL 500 ORM-O01 EVENT^SPOKE TO HUB MESSAGES^^E^^^^^^^^\par
"KRN",101,6262,99)\par
64322,67064\par
"KRN",101,6262,770)\par
AHMLDOL HOST 565^^ORM^O01^^^^NE^NE^2.4^\par
"KRN",101,6262,773)\par
1^1^0\par
"KRN",101,6262,775,0)\par
^101.0775PA^1^1\par
"KRN",101,6262,775,1,0)\par
6263\par
"KRN",101,6262,775,1,"^")\par
AHMLDOL 500 ORM-O01 SUBS\par
"KRN",101,6263,-1)\par
0^2\par
"KRN",101,6263,0)\par
AHMLDOL 500 ORM-O01 SUBS^SPOKE TO HUB SUBSCRIBER^^S^^^^^^^^\par
"KRN",101,6263,99)\par
64322,67064\par
"KRN",101,6263,770)\par
^AHMLDOL 500 CLIENT^^^^^AHMLDO1^NE^NE^2.4^\par
"KRN",101,6263,773)\par
1^1^0\par
"KRN",101,6266,-1)\par
0^24\par
"KRN",101,6266,0)\par
AHMLDOR REG RMTE SUBS^SPOKE TO HUB RAD^^S^^^^^^^^\par
"KRN",101,6266,99)\par
64322,67064\par
"KRN",101,6266,770)\par
^AHMLDOR 500 CLIENT^^^^^AHMLDO1^NE^NE^2.4^\par
"KRN",101,6266,771)\par
Q\par
"KRN",101,6266,773)\par
1^1^0\par
"KRN",101,6267,-1)\par
0^28\par
"KRN",101,6267,0)\par
AHMLDOR RPT RMTE SUBS^SPOKE TO HUB RESULTS^^S^^^^^^^^\par
"KRN",101,6267,99)\par
64322,67064\par
"KRN",101,6267,770)\par
^AHMLDOR 500 CLIENT^^^^^AHMLDO1^NE^NE^2.4^\par
"KRN",101,6267,771)\par
Q\par
"KRN",101,6267,773)\par
1^1^0\par
"KRN",101,6268,-1)\par
0^27\par
"KRN",101,6268,0)\par
AHMLDOR RPT RMTE EVENT^RAD RESULTS TO HUB^^E^^^^^^^^\par
"KRN",101,6268,20)\par
\par
"KRN",101,6268,99)\par
64322,67064\par
"KRN",101,6268,770)\par
AHMLDOR HOST 565^^ORM^O01^^^^NE^NE^2.4^\par
"KRN",101,6268,773)\par
1^1^0\par
"KRN",101,6268,775,0)\par
^101.0775PA^1^1\par
"KRN",101,6268,775,1,0)\par
6267\par
"KRN",101,6268,775,1,"^")\par
AHMLDOR RPT RMTE SUBS\par
"KRN",101,6269,-1)\par
0^18\par
"KRN",101,6269,0)\par
AHMLDOR EVSEND REMOTE^RAD OERR => VISTA^^A^^^^^^^^\par
"KRN",101,6269,15)\par
K HLA("HLS")\par
"KRN",101,6269,20)\par
I $G(REMOTE)'=1 D EN1^AHMLDORO(.XQORMSG)\par
"KRN",101,6269,99)\par
64322,67064\par
"KRN",101,6269,770)\par
^^^^^^^^^^ACK\par
"KRN",101,6270,-1)\par
0^6\par
"KRN",101,6270,0)\par
AHMLDOR 500 ORM-O01 SUBS^SPOKE TO HUB RAD^^S^^^^^^^^\par
"KRN",101,6270,99)\par
64322,67064\par
"KRN",101,6270,770)\par
^AHMLDOR 500 CLIENT^^^^^AHMLDO1^NE^NE^2.4^\par
"KRN",101,6270,773)\par
1^1^0\par
"KRN",101,6271,-1)\par
0^5\par
"KRN",101,6271,0)\par
AHMLDOR 500 ORM-O01 EVENT^SPOKE TO HUB RAD^^E^^^^^^^^\par
"KRN",101,6271,99)\par
64322,67064\par
"KRN",101,6271,770)\par
AHMLDOR HOST 565^^ORM^O01^^^^NE^NE^2.4^\par
"KRN",101,6271,773)\par
1^1^0\par
"KRN",101,6271,775,0)\par
^101.0775PA^1^1\par
"KRN",101,6271,775,1,0)\par
6270\par
"KRN",101,6271,775,1,"^")\par
AHMLDOR 500 ORM-O01 SUBS\par
"KRN",101,6272,-1)\par
0^15\par
"KRN",101,6272,0)\par
AHMLDOR REMOTE DC EVENT^CPRS DC AT SPOKE^^E^^^^^^^^\par
"KRN",101,6272,99)\par
64322,67064\par
"KRN",101,6272,770)\par
AHMLDOR HOST 565^^ORM^O01^49^^^NE^NE^2.4^\par
"KRN",101,6272,771)\par
\par
"KRN",101,6272,772)\par
Q\par
"KRN",101,6272,773)\par
1^1^0\par
"KRN",101,6272,775,0)\par
^101.0775PA^1^1\par
"KRN",101,6272,775,1,0)\par
6273\par
"KRN",101,6272,775,1,"^")\par
AHMLDOR REMOTE DC SUBS\par
"KRN",101,6273,-1)\par
0^16\par
"KRN",101,6273,0)\par
AHMLDOR REMOTE DC SUBS^SPOKE CPRS DC^^S^^^^^^^^\par
"KRN",101,6273,99)\par
64322,67064\par
"KRN",101,6273,770)\par
^AHMLDOR 500 CLIENT^^O01^^^AHMLDO1^NE^NE^2.4^ACK\par
"KRN",101,6273,771)\par
Q\par
"KRN",101,6273,772)\par
\par
"KRN",101,6273,773)\par
1^1^0\par
"KRN",101,6273,775,0)\par
^101.0775PA^^0\par
"KRN",101,6274,-1)\par
0^17\par
"KRN",101,6274,0)\par
AHMLDOR EVSEND CPRS^SPOKE TO HUB ARRIVALS^^A^^^^^^^^\par
"KRN",101,6274,15)\par
K HLA("HLS")\par
"KRN",101,6274,20)\par
I $G(REMOTE)'=1 D EN1^AHMLDORO(.XQORMSG)\par
"KRN",101,6274,99)\par
64322,67064\par
"KRN",101,6275,-1)\par
0^25\par
"KRN",101,6275,0)\par
AHMLDOR REG ORM SEND^SEND RAD MESSAGES TO PROCESSING ROUTINE^^S^^^^^^^^\par
"KRN",101,6275,99)\par
64322,67064\par
"KRN",101,6275,770)\par
^AHMLDOR 500 CLIENT^ORM^O01^^^^^^2.4^\par
"KRN",101,6275,771)\par
D EN^AHMLDORO\par
"KRN",101,6275,773)\par
1^1^0\par
"KRN",101,6276,-1)\par
0^26\par
"KRN",101,6276,0)\par
AHMLDOR CANCEL ORM SEND^SEND CANCEL MESSAGES TO PROCESSING ROUTINE^^S^^^^^^^^\par
"KRN",101,6276,99)\par
64322,67064\par
"KRN",101,6276,770)\par
^AHMLDOR 500 CLIENT^ORM^O01^^^^^^2.4^\par
"KRN",101,6276,771)\par
D EN^AHMLDORO\par
"KRN",101,6276,773)\par
1^1^0\par
"KRN",101,6277,-1)\par
0^38\par
"KRN",101,6277,0)\par
AHMLDOR RPT ORU SEND^SEND ORU RAD MESSAGES TO PROCESSING ROUTINE^^S^^^^^^^^\par
"KRN",101,6277,99)\par
64322,67064\par
"KRN",101,6277,770)\par
^AHMLDOR 500 CLIENT^ORU^R01^^^^^^2.4^\par
"KRN",101,6277,771)\par
D EN^AHMLDORO\par
"KRN",101,6277,773)\par
1^1^0\par
"KRN",101,6278,-1)\par
0^23\par
"KRN",101,6278,0)\par
AHMLDOR REG RMTE EVENT^RAD SPOKE TO HUB ARRIVALS^^E^^^^^^^^\par
"KRN",101,6278,99)\par
64322,67064\par
"KRN",101,6278,770)\par
AHMLDOR HOST 565^^ORM^O01^^^^NE^NE^2.4^\par
"KRN",101,6278,773)\par
1^1^0\par
"KRN",101,6278,775,0)\par
^101.0775PA^1^1\par
"KRN",101,6278,775,1,0)\par
6266\par
"KRN",101,6278,775,1,"^")\par
AHMLDOR REG RMTE SUBS\par
"KRN",101,6279,-1)\par
0^39\par
"KRN",101,6279,0)\par
AHMLDOR REMOTE ORM-O01 EVENT^INCOMING RAD ORDER^^E^^^^^^^^\par
"KRN",101,6279,99)\par
64323,52191\par
"KRN",101,6279,770)\par
AHMLDOR HOST 500^^ORM^O01^49^^^AL^NE^2.4^\par
"KRN",101,6279,775,0)\par
^101.0775PA^1^1\par
"KRN",101,6279,775,1,0)\par
6280\par
"KRN",101,6279,775,1,"^")\par
AHMLDOR REMOTE ORM-O01 SUBS\par
"KRN",101,6280,-1)\par
0^40\par
"KRN",101,6280,0)\par
AHMLDOR REMOTE ORM-O01 SUBS^RECEIVE REMOTE RAD ORDERS^^S^^^^^^^^\par
"KRN",101,6280,99)\par
64323,52320\par
"KRN",101,6280,770)\par
^AHMLDOR 565 CLIENT^^O01^^^^AL^NE^2.4^ACK\par
"KRN",101,6280,771)\par
D EN^AHMLDOS\par
"KRN",101,6280,773)\par
0^0^0\par
"KRN",771,254,-1)\par
0^7\par
"KRN",771,254,0)\par
AHMLDOL HOST 500^a^500^^^^USA\par
"KRN",771,254,"EC")\par
^~\\&\par
"KRN",771,254,"FS")\par
|\par
"KRN",771,255,-1)\par
0^2\par
"KRN",771,255,0)\par
AHMLDOL 565 CLIENT^a^565^^^^USA\par
"KRN",771,255,"EC")\par
^~\\&\par
"KRN",771,255,"FS")\par
|\par
"KRN",771,256,-1)\par
0^1\par
"KRN",771,256,0)\par
AHMLDOL 500 CLIENT^a^500^^^^USA\par
"KRN",771,256,"EC")\par
^~\\&\par
"KRN",771,256,"FS")\par
|\par
"KRN",771,257,-1)\par
0^8\par
"KRN",771,257,0)\par
AHMLDOL HOST 565^a^565^^^^USA\par
"KRN",771,257,"EC")\par
^~\\&\par
"KRN",771,257,"FS")\par
|\par
"KRN",771,258,-1)\par
0^5\par
"KRN",771,258,0)\par
AHMLDOR HOST 500^a^500^^^^USA\par
"KRN",771,258,"EC")\par
^~\\&\par
"KRN",771,258,"FS")\par
|\par
"KRN",771,259,-1)\par
0^4\par
"KRN",771,259,0)\par
AHMLDOR 565 CLIENT^a^565^^^^USA\par
"KRN",771,259,"EC")\par
^~\\&\par
"KRN",771,259,"FS")\par
|\par
"KRN",771,260,-1)\par
0^3\par
"KRN",771,260,0)\par
AHMLDOR 500 CLIENT^a^500^^^^USA\par
"KRN",771,260,"EC")\par
^~\\&\par
"KRN",771,260,"FS")\par
|\par
"KRN",771,261,-1)\par
0^6\par
"KRN",771,261,0)\par
AHMLDOR HOST 565^a^565^^^^USA\par
"KRN",771,261,"EC")\par
^~\\&\par
"KRN",771,261,"FS")\par
|\par
"KRN",870,150,-1)\par
0^2\par
"KRN",870,150,0)\par
AHMLDO1^^TCP^^^^^^^^^^^^^^^^^^10\par
"KRN",870,150,200)\par
^^^^^11^28\par
"KRN",870,150,400)\par
54.196.197.70^5026^C^N^^^^5026^\par
"KRN",870,151,-1)\par
0^1\par
"KRN",870,151,0)\par
AHMLDOS^^TCP^^^^^^^^^^^^^^^^^^10\par
"KRN",870,151,3,0)\par
^870.02^1^1^3160308^^^^\par
"KRN",870,151,3,1,0)\par
Remote Ordering project Spoke 1\par
"KRN",870,151,200)\par
^5^245^10^60^^^^^I\par
"KRN",870,151,400)\par
54.236.141.114^5026^S^Y^^^^5027^\par
"MBREQ")\par
0\par
"ORD",13,870)\par
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)\par
"ORD",13,870,0)\par
HL LOGICAL LINK\par
"ORD",14,771)\par
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)\par
"ORD",14,771,0)\par
HL7 APPLICATION PARAMETER\par
"ORD",15,101)\par
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA\par
"ORD",15,101,0)\par
PROTOCOL\par
"PKG",576,-1)\par
1^1\par
"PKG",576,0)\par
MOBILE SCHEDULING APPLICATIONS^MBAA^MOBILE SCHEDULING APPLICATIONS SUITE\par
"PKG",576,22,0)\par
^9.49I^1^1\par
"PKG",576,22,1,0)\par
1.0^3161115^3161114^10000000231\par
"PKG",576,22,1,"PAH",1,0)\par
2^3170222^10000000231\par
"PKG",576,22,1,"PAH",1,1,0)\par
^^1^1^3170222\par
"PKG",576,22,1,"PAH",1,1,1,0)\par
Remote ordering spoke KIDS BUILD\par
"QUES","XPF1",0)\par
Y\par
"QUES","XPF1","??")\par
^D REP^XPDH\par
"QUES","XPF1","A")\par
Shall I write over your |FLAG| File\par
"QUES","XPF1","B")\par
YES\par
"QUES","XPF1","M")\par
D XPF1^XPDIQ\par
"QUES","XPF2",0)\par
Y\par
"QUES","XPF2","??")\par
^D DTA^XPDH\par
"QUES","XPF2","A")\par
Want my data |FLAG| yours\par
"QUES","XPF2","B")\par
YES\par
"QUES","XPF2","M")\par
D XPF2^XPDIQ\par
"QUES","XPI1",0)\par
YO\par
"QUES","XPI1","??")\par
^D INHIBIT^XPDH\par
"QUES","XPI1","A")\par
Want KIDS to INHIBIT LOGONs during the install\par
"QUES","XPI1","B")\par
NO\par
"QUES","XPI1","M")\par
D XPI1^XPDIQ\par
"QUES","XPM1",0)\par
PO^VA(200,:EM\par
"QUES","XPM1","??")\par
^D MG^XPDH\par
"QUES","XPM1","A")\par
Enter the Coordinator for Mail Group '|FLAG|'\par
"QUES","XPM1","B")\par
\par
"QUES","XPM1","M")\par
D XPM1^XPDIQ\par
"QUES","XPO1",0)\par
Y\par
"QUES","XPO1","??")\par
^D MENU^XPDH\par
"QUES","XPO1","A")\par
Want KIDS to Rebuild Menu Trees Upon Completion of Install\par
"QUES","XPO1","B")\par
NO\par
"QUES","XPO1","M")\par
D XPO1^XPDIQ\par
"QUES","XPZ1",0)\par
Y\par
"QUES","XPZ1","??")\par
^D OPT^XPDH\par
"QUES","XPZ1","A")\par
Want to DISABLE Scheduled Options, Menu Options, and Protocols\par
"QUES","XPZ1","B")\par
NO\par
"QUES","XPZ1","M")\par
D XPZ1^XPDIQ\par
"QUES","XPZ2",0)\par
Y\par
"QUES","XPZ2","??")\par
^D RTN^XPDH\par
"QUES","XPZ2","A")\par
Want to MOVE routines to other CPUs\par
"QUES","XPZ2","B")\par
NO\par
"QUES","XPZ2","M")\par
D XPZ2^XPDIQ\par
"RTN")\par
6\par
"RTN","AHMLDOL0")\par
0^7^B39982002\par
"RTN","AHMLDOL0",1,0)\par
AHMLDOL0 ;LEIDOS/TCK - REMOTE ORDERING ; 2/20/17 1:04pm\par
"RTN","AHMLDOL0",2,0)\par
 ;;1.0;REMOTE ORDERING;**2**;DEC 28, 2015;Build 42\par
"RTN","AHMLDOL0",3,0)\par
 Q\par
"RTN","AHMLDOL0",4,0)\par
 ;\par
"RTN","AHMLDOL0",5,0)\par
EN(MSG1,MSG2) ;Pass in message from VistA or CPRS\par
"RTN","AHMLDOL0",6,0)\par
 N HLA,PROT,PR,REC,FLG\par
"RTN","AHMLDOL0",7,0)\par
 S (CHK,FLG)=0\par
"RTN","AHMLDOL0",8,0)\par
 Q:$G(REMOTE)=1\par
"RTN","AHMLDOL0",9,0)\par
 I $D(MSG2)>1 M XQORMSG=MSG2\par
"RTN","AHMLDOL0",10,0)\par
 I $D(MSG1)>1 M XQORMSG=MSG1\par
"RTN","AHMLDOL0",11,0)\par
 I $D(MSG1)>1 M REC=XQORMSG D GENMSG(.REC)\par
"RTN","AHMLDOL0",12,0)\par
 I $G(MSG2)'="" I $G(ORAPMSG)'="" M REC=@ORAPMSG D GENMSG(.REC)\par
"RTN","AHMLDOL0",13,0)\par
 I $G(MSG2)'="",$G(XQORMSG)'="" M REC=@XQORMSG D GENMSG(.REC)\par
"RTN","AHMLDOL0",14,0)\par
 I $G(MSG1)["TMP" M REC=@XQORMSG D GENMSG(.REC)\par
"RTN","AHMLDOL0",15,0)\par
 I $G(MSG)["TMP" M REC=@MSG D GENMSG(.REC)\par
"RTN","AHMLDOL0",16,0)\par
 K MSG,MSG1,REC,CHK,FLG,ODC,AP,VFGL,STOP,CHG,MSGTYP,MSGNDE\par
"RTN","AHMLDOL0",17,0)\par
 Q\par
"RTN","AHMLDOL0",18,0)\par
 ;\par
"RTN","AHMLDOL0",19,0)\par
GENMSG(REC) ;\par
"RTN","AHMLDOL0",20,0)\par
 S (CCDE,ZCNT,CDE)="",(CHK,FLG,ODC,AP,VFLG,STOP,CHG)=0,D1="|",D2="^",CK=1\par
"RTN","AHMLDOL0",21,0)\par
 F  S ZCNT=$O(REC(ZCNT)) Q:ZCNT=""  D  Q:FLG=2\par
"RTN","AHMLDOL0",22,0)\par
 .S MSGNDE=REC(ZCNT),MSGTYP=$P(MSGNDE,"|"),CCDE=$P(MSGNDE,"|",2)\par
"RTN","AHMLDOL0",23,0)\par
 .Q:MSGTYP=""\par
"RTN","AHMLDOL0",24,0)\par
 .Q:MSGTYP="MSH"\par
"RTN","AHMLDOL0",25,0)\par
 .;Q:MSGTYP="NTE"\par
"RTN","AHMLDOL0",26,0)\par
 .;Q:$G(CCDE)=""&(MSGTYP'="NTE")\par
"RTN","AHMLDOL0",27,0)\par
 .S TYP="LAB"\par
"RTN","AHMLDOL0",28,0)\par
 .I MSGTYP="PID" D GTPTID(.REC,ZCNT)\par
"RTN","AHMLDOL0",29,0)\par
 .I MSGTYP="ORC" D  Q:FLG\par
"RTN","AHMLDOL0",30,0)\par
 ..S ORN=$P(MSGNDE,"|",3),OR=+ORN\par
"RTN","AHMLDOL0",31,0)\par
 ..I CCDE="NA" S FLG=2 Q\par
"RTN","AHMLDOL0",32,0)\par
 ..I CCDE="SN" S FLG=2 Q\par
"RTN","AHMLDOL0",33,0)\par
 ..I CCDE="NW" S FLG=2 Q\par
"RTN","AHMLDOL0",34,0)\par
 ..I CCDE="OK" S FLG=2 Q\par
"RTN","AHMLDOL0",35,0)\par
 ..I CCDE="CR" S FLG=2 Q\par
"RTN","AHMLDOL0",36,0)\par
 ..I CCDE="OC" D CHKRMT(+ORN,.CK)\par
"RTN","AHMLDOL0",37,0)\par
 ..I CK S CDI="OC",FLG=1\par
"RTN","AHMLDOL0",38,0)\par
 ..I 'CK S CDI="OC",FLG=2\par
"RTN","AHMLDOL0",39,0)\par
 ..I CCDE="CA" D CHKRMT(+ORN,.CK)\par
"RTN","AHMLDOL0",40,0)\par
 ..I CK S CDI="CA",FLG=1\par
"RTN","AHMLDOL0",41,0)\par
 ..I 'CK S CDI="CA",FLG=2\par
"RTN","AHMLDOL0",42,0)\par
 ..I CCDE="DC",$P(MSGNDE,"|",4) D CHKRMT(+ORN,.CK)\par
"RTN","AHMLDOL0",43,0)\par
 ..I CK S CDI="DC",FLG=1\par
"RTN","AHMLDOL0",44,0)\par
 ..I 'CK S CDI="DC",FLG=2\par
"RTN","AHMLDOL0",45,0)\par
 ..I CCDE="SC" D CHKRMT(+ORN,.CK)\par
"RTN","AHMLDOL0",46,0)\par
 ..I CK S CDI="SC",FLG=1\par
"RTN","AHMLDOL0",47,0)\par
 ..I 'CK S CDI="SC",FLG=2\par
"RTN","AHMLDOL0",48,0)\par
 ..I CCDE="RE" D CHKRMT(+ORN,.CK)\par
"RTN","AHMLDOL0",49,0)\par
 ..I CK S CDI="SC",FLG=1\par
"RTN","AHMLDOL0",50,0)\par
 ..I 'CK S CDI="SC",FLG=2\par
"RTN","AHMLDOL0",51,0)\par
 ..S ORN=$P(MSGNDE,"|",3),OR=+ORN\par
"RTN","AHMLDOL0",52,0)\par
 ..S $P(REC(ZCNT),"|",14)=$G(^XTMP("AHMLDO","LOC"))\par
"RTN","AHMLDOL0",53,0)\par
 ..I $G(OR)>0,$D(^XTMP("AHMLDO",TYP,"B")),$D(^XTMP("AHMLDO",TYP,"B",OR)) S ORIFN=^XTMP("AHMLDO",TYP,"B",OR)\par
"RTN","AHMLDOL0",54,0)\par
 ..I $G(ORIFN)>0 S ORIFN=ORIFN_";1^OR",$P(REC(ZCNT),"|",3)=ORIFN\par
"RTN","AHMLDOL0",55,0)\par
 .I MSGTYP="OBR" D\par
"RTN","AHMLDOL0",56,0)\par
 ..I $G(CDI)'="" S CDE=CDI\par
"RTN","AHMLDOL0",57,0)\par
 ..Q:CDE'="SC"\par
"RTN","AHMLDOL0",58,0)\par
 ..S CDE=""\par
"RTN","AHMLDOL0",59,0)\par
 ..S ACC=$P(REC(ZCNT),"|",21)\par
"RTN","AHMLDOL0",60,0)\par
 ..S LRTST=$P($P(REC(ZCNT),D1,5),D2,4)\par
"RTN","AHMLDOL0",61,0)\par
 ..D GTUID(.UID,.REC,ZCNT,LRTST,OR)\par
"RTN","AHMLDOL0",62,0)\par
 ..I $G(UID)="" S FLG=2 Q\par
"RTN","AHMLDOL0",63,0)\par
 .I MSGTYP="OBX" D\par
"RTN","AHMLDOL0",64,0)\par
 ..I $P(REC(ZCNT),"|",9)["HH" S $P(REC(ZCNT),"|",9)="H*"\par
"RTN","AHMLDOL0",65,0)\par
 ..I $P(REC(ZCNT),"|",9)["LL" S $P(REC(ZCNT),"|",9)="L*"\par
"RTN","AHMLDOL0",66,0)\par
 .I MSGTYP="NTE" D FIXNTE(.REC,ZCNT)\par
"RTN","AHMLDOL0",67,0)\par
 I $G(FLG)=1 D\par
"RTN","AHMLDOL0",68,0)\par
 .Q:$G(ORN)'>0\par
"RTN","AHMLDOL0",69,0)\par
 .Q:'FLG\par
"RTN","AHMLDOL0",70,0)\par
 .Q:FLG=2\par
"RTN","AHMLDOL0",71,0)\par
 .D GTNME(.REC)\par
"RTN","AHMLDOL0",72,0)\par
 .I $G(ORIFN)[";" S ORIFN=+ORIFN\par
"RTN","AHMLDOL0",73,0)\par
 .I $G(ORDERID)>0,ORDERID[";" S ORIFN=+ORDERID\par
"RTN","AHMLDOL0",74,0)\par
 .D CHKRMT(OR,.CK)\par
"RTN","AHMLDOL0",75,0)\par
 .I TYP="RAD",'CK Q\par
"RTN","AHMLDOL0",76,0)\par
 .D GTREM(.PROT,OR,TYP)\par
"RTN","AHMLDOL0",77,0)\par
 .M HLA("HLS")=REC K HLA("HLS",1) D GENERATE^HLMA($O(^ORD(101,"B",PROT,0)),"LM",1,.HLREST,"",.HLP) S FLG=3\par
"RTN","AHMLDOL0",78,0)\par
 Q\par
"RTN","AHMLDOL0",79,0)\par
 ;\par
"RTN","AHMLDOL0",80,0)\par
CHKRMT(ORN,CK) ;\par
"RTN","AHMLDOL0",81,0)\par
 N INDX,ST,STOP,LIEN\par
"RTN","AHMLDOL0",82,0)\par
 S ST="",(STOP,INDX)=0\par
"RTN","AHMLDOL0",83,0)\par
 Q:'$D(^OR(100,ORN))\par
"RTN","AHMLDOL0",84,0)\par
 Q:'$D(^OR(100,ORN,4.5))\par
"RTN","AHMLDOL0",85,0)\par
 F  S INDX=$O(^OR(100,ORN,4.5,INDX)) Q:$G(INDX)'>0  D  Q:STOP\par
"RTN","AHMLDOL0",86,0)\par
 .S LIEN=INDX_","_ORN_","\par
"RTN","AHMLDOL0",87,0)\par
 .S ST=$$GET1^DIQ(100.045,LIEN,.04,"I")\par
"RTN","AHMLDOL0",88,0)\par
 .Q:ST'="Location"\par
"RTN","AHMLDOL0",89,0)\par
 .Q:'$D(^OR(100,ORN,4.5,INDX,1))\par
"RTN","AHMLDOL0",90,0)\par
 .S RMTE=$$GET1^DIQ(100.045,LIEN,1,"I")\par
"RTN","AHMLDOL0",91,0)\par
 .I RMTE'="LOCAL" S STOP=1 Q\par
"RTN","AHMLDOL0",92,0)\par
 .I RMTE="LOCAL" S STOP=1,CK=0 Q\par
"RTN","AHMLDOL0",93,0)\par
 I 'STOP,CK S CK=0\par
"RTN","AHMLDOL0",94,0)\par
 Q\par
"RTN","AHMLDOL0",95,0)\par
 ;\par
"RTN","AHMLDOL0",96,0)\par
FIXNTE(REC,ZCNT) ;\par
"RTN","AHMLDOL0",97,0)\par
 N CNT,INDX,NN,II,STOP\par
"RTN","AHMLDOL0",98,0)\par
 S STOP=0\par
"RTN","AHMLDOL0",99,0)\par
 S INDX="",CNT=ZCNT,AMEND=0\par
"RTN","AHMLDOL0",100,0)\par
 I '$D(REC(ZCNT,1)) S STOP=1\par
"RTN","AHMLDOL0",101,0)\par
 I 'STOP D\par
"RTN","AHMLDOL0",102,0)\par
 .F  S INDX=$O(REC(ZCNT,INDX)) Q:INDX=""  D  Q:STOP\par
"RTN","AHMLDOL0",103,0)\par
 ..Q:$G(INDX)'>0\par
"RTN","AHMLDOL0",104,0)\par
 ..S TXT=REC(ZCNT,INDX)\par
"RTN","AHMLDOL0",105,0)\par
 ..I TXT["reported" S AMEND=1\par
"RTN","AHMLDOL0",106,0)\par
 ..I TXT["Ordering" K REC(ZCNT,INDX) Q\par
"RTN","AHMLDOL0",107,0)\par
 ..I $E(TXT,1)=" " K REC(ZCNT,INDX) Q\par
"RTN","AHMLDOL0",108,0)\par
 ..I TXT["Report" K REC(ZCNT,INDX) Q\par
"RTN","AHMLDOL0",109,0)\par
 ..I TXT["Performing" K REC(ZCNT,INDX) Q\par
"RTN","AHMLDOL0",110,0)\par
 ..I $E(TXT,1,4)="" K REC(ZCNT,INDX) Q\par
"RTN","AHMLDOL0",111,0)\par
 ..I $E(TXT,1,5)["NP" S REC(ZCNT)=REC(ZCNT)_TXT K REC(ZCNT,INDX)\par
"RTN","AHMLDOL0",112,0)\par
 Q:STOP&('AMEND)\par
"RTN","AHMLDOL0",113,0)\par
 ;I 'AMEND K REC(ZCNT)\par
"RTN","AHMLDOL0",114,0)\par
 I AMEND D\par
"RTN","AHMLDOL0",115,0)\par
 .;S TOT=$O(REC(ZCNT,9999),-2)\par
"RTN","AHMLDOL0",116,0)\par
 .;I TOT>2 S TOT=TOT-1\par
"RTN","AHMLDOL0",117,0)\par
 .S INDX="",CNT=ZCNT\par
"RTN","AHMLDOL0",118,0)\par
 .F  S INDX=$O(REC(ZCNT,INDX)) Q:INDX=""  D  Q:STOP\par
"RTN","AHMLDOL0",119,0)\par
 ..I $G(INDX)'>0 S STOP=1 Q\par
"RTN","AHMLDOL0",120,0)\par
 ..;I INDX<TOT K REC(ZCNT,INDX) Q\par
"RTN","AHMLDOL0",121,0)\par
 ..S TXT=REC(ZCNT,INDX),NN=$G(NN)+1\par
"RTN","AHMLDOL0",122,0)\par
 ..Q:$G(TXT)=""\par
"RTN","AHMLDOL0",123,0)\par
 ..S CNT=$G(CNT)+1\par
"RTN","AHMLDOL0",124,0)\par
 ..S REC(CNT)="NTE|"_NN_"|L|"_TXT K REC(ZCNT,INDX)\par
"RTN","AHMLDOL0",125,0)\par
 I\par
"RTN","AHMLDOL0",126,0)\par
 S II=$P($G(REC(ZCNT)),"|")\par
"RTN","AHMLDOL0",127,0)\par
 Q:$G(II)'>0\par
"RTN","AHMLDOL0",128,0)\par
 Q:II'="NTE"\par
"RTN","AHMLDOL0",129,0)\par
 ;I $P(REC(ZCNT),"|",2)="" K REC(ZCNT)\par
"RTN","AHMLDOL0",130,0)\par
 Q\par
"RTN","AHMLDOL0",131,0)\par
 ;\par
"RTN","AHMLDOL0",132,0)\par
GTPTID(REC,ZCNT) ;\par
"RTN","AHMLDOL0",133,0)\par
 N IEN,VPSSN,VPDOB,ORVP\par
"RTN","AHMLDOL0",134,0)\par
 S ORVP=0,(VPSSN,VPDOB)=""\par
"RTN","AHMLDOL0",135,0)\par
 S ORVP=$P(REC(ZCNT),"|",4)\par
"RTN","AHMLDOL0",136,0)\par
 I $G(ORVP)'>0 S ORVP=0 Q\par
"RTN","AHMLDOL0",137,0)\par
 S VPDOB=$$GET1^DIQ(2,ORVP,.03,"I")\par
"RTN","AHMLDOL0",138,0)\par
 S VPSSN=$$GET1^DIQ(2,ORVP,.09,"I")\par
"RTN","AHMLDOL0",139,0)\par
 S $P(REC(ZCNT),"|",5)=VPDOB\par
"RTN","AHMLDOL0",140,0)\par
 S $P(REC(ZCNT),"|",7)=VPSSN\par
"RTN","AHMLDOL0",141,0)\par
 Q\par
"RTN","AHMLDOL0",142,0)\par
 ;\par
"RTN","AHMLDOL0",143,0)\par
GTUID(UID,REC,ZCNT,LRTST,OR) ;\par
"RTN","AHMLDOL0",144,0)\par
 N LIEN\par
"RTN","AHMLDOL0",145,0)\par
 S UID="",LRDATA=^OR(100,OR,4)\par
"RTN","AHMLDOL0",146,0)\par
 S LRORD=$P(LRDATA,";"),LRODT=$P(LRDATA,";",2),LRSN=$P(LRDATA,";",3)\par
"RTN","AHMLDOL0",147,0)\par
 S LRSND="",LRSND=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRTST,LRSND))\par
"RTN","AHMLDOL0",148,0)\par
 I '$D(^LRO(69,LRODT,1,LRSN,2,LRSND,.3)) S UID=0 Q\par
"RTN","AHMLDOL0",149,0)\par
 S LIEN=LRSND_","_LRSN_","_LRODT_","\par
"RTN","AHMLDOL0",150,0)\par
 S UID=$$GET1^DIQ(69.03,LIEN,13,"I")\par
"RTN","AHMLDOL0",151,0)\par
 I $G(UID)="" S UID=0 Q\par
"RTN","AHMLDOL0",152,0)\par
 S $P(REC(ZCNT),"|",22)=UID\par
"RTN","AHMLDOL0",153,0)\par
 Q\par
"RTN","AHMLDOL0",154,0)\par
GTNME(REC) ;\par
"RTN","AHMLDOL0",155,0)\par
 N CNT,MSGNDE,MSGTYP,TYP\par
"RTN","AHMLDOL0",156,0)\par
 S (MSGNDE,MSGTYP)="",CNT=0\par
"RTN","AHMLDOL0",157,0)\par
 F  S CNT=$O(REC(CNT)) Q:CNT=""  D\par
"RTN","AHMLDOL0",158,0)\par
 .S MSGNDE=REC(CNT)\par
"RTN","AHMLDOL0",159,0)\par
 .Q:$G(MSGNDE)=""\par
"RTN","AHMLDOL0",160,0)\par
 .S MSGTYP=$P(MSGNDE,"|"),CCDE=$P(MSGNDE,"|",2)\par
"RTN","AHMLDOL0",161,0)\par
 .I MSGTYP="MSH" D\par
"RTN","AHMLDOL0",162,0)\par
 ..S TYP=$P(MSGNDE,"|",3)\par
"RTN","AHMLDOL0",163,0)\par
 .I MSGTYP="ORC" D\par
"RTN","AHMLDOL0",164,0)\par
 ..S USR=+$P(MSGNDE,"|",11)\par
"RTN","AHMLDOL0",165,0)\par
 ..S PROV=+$P(MSGNDE,"|",13)\par
"RTN","AHMLDOL0",166,0)\par
 ..I USR'=PROV S USR=PROV\par
"RTN","AHMLDOL0",167,0)\par
 ..S USRNME=$$GET1^DIQ(200,USR,.01,"I")\par
"RTN","AHMLDOL0",168,0)\par
 ..S PROVNME=$$GET1^DIQ(200,PROV,.01,"I")\par
"RTN","AHMLDOL0",169,0)\par
 ..I $G(USRNME)'="" S $P(REC(CNT),"|",11)=USR_"^"_USRNME\par
"RTN","AHMLDOL0",170,0)\par
 ..I $G(PROVNME)'="" S $P(REC(CNT),"|",13)=PROV_"^"_PROVNME\par
"RTN","AHMLDOL0",171,0)\par
 Q\par
"RTN","AHMLDOL0",172,0)\par
 ;\par
"RTN","AHMLDOL0",173,0)\par
GTREM(PROT,OR,TYP) ;\par
"RTN","AHMLDOL0",174,0)\par
 N FAC,REM,LIEN\par
"RTN","AHMLDOL0",175,0)\par
 S PROT=0\par
"RTN","AHMLDOL0",176,0)\par
 Q:'$D(^XTMP("AHMLDO"))\par
"RTN","AHMLDOL0",177,0)\par
 Q:'$D(^OR(100,OR,4.5,"ID"))\par
"RTN","AHMLDOL0",178,0)\par
 Q:'$D(^OR(100,OR,4.5,"ID","Location"))\par
"RTN","AHMLDOL0",179,0)\par
 S IFN="",IFN=$O(^OR(100,OR,4.5,"ID","Location",IFN))\par
"RTN","AHMLDOL0",180,0)\par
 Q:IFN=""\par
"RTN","AHMLDOL0",181,0)\par
 I $D(^XTMP("AHMLDO","RMLOC")) S REM=^XTMP("AHMLDO","RMLOC")\par
"RTN","AHMLDOL0",182,0)\par
 I TYP["LAB" S PROT="AHMLDOL "_REM_" ORM-O01 EVENT"\par
"RTN","AHMLDOL0",183,0)\par
 I TYP["RAD" S PROT="AHMLDOR "_REM_" ORM-O01 EVENT"\par
"RTN","AHMLDOL0",184,0)\par
 ;REMOVE STAION ID FROM 8 NODE\par
"RTN","AHMLDOL0",185,0)\par
 Q\par
"RTN","AHMLDOL0",186,0)\par
 ;\par
"RTN","AHMLDOL0",187,0)\par
GTDOM(RR) ;\par
"RTN","AHMLDOL0",188,0)\par
 N NME,INST,CNT\par
"RTN","AHMLDOL0",189,0)\par
 S NME="AHMLD"\par
"RTN","AHMLDOL0",190,0)\par
 S (DOM,INST,RR)="",CNT=0\par
"RTN","AHMLDOL0",191,0)\par
 Q:'$D(^XTMP(NME))\par
"RTN","AHMLDOL0",192,0)\par
 F  S CNT=$O(^XTMP(NME,CNT)) Q:CNT=""  D\par
"RTN","AHMLDOL0",193,0)\par
 .S INST=$G(^XTMP(NME,CNT))\par
"RTN","AHMLDOL0",194,0)\par
 .S RR(CNT)=INST\par
"RTN","AHMLDOL0",195,0)\par
 Q\par
"RTN","AHMLDOL0",196,0)\par
 ;\par
"RTN","AHMLDOL0",197,0)\par
END ;\par
"RTN","AHMLDOL0",198,0)\par
 K ACC,AMEND,CDE,CCDE,CDE,CDI,D1,D2,DOM,HLP,HLREST,II,IFN\par
"RTN","AHMLDOL0",199,0)\par
 K LRDATA,LRODT,LRORD,LRSN,LRSND,NN,ORAPMSG,ORDERID,ORIFN\par
"RTN","AHMLDOL0",200,0)\par
 K PROV,PROVNME,REMOTE,RMTE,TXT,USR,USRNME,VFLG,XQORMSG\par
"RTN","AHMLDOL0",201,0)\par
 Q\par
"RTN","AHMLDOP1")\par
0^5^B125247937\par
"RTN","AHMLDOP1",1,0)\par
AHMLDOP1 ;LEIDOS/WW/TCK - REMOTE ORDERING - Lab Report ; 2/22/17 5:56pm\par
"RTN","AHMLDOP1",2,0)\par
 ;;1.0;REMOTE ORDERS;**2**;OCT 1,2016;Build 42\par
"RTN","AHMLDOP1",3,0)\par
 ;\par
"RTN","AHMLDOP1",4,0)\par
 Q\par
"RTN","AHMLDOP1",5,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",6,0)\par
LAB ; Entry point for Remote Laboratory Orders by Location.\par
"RTN","AHMLDOP1",7,0)\par
 ;\par
"RTN","AHMLDOP1",8,0)\par
 S LRT=2\par
"RTN","AHMLDOP1",9,0)\par
 ;\par
"RTN","AHMLDOP1",10,0)\par
 D INIT,GDT:'LREND,LOC:'LREND,DETAIL:'LREND,GDV:'LREND,RUN:'LREND,STOP\par
"RTN","AHMLDOP1",11,0)\par
 ;\par
"RTN","AHMLDOP1",12,0)\par
 Q\par
"RTN","AHMLDOP1",13,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",14,0)\par
RAD ; Entry point for Remote Radiology Orders by Location.\par
"RTN","AHMLDOP1",15,0)\par
 ;\par
"RTN","AHMLDOP1",16,0)\par
 S LRT=1\par
"RTN","AHMLDOP1",17,0)\par
 ;\par
"RTN","AHMLDOP1",18,0)\par
 D INIT,GDT:'LREND,LOC:'LREND,DETAIL:'LREND,GDV:'LREND,RUN:'LREND,STOP\par
"RTN","AHMLDOP1",19,0)\par
 ;\par
"RTN","AHMLDOP1",20,0)\par
 Q\par
"RTN","AHMLDOP1",21,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",22,0)\par
TAT ; Entry point for Turnaround Time for Remote Lab Orders report.\par
"RTN","AHMLDOP1",23,0)\par
 ;\par
"RTN","AHMLDOP1",24,0)\par
 S LRT="2A"\par
"RTN","AHMLDOP1",25,0)\par
 ;\par
"RTN","AHMLDOP1",26,0)\par
 D INIT,GDT:'LREND,LOC:'LREND,DETAIL:'LREND,GDV:'LREND,RUN:'LREND,STOP\par
"RTN","AHMLDOP1",27,0)\par
 ;\par
"RTN","AHMLDOP1",28,0)\par
 Q\par
"RTN","AHMLDOP1",29,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",30,0)\par
INIT ; Initialize common variables.\par
"RTN","AHMLDOP1",31,0)\par
 ;\par
"RTN","AHMLDOP1",32,0)\par
 S U="^",D1="|",D2=";"\par
"RTN","AHMLDOP1",33,0)\par
 S LREND=0,LRSDT="TODAY",LREDT="T-7"\par
"RTN","AHMLDOP1",34,0)\par
 I LRT="2A" W !,"Turnaround Time for Remote Lab Orders" Q\par
"RTN","AHMLDOP1",35,0)\par
 W !,"REMOTE ORDERS - Remote ",$S(LRT=1:"Radiology",1:"Lab")\par
"RTN","AHMLDOP1",36,0)\par
 W " Orders by Location"\par
"RTN","AHMLDOP1",37,0)\par
 ;\par
"RTN","AHMLDOP1",38,0)\par
 Q\par
"RTN","AHMLDOP1",39,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",40,0)\par
RUN ; Run the report either queued or in person.\par
"RTN","AHMLDOP1",41,0)\par
 ;\par
"RTN","AHMLDOP1",42,0)\par
 K ^TMP($J,"AHML"),^TMP($J,"AHMLX"),^TMP($J,"AHMLT")\par
"RTN","AHMLDOP1",43,0)\par
 S:$D(ZTQUEUED) ZTREQ="@" U IO\par
"RTN","AHMLDOP1",44,0)\par
 S (LRPAG,LREND)=0\par
"RTN","AHMLDOP1",45,0)\par
 D:'LREND START\par
"RTN","AHMLDOP1",46,0)\par
 D:$D(ZTQUEUED) STOP\par
"RTN","AHMLDOP1",47,0)\par
 ;\par
"RTN","AHMLDOP1",48,0)\par
 Q\par
"RTN","AHMLDOP1",49,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",50,0)\par
STOP ; End and cleanup.\par
"RTN","AHMLDOP1",51,0)\par
 ;\par
"RTN","AHMLDOP1",52,0)\par
 I ($E(IOST,1,2)="C-") D WAIT\par
"RTN","AHMLDOP1",53,0)\par
 I '$D(ZTQUEUED) D ^%ZISC\par
"RTN","AHMLDOP1",54,0)\par
 K ^TMP($J,"AHML"),^TMP($J,"AHMLX"),^TMP($J,"AHMLT")\par
"RTN","AHMLDOP1",55,0)\par
 K %DT,D1,DATA1,DD,DM,DSTR,DTOUT,DUOUT,DY,LRDET,LREDT,LREND,LRLOC\par
"RTN","AHMLDOP1",56,0)\par
 K LRPAG,LRSDT,LRT,OR,PLOC,POP,D1,D2,XX,YY,Y,ZTDESC,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE\par
"RTN","AHMLDOP1",57,0)\par
 ;\par
"RTN","AHMLDOP1",58,0)\par
 Q\par
"RTN","AHMLDOP1",59,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",60,0)\par
GDT ; Get dates (start and end).\par
"RTN","AHMLDOP1",61,0)\par
 ;\par
"RTN","AHMLDOP1",62,0)\par
 N Y\par
"RTN","AHMLDOP1",63,0)\par
 I LRSDT?1.7N S Y=LRSDT D DD^LRX S LRSDT=Y\par
"RTN","AHMLDOP1",64,0)\par
 I LREDT?1.7N S Y=LREDT D DD^LRX S LREDT=Y\par
"RTN","AHMLDOP1",65,0)\par
 S %DT("A")="Enter START date: ",%DT("B")=LRSDT,%DT="AET"\par
"RTN","AHMLDOP1",66,0)\par
 D ^%DT S LREND=Y<1 Q:LREND\par
"RTN","AHMLDOP1",67,0)\par
 S LRSDT=Y\par
"RTN","AHMLDOP1",68,0)\par
 S %DT("A")="Enter END date: ",%DT("B")=LREDT\par
"RTN","AHMLDOP1",69,0)\par
 D ^%DT S LREND=Y<1 Q:LREND\par
"RTN","AHMLDOP1",70,0)\par
 S LREDT=Y\par
"RTN","AHMLDOP1",71,0)\par
 S:LREDT>LRSDT XX=LREDT,LREDT=LRSDT,LRSDT=XX\par
"RTN","AHMLDOP1",72,0)\par
 ;\par
"RTN","AHMLDOP1",73,0)\par
 Q\par
"RTN","AHMLDOP1",74,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",75,0)\par
GDV ; Get output device.\par
"RTN","AHMLDOP1",76,0)\par
 ;\par
"RTN","AHMLDOP1",77,0)\par
 S %ZIS="Q" D ^%ZIS K %ZIS I POP S LREND=1 Q\par
"RTN","AHMLDOP1",78,0)\par
 I $D(IO("Q")) D\par
"RTN","AHMLDOP1",79,0)\par
 .K IO("Q")\par
"RTN","AHMLDOP1",80,0)\par
 .S LREND=1,ZTRTN="RUN^AHMLDOP1",ZTDESC="Lab Special Report"\par
"RTN","AHMLDOP1",81,0)\par
 .S ZTSAVE($J,"AHML*")=""\par
"RTN","AHMLDOP1",82,0)\par
 .D ^%ZTLOAD\par
"RTN","AHMLDOP1",83,0)\par
 ;\par
"RTN","AHMLDOP1",84,0)\par
 Q\par
"RTN","AHMLDOP1",85,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",86,0)\par
LOC ; Get the locations to run report for.  Default "ALL".\par
"RTN","AHMLDOP1",87,0)\par
 ;\par
"RTN","AHMLDOP1",88,0)\par
 N II,JJ,LOC\par
"RTN","AHMLDOP1",89,0)\par
 ;\par
"RTN","AHMLDOP1",90,0)\par
 I '$D(^XTMP("AHMLDOID")) D  Q\par
"RTN","AHMLDOP1",91,0)\par
 .S LRLOC=D1_$$NAME^XUAF4($$KSP^XUPARAM("INST"))_D1\par
"RTN","AHMLDOP1",92,0)\par
 .;S LRLOC=D1_^TMP("AHMLDOP1_LOCATION")_D1   ;[temp until configuration complete then remove]\par
"RTN","AHMLDOP1",93,0)\par
 ;\par
"RTN","AHMLDOP1",94,0)\par
 K DIR\par
"RTN","AHMLDOP1",95,0)\par
 S DIR("B")="ALL",DIR("A")="Location",DIR(0)="S^1:ALL;",II=""\par
"RTN","AHMLDOP1",96,0)\par
 S LOC(1)="ALL",DIR("?")="Select Location"\par
"RTN","AHMLDOP1",97,0)\par
 ;\par
"RTN","AHMLDOP1",98,0)\par
 I $D(^XTMP("AHMLDOID")) D\par
"RTN","AHMLDOP1",99,0)\par
 .F JJ=2:1 S II=$O(^XTMP("AHMLDOID",0,II)) Q:II=""  D\par
"RTN","AHMLDOP1",100,0)\par
 ..S LOC=$$GET1^DIQ(4,II,.01),LOC(JJ)=LOC\par
"RTN","AHMLDOP1",101,0)\par
 ..S DIR(0)=DIR(0)_JJ_":"_$$GET1^DIQ(4,II,.01)_";",LOC(JJ)=LOC\par
"RTN","AHMLDOP1",102,0)\par
 ;\par
"RTN","AHMLDOP1",103,0)\par
 D ^DIR\par
"RTN","AHMLDOP1",104,0)\par
 S:($D(DUOUT))!($D(DTOUT)) LREND=1\par
"RTN","AHMLDOP1",105,0)\par
 I 'LREND D\par
"RTN","AHMLDOP1",106,0)\par
 .Q:'$D(^XTMP("AHMLDOID"))\par
"RTN","AHMLDOP1",107,0)\par
 .I LOC(Y)'="ALL" D  Q\par
"RTN","AHMLDOP1",108,0)\par
 ..S LRLOC=D1_LOC(Y)_D1\par
"RTN","AHMLDOP1",109,0)\par
 .S II="",LRLOC=D1\par
"RTN","AHMLDOP1",110,0)\par
 .F  S II=$O(^XTMP("AHMLDOID",0,II)) Q:II=""  S LRLOC=LRLOC_$P(^XTMP("AHMLDOID",0,II),"^",2)_D1\par
"RTN","AHMLDOP1",111,0)\par
 ;\par
"RTN","AHMLDOP1",112,0)\par
 Q\par
"RTN","AHMLDOP1",113,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",114,0)\par
DETAIL ; Include detail?  (1=yes, 0=no).  Default "NO".\par
"RTN","AHMLDOP1",115,0)\par
 ;\par
"RTN","AHMLDOP1",116,0)\par
 K DIR\par
"RTN","AHMLDOP1",117,0)\par
 S DIR("B")="NO",DIR("A")="Include a Detailed Report?",DIR(0)="S^1:NO;2:YES"\par
"RTN","AHMLDOP1",118,0)\par
 ;\par
"RTN","AHMLDOP1",119,0)\par
 D ^DIR\par
"RTN","AHMLDOP1",120,0)\par
 S:($D(DUOUT))!($D(DTOUT)) LREND=1 S:'LREND LRDET=Y-1 Q\par
"RTN","AHMLDOP1",121,0)\par
 ;\par
"RTN","AHMLDOP1",122,0)\par
 Q\par
"RTN","AHMLDOP1",123,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",124,0)\par
START ; Produce report looping through OR(100 data.\par
"RTN","AHMLDOP1",125,0)\par
 ;\par
"RTN","AHMLDOP1",126,0)\par
 ;   Input: LRSDT - Start date\par
"RTN","AHMLDOP1",127,0)\par
 ;          LREDT - End date\par
"RTN","AHMLDOP1",128,0)\par
 ;          LRLOC - Location(s) [|loc1|loc2|...]\par
"RTN","AHMLDOP1",129,0)\par
 ;          LRDET - Detail      [0=No, 1=Yes]\par
"RTN","AHMLDOP1",130,0)\par
 ;\par
"RTN","AHMLDOP1",131,0)\par
 ;  Output: Report.\par
"RTN","AHMLDOP1",132,0)\par
 ;\par
"RTN","AHMLDOP1",133,0)\par
 N ABREV,CDATE,COLDT,CPT,D0,DATA,IPROC,ITYPE,LOC,LRDT,LRDT1,ODATE,OR,OR1\par
"RTN","AHMLDOP1",134,0)\par
 N PNAME,PROV,RDATE,RPTDT,STATUS,TAT,TEST,TMP,TNAME,LIEN\par
"RTN","AHMLDOP1",135,0)\par
 ;\par
"RTN","AHMLDOP1",136,0)\par
 S LRDT=(LREDT-1)+.999999,LRDT1=LRSDT+.999999\par
"RTN","AHMLDOP1",137,0)\par
 ;\par
"RTN","AHMLDOP1",138,0)\par
 F  S LRDT=$O(^OR(100,"AF",LRDT)) Q:LRDT=""!(LRDT>LRDT1)  D\par
"RTN","AHMLDOP1",139,0)\par
 .S OR="" F  S OR=$O(^OR(100,"AF",LRDT,OR)) Q:OR=""  D\par
"RTN","AHMLDOP1",140,0)\par
 ..Q:OR=""\par
"RTN","AHMLDOP1",141,0)\par
 ..S LIEN=OR_","\par
"RTN","AHMLDOP1",142,0)\par
 ..I +$$GET1^DIQ(100,LIEN,2,"I")'=+LRT Q         ;not a lab/rad test\par
"RTN","AHMLDOP1",143,0)\par
 ..I '$D(^OR(100,OR,4.5)) Q\par
"RTN","AHMLDOP1",144,0)\par
 ..S OR1=0 F  S OR1=$O(^OR(100,OR,4.5,OR1)) Q:OR1=""  D\par
"RTN","AHMLDOP1",145,0)\par
 ...Q:OR1=""\par
"RTN","AHMLDOP1",146,0)\par
 ...S LIEN=OR1_","_OR_","\par
"RTN","AHMLDOP1",147,0)\par
 ...S DATA=$$GET1^DIQ(100.045,LIEN,.04,"I")\par
"RTN","AHMLDOP1",148,0)\par
 ...I DATA="ORDERABLE" S TEST=$$GET1^DIQ(100.045,LIEN,1,"I")\par
"RTN","AHMLDOP1",149,0)\par
 ...I DATA'="Location" Q\par
"RTN","AHMLDOP1",150,0)\par
 ...S LOC=$$GET1^DIQ(100.045,LIEN,1,"I") Q:LOC=""\par
"RTN","AHMLDOP1",151,0)\par
 ...I LRLOC'[(D1_LOC_D1) Q\par
"RTN","AHMLDOP1",152,0)\par
 ...I $D(^TMP($J,"AHML",LOC,OR)) Q\par
"RTN","AHMLDOP1",153,0)\par
 ...S ODATE=$$DATE($$FMTE^XLFDT(LRDT))            ;order date/time\par
"RTN","AHMLDOP1",154,0)\par
 ...S PROV=$$GET1^DIQ(100,OR,1,"E")                   ;provider\par
"RTN","AHMLDOP1",155,0)\par
 ...S PNAME=$$GET1^DIQ(100,OR,.02,"E")                ;patient name\par
"RTN","AHMLDOP1",156,0)\par
 ...S TNAME=$$GET1^DIQ(101.43,TEST,.01,"I")         ;test/procedure name\par
"RTN","AHMLDOP1",157,0)\par
 ...S D0=+$$GET1^DIQ(101.43,TEST,2,"I")           ;D0 rad/nuc #71 file\par
"RTN","AHMLDOP1",158,0)\par
 ...S (ABREV,CPT,ITYPE,IPROC,TMP)=""\par
"RTN","AHMLDOP1",159,0)\par
 ...I D0]"" D\par
"RTN","AHMLDOP1",160,0)\par
 ....S CPT=$$GET1^DIQ(71,D0,9,"I")                    ;CPT code\par
"RTN","AHMLDOP1",161,0)\par
 ....S ITYPE=$$GET1^DIQ(71,D0,12,"I")                 ;Imaging type\par
"RTN","AHMLDOP1",162,0)\par
 ....I ITYPE]"" S TMP=$O(^RA(79.2,"B",ITYPE,""))\par
"RTN","AHMLDOP1",163,0)\par
 ....I TMP]"" S ABREV=$$GET1^DIQ(79.2,TMP_",",3,"I")      ;Imaging type abbrev\par
"RTN","AHMLDOP1",164,0)\par
 ....S IPROC=$$GET1^DIQ(71,D0,.01,"I")                ;Imaging procedure\par
"RTN","AHMLDOP1",165,0)\par
 ...S STATUS=$$GET1^DIQ(100,OR,5,"E")                 ;status\par
"RTN","AHMLDOP1",166,0)\par
 ...I LRT="2A",$E(STATUS,1)'="C" Q                ;only complete for TAT\par
"RTN","AHMLDOP1",167,0)\par
 ...I STATUS="UNRELEASED" Q                       ;no unreleased\par
"RTN","AHMLDOP1",168,0)\par
 ...S CDATE=$P($$GET1^DIQ(100,OR,33),D2,2,3)       ;collect date/time\par
"RTN","AHMLDOP1",169,0)\par
 ...S COLDT=CDATE\par
"RTN","AHMLDOP1",170,0)\par
 ...I CDATE]"",$P(CDATE,D2)]"",$P(CDATE,D2,2)]"" D\par
"RTN","AHMLDOP1",171,0)\par
 ....S CDATE=$P($G(^LRO(69,$P(CDATE,D2),1,$P(CDATE,D2,2),1)),U)\par
"RTN","AHMLDOP1",172,0)\par
 ....S COLDT=CDATE\par
"RTN","AHMLDOP1",173,0)\par
 ....S CDATE=$$DATE($$FMTE^XLFDT(CDATE))\par
"RTN","AHMLDOP1",174,0)\par
 ...S RPTDT=$$GET1^DIQ(100,OR,22,"I")             ;report date/time internal\par
"RTN","AHMLDOP1",175,0)\par
 ...I LRT="2A",COLDT="" Q                         ;tat must have collect\par
"RTN","AHMLDOP1",176,0)\par
 ...S TAT="" I LRT="2A" D                         ;turnaround time (minutes)\par
"RTN","AHMLDOP1",177,0)\par
 ....S TAT=$TR($J($$FMDIFF^XLFDT(RPTDT,COLDT,2)/60,50,0)," ","")\par
"RTN","AHMLDOP1",178,0)\par
 ...S RDATE=$$DATE($$GET1^DIQ(100,OR,22,"E"))     ;report date/time\par
"RTN","AHMLDOP1",179,0)\par
 ...I LRT="2A",RDATE="" Q                         ;must have rpt date for tat\par
"RTN","AHMLDOP1",180,0)\par
 ...I LRT=1 D\par
"RTN","AHMLDOP1",181,0)\par
 ....S TMP=ODATE_D1_PROV_D1_PNAME_D1_CPT             ;rad order detail\par
"RTN","AHMLDOP1",182,0)\par
 ....S TMP=TMP_D1_ITYPE_D1_IPROC_D1_$E(STATUS,1)\par
"RTN","AHMLDOP1",183,0)\par
 ...I +LRT=2 D\par
"RTN","AHMLDOP1",184,0)\par
 ....S TMP=ODATE_D1_PROV_D1_PNAME_D1_TNAME           ;lab order detail\par
"RTN","AHMLDOP1",185,0)\par
 ....S TMP=TMP_D1_$E(STATUS,1)_D1_CDATE_D1_RDATE\par
"RTN","AHMLDOP1",186,0)\par
 ....S TMP=TMP_D1_TAT\par
"RTN","AHMLDOP1",187,0)\par
 ...I LRT=1,ITYPE]"",ABREV]"" D\par
"RTN","AHMLDOP1",188,0)\par
 ....S ^TMP($J,"AHMLX",ITYPE)=ABREV                 ;Image type abrev\par
"RTN","AHMLDOP1",189,0)\par
 ...S ^TMP($J,"AHML")=$G(^TMP($J,"AHML"))+1           ;grand total\par
"RTN","AHMLDOP1",190,0)\par
 ...S ^TMP($J,"AHML",LOC)=$G(^TMP($J,"AHML",LOC))+1   ;location total\par
"RTN","AHMLDOP1",191,0)\par
 ...S ^TMP($J,"AHML",LOC,OR)=TMP                    ;order detail\par
"RTN","AHMLDOP1",192,0)\par
 ...S ^TMP($J,"AHMLT",LOC)=$G(^TMP($J,"AHMLT",LOC))+TAT   ;tat location total\par
"RTN","AHMLDOP1",193,0)\par
 ...S ^TMP($J,"AHMLT")=$G(^TMP($J,"AHMLT"))+TAT       ;tat grand total\par
"RTN","AHMLDOP1",194,0)\par
 ;\par
"RTN","AHMLDOP1",195,0)\par
 D HDR\par
"RTN","AHMLDOP1",196,0)\par
 I 'LRDET Q\par
"RTN","AHMLDOP1",197,0)\par
 ;\par
"RTN","AHMLDOP1",198,0)\par
 S (LOC,OR,PLOC)=""\par
"RTN","AHMLDOP1",199,0)\par
 F  S LOC=$O(^TMP($J,"AHML",LOC)) Q:LOC=""  D  Q:LREND\par
"RTN","AHMLDOP1",200,0)\par
 .I LOC'=PLOC S PLOC=LOC D SHDR\par
"RTN","AHMLDOP1",201,0)\par
 .F  S OR=$O(^TMP($J,"AHML",LOC,OR)) Q:OR=""  D  Q:LREND\par
"RTN","AHMLDOP1",202,0)\par
 ..S DATA=^TMP($J,"AHML",LOC,OR)\par
"RTN","AHMLDOP1",203,0)\par
 ..I $Y+2>IOSL D WAIT Q:LREND  D:$E(IOST,1,2)'="C-" HDR D SHDR\par
"RTN","AHMLDOP1",204,0)\par
 ..I LRT=1 D\par
"RTN","AHMLDOP1",205,0)\par
 ...S TMP=$P(DATA,D1,5)\par
"RTN","AHMLDOP1",206,0)\par
 ...I TMP]"",$G(^TMP($J,"AHMLX",TMP))]"" S TMP=^TMP($J,"AHMLX",TMP)\par
"RTN","AHMLDOP1",207,0)\par
 ...W !,$P($P(DATA,D1),"@")\par
"RTN","AHMLDOP1",208,0)\par
 ...W ?10,$E($P(DATA,D1,2),1,14),?26,$E($P(DATA,D1,3),1,14)\par
"RTN","AHMLDOP1",209,0)\par
 ...W ?42,$E($P(DATA,D1,4),1,14),?49,$E(TMP,1,11)\par
"RTN","AHMLDOP1",210,0)\par
 ...W ?55,$E($P(DATA,D1,6),1,21),?77,$P(DATA,D1,7)\par
"RTN","AHMLDOP1",211,0)\par
 ...W ! I $P(DATA,D1)]"" W " @",$P($P(DATA,D1),"@",2)\par
"RTN","AHMLDOP1",212,0)\par
 ...W ?10,$E($P(DATA,D1,2),15,28),?26,$E($P(DATA,D1,3),15,28)\par
"RTN","AHMLDOP1",213,0)\par
 ...W ?42,$E($P(DATA,D1,4),15,28),?49,$E(TMP,12,22)\par
"RTN","AHMLDOP1",214,0)\par
 ...W ?55,$E($P(DATA,D1,6),22,42)\par
"RTN","AHMLDOP1",215,0)\par
 ..I LRT=2 D\par
"RTN","AHMLDOP1",216,0)\par
 ...W !,$P($P(DATA,D1),"@"),?10,$E($P(DATA,D1,2),1,14)\par
"RTN","AHMLDOP1",217,0)\par
 ...W ?26,$E($P(DATA,D1,3),1,14),?42,$E($P(DATA,D1,4),1,14)\par
"RTN","AHMLDOP1",218,0)\par
 ...W ?58,$P(DATA,D1,5),?62,$P($P(DATA,D1,6),"@")\par
"RTN","AHMLDOP1",219,0)\par
 ...W ?72 I $P(DATA,D1,5)'="D" W $P($P(DATA,D1,7),"@")\par
"RTN","AHMLDOP1",220,0)\par
 ...W ! I $P(DATA,D1)]"" W " @",$P($P(DATA,D1),"@",2)\par
"RTN","AHMLDOP1",221,0)\par
 ...W ?10,$E($P(DATA,D1,2),15,28),?26,$E($P(DATA,D1,3),15,28)\par
"RTN","AHMLDOP1",222,0)\par
 ...W ?42,$E($P(DATA,D1,4),15,28)\par
"RTN","AHMLDOP1",223,0)\par
 ...W ?62 I $P(DATA,D1,6)]"" W " @",$P($P(DATA,D1,6),"@",2)\par
"RTN","AHMLDOP1",224,0)\par
 ...W ?72 I $P(DATA,D1,5)'="D",$P(DATA,D1,7)]"" D\par
"RTN","AHMLDOP1",225,0)\par
 ....W " @",$P($P(DATA,D1,7),"@",2)\par
"RTN","AHMLDOP1",226,0)\par
 ..I LRT="2A" D\par
"RTN","AHMLDOP1",227,0)\par
 ...W !,$P($P(DATA,D1),"@"),?9,$E($P(DATA,D1,2),1,14)\par
"RTN","AHMLDOP1",228,0)\par
 ...W ?24,$E($P(DATA,D1,3),1,14),?39,$E($P(DATA,D1,4),1,14)\par
"RTN","AHMLDOP1",229,0)\par
 ...W ?54,$P(DATA,D1,5),?57,$P($P(DATA,D1,6),"@")\par
"RTN","AHMLDOP1",230,0)\par
 ...W ?66 I $P(DATA,D1,5)'="D" W $P($P(DATA,D1,7),"@")\par
"RTN","AHMLDOP1",231,0)\par
 ...W ?75,$P(DATA,D1,8)\par
"RTN","AHMLDOP1",232,0)\par
 ...W ! I $P(DATA,D1)]"" W " @",$P($P(DATA,D1),"@",2)\par
"RTN","AHMLDOP1",233,0)\par
 ...W ?9,$E($P(DATA,D1,2),15,28),?24,$E($P(DATA,D1,3),15,28)\par
"RTN","AHMLDOP1",234,0)\par
 ...W ?39,$E($P(DATA,D1,4),15,28)\par
"RTN","AHMLDOP1",235,0)\par
 ...W ?57 I $P(DATA,D1,6)]"" W " @",$P($P(DATA,D1,6),"@",2)\par
"RTN","AHMLDOP1",236,0)\par
 ...W ?66 I $P(DATA,D1,5)'="D",$P(DATA,D1,7)]"" D\par
"RTN","AHMLDOP1",237,0)\par
 ....W " @",$P($P(DATA,D1,7),"@",2)\par
"RTN","AHMLDOP1",238,0)\par
 ;\par
"RTN","AHMLDOP1",239,0)\par
 Q\par
"RTN","AHMLDOP1",240,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",241,0)\par
HDR ; Print header and totals by location.\par
"RTN","AHMLDOP1",242,0)\par
 ;\par
"RTN","AHMLDOP1",243,0)\par
 N LL,TC,TM,TTC,TTM\par
"RTN","AHMLDOP1",244,0)\par
 ;\par
"RTN","AHMLDOP1",245,0)\par
 S LRPAG=LRPAG+1\par
"RTN","AHMLDOP1",246,0)\par
 ;\par
"RTN","AHMLDOP1",247,0)\par
 I LRT'="2A" D\par
"RTN","AHMLDOP1",248,0)\par
 .W ?$S(LRT=1:22,1:24),"Remote ",$S(LRT=1:"Radiology",1:"Lab")\par
"RTN","AHMLDOP1",249,0)\par
 .W " Orders by Location"\par
"RTN","AHMLDOP1",250,0)\par
 I LRT="2A" W ?21,"Turnaround Time for Remote Lab Orders"\par
"RTN","AHMLDOP1",251,0)\par
 W ?73,"Page ",LRPAG\par
"RTN","AHMLDOP1",252,0)\par
 W !?23,"From ",$$FMTE^XLFDT(LREDT)," to ",$$FMTE^XLFDT(LRSDT)\par
"RTN","AHMLDOP1",253,0)\par
 W !?22,"Date Printed: ",$$FMTE^XLFDT($$NOW^XLFDT),!\par
"RTN","AHMLDOP1",254,0)\par
 ;\par
"RTN","AHMLDOP1",255,0)\par
 I LRT="2A" D  Q\par
"RTN","AHMLDOP1",256,0)\par
 .W !?5,"Location",?25,"# of Tests",?40,"Total Time",?60,"Average Time"\par
"RTN","AHMLDOP1",257,0)\par
 .W !?5,$TR($J("",68)," ","-")\par
"RTN","AHMLDOP1",258,0)\par
 .S LL="",(TTC,TTM)=0\par
"RTN","AHMLDOP1",259,0)\par
 .F  S LL=$O(^TMP($J,"AHML",LL)) Q:LL=""  D  Q:LREND\par
"RTN","AHMLDOP1",260,0)\par
 ..S TC=^TMP($J,"AHML",LL),TM=^TMP($J,"AHMLT",LL)\par
"RTN","AHMLDOP1",261,0)\par
 ..S TTC=TTC+TC,TTM=TTM+TM\par
"RTN","AHMLDOP1",262,0)\par
 ..W !?5,$J(LL,15),$TR($J(TC,10)," ","."),?40,TM,?60,$J(TM/TC,10,2)\par
"RTN","AHMLDOP1",263,0)\par
 .W !?5,$TR($J("",68)," ","-")\par
"RTN","AHMLDOP1",264,0)\par
 .W !?5,$J("Totals",15),$TR($J(TTC,10)," ","."),?40,TTM,?60\par
"RTN","AHMLDOP1",265,0)\par
 .W $S(TTC=0:0,1:$J(TTM/TTC,10,2)),!\par
"RTN","AHMLDOP1",266,0)\par
 ;\par
"RTN","AHMLDOP1",267,0)\par
 S LL=""\par
"RTN","AHMLDOP1",268,0)\par
 F  S LL=$O(^TMP($J,"AHML",LL)) Q:LL=""  D  Q:LREND\par
"RTN","AHMLDOP1",269,0)\par
 .W !?5,$J(LL,15),$TR($J(^TMP($J,"AHML",LL),10)," ",".")\par
"RTN","AHMLDOP1",270,0)\par
 W !?5,$TR($J("",26)," ","-")\par
"RTN","AHMLDOP1",271,0)\par
 W !?5,$J("Total",15),$TR($J(+$G(^TMP($J,"AHML")),10)," ","."),!\par
"RTN","AHMLDOP1",272,0)\par
 ;\par
"RTN","AHMLDOP1",273,0)\par
 Q\par
"RTN","AHMLDOP1",274,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",275,0)\par
SHDR ; Print sub header.\par
"RTN","AHMLDOP1",276,0)\par
 ;\par
"RTN","AHMLDOP1",277,0)\par
 I $Y+6>IOSL D WAIT Q:LREND  D:$E(IOST,1,2)'="C-" HDR W !\par
"RTN","AHMLDOP1",278,0)\par
 ;\par
"RTN","AHMLDOP1",279,0)\par
 W !!,"==> Performing Location: ",LOC,!\par
"RTN","AHMLDOP1",280,0)\par
 I LRT=1 D                                       ;rad sub header\par
"RTN","AHMLDOP1",281,0)\par
 .W !,"Order",?10,"Provider",?26,"Patient"\par
"RTN","AHMLDOP1",282,0)\par
 .W ?42,"CPT",?49,"Type",?55,"Image Procedure",?77,"St"\par
"RTN","AHMLDOP1",283,0)\par
 .W !,$TR($J("",8)," ","-"),?10,$TR($J("",14)," ","-")\par
"RTN","AHMLDOP1",284,0)\par
 .W ?26,$TR($J("",14)," ","-"),?42,$TR($J("",5)," ","-")\par
"RTN","AHMLDOP1",285,0)\par
 .W ?49,$TR($J("",4)," ","-"),?55,$TR($J("",20)," ","-")\par
"RTN","AHMLDOP1",286,0)\par
 .W ?77,$TR($J("",3)," ","-")\par
"RTN","AHMLDOP1",287,0)\par
 ;\par
"RTN","AHMLDOP1",288,0)\par
 I LRT=2 D                                       ;lab sub header\par
"RTN","AHMLDOP1",289,0)\par
 .W !,"Order",?10,"Provider",?26,"Patient",?42\par
"RTN","AHMLDOP1",290,0)\par
 .W "Test",?58,"St",?62,"Collect",?72,"Report"\par
"RTN","AHMLDOP1",291,0)\par
 .W !,$TR($J("",8)," ","-"),?10,$TR($J("",14)," ","-")\par
"RTN","AHMLDOP1",292,0)\par
 .W ?26,$TR($J("",14)," ","-"),?42,$TR($J("",14)," ","-")\par
"RTN","AHMLDOP1",293,0)\par
 .W ?58,$TR($J("",3)," ","-"),?62,$TR($J("",8)," ","-")\par
"RTN","AHMLDOP1",294,0)\par
 .W ?72,$TR($J("",8)," ","-")\par
"RTN","AHMLDOP1",295,0)\par
 ;\par
"RTN","AHMLDOP1",296,0)\par
 I LRT="2A" D                                       ;lab sub header\par
"RTN","AHMLDOP1",297,0)\par
 .W !,"Order",?9,"Provider",?24,"Patient",?39\par
"RTN","AHMLDOP1",298,0)\par
 .W "Test",?54,"St",?57,"Collect",?66,"Report",?75,"TAT"\par
"RTN","AHMLDOP1",299,0)\par
 .W !,$TR($J("",8)," ","-"),?9,$TR($J("",14)," ","-")\par
"RTN","AHMLDOP1",300,0)\par
 .W ?24,$TR($J("",14)," ","-"),?39,$TR($J("",14)," ","-")\par
"RTN","AHMLDOP1",301,0)\par
 .W ?54,$TR($J("",3)," ","-"),?57,$TR($J("",8)," ","-")\par
"RTN","AHMLDOP1",302,0)\par
 .W ?66,$TR($J("",8)," ","-"),?75,$TR($J("",5)," ","-")\par
"RTN","AHMLDOP1",303,0)\par
 ;\par
"RTN","AHMLDOP1",304,0)\par
 Q\par
"RTN","AHMLDOP1",305,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",306,0)\par
DATE(DATE) ; Convert mmm dd, yyyy@hh:mm to mm/dd/yyyy@hh:mm\par
"RTN","AHMLDOP1",307,0)\par
 ;\par
"RTN","AHMLDOP1",308,0)\par
 N DD,DM,DSTR,DY,LOWER,TM,UPPER\par
"RTN","AHMLDOP1",309,0)\par
 ;\par
"RTN","AHMLDOP1",310,0)\par
 I $G(DATE)="" Q ""\par
"RTN","AHMLDOP1",311,0)\par
 ;\par
"RTN","AHMLDOP1",312,0)\par
 S LOWER="abcdefghijklmnopqrstuvwxyz"\par
"RTN","AHMLDOP1",313,0)\par
 S UPPER="ABCDEFGHIJKLMNOPQRSTUVWXYZ"\par
"RTN","AHMLDOP1",314,0)\par
 S DSTR("JAN")="01",DSTR("FEB")="02",DSTR("MAR")="03",DSTR("APR")="04"\par
"RTN","AHMLDOP1",315,0)\par
 S DSTR("MAY")="05",DSTR("JUN")="06",DSTR("JUL")="07",DSTR("AUG")="08"\par
"RTN","AHMLDOP1",316,0)\par
 S DSTR("SEP")="09",DSTR("OCT")=10,DSTR("NOV")=11,DSTR("DEC")=12\par
"RTN","AHMLDOP1",317,0)\par
 ;\par
"RTN","AHMLDOP1",318,0)\par
 S DM=$TR($P(DATE," "),LOWER,UPPER),DD=$P($P(DATE," ",2),",")\par
"RTN","AHMLDOP1",319,0)\par
 S DY=$E($P($P(DATE," ",3),"@"),3,4),TM=$P($P(DATE,"@",2),":",1,2)\par
"RTN","AHMLDOP1",320,0)\par
 ;\par
"RTN","AHMLDOP1",321,0)\par
 Q DSTR(DM)_"/"_DD_"/"_DY_"@"_TM\par
"RTN","AHMLDOP1",322,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP1",323,0)\par
WAIT ; Pause for page breaks.\par
"RTN","AHMLDOP1",324,0)\par
 ;\par
"RTN","AHMLDOP1",325,0)\par
 K DIR\par
"RTN","AHMLDOP1",326,0)\par
 S DIR(0)="E"\par
"RTN","AHMLDOP1",327,0)\par
 D ^DIR\par
"RTN","AHMLDOP1",328,0)\par
 S:($D(DUOUT))!($D(DTOUT)) LREND=1\par
"RTN","AHMLDOP1",329,0)\par
 S $Y=1\par
"RTN","AHMLDOP1",330,0)\par
 ;\par
"RTN","AHMLDOP1",331,0)\par
 Q\par
"RTN","AHMLDOP2")\par
0^6^B176410274\par
"RTN","AHMLDOP2",1,0)\par
AHMLDOP2 ;LEIDOS/WW/TCK - REMOTE ORDERING -reports; 10/16/16 8:58pm ; 2/22/17 5:56pm\par
"RTN","AHMLDOP2",2,0)\par
 ;;1.0;REMOTE ORDERS;**2**;OCT 1,2016;Build 42\par
"RTN","AHMLDOP2",3,0)\par
 ;\par
"RTN","AHMLDOP2",4,0)\par
 Q\par
"RTN","AHMLDOP2",5,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",6,0)\par
LAB ; Entry point for Remote Laboratory Orders by Test Name.\par
"RTN","AHMLDOP2",7,0)\par
 ;\par
"RTN","AHMLDOP2",8,0)\par
 N LRT\par
"RTN","AHMLDOP2",9,0)\par
 S LRT=2,XREF="AF"\par
"RTN","AHMLDOP2",10,0)\par
 ;\par
"RTN","AHMLDOP2",11,0)\par
 D INIT,GDT:'LREND,TEST:'LREND,LOC:'LREND,DETAIL:'LREND\par
"RTN","AHMLDOP2",12,0)\par
 D GDV:'LREND,RUN:'LREND,STOP\par
"RTN","AHMLDOP2",13,0)\par
 ;\par
"RTN","AHMLDOP2",14,0)\par
 Q\par
"RTN","AHMLDOP2",15,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",16,0)\par
RAD ; Entry point for Remote Radiology Orders by Image Type.\par
"RTN","AHMLDOP2",17,0)\par
 ;\par
"RTN","AHMLDOP2",18,0)\par
 S LRT=1,XREF="AF"\par
"RTN","AHMLDOP2",19,0)\par
 ;\par
"RTN","AHMLDOP2",20,0)\par
 D INIT,GDT:'LREND,IMAGE:'LREND,LOC:'LREND,DETAIL:'LREND\par
"RTN","AHMLDOP2",21,0)\par
 D GDV:'LREND,RUN:'LREND,STOP\par
"RTN","AHMLDOP2",22,0)\par
 ;\par
"RTN","AHMLDOP2",23,0)\par
 Q\par
"RTN","AHMLDOP2",24,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",25,0)\par
RADC ; Entry point for Remote Radiology Orders by CPT Code.\par
"RTN","AHMLDOP2",26,0)\par
 ;\par
"RTN","AHMLDOP2",27,0)\par
 S LRT="1A",XREF="AF"\par
"RTN","AHMLDOP2",28,0)\par
 ;\par
"RTN","AHMLDOP2",29,0)\par
 D INIT,GDT:'LREND,CPT:'LREND,LOC:'LREND,DETAIL:'LREND\par
"RTN","AHMLDOP2",30,0)\par
 D GDV:'LREND,RUN:'LREND,STOP\par
"RTN","AHMLDOP2",31,0)\par
 ;\par
"RTN","AHMLDOP2",32,0)\par
 Q\par
"RTN","AHMLDOP2",33,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",34,0)\par
RADCR ; Entry point for Remote Radiology Orders by CPT Code and RVU.\par
"RTN","AHMLDOP2",35,0)\par
 ;\par
"RTN","AHMLDOP2",36,0)\par
 S LRT="1B",XREF="AF",LRTEST="*"\par
"RTN","AHMLDOP2",37,0)\par
 ;\par
"RTN","AHMLDOP2",38,0)\par
 D INIT,GDT:'LREND,LOC:'LREND,DETAIL:'LREND,GDV:'LREND,RUN:'LREND,STOP\par
"RTN","AHMLDOP2",39,0)\par
 ;\par
"RTN","AHMLDOP2",40,0)\par
 Q\par
"RTN","AHMLDOP2",41,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",42,0)\par
INIT ; Initialize common variables.\par
"RTN","AHMLDOP2",43,0)\par
 ;\par
"RTN","AHMLDOP2",44,0)\par
 S U="^",D1="|",D2=";"\par
"RTN","AHMLDOP2",45,0)\par
 S LREND=0,LRSDT="TODAY",LREDT="T-7"\par
"RTN","AHMLDOP2",46,0)\par
 W !,"REMOTE ORDERS - Remote ",$S(LRT=1:"Radiology",1:"Lab")\par
"RTN","AHMLDOP2",47,0)\par
 W " Orders by "_$S(LRT=2:"Test Name",LRT=1:"Imaging Type",1:"CPT Code")\par
"RTN","AHMLDOP2",48,0)\par
 I LRT="1B" W " and wRVU"\par
"RTN","AHMLDOP2",49,0)\par
 ;\par
"RTN","AHMLDOP2",50,0)\par
 Q\par
"RTN","AHMLDOP2",51,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",52,0)\par
RUN ; Run the report either queued or in person.\par
"RTN","AHMLDOP2",53,0)\par
 ;\par
"RTN","AHMLDOP2",54,0)\par
 K ^TMP($J,"AHML")\par
"RTN","AHMLDOP2",55,0)\par
 S:$D(ZTQUEUED) ZTREQ="@" U IO\par
"RTN","AHMLDOP2",56,0)\par
 S (LRPAG,LREND)=0\par
"RTN","AHMLDOP2",57,0)\par
 D:'LREND START\par
"RTN","AHMLDOP2",58,0)\par
 D:$D(ZTQUEUED) STOP\par
"RTN","AHMLDOP2",59,0)\par
 ;\par
"RTN","AHMLDOP2",60,0)\par
 Q\par
"RTN","AHMLDOP2",61,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",62,0)\par
STOP ; End and cleanup.\par
"RTN","AHMLDOP2",63,0)\par
 ;\par
"RTN","AHMLDOP2",64,0)\par
 I ($E(IOST,1,2)="C-") D WAIT\par
"RTN","AHMLDOP2",65,0)\par
 I '$D(ZTQUEUED) D ^%ZISC\par
"RTN","AHMLDOP2",66,0)\par
 K ^TMP($J,"AHML"),^TMP($J,"AHMLTST"),^TMP($J,"AHMLX"),^TMP($J,"AHMLCPT")\par
"RTN","AHMLDOP2",67,0)\par
 K %DT,D1,DATA1,DD,DM,DSTR,DTOUT,DUOUT,DY\par
"RTN","AHMLDOP2",68,0)\par
 K LRDET,LREDT,LREND,LRLOC,LRPAG,LRSDT,LRTEST\par
"RTN","AHMLDOP2",69,0)\par
 K OR,PLOC,POP,D2,XX,XREF,YY,ZTDESC,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE\par
"RTN","AHMLDOP2",70,0)\par
 ;\par
"RTN","AHMLDOP2",71,0)\par
 Q\par
"RTN","AHMLDOP2",72,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",73,0)\par
GDT ; Get dates (start and end).\par
"RTN","AHMLDOP2",74,0)\par
 ;\par
"RTN","AHMLDOP2",75,0)\par
 N Y\par
"RTN","AHMLDOP2",76,0)\par
 I LRSDT?1.7N S Y=LRSDT D DD^LRX S LRSDT=Y\par
"RTN","AHMLDOP2",77,0)\par
 I LREDT?1.7N S Y=LREDT D DD^LRX S LREDT=Y\par
"RTN","AHMLDOP2",78,0)\par
 S %DT("A")="Enter START date: ",%DT("B")=LRSDT,%DT="AET"\par
"RTN","AHMLDOP2",79,0)\par
 D ^%DT S LREND=Y<1 Q:LREND\par
"RTN","AHMLDOP2",80,0)\par
 S LRSDT=Y\par
"RTN","AHMLDOP2",81,0)\par
 S %DT("A")="Enter END date: ",%DT("B")=LREDT\par
"RTN","AHMLDOP2",82,0)\par
 D ^%DT S LREND=Y<1 Q:LREND\par
"RTN","AHMLDOP2",83,0)\par
 S LREDT=Y\par
"RTN","AHMLDOP2",84,0)\par
 S:LREDT>LRSDT X=LREDT,LREDT=LRSDT,LRSDT=X\par
"RTN","AHMLDOP2",85,0)\par
 ;\par
"RTN","AHMLDOP2",86,0)\par
 Q\par
"RTN","AHMLDOP2",87,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",88,0)\par
GDV ; Get output device.\par
"RTN","AHMLDOP2",89,0)\par
 ;\par
"RTN","AHMLDOP2",90,0)\par
 S %ZIS="Q" D ^%ZIS K %ZIS I POP S LREND=1 Q\par
"RTN","AHMLDOP2",91,0)\par
 I $D(IO("Q")) D\par
"RTN","AHMLDOP2",92,0)\par
 .K IO("Q")\par
"RTN","AHMLDOP2",93,0)\par
 .S LREND=1,ZTRTN="RUN^AHMLDOP2",ZTDESC="Lab Special Report"\par
"RTN","AHMLDOP2",94,0)\par
 .S ZTSAVE($J,"AHML*")=""\par
"RTN","AHMLDOP2",95,0)\par
 .D ^%ZTLOAD\par
"RTN","AHMLDOP2",96,0)\par
 ;\par
"RTN","AHMLDOP2",97,0)\par
 Q\par
"RTN","AHMLDOP2",98,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",99,0)\par
LOC ; Get the locations to run report for.  Default "ALL".\par
"RTN","AHMLDOP2",100,0)\par
 ;\par
"RTN","AHMLDOP2",101,0)\par
 N II,JJ,LOC\par
"RTN","AHMLDOP2",102,0)\par
 ;\par
"RTN","AHMLDOP2",103,0)\par
 I '$D(^XTMP("AHMLDOID")) D  Q\par
"RTN","AHMLDOP2",104,0)\par
 .S LRLOC=D1_$$NAME^XUAF4($$KSP^XUPARAM("INST"))_D1\par
"RTN","AHMLDOP2",105,0)\par
 .;S LRLOC=D1_^TMP("AHMLDOP1_LOCATION")_D1   ;[temp until configuration complete then remove]\par
"RTN","AHMLDOP2",106,0)\par
 ;\par
"RTN","AHMLDOP2",107,0)\par
 K DIR\par
"RTN","AHMLDOP2",108,0)\par
 S DIR("B")="ALL",DIR("A")="Location",DIR(0)="S^1:ALL;",II=""\par
"RTN","AHMLDOP2",109,0)\par
 S LOC(1)="ALL",DIR("?")="Select Location"\par
"RTN","AHMLDOP2",110,0)\par
 ;\par
"RTN","AHMLDOP2",111,0)\par
 I $D(^XTMP("AHMLDOID")) D\par
"RTN","AHMLDOP2",112,0)\par
 .F JJ=2:1 S II=$O(^XTMP("AHMLDOID",0,II)) Q:II=""  D\par
"RTN","AHMLDOP2",113,0)\par
 ..S LOC=$$GET1^DIQ(4,II,.01),LOC(JJ)=LOC\par
"RTN","AHMLDOP2",114,0)\par
 ..S DIR(0)=DIR(0)_JJ_":"_$$GET1^DIQ(4,II,.01)_";",LOC(JJ)=LOC\par
"RTN","AHMLDOP2",115,0)\par
 ;\par
"RTN","AHMLDOP2",116,0)\par
 D ^DIR\par
"RTN","AHMLDOP2",117,0)\par
 S:($D(DUOUT))!($D(DTOUT)) LREND=1\par
"RTN","AHMLDOP2",118,0)\par
 I 'LREND D\par
"RTN","AHMLDOP2",119,0)\par
 .Q:'$D(^XTMP("AHMLDOID"))\par
"RTN","AHMLDOP2",120,0)\par
 .I LOC(Y)'="ALL" D  Q\par
"RTN","AHMLDOP2",121,0)\par
 ..S LRLOC=D1_LOC(Y)_D1\par
"RTN","AHMLDOP2",122,0)\par
 .S II="",LRLOC=D1\par
"RTN","AHMLDOP2",123,0)\par
 .F  S II=$O(^DIC(4,"E",II)) Q:II=""  S LRLOC=LRLOC_$$GET1^DIQ(4,II,.01)_D1\par
"RTN","AHMLDOP2",124,0)\par
 ;\par
"RTN","AHMLDOP2",125,0)\par
 Q\par
"RTN","AHMLDOP2",126,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",127,0)\par
TEST ; Prompt for lab test(s) to be included (<Return> for all).\par
"RTN","AHMLDOP2",128,0)\par
 ;\par
"RTN","AHMLDOP2",129,0)\par
 N X,STOP\par
"RTN","AHMLDOP2",130,0)\par
 ;\par
"RTN","AHMLDOP2",131,0)\par
 K DIC,^TMP($J,"AHMLTST")\par
"RTN","AHMLDOP2",132,0)\par
 W !!,"Press <Enter> at LABORATORY TEST NAME Prompt to select All Tests",!\par
"RTN","AHMLDOP2",133,0)\par
 S DIC="^LAB(60,",DIC(0)="AEMOQ",STOP=0\par
"RTN","AHMLDOP2",134,0)\par
 S DIC("S")="I $P(^(0),U,4)[""CH"",""BO""[$P(^(0),U,3)"\par
"RTN","AHMLDOP2",135,0)\par
 ;\par
"RTN","AHMLDOP2",136,0)\par
 F  D  Q:STOP!(LREND)\par
"RTN","AHMLDOP2",137,0)\par
 .D ^DIC\par
"RTN","AHMLDOP2",138,0)\par
 .I X["^" S LREND=1 Q\par
"RTN","AHMLDOP2",139,0)\par
 .I Y>0 S ^TMP($J,"AHMLTST",$P(Y,U,2))=""\par
"RTN","AHMLDOP2",140,0)\par
 .I Y<0 S STOP=1 Q\par
"RTN","AHMLDOP2",141,0)\par
 ;\par
"RTN","AHMLDOP2",142,0)\par
 I '$D(^TMP($J,"AHMLTST")) S LRTEST="*" W "ALL Tests Selected"\par
"RTN","AHMLDOP2",143,0)\par
 E  S LRTEST=""\par
"RTN","AHMLDOP2",144,0)\par
 ;\par
"RTN","AHMLDOP2",145,0)\par
 Q\par
"RTN","AHMLDOP2",146,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",147,0)\par
IMAGE ; Prompt for rad image type(s) to be included (<Return> for all).\par
"RTN","AHMLDOP2",148,0)\par
 ;\par
"RTN","AHMLDOP2",149,0)\par
 N X,Y,STOP\par
"RTN","AHMLDOP2",150,0)\par
 ;\par
"RTN","AHMLDOP2",151,0)\par
 K DIC,^TMP($J,"AHMLTST")\par
"RTN","AHMLDOP2",152,0)\par
 W !!,"Press <Enter> at IMAGE TYPE Prompt to select All Tests",!\par
"RTN","AHMLDOP2",153,0)\par
 S DIC="^RA(79.2,",DIC(0)="AEMOQ",STOP=0,DIC("A")="IMAGE TYPE: "\par
"RTN","AHMLDOP2",154,0)\par
 ;\par
"RTN","AHMLDOP2",155,0)\par
 F  D  Q:STOP!(LREND)\par
"RTN","AHMLDOP2",156,0)\par
 .D ^DIC\par
"RTN","AHMLDOP2",157,0)\par
 .I X["^" S LREND=1 Q\par
"RTN","AHMLDOP2",158,0)\par
 .I Y>0 S ^TMP($J,"AHMLTST",$P(Y,U,2))=""\par
"RTN","AHMLDOP2",159,0)\par
 .I Y<0 S STOP=1 Q\par
"RTN","AHMLDOP2",160,0)\par
 ;\par
"RTN","AHMLDOP2",161,0)\par
 I '$D(^TMP($J,"AHMLTST")) S LRTEST="*" W "ALL Image Types Selected"\par
"RTN","AHMLDOP2",162,0)\par
 E  S LRTEST=""\par
"RTN","AHMLDOP2",163,0)\par
 ;\par
"RTN","AHMLDOP2",164,0)\par
 Q\par
"RTN","AHMLDOP2",165,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",166,0)\par
CPT ; Prompt for CPT Code(s) to be included (<Return> for all).\par
"RTN","AHMLDOP2",167,0)\par
 ;\par
"RTN","AHMLDOP2",168,0)\par
 N X,STOP\par
"RTN","AHMLDOP2",169,0)\par
 ;\par
"RTN","AHMLDOP2",170,0)\par
 K DIC,^TMP($J,"AHMLCPT")\par
"RTN","AHMLDOP2",171,0)\par
 W !!,"Press <Enter> at CPT CODE Prompt to select All Tests",!\par
"RTN","AHMLDOP2",172,0)\par
 S DIC="^ICPT(",DIC(0)="AEMOQ",STOP=0,DIC("A")="CPT CODE: "\par
"RTN","AHMLDOP2",173,0)\par
 ;\par
"RTN","AHMLDOP2",174,0)\par
 F  D  Q:STOP!(LREND)\par
"RTN","AHMLDOP2",175,0)\par
 .D ^DIC\par
"RTN","AHMLDOP2",176,0)\par
 .I X["^" S LREND=1 Q\par
"RTN","AHMLDOP2",177,0)\par
 .I Y>0 S ^TMP($J,"AHMLCPT",$P(Y,U,2))=""\par
"RTN","AHMLDOP2",178,0)\par
 .I Y<0 S STOP=1 Q\par
"RTN","AHMLDOP2",179,0)\par
 ;\par
"RTN","AHMLDOP2",180,0)\par
 I '$D(^TMP($J,"AHMLCPT")) S LRTEST="*" W "ALL CPT Codes Selected"\par
"RTN","AHMLDOP2",181,0)\par
 E  S LRTEST=""\par
"RTN","AHMLDOP2",182,0)\par
 ;\par
"RTN","AHMLDOP2",183,0)\par
 Q\par
"RTN","AHMLDOP2",184,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",185,0)\par
DETAIL ; Include detail?  (1=yes, 0=no).  Default "NO".\par
"RTN","AHMLDOP2",186,0)\par
 ;\par
"RTN","AHMLDOP2",187,0)\par
 N Y\par
"RTN","AHMLDOP2",188,0)\par
 K DIR\par
"RTN","AHMLDOP2",189,0)\par
 S DIR("B")="NO",DIR("A")="Include a Detailed Report?",DIR(0)="S^1:NO;2:YES"\par
"RTN","AHMLDOP2",190,0)\par
 ;\par
"RTN","AHMLDOP2",191,0)\par
 D ^DIR\par
"RTN","AHMLDOP2",192,0)\par
 S:($D(DUOUT))!($D(DTOUT)) LREND=1 S:'LREND LRDET=Y-1 Q\par
"RTN","AHMLDOP2",193,0)\par
 ;\par
"RTN","AHMLDOP2",194,0)\par
 Q\par
"RTN","AHMLDOP2",195,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",196,0)\par
START ; Produce report looping through OR(100 data.\par
"RTN","AHMLDOP2",197,0)\par
 ;\par
"RTN","AHMLDOP2",198,0)\par
 ;   Input: LRSDT - Start date\par
"RTN","AHMLDOP2",199,0)\par
 ;          LREDT - End date\par
"RTN","AHMLDOP2",200,0)\par
 ;          LRLOC - Location(s) [|loc1|loc2|...]\par
"RTN","AHMLDOP2",201,0)\par
 ;          LRDET - Detail      [0=No, 1=Yes]\par
"RTN","AHMLDOP2",202,0)\par
 ;\par
"RTN","AHMLDOP2",203,0)\par
 ;  Output: Report.\par
"RTN","AHMLDOP2",204,0)\par
 ;\par
"RTN","AHMLDOP2",205,0)\par
 N ABREV,CDATE,CPT,D0,DATA,IPROC,ITYPE,LOC,LRDT,LRDT1,ODATE,OR,OR1\par
"RTN","AHMLDOP2",206,0)\par
 N PNAME,PROV,RDATE,STATUS,TEST,TMP,TNAME\par
"RTN","AHMLDOP2",207,0)\par
 ;\par
"RTN","AHMLDOP2",208,0)\par
 S LRDT=(LREDT-1)+.999999,LRDT1=LRSDT+.999999\par
"RTN","AHMLDOP2",209,0)\par
 ;\par
"RTN","AHMLDOP2",210,0)\par
 F  S LRDT=$O(^OR(100,XREF,LRDT)) Q:LRDT=""!(LRDT>LRDT1)  D\par
"RTN","AHMLDOP2",211,0)\par
 .S OR="" F  S OR=$O(^OR(100,XREF,LRDT,OR)) Q:OR=""  D\par
"RTN","AHMLDOP2",212,0)\par
 ..I +$P($G(^OR(100,OR,0)),U,5)'=+LRT Q           ;not a lab/rad test\par
"RTN","AHMLDOP2",213,0)\par
 ..I '$D(^OR(100,OR,4.5)) Q\par
"RTN","AHMLDOP2",214,0)\par
 ..S OR1="" F  S OR1=$O(^OR(100,OR,4.5,OR1)) Q:OR1=""  D\par
"RTN","AHMLDOP2",215,0)\par
 ...S DATA=$G(^OR(100,OR,4.5,OR1,0))\par
"RTN","AHMLDOP2",216,0)\par
 ...I $P(DATA,U,4)'="Location" Q\par
"RTN","AHMLDOP2",217,0)\par
 ...S LOC=$G(^OR(100,OR,4.5,OR1,1)) Q:LOC=""\par
"RTN","AHMLDOP2",218,0)\par
 ...I LRLOC'[(D1_LOC_D1) Q\par
"RTN","AHMLDOP2",219,0)\par
 ...I $D(^TMP($J,"AHML",LOC,OR)) Q\par
"RTN","AHMLDOP2",220,0)\par
 ...S TEST=$G(^OR(100,OR,4.5,1,1))                ;test\par
"RTN","AHMLDOP2",221,0)\par
 ...S ODATE=$$DATE($$FMTE^XLFDT(LRDT))            ;order date/time\par
"RTN","AHMLDOP2",222,0)\par
 ...S PROV=$$GET1^DIQ(100,OR,1)                   ;provider\par
"RTN","AHMLDOP2",223,0)\par
 ...S PNAME=$$GET1^DIQ(100,OR,.02)                ;patient name\par
"RTN","AHMLDOP2",224,0)\par
 ...S TNAME=$$GET1^DIQ(101.43,TEST,.01)           ;test/procedure name\par
"RTN","AHMLDOP2",225,0)\par
 ...S D0=+$$GET1^DIQ(101.43,TEST,2,"I")           ;D0 rad/nuc #71 file\par
"RTN","AHMLDOP2",226,0)\par
 ...S (ABREV,CPT,ITYPE,IPROC,TMP)=""\par
"RTN","AHMLDOP2",227,0)\par
 ...I D0]"" D\par
"RTN","AHMLDOP2",228,0)\par
 ....S CPT=$$GET1^DIQ(71,D0,9)                    ;CPT code\par
"RTN","AHMLDOP2",229,0)\par
 ....S ITYPE=$$GET1^DIQ(71,D0,12)                 ;Imaging type\par
"RTN","AHMLDOP2",230,0)\par
 ....I ITYPE]"" S TMP=$O(^RA(79.2,"B",ITYPE,""))\par
"RTN","AHMLDOP2",231,0)\par
 ....I TMP]"" S ABREV=$$GET1^DIQ(79.2,TMP,3)      ;Imaging type abbrev\par
"RTN","AHMLDOP2",232,0)\par
 ....S IPROC=$$GET1^DIQ(71,D0,.01)                ;Imaging procedure\par
"RTN","AHMLDOP2",233,0)\par
 ...S STATUS=$$GET1^DIQ(100,OR,5)                 ;status\par
"RTN","AHMLDOP2",234,0)\par
 ...I STATUS="UNRELEASED" Q                       ;no unreleased\par
"RTN","AHMLDOP2",235,0)\par
 ...S CDATE=$P($$GET1^DIQ(100,OR,33),D2,2,3)       ;collect date/time\par
"RTN","AHMLDOP2",236,0)\par
 ...I CDATE]"",$P(CDATE,D2)]"",$P(CDATE,D2,2)]"" D\par
"RTN","AHMLDOP2",237,0)\par
 ....S CDATE=$P($G(^LRO(69,$P(CDATE,D2),1,$P(CDATE,D2,2),1)),U)\par
"RTN","AHMLDOP2",238,0)\par
 ....S CDATE=$$DATE($$FMTE^XLFDT(CDATE))\par
"RTN","AHMLDOP2",239,0)\par
 ...S RDATE=$$DATE($$GET1^DIQ(100,OR,22,"E"))     ;report date/time\par
"RTN","AHMLDOP2",240,0)\par
 ...I LRT="1B",RDATE="" Q                         ;CPT wRVU only reported\par
"RTN","AHMLDOP2",241,0)\par
 ...I LRT="1B",$E(STATUS,1)="D" Q                 ;         and no deleted\par
"RTN","AHMLDOP2",242,0)\par
 ...I +LRT=1 D\par
"RTN","AHMLDOP2",243,0)\par
 ....S TMP=$S(LRT="1B":RDATE,1:ODATE)_D1_PROV      ;rad order detail\par
"RTN","AHMLDOP2",244,0)\par
 ....S TMP=TMP_D1_PNAME_D1_CPT_D1_ITYPE\par
"RTN","AHMLDOP2",245,0)\par
 ....S TMP=TMP_D1_IPROC_D1_$E(STATUS,1)\par
"RTN","AHMLDOP2",246,0)\par
 ....S TNAME=ITYPE\par
"RTN","AHMLDOP2",247,0)\par
 ...I LRT=2 D\par
"RTN","AHMLDOP2",248,0)\par
 ....S TMP=ODATE_D1_PROV_D1_PNAME_D1_TNAME           ;lab report detail\par
"RTN","AHMLDOP2",249,0)\par
 ....S TMP=TMP_D1_$E(STATUS,1)_D1_CDATE_D1_RDATE\par
"RTN","AHMLDOP2",250,0)\par
 ...I LRT'="1A",LRT'="1B",TNAME]"",$D(^TMP($J,"AHMLTST",TNAME))!(LRTEST="*") D\par
"RTN","AHMLDOP2",251,0)\par
 ....S ^TMP($J,"AHMLTST")=$G(^TMP($J,"AHMLTST"))+1              ;total\par
"RTN","AHMLDOP2",252,0)\par
 ....S ^TMP($J,"AHMLTST",TNAME)=$G(^TMP($J,"AHMLTST",TNAME))+1  ;total by test\par
"RTN","AHMLDOP2",253,0)\par
 ...I +LRT=1,TNAME]"",ABREV]"" D\par
"RTN","AHMLDOP2",254,0)\par
 ....S ^TMP($J,"AHMLX",TNAME)=ABREV                           ;Image type abrev\par
"RTN","AHMLDOP2",255,0)\par
 ...I LRT'="1A",LRT'="1B",TNAME]"",'$D(^TMP($J,"AHMLTST",TNAME)),LRTEST'="*" Q   ;test not selected\par
"RTN","AHMLDOP2",256,0)\par
 ...I (LRT="1A"!(LRT="1B")),IPROC]"" S:CPT="" CPT="NONE" D\par
"RTN","AHMLDOP2",257,0)\par
 ....I LRTEST'="*",'$D(^TMP($J,"AHMLCPT",CPT)) Q\par
"RTN","AHMLDOP2",258,0)\par
 ....S ^TMP($J,"AHMLTST")=$G(^TMP($J,"AHMLTST"))+1                      ;Total\par
"RTN","AHMLDOP2",259,0)\par
 ....S ^TMP($J,"AHMLTST",CPT,IPROC)=$G(^TMP($J,"AHMLTST",CPT,IPROC))+1  ;total by CPT\par
"RTN","AHMLDOP2",260,0)\par
 ...I LRT="1A",LRTEST'="*",CPT]"",'$D(^TMP($J,"AHMLCPT",CPT)) Q       ;not a CPT to total\par
"RTN","AHMLDOP2",261,0)\par
 ...I LRT="1A",CPT="",LRTEST'="*" Q\par
"RTN","AHMLDOP2",262,0)\par
 ...S ^TMP($J,"AHML")=$G(^TMP($J,"AHML"))+1                     ;grand total\par
"RTN","AHMLDOP2",263,0)\par
 ...S ^TMP($J,"AHML",LOC)=$G(^TMP($J,"AHML",LOC))+1             ;location total\par
"RTN","AHMLDOP2",264,0)\par
 ...S ^TMP($J,"AHML",LOC,OR)=TMP                              ;order detail\par
"RTN","AHMLDOP2",265,0)\par
 ;\par
"RTN","AHMLDOP2",266,0)\par
 I '$D(^TMP($J,"AHML")) D  Q                                  ;nothing matching criteria\par
"RTN","AHMLDOP2",267,0)\par
 .W !!,"No data found matching prescribed criteria.",!\par
"RTN","AHMLDOP2",268,0)\par
 D HDR\par
"RTN","AHMLDOP2",269,0)\par
 I 'LRDET Q\par
"RTN","AHMLDOP2",270,0)\par
 ;\par
"RTN","AHMLDOP2",271,0)\par
 S (LOC,OR,PLOC)=""\par
"RTN","AHMLDOP2",272,0)\par
 F  S LOC=$O(^TMP($J,"AHML",LOC)) Q:LOC=""  D  Q:LREND\par
"RTN","AHMLDOP2",273,0)\par
 .I LOC'=PLOC S PLOC=LOC D SHDR\par
"RTN","AHMLDOP2",274,0)\par
 .F  S OR=$O(^TMP($J,"AHML",LOC,OR)) Q:OR=""  D  Q:LREND\par
"RTN","AHMLDOP2",275,0)\par
 ..S DATA=^TMP($J,"AHML",LOC,OR)\par
"RTN","AHMLDOP2",276,0)\par
 ..I DATA="" Q\par
"RTN","AHMLDOP2",277,0)\par
 ..I $Y+2>IOSL D WAIT Q:LREND  D:$E(IOST,1,2)'="C-" HDR D SHDR\par
"RTN","AHMLDOP2",278,0)\par
 ..I +LRT=1 D\par
"RTN","AHMLDOP2",279,0)\par
 ...S TMP=$P(DATA,D1,5)\par
"RTN","AHMLDOP2",280,0)\par
 ...I TMP]"",$G(^TMP($J,"AHMLX",TMP))]"" S TMP=^TMP($J,"AHMLX",TMP)\par
"RTN","AHMLDOP2",281,0)\par
 ...W !,$P($P(DATA,D1),"@")\par
"RTN","AHMLDOP2",282,0)\par
 ...W ?10,$E($P(DATA,D1,2),1,14),?26,$E($P(DATA,D1,3),1,14)\par
"RTN","AHMLDOP2",283,0)\par
 ...W ?42,$E($P(DATA,D1,4),1,14),?49,$E(TMP,1,11)\par
"RTN","AHMLDOP2",284,0)\par
 ...W ?55,$E($P(DATA,D1,6),1,21),?77,$P(DATA,D1,7)\par
"RTN","AHMLDOP2",285,0)\par
 ...W ! I $P(DATA,D1)]"" W " @",$P($P(DATA,D1),"@",2)\par
"RTN","AHMLDOP2",286,0)\par
 ...W ?10,$E($P(DATA,D1,2),15,28),?26,$E($P(DATA,D1,3),15,28)\par
"RTN","AHMLDOP2",287,0)\par
 ...W ?42,$E($P(DATA,D1,4),15,28),?49,$E(TMP,12,22)\par
"RTN","AHMLDOP2",288,0)\par
 ...W ?55,$E($P(DATA,D1,6),22,42)\par
"RTN","AHMLDOP2",289,0)\par
 ..I LRT=2 D\par
"RTN","AHMLDOP2",290,0)\par
 ...W !,$P($P(DATA,D1),"@"),?10,$E($P(DATA,D1,2),1,14)\par
"RTN","AHMLDOP2",291,0)\par
 ...W ?26,$E($P(DATA,D1,3),1,14),?42,$E($P(DATA,D1,4),1,14)\par
"RTN","AHMLDOP2",292,0)\par
 ...W ?58,$P(DATA,D1,5),?62,$P($P(DATA,D1,6),"@")\par
"RTN","AHMLDOP2",293,0)\par
 ...W ?72 I $P(DATA,D1,5)'="D" W $P($P(DATA,D1,7),"@")\par
"RTN","AHMLDOP2",294,0)\par
 ...W ! I $P(DATA,D1)]"" W " @",$P($P(DATA,D1),"@",2)\par
"RTN","AHMLDOP2",295,0)\par
 ...W ?10,$E($P(DATA,D1,2),15,28),?26,$E($P(DATA,D1,3),15,28)\par
"RTN","AHMLDOP2",296,0)\par
 ...W ?42,$E($P(DATA,D1,4),15,28)\par
"RTN","AHMLDOP2",297,0)\par
 ...W ?62 I $P(DATA,D1,6)]"" W " @",$P($P(DATA,D1,6),"@",2)\par
"RTN","AHMLDOP2",298,0)\par
 ...W ?72 I $P(DATA,D1,5)'="D",$P(DATA,D1,7)]"" D\par
"RTN","AHMLDOP2",299,0)\par
 ....W " @",$P($P(DATA,D1,7),"@",2)\par
"RTN","AHMLDOP2",300,0)\par
 ;\par
"RTN","AHMLDOP2",301,0)\par
 Q\par
"RTN","AHMLDOP2",302,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",303,0)\par
HDR ; Print header and totals by location.\par
"RTN","AHMLDOP2",304,0)\par
 ;\par
"RTN","AHMLDOP2",305,0)\par
 N EXAM,GTWRVU,LL,NAME,TEXAM,TWRVU,WRVU,GTEXAM\par
"RTN","AHMLDOP2",306,0)\par
 ;\par
"RTN","AHMLDOP2",307,0)\par
 S LRPAG=LRPAG+1\par
"RTN","AHMLDOP2",308,0)\par
 ;\par
"RTN","AHMLDOP2",309,0)\par
 W ?$S(LRT=2:24,LRT=1:20,LRT="1B":18,1:22),"Remote "\par
"RTN","AHMLDOP2",310,0)\par
 W $S(LRT=2:"Lab",1:"Radiology")," Orders by "\par
"RTN","AHMLDOP2",311,0)\par
 W $S(LRT=2:"Test Name",LRT=1:"Imaging Type",1:"CPT Code")\par
"RTN","AHMLDOP2",312,0)\par
 I LRT="1B" W " and wRVU"\par
"RTN","AHMLDOP2",313,0)\par
 W ?73,"Page ",LRPAG\par
"RTN","AHMLDOP2",314,0)\par
 W !?23,"From ",$$FMTE^XLFDT(LREDT)," to ",$$FMTE^XLFDT(LRSDT)\par
"RTN","AHMLDOP2",315,0)\par
 W !?22,"Date Printed: ",$$FMTE^XLFDT($$NOW^XLFDT),!\par
"RTN","AHMLDOP2",316,0)\par
 ;\par
"RTN","AHMLDOP2",317,0)\par
 I LRT="1A" D  Q\par
"RTN","AHMLDOP2",318,0)\par
 .W !?5,"CPT",?12,"Procedure",?50,"Total"\par
"RTN","AHMLDOP2",319,0)\par
 .W !?5,$TR($J("",65)," ","-")\par
"RTN","AHMLDOP2",320,0)\par
 .S (LL,NAME)=""\par
"RTN","AHMLDOP2",321,0)\par
 .F  S LL=$O(^TMP($J,"AHMLTST",LL)) Q:LL=""  D  Q:LREND\par
"RTN","AHMLDOP2",322,0)\par
 ..F  S NAME=$O(^TMP($J,"AHMLTST",LL,NAME)) Q:NAME=""  D  Q:LREND\par
"RTN","AHMLDOP2",323,0)\par
 ...W !?5,LL,?12,$E(NAME,1,37),?50,^TMP($J,"AHMLTST",LL,NAME)\par
"RTN","AHMLDOP2",324,0)\par
 .W !?5,$TR($J("",50)," ","-")\par
"RTN","AHMLDOP2",325,0)\par
 .W !?5,$J("Total",38),$TR($J(^TMP($J,"AHMLTST"),10)," ","."),!\par
"RTN","AHMLDOP2",326,0)\par
 ;\par
"RTN","AHMLDOP2",327,0)\par
 I LRT="1B" D  Q\par
"RTN","AHMLDOP2",328,0)\par
 .S (WRVU,TWRVU,GTWRVU,EXAM,GTEXAM)=0\par
"RTN","AHMLDOP2",329,0)\par
 .W !?58,"Total",?70,"Total"\par
"RTN","AHMLDOP2",330,0)\par
 .W !?5,"CPT",?12,"Procedure",?50,"wRVU",?58,"Exams",?70,"wRVU"\par
"RTN","AHMLDOP2",331,0)\par
 .W !?5,$TR($J("",70)," ","-")\par
"RTN","AHMLDOP2",332,0)\par
 .S (LL,NAME)=""\par
"RTN","AHMLDOP2",333,0)\par
 .F  S LL=$O(^TMP($J,"AHMLTST",LL)) Q:LL=""  D  Q:LREND\par
"RTN","AHMLDOP2",334,0)\par
 ..F  S NAME=$O(^TMP($J,"AHMLTST",LL,NAME)) Q:NAME=""  D  Q:LREND\par
"RTN","AHMLDOP2",335,0)\par
 ...S WRVU=+$$RVU^FBRVU(LL),EXAM=^TMP($J,"AHMLTST",LL,NAME)\par
"RTN","AHMLDOP2",336,0)\par
 ...S TWRVU=WRVU*EXAM,GTWRVU=GTWRVU+TWRVU,GTEXAM=GTEXAM+EXAM\par
"RTN","AHMLDOP2",337,0)\par
 ...W !?5,LL,?12,$E(NAME,1,37),?50,WRVU,?58,EXAM,?70,TWRVU\par
"RTN","AHMLDOP2",338,0)\par
 .W !?5,$TR($J("",70)," ","-")\par
"RTN","AHMLDOP2",339,0)\par
 .W !?5,$J("Totals",40),?58,GTEXAM,?70,GTWRVU,!\par
"RTN","AHMLDOP2",340,0)\par
 ;\par
"RTN","AHMLDOP2",341,0)\par
 S LL=""\par
"RTN","AHMLDOP2",342,0)\par
 F  S LL=$O(^TMP($J,"AHMLTST",LL)) Q:LL=""  D  Q:LREND\par
"RTN","AHMLDOP2",343,0)\par
 .I $G(^TMP($J,"AHMLX",LL))]"" S NAME=^TMP($J,"AHMLX",LL)\par
"RTN","AHMLDOP2",344,0)\par
 .E  S NAME=LL\par
"RTN","AHMLDOP2",345,0)\par
 .W !?5,$J(NAME,$S(+LRT=1:15,1:35))\par
"RTN","AHMLDOP2",346,0)\par
 .W $TR($J(^TMP($J,"AHMLTST",LL),10)," ",".")\par
"RTN","AHMLDOP2",347,0)\par
 W !?5,$TR($J("",$S(+LRT=1:26,1:46))," ","-")\par
"RTN","AHMLDOP2",348,0)\par
 W !?5,$J("Total",$S(+LRT=1:15,1:35))\par
"RTN","AHMLDOP2",349,0)\par
 W $TR($J(+$G(^TMP($J,"AHMLTST")),10)," ","."),!\par
"RTN","AHMLDOP2",350,0)\par
 ;\par
"RTN","AHMLDOP2",351,0)\par
 Q\par
"RTN","AHMLDOP2",352,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",353,0)\par
SHDR ; Print sub header.\par
"RTN","AHMLDOP2",354,0)\par
 ;\par
"RTN","AHMLDOP2",355,0)\par
 I $Y+6>IOSL D WAIT Q:LREND  D:$E(IOST,1,2)'="C-" HDR W !\par
"RTN","AHMLDOP2",356,0)\par
 ;\par
"RTN","AHMLDOP2",357,0)\par
 W !!,"==> Performing Location: ",LOC,!\par
"RTN","AHMLDOP2",358,0)\par
 I +LRT=1 D                                       ;rad sub header\par
"RTN","AHMLDOP2",359,0)\par
 .W !,$S(LRT="1B":"Report",1:"Order")\par
"RTN","AHMLDOP2",360,0)\par
 .W ?10,"Provider",?26,"Patient",?42,"CPT",?49,"Type"\par
"RTN","AHMLDOP2",361,0)\par
 .W ?55,"Image Procedure",?77,"St"\par
"RTN","AHMLDOP2",362,0)\par
 .W !,$TR($J("",8)," ","-"),?10,$TR($J("",14)," ","-")\par
"RTN","AHMLDOP2",363,0)\par
 .W ?26,$TR($J("",14)," ","-"),?42,$TR($J("",5)," ","-")\par
"RTN","AHMLDOP2",364,0)\par
 .W ?49,$TR($J("",4)," ","-"),?55,$TR($J("",20)," ","-")\par
"RTN","AHMLDOP2",365,0)\par
 .W ?77,$TR($J("",3)," ","-")\par
"RTN","AHMLDOP2",366,0)\par
 ;\par
"RTN","AHMLDOP2",367,0)\par
 I LRT=2 D                                       ;lab sub header\par
"RTN","AHMLDOP2",368,0)\par
 .W !,"Order",?10,"Provider",?26,"Patient",?42\par
"RTN","AHMLDOP2",369,0)\par
 .W "Test",?58,"St",?62,"Collect",?72,"Report"\par
"RTN","AHMLDOP2",370,0)\par
 .W !,$TR($J("",8)," ","-"),?10,$TR($J("",14)," ","-")\par
"RTN","AHMLDOP2",371,0)\par
 .W ?26,$TR($J("",14)," ","-"),?42,$TR($J("",14)," ","-")\par
"RTN","AHMLDOP2",372,0)\par
 .W ?58,$TR($J("",3)," ","-"),?62,$TR($J("",8)," ","-")\par
"RTN","AHMLDOP2",373,0)\par
 .W ?72,$TR($J("",8)," ","-")\par
"RTN","AHMLDOP2",374,0)\par
 ;\par
"RTN","AHMLDOP2",375,0)\par
 Q\par
"RTN","AHMLDOP2",376,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",377,0)\par
DATE(DATE) ; Convert mmm dd, yyyy@hh:mm to mm/dd/yyyy@hh:mm\par
"RTN","AHMLDOP2",378,0)\par
 ;\par
"RTN","AHMLDOP2",379,0)\par
 N DD,DM,DSTR,DY,LOWER,TM,UPPER\par
"RTN","AHMLDOP2",380,0)\par
 ;\par
"RTN","AHMLDOP2",381,0)\par
 I $G(DATE)="" Q ""\par
"RTN","AHMLDOP2",382,0)\par
 ;\par
"RTN","AHMLDOP2",383,0)\par
 S LOWER="abcdefghijklmnopqrstuvwxyz"\par
"RTN","AHMLDOP2",384,0)\par
 S UPPER="ABCDEFGHIJKLMNOPQRSTUVWXYZ"\par
"RTN","AHMLDOP2",385,0)\par
 S DSTR("JAN")="01",DSTR("FEB")="02",DSTR("MAR")="03",DSTR("APR")="04"\par
"RTN","AHMLDOP2",386,0)\par
 S DSTR("MAY")="05",DSTR("JUN")="06",DSTR("JUL")="07",DSTR("AUG")="08"\par
"RTN","AHMLDOP2",387,0)\par
 S DSTR("SEP")="09",DSTR("OCT")=10,DSTR("NOV")=11,DSTR("DEC")=12\par
"RTN","AHMLDOP2",388,0)\par
 ;\par
"RTN","AHMLDOP2",389,0)\par
 S DM=$TR($P(DATE," "),LOWER,UPPER),DD=$P($P(DATE," ",2),",")\par
"RTN","AHMLDOP2",390,0)\par
 S DY=$E($P($P(DATE," ",3),"@"),3,4),TM=$P($P(DATE,"@",2),":",1,2)\par
"RTN","AHMLDOP2",391,0)\par
 ;\par
"RTN","AHMLDOP2",392,0)\par
 Q DSTR(DM)_"/"_DD_"/"_DY_"@"_TM\par
"RTN","AHMLDOP2",393,0)\par
 ;---------------------------------------------------------------------\par
"RTN","AHMLDOP2",394,0)\par
WAIT ; Pause for page breaks.\par
"RTN","AHMLDOP2",395,0)\par
 ;\par
"RTN","AHMLDOP2",396,0)\par
 K DIR\par
"RTN","AHMLDOP2",397,0)\par
 S DIR(0)="E"\par
"RTN","AHMLDOP2",398,0)\par
 D ^DIR\par
"RTN","AHMLDOP2",399,0)\par
 S:($D(DUOUT))!($D(DTOUT)) LREND=1\par
"RTN","AHMLDOP2",400,0)\par
 S $Y=1\par
"RTN","AHMLDOP2",401,0)\par
 ;\par
"RTN","AHMLDOP2",402,0)\par
 Q\par
"RTN","AHMLDORO")\par
0^4^B98154804\par
"RTN","AHMLDORO",1,0)\par
AHMLDORO ;;LEIDOS/TCK - REMOTE ORDER - OUTGOING ; 2/20/17 2:49pm\par
"RTN","AHMLDORO",2,0)\par
 ;;1.0;REMOTE ORDERS;**2**;OCT 1,2016;Build 42\par
"RTN","AHMLDORO",3,0)\par
 ;; TEST\par
"RTN","AHMLDORO",4,0)\par
 ;\par
"RTN","AHMLDORO",5,0)\par
 Q\par
"RTN","AHMLDORO",6,0)\par
 ;\par
"RTN","AHMLDORO",7,0)\par
 ; Order#  (ien for #100) to be set in ORC-2 & ORB-2\par
"RTN","AHMLDORO",8,0)\par
 ; add pregnancy segment if needed.\par
"RTN","AHMLDORO",9,0)\par
 ;\par
"RTN","AHMLDORO",10,0)\par
EN1(MSG1,MSG2) ;\par
"RTN","AHMLDORO",11,0)\par
 ;\par
"RTN","AHMLDORO",12,0)\par
 N HLA,PROT,PR,REC,FLG,CK,REM\par
"RTN","AHMLDORO",13,0)\par
 S (CK,FLG)=0\par
"RTN","AHMLDORO",14,0)\par
 Q:$G(REMOTE)=1\par
"RTN","AHMLDORO",15,0)\par
 I $D(MSG1)>1 M HLA("HLS")=MSG1\par
"RTN","AHMLDORO",16,0)\par
 I $G(MSG2)'="",$G(XQORMSG)'="" M HLA=@XQORMSG\par
"RTN","AHMLDORO",17,0)\par
 I $G(MSG1)["TMP" M HLA=@XQORMSG\par
"RTN","AHMLDORO",18,0)\par
 K MSG,MSG1,REC,CHK,FLG,ODC,AP,VFGL,STOP,CHG,MSGTYP,MSGNDE\par
"RTN","AHMLDORO",19,0)\par
 ;\par
"RTN","AHMLDORO",20,0)\par
EN ;\par
"RTN","AHMLDORO",21,0)\par
 Q:'$D(HLA)\par
"RTN","AHMLDORO",22,0)\par
 N QQ,RAIEN,ORST\par
"RTN","AHMLDORO",23,0)\par
 N HLFS S HLFS="|"\par
"RTN","AHMLDORO",24,0)\par
 N HLCS S HLCS="^"\par
"RTN","AHMLDORO",25,0)\par
 N RAOIEN,RPTIEN S RAOIEN=0,RPTIEN="",CK=1\par
"RTN","AHMLDORO",26,0)\par
 ;\par
"RTN","AHMLDORO",27,0)\par
 N ORDNB S ORDNB="" ; Order#; ien of ^OR(100\par
"RTN","AHMLDORO",28,0)\par
 N SEGARY D GETSEG\par
"RTN","AHMLDORO",29,0)\par
 N XCASE S XCASE=""\par
"RTN","AHMLDORO",30,0)\par
 ;\par
"RTN","AHMLDORO",31,0)\par
 D ORC\par
"RTN","AHMLDORO",32,0)\par
 I $G(ORC1)="DC" D  Q\par
"RTN","AHMLDORO",33,0)\par
 .I $G(ORDNB)>0 D CHKRMT^AHMLDOL0(ORDNB,.CK)\par
"RTN","AHMLDORO",34,0)\par
 .I 'CK G EXIT\par
"RTN","AHMLDORO",35,0)\par
 .D PID(.HLA)\par
"RTN","AHMLDORO",36,0)\par
 .D FIX,MSG G EXIT\par
"RTN","AHMLDORO",37,0)\par
 Q:$G(ORC1)="DC"\par
"RTN","AHMLDORO",38,0)\par
 I ORDNB'="" D CHKRMT^AHMLDOL0(ORDNB,.CK)\par
"RTN","AHMLDORO",39,0)\par
 Q:'CK\par
"RTN","AHMLDORO",40,0)\par
 D PID(.HLA)\par
"RTN","AHMLDORO",41,0)\par
 I ORDNB'="" D FIX,PREG  ;CASE 1\par
"RTN","AHMLDORO",42,0)\par
 D OBR\par
"RTN","AHMLDORO",43,0)\par
 I $G(XCASE)'="" D  Q:'CK\par
"RTN","AHMLDORO",44,0)\par
 . Q:'CK\par
"RTN","AHMLDORO",45,0)\par
 . S ORDNB=$$GETORD(XCASE) Q:'ORDNB\par
"RTN","AHMLDORO",46,0)\par
 . D CHKRMT^AHMLDOL0(ORDNB,.CK)\par
"RTN","AHMLDORO",47,0)\par
 . I 'CK K HLA G EXIT\par
"RTN","AHMLDORO",48,0)\par
 . D FIX,PREG ; Case 2&3\par
"RTN","AHMLDORO",49,0)\par
 I $G(ORC1)="NW",$G(ORC5)="IP" D MSG1\par
"RTN","AHMLDORO",50,0)\par
 I $G(ORC1)="RE",ORC5="CM" D MSG2\par
"RTN","AHMLDORO",51,0)\par
 I $G(ORC1)="CA",ORC5="CA" D MSG3\par
"RTN","AHMLDORO",52,0)\par
 D EXIT\par
"RTN","AHMLDORO",53,0)\par
 Q\par
"RTN","AHMLDORO",54,0)\par
 ;\par
"RTN","AHMLDORO",55,0)\par
PREG ;  add preg obx segment if needed\par
"RTN","AHMLDORO",56,0)\par
 I RAOIEN D OBXPRG\par
"RTN","AHMLDORO",57,0)\par
 Q\par
"RTN","AHMLDORO",58,0)\par
 ;\par
"RTN","AHMLDORO",59,0)\par
EXIT ;\par
"RTN","AHMLDORO",60,0)\par
 D END\par
"RTN","AHMLDORO",61,0)\par
 Q\par
"RTN","AHMLDORO",62,0)\par
 ;\par
"RTN","AHMLDORO",63,0)\par
MSG ;\par
"RTN","AHMLDORO",64,0)\par
 S PROT="AHMLDOR REMOTE DC EVENT"\par
"RTN","AHMLDORO",65,0)\par
 K HLA("HLS",1)\par
"RTN","AHMLDORO",66,0)\par
 D GENERATE^HLMA($O(^ORD(101,"B",PROT,0)),"LM",1,.HLREST,"",.HLP)\par
"RTN","AHMLDORO",67,0)\par
 Q\par
"RTN","AHMLDORO",68,0)\par
 ;\par
"RTN","AHMLDORO",69,0)\par
MSG1 ;\par
"RTN","AHMLDORO",70,0)\par
 S PROT="AHMLDOR REG RMTE EVENT"\par
"RTN","AHMLDORO",71,0)\par
 D GENERATE^HLMA($O(^ORD(101,"B",PROT,0)),"LM",1,.HLREST,"",.HLP)\par
"RTN","AHMLDORO",72,0)\par
 Q\par
"RTN","AHMLDORO",73,0)\par
 ;\par
"RTN","AHMLDORO",74,0)\par
MSG2 ;\par
"RTN","AHMLDORO",75,0)\par
 S PROT="AHMLDOR RPT RMTE EVENT"\par
"RTN","AHMLDORO",76,0)\par
 D GENERATE^HLMA($O(^ORD(101,"B",PROT,0)),"LM",1,.HLREST,"",.HLP)\par
"RTN","AHMLDORO",77,0)\par
 Q\par
"RTN","AHMLDORO",78,0)\par
 ;\par
"RTN","AHMLDORO",79,0)\par
MSG3 ;\par
"RTN","AHMLDORO",80,0)\par
 N RMLOC\par
"RTN","AHMLDORO",81,0)\par
 I $D(^XTMP("AHMLDO","RMLOC")) S REM=^XTMP("AHMLDO","RMLOC")\par
"RTN","AHMLDORO",82,0)\par
 S PROT="AHMLDOR "_REM_" ORM-O01 EVENT"\par
"RTN","AHMLDORO",83,0)\par
 D GENERATE^HLMA($O(^ORD(101,"B",PROT,0)),"LM",1,.HLREST,"",.HLP)\par
"RTN","AHMLDORO",84,0)\par
 Q\par
"RTN","AHMLDORO",85,0)\par
 ;\par
"RTN","AHMLDORO",86,0)\par
PID(HLA) ;\par
"RTN","AHMLDORO",87,0)\par
 Q:'$D(HLA)\par
"RTN","AHMLDORO",88,0)\par
 N II,SEG,ORVP,SSN,DOB\par
"RTN","AHMLDORO",89,0)\par
 S II=0 F  S II=$O(HLA("HLS",II)) Q:II=""  D\par
"RTN","AHMLDORO",90,0)\par
 .S SEG=$P(HLA("HLS",II),"|")\par
"RTN","AHMLDORO",91,0)\par
 .Q:SEG=""\par
"RTN","AHMLDORO",92,0)\par
 .Q:SEG'="PID"\par
"RTN","AHMLDORO",93,0)\par
 .I $G(ORC1)="DC" D\par
"RTN","AHMLDORO",94,0)\par
 ..S ORVP=$P(HLA("HLS",II),"|",4)\par
"RTN","AHMLDORO",95,0)\par
 ..S DOB=$$GET1^DIQ(2,ORVP,.03,"I")\par
"RTN","AHMLDORO",96,0)\par
 ..S SSN=$$GET1^DIQ(2,ORVP,.09,"I")\par
"RTN","AHMLDORO",97,0)\par
 ..S $P(HLA("HLS",II),"|",5)=DOB\par
"RTN","AHMLDORO",98,0)\par
 ..S $P(HLA("HLS",II),"|",7)=SSN\par
"RTN","AHMLDORO",99,0)\par
 .I $G(ORC1)'="DC" D\par
"RTN","AHMLDORO",100,0)\par
 ..S ORVP=$P(HLA("HLS",II),"|",3)\par
"RTN","AHMLDORO",101,0)\par
 ..I ORVP["-" S ORVP=$P(ORVP,"-",2),ORVP=+ORVP\par
"RTN","AHMLDORO",102,0)\par
 ..S DOB=$$GET1^DIQ(2,ORVP,.03,"I")\par
"RTN","AHMLDORO",103,0)\par
 ..I $G(DOB)>0 S $P(HLA("HLS",II),"|",8)=DOB\par
"RTN","AHMLDORO",104,0)\par
 Q\par
"RTN","AHMLDORO",105,0)\par
 ;\par
"RTN","AHMLDORO",106,0)\par
GETSEG ;\par
"RTN","AHMLDORO",107,0)\par
 N XI S XI=""\par
"RTN","AHMLDORO",108,0)\par
 N XSEG\par
"RTN","AHMLDORO",109,0)\par
 ;THERE IS A POSSIBLE ISSUE WITH DELIMETERS HERE\par
"RTN","AHMLDORO",110,0)\par
 ;THIS CODE IS NOT ABLE TO SEE THE XSEG PROPERLY\par
"RTN","AHMLDORO",111,0)\par
 ;FOR REG PATIENTS ESB MAY BE PULLING THE XCASE AND REPLACING\par
"RTN","AHMLDORO",112,0)\par
 ;\par
"RTN","AHMLDORO",113,0)\par
 FOR  S XI=$O(HLA("HLS",XI)) Q:'XI  S XSEG=$P(HLA("HLS",XI),HLFS,1) D\par
"RTN","AHMLDORO",114,0)\par
 . I XSEG="ORC" S SEGARY("ORC")=XI_"^"_$D(HLA("HLS",XI))\par
"RTN","AHMLDORO",115,0)\par
 . I XSEG="OBR" S SEGARY("OBR")=XI_"^"_$D(HLA("HLS",XI))\par
"RTN","AHMLDORO",116,0)\par
 Q\par
"RTN","AHMLDORO",117,0)\par
 ;\par
"RTN","AHMLDORO",118,0)\par
GETORD(XCASE) ; get Order# from Case#\par
"RTN","AHMLDORO",119,0)\par
 ;  XCASE= big Case#,\par
"RTN","AHMLDORO",120,0)\par
 N LIEN\par
"RTN","AHMLDORO",121,0)\par
 N XEXAM ; exam line\par
"RTN","AHMLDORO",122,0)\par
 N XDFN  ; dfn\par
"RTN","AHMLDORO",123,0)\par
 N XDT   ; order date\par
"RTN","AHMLDORO",124,0)\par
 N XD2   ; 70.03 ien\par
"RTN","AHMLDORO",125,0)\par
 N X11   ; 11 piece of exam line;  ien of RAO(75.1\par
"RTN","AHMLDORO",126,0)\par
 ;\par
"RTN","AHMLDORO",127,0)\par
 ;S:$D(HLA("HLS",XI))=1 XCASE=$P(HLA("HLS",XI),"|",3)\par
"RTN","AHMLDORO",128,0)\par
 ;S:$D(HLA("HLS",XI))=11 XCASE=$P(HLA("HLS",XI,1),"|",2)\par
"RTN","AHMLDORO",129,0)\par
 S ORDNB=""\par
"RTN","AHMLDORO",130,0)\par
 ;\par
"RTN","AHMLDORO",131,0)\par
 S XDFN=$O(^RADPT("ADC",XCASE,"")) Q:'XDFN  D\par
"RTN","AHMLDORO",132,0)\par
 . S XDT=$O(^RADPT("ADC",XCASE,XDFN,"")) Q:XDT=""  D\par
"RTN","AHMLDORO",133,0)\par
 . . S XD2=$O(^RADPT("ADC",XCASE,XDFN,XDT,"")) Q:XD2=""\par
"RTN","AHMLDORO",134,0)\par
 . . S XEXAM=$G(^RADPT(XDFN,"DT",XDT,"P",XD2,0)) Q:XEXAM=""\par
"RTN","AHMLDORO",135,0)\par
 . . S LIEN=XD2_","_XDT_","_XDFN_","\par
"RTN","AHMLDORO",136,0)\par
 . . S EXMSTA=$$GET1^DIQ(70.03,LIEN,3,"I")\par
"RTN","AHMLDORO",137,0)\par
 . . S CATEG=$$GET1^DIQ(70.03,LIEN,4,"I")\par
"RTN","AHMLDORO",138,0)\par
 . . S WARD=$$GET1^DIQ(70.03,LIEN,6,"I")\par
"RTN","AHMLDORO",139,0)\par
 . . S SERVICE=$$GET1^DIQ(70.03,LIEN,7,"I")\par
"RTN","AHMLDORO",140,0)\par
 . . S RPTIEN=$$GET1^DIQ(70.03,LIEN,17,"I")\par
"RTN","AHMLDORO",141,0)\par
 . . I +XEXAM=$P(XCASE,"-",2) D\par
"RTN","AHMLDORO",142,0)\par
 . . S X11=$P(XEXAM,"^",11)\par
"RTN","AHMLDORO",143,0)\par
 . . S:X11'="" ORDNB=$$GET1^DIQ(75.1,X11_",",7,"I"),RAOIEN=X11\par
"RTN","AHMLDORO",144,0)\par
 I ORDNB["-" S ORDNB=0 Q\par
"RTN","AHMLDORO",145,0)\par
 I $G(RPTIEN)>0 D\par
"RTN","AHMLDORO",146,0)\par
 .Q:'$D(^RARPT(RPTIEN,"H"))\par
"RTN","AHMLDORO",147,0)\par
 .S STOP=$P(^RARPT(RPTIEN,"H",0),"^",3)\par
"RTN","AHMLDORO",148,0)\par
 .S INDX=0 F  S INDX=$O(^RARPT(RPTIEN,"H",INDX)) Q:INDX=""  D\par
"RTN","AHMLDORO",149,0)\par
 ..S LIEN=INDX_","_RPTIEN_","\par
"RTN","AHMLDORO",150,0)\par
 ..S HIST("TXT",INDX)=$$GET1^DIQ(74.04,LIEN,.01,"I")\par
"RTN","AHMLDORO",151,0)\par
 Q ORDNB\par
"RTN","AHMLDORO",152,0)\par
 ;\par
"RTN","AHMLDORO",153,0)\par
 ;====================================================================\par
"RTN","AHMLDORO",154,0)\par
 S:$D(HLA("HLS",XI))=1 $P(HLA("HLS",XI),"|",3)=XCASE_"^"_ORDNB\par
"RTN","AHMLDORO",155,0)\par
 S:$D(HLA("HLS",XI))=11 $P(HLA("HLS",XI,1),"|",2)=XCASE_"^"_ORDNB\par
"RTN","AHMLDORO",156,0)\par
 Q ORDNB\par
"RTN","AHMLDORO",157,0)\par
 ;\par
"RTN","AHMLDORO",158,0)\par
ORC ;\par
"RTN","AHMLDORO",159,0)\par
 I $G(SEGARY("ORC"))="" S ORC1="RE",ORC5="CM" Q\par
"RTN","AHMLDORO",160,0)\par
 N XI,XD\par
"RTN","AHMLDORO",161,0)\par
 S XI=$P(SEGARY("ORC"),"^",1),XD=$P(SEGARY("ORC"),"^",2)\par
"RTN","AHMLDORO",162,0)\par
 I XD=1,$P(HLA("HLS",XI),HLFS,3)'="" S ORDNB=$P($P(HLA("HLS",XI),HLFS,3),";",1)\par
"RTN","AHMLDORO",163,0)\par
 I ORDNB'="" D\par
"RTN","AHMLDORO",164,0)\par
 .I '$D(^OR(100,ORDNB)) S $P(HLA("HLS",XI),HLFS,3)="",ORDNB=""\par
"RTN","AHMLDORO",165,0)\par
 S ORC1=$P(HLA("HLS",XI),HLFS,2)\par
"RTN","AHMLDORO",166,0)\par
 S ORC5=$P(HLA("HLS",XI),HLFS,6)\par
"RTN","AHMLDORO",167,0)\par
 I $G(DUZ)'="" D\par
"RTN","AHMLDORO",168,0)\par
 .S USNM=$$GET1^DIQ(200,DUZ,.01,"E")\par
"RTN","AHMLDORO",169,0)\par
 .S USNM=$TR(USNM,",","^")\par
"RTN","AHMLDORO",170,0)\par
 .S $P(HLA("HLS",XI),HLFS,11)=DUZ_"^"_$G(USNM)\par
"RTN","AHMLDORO",171,0)\par
 .S PRVID=$P(HLA("HLS",XI),HLFS,13)\par
"RTN","AHMLDORO",172,0)\par
 .I PRVID'="" S PRVNME=$$GET1^DIQ(200,PRVID,.01,"E")\par
"RTN","AHMLDORO",173,0)\par
 .I $G(PRVNME)'="" S $P(HLA("HLS",XI),HLFS,13)=PRVID_"^"_$G(PRVNME)\par
"RTN","AHMLDORO",174,0)\par
 Q\par
"RTN","AHMLDORO",175,0)\par
 ;\par
"RTN","AHMLDORO",176,0)\par
OBR ;\par
"RTN","AHMLDORO",177,0)\par
 Q:'$D(SEGARY("OBR"))\par
"RTN","AHMLDORO",178,0)\par
 N XI,XD,XSEG\par
"RTN","AHMLDORO",179,0)\par
 N OBR2,OBR3\par
"RTN","AHMLDORO",180,0)\par
 S XI=$P($G(SEGARY("OBR")),"^",1),XD=$P(SEGARY("OBR"),"^",2)\par
"RTN","AHMLDORO",181,0)\par
 I XD=1 S XSEG=HLA("HLS",XI),OBR2=$P(XSEG,HLFS,3),OBR3=$P(XSEG,HLFS,4) S:OBR2'="" XCASE=OBR2 S:OBR2="" XCASE=$P(OBR3,HLCS,2)\par
"RTN","AHMLDORO",182,0)\par
 I XD=11 S XSEG=HLA("HLS",XI,1),OBR2=$P(XSEG,HLFS,2),OBR3=$P(XSEG,HLFS,3) S:OBR2'="" XCASE=OBR2 S:OBR2="" XCASE=$P(OBR3,HLCS,2)\par
"RTN","AHMLDORO",183,0)\par
 Q\par
"RTN","AHMLDORO",184,0)\par
 ;\par
"RTN","AHMLDORO",185,0)\par
FIX ; put ORDNB into ORC-2, OBR-2 and add Adittional clinical history\par
"RTN","AHMLDORO",186,0)\par
 N XI,XD,XSEG,TP,CNTR,ORST,SCNTR,OBRSEG,RAIEN,REAIEN,REASON,ORB7,OBRTZ\par
"RTN","AHMLDORO",187,0)\par
 N REQST,ORCTR,ORC,II,LIEN\par
"RTN","AHMLDORO",188,0)\par
 S TYP="RAD",II=""\par
"RTN","AHMLDORO",189,0)\par
 S CNTR="",DONE=0\par
"RTN","AHMLDORO",190,0)\par
 I $G(ORDNB)>0,$D(^XTMP("AHMLDO",TYP,"B")),$D(^XTMP("AHMLDO",TYP,"B",ORDNB)) S ORIFN=^XTMP("AHMLDO",TYP,"B",ORDNB)\par
"RTN","AHMLDORO",191,0)\par
 F  S CNTR=$O(HLA("HLS",CNTR)) Q:CNTR=""  D\par
"RTN","AHMLDORO",192,0)\par
 .S TP=$P(HLA("HLS",CNTR),HLFS) D\par
"RTN","AHMLDORO",193,0)\par
 ..;ORC segment mods\par
"RTN","AHMLDORO",194,0)\par
 ..I TP="ORC" D\par
"RTN","AHMLDORO",195,0)\par
 ...M ORC=HLA("HLS",CNTR)\par
"RTN","AHMLDORO",196,0)\par
 ...S ORCTR=$P(HLA("HLS",CNTR),HLFS,2)\par
"RTN","AHMLDORO",197,0)\par
 ...;Get hub order number from cross ref\par
"RTN","AHMLDORO",198,0)\par
 ...I $G(ORIFN)>0 S $P(HLA("HLS",CNTR),HLFS,3)=ORIFN\par
"RTN","AHMLDORO",199,0)\par
 ...;  Check Cancel/Hold and get reason - 2752\par
"RTN","AHMLDORO",200,0)\par
 ...; get ien that points to file RAD/NUC MED ORDERS file #75.1\par
"RTN","AHMLDORO",201,0)\par
 ...S RAIEN=+$$GET1^DIQ(100,ORDNB,"PACKAGE REFERENCE","I")\par
"RTN","AHMLDORO",202,0)\par
 ...;Cancel/Hold Reason exists\par
"RTN","AHMLDORO",203,0)\par
 ...D:RAIEN\par
"RTN","AHMLDORO",204,0)\par
 ....S REAIEN=$$GET1^DIQ(75.1,RAIEN,"REASON","I")\par
"RTN","AHMLDORO",205,0)\par
 ....S REASON=$$GET1^DIQ(75.1,RAIEN,"REASON")\par
"RTN","AHMLDORO",206,0)\par
 ....S REQST=$$GET1^DIQ(75.1,RAIEN,"REQUEST STATUS")   ;Sts, Hold?\par
"RTN","AHMLDORO",207,0)\par
 ....I $G(ORC1)'="DC" S $P(HLA("HLS",CNTR),HLFS,17)="X"_HLCS_HLCS_"99OR"_HLCS_REAIEN_HLCS_REASON\par
"RTN","AHMLDORO",208,0)\par
 ....D:REQST="HOLD"\par
"RTN","AHMLDORO",209,0)\par
 .....S $P(HLA("HLS",CNTR),HLFS,2)="SC"\par
"RTN","AHMLDORO",210,0)\par
 .....S $P(HLA("HLS",CNTR),HLFS,6)="IP"\par
"RTN","AHMLDORO",211,0)\par
 ..;OBR segment mods\par
"RTN","AHMLDORO",212,0)\par
 ..I TP="OBR" D\par
"RTN","AHMLDORO",213,0)\par
 ...S SCNTR=""\par
"RTN","AHMLDORO",214,0)\par
 ...F  S SCNTR=$O(HLA("HLS",CNTR,SCNTR)) Q:SCNTR=""  D\par
"RTN","AHMLDORO",215,0)\par
 ....S OBRSEG=HLA("HLS",CNTR),STRNG=HLA("HLS",CNTR,SCNTR)\par
"RTN","AHMLDORO",216,0)\par
 ....S OBRSEG=OBRSEG_STRNG,HLA("HLS",CNTR)=OBRSEG\par
"RTN","AHMLDORO",217,0)\par
 ....K HLA("HLS",CNTR,SCNTR)\par
"RTN","AHMLDORO",218,0)\par
 ...S $P(HLA("HLS",CNTR),HLFS,3)=ORIFN\par
"RTN","AHMLDORO",219,0)\par
 ...;CCR 5331 PUT TECHNOLOGIST ID IN OBR.34\par
"RTN","AHMLDORO",220,0)\par
 ...I $G(RADTI)'="",$G(RACNI)'="" D\par
"RTN","AHMLDORO",221,0)\par
 ....I $O(^RADPT($G(RADFN),"DT",$G(RADTI),"P",$G(RACNI),"TC",0)) D\par
"RTN","AHMLDORO",222,0)\par
 .....S INDX=$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0),"^",3)\par
"RTN","AHMLDORO",223,0)\par
 .....Q:INDX'>0\par
"RTN","AHMLDORO",224,0)\par
 .....S RAIEN=INDX_","_RACNI_","_RADTI_","_RADFN_","\par
"RTN","AHMLDORO",225,0)\par
 .....S TECHID=$$GET1^DIQ(70.12,RAIEN,.01,"I")\par
"RTN","AHMLDORO",226,0)\par
 .....I $G(TECHID)>0 S $P(HLA("HLS",CNTR),HLFS,35)=TECHID\par
"RTN","AHMLDORO",227,0)\par
 ...I $G(TECHID)'>0 S $P(HLA("HLS",CNTR),HLFS,35)=DUZ\par
"RTN","AHMLDORO",228,0)\par
 ...S OBR7=$P(HLA("HLS",CNTR),HLFS,8)\par
"RTN","AHMLDORO",229,0)\par
 ...S OBR25=$P(HLA("HLS",CNTR),HLFS,26)\par
"RTN","AHMLDORO",230,0)\par
 ...I OBR25="" S $P(HLA("HLS",CNTR),HLFS,26)="I"\par
"RTN","AHMLDORO",231,0)\par
 ...S OBR25=$P(HLA("HLS",CNTR),HLFS,26)\par
"RTN","AHMLDORO",232,0)\par
 ...; Timezone missing, add it  4954\par
"RTN","AHMLDORO",233,0)\par
 ...D:$P(OBR7,"-",2)=""\par
"RTN","AHMLDORO",234,0)\par
 ....S OBRTZ=$P($$HLDATE^HLFNC($$NOW^XLFDT,"TS"),"-",2)\par
"RTN","AHMLDORO",235,0)\par
 ....S $P(OBR7,"-",2)=OBRTZ\par
"RTN","AHMLDORO",236,0)\par
 ....S $P(HLA("HLS",CNTR),HLFS,8)=OBR7\par
"RTN","AHMLDORO",237,0)\par
 ...; Hold Order event, set obr.25 = X  4453\par
"RTN","AHMLDORO",238,0)\par
 ...S:$G(REQST)="HOLD" $P(HLA("HLS",CNTR),HLFS,26)="X"\par
"RTN","AHMLDORO",239,0)\par
 ...; Set obr.25 = B to block transmissison to DoD, when cancel of\par
"RTN","AHMLDORO",240,0)\par
 ...; child and order still Active.     5204\par
"RTN","AHMLDORO",241,0)\par
 ...I $G(ORCTR)="CA",$G(REQST)="ACTIVE" S $P(HLA("HLS",CNTR),HLFS,26)="B"\par
"RTN","AHMLDORO",242,0)\par
 ...; Check IF report/result type HL7 and is a cancelled case.  5204\par
"RTN","AHMLDORO",243,0)\par
 ...; If so, then this is a bad case, so ESB will need to block this.\par
"RTN","AHMLDORO",244,0)\par
 ...; Legacy RA code creates this message erroneously as they only\par
"RTN","AHMLDORO",245,0)\par
 ...; check for if the exam case belongs to a Printset (parent/child).\par
"RTN","AHMLDORO",246,0)\par
 ...I '$D(ORC),OBR25="F" D\par
"RTN","AHMLDORO",247,0)\par
 ....S RDIENS=RACNI_","_RADTI_","_RADFN_","\par
"RTN","AHMLDORO",248,0)\par
 ....I $$GET1^DIQ(70.03,RDIENS,3)="CANCELLED" D\par
"RTN","AHMLDORO",249,0)\par
 .....S $P(HLA("HLS",CNTR),HLFS,26)="B"\par
"RTN","AHMLDORO",250,0)\par
 ..I TP="OBX",'DONE D\par
"RTN","AHMLDORO",251,0)\par
 ...Q:'$D(HIST)\par
"RTN","AHMLDORO",252,0)\par
 ...S XH=$O(HLA("HLS",999999999),-1)\par
"RTN","AHMLDORO",253,0)\par
 ...F  S II=$O(HIST("TXT",II)) Q:II=""  D\par
"RTN","AHMLDORO",254,0)\par
 ....S TXT=HIST("TXT",II)\par
"RTN","AHMLDORO",255,0)\par
 ....Q:$G(TXT)=""\par
"RTN","AHMLDORO",256,0)\par
 ....S XH=$G(XH)+1\par
"RTN","AHMLDORO",257,0)\par
 ....S HLA("HLS",XH)="OBX"_"|"_XH_"|"_"TX"_"|"_"H^HISTORY^L"_"||"_TXT\par
"RTN","AHMLDORO",258,0)\par
 ....S DONE=1\par
"RTN","AHMLDORO",259,0)\par
 S DONE=""\par
"RTN","AHMLDORO",260,0)\par
 ;\par
"RTN","AHMLDORO",261,0)\par
 Q\par
"RTN","AHMLDORO",262,0)\par
 ;\par
"RTN","AHMLDORO",263,0)\par
OBXPRG ;\par
"RTN","AHMLDORO",264,0)\par
 N X,X13\par
"RTN","AHMLDORO",265,0)\par
 N XN S XN=0\par
"RTN","AHMLDORO",266,0)\par
 N PRGSEG S PRGSEG=0\par
"RTN","AHMLDORO",267,0)\par
 S X13=$$GET1^DIQ(75.1,RAOIEN_",",13,"I")\par
"RTN","AHMLDORO",268,0)\par
 Q:X13=""\par
"RTN","AHMLDORO",269,0)\par
 ;\par
"RTN","AHMLDORO",270,0)\par
 S:X13="y" X13="YES" S:X13="n" X13="NO" S:X13="u" X13="UNKNOWN"\par
"RTN","AHMLDORO",271,0)\par
 FOR  S XN=$O(HLA("HLS",XN)) Q:XN=""  D  Q:PRGSEG\par
"RTN","AHMLDORO",272,0)\par
 . S X=HLA("HLS",XN) Q:$P(X,HLFS,1)'="OBX"\par
"RTN","AHMLDORO",273,0)\par
 . I $P(X,HLFS,4)["PREGNANT" S PRGSEG=1 Q  ; already a OBX preg seg\par
"RTN","AHMLDORO",274,0)\par
 Q:PRGSEG  ; already a OBX preg seg\par
"RTN","AHMLDORO",275,0)\par
 S XN=$O(HLA("HLS",999999999999999),-1),XN=XN+1\par
"RTN","AHMLDORO",276,0)\par
 S HLA("HLS",XN)="OBX"_HLFS_HLFS_"TX"_HLFS_"2000.33"_HLCS_"PREGNANT"_HLCS_"AS4"_HLFS_HLFS_X13\par
"RTN","AHMLDORO",277,0)\par
 Q\par
"RTN","AHMLDORO",278,0)\par
 ;\par
"RTN","AHMLDORO",279,0)\par
END ;\par
"RTN","AHMLDORO",280,0)\par
 K CATEG,DONE,EXMSTA,HIST,HLP,HLREST,OBR25,OBR7,ORC1,PRVID\par
"RTN","AHMLDORO",281,0)\par
 K PRVNME,RACNI,RADFN,RADTI,RDIENS,REMOTE,SERVICE,USNM,ORIFN\par
"RTN","AHMLDORO",282,0)\par
 K STRG,STRNG,TECHID,TXT,TYP,WARD,XH,XQORMSG,INDX,USN,ORC5\par
"RTN","AHMLDORO",283,0)\par
 Q\par
"RTN","AHMLDORO",284,0)\par
 ;\par
"RTN","AHMLDOS")\par
0^1^B33133808\par
"RTN","AHMLDOS",1,0)\par
AHMLDOS ;;LEIDOS/TCK - REMOTE ORDER - INCOMING ; 2/20/17 12:14pm\par
"RTN","AHMLDOS",2,0)\par
 ;;1.0;REMOTE ORDERS;**2**;OCT 1,2016;Build 42\par
"RTN","AHMLDOS",3,0)\par
 ; Reference to UNESC^ORHLESC supported by IA #4922\par
"RTN","AHMLDOS",4,0)\par
 ;; TEST\par
"RTN","AHMLDOS",5,0)\par
 ;\par
"RTN","AHMLDOS",6,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS",7,0)\par
EN ; Entry point for INCOMING ORDERS FROM A HOST FACILITY\par
"RTN","AHMLDOS",8,0)\par
 ;\par
"RTN","AHMLDOS",9,0)\par
 ;    Input: HLMTIEN - ^HL(772,IEN\par
"RTN","AHMLDOS",10,0)\par
 ;\par
"RTN","AHMLDOS",11,0)\par
 ;   Output: None.\par
"RTN","AHMLDOS",12,0)\par
 ;\par
"RTN","AHMLDOS",13,0)\par
 N II\par
"RTN","AHMLDOS",14,0)\par
 S (II,TYPE)="",ACKERR=0\par
"RTN","AHMLDOS",15,0)\par
 ;\par
"RTN","AHMLDOS",16,0)\par
 I $G(HLMTIEN)'>0 Q\par
"RTN","AHMLDOS",17,0)\par
 S REMOTE=1\par
"RTN","AHMLDOS",18,0)\par
 S HLMA=$O(^HLMA("B",HLMTIEN,""))\par
"RTN","AHMLDOS",19,0)\par
 I $G(HLMA)'>0 Q\par
"RTN","AHMLDOS",20,0)\par
 ;\par
"RTN","AHMLDOS",21,0)\par
 I '$D(^HLMA(HLMA,0)) Q\par
"RTN","AHMLDOS",22,0)\par
 I '$D(^HLMA(HLMA,"MSH")) Q\par
"RTN","AHMLDOS",23,0)\par
 ;\par
"RTN","AHMLDOS",24,0)\par
 I $P(^HLMA(HLMA,"MSH",1,0),"|",3)["AHMLDOL HOST" S TYPE="LAB"\par
"RTN","AHMLDOS",25,0)\par
 I $P(^HLMA(HLMA,"MSH",1,0),"|",3)["AHMLDOR HOST" S TYPE="RAD"\par
"RTN","AHMLDOS",26,0)\par
 S RMLOC=+$P(^HLMA(HLMA,"MSH",1,0),"|",4)\par
"RTN","AHMLDOS",27,0)\par
 S LOC=+$P(^HLMA(HLMA,"MSH",1,0),"|",6)\par
"RTN","AHMLDOS",28,0)\par
 Q:$G(RMLOC)'>0\par
"RTN","AHMLDOS",29,0)\par
 Q:$G(LOC)'>0\par
"RTN","AHMLDOS",30,0)\par
 S ^XTMP("AHMLDO","RMLOC")=RMLOC\par
"RTN","AHMLDOS",31,0)\par
 S ^XTMP("AHMLDO","LOC")=LOC\par
"RTN","AHMLDOS",32,0)\par
 S II=0 F  S II=$O(^HL(772,HLMTIEN,"IN",II)) Q:II=""  D\par
"RTN","AHMLDOS",33,0)\par
  .S REC(II)=^HL(772,HLMTIEN,"IN",II,0)\par
"RTN","AHMLDOS",34,0)\par
 ;\par
"RTN","AHMLDOS",35,0)\par
 Q:'$D(REC)\par
"RTN","AHMLDOS",36,0)\par
 ;\par
"RTN","AHMLDOS",37,0)\par
 S ACT=""\par
"RTN","AHMLDOS",38,0)\par
 ;\par
"RTN","AHMLDOS",39,0)\par
 D ACTION(.REC,.ACT,.ORN)\par
"RTN","AHMLDOS",40,0)\par
 ;\par
"RTN","AHMLDOS",41,0)\par
 D EN^AHMLDOS1(.REC,TYPE,LOC,HLMA,HLMTIEN,.ACKERR,ACT)\par
"RTN","AHMLDOS",42,0)\par
 ;\par
"RTN","AHMLDOS",43,0)\par
 ;I ACKERR D ACK(HLMA,HLMTIEN,"AA")\par
"RTN","AHMLDOS",44,0)\par
 ;\par
"RTN","AHMLDOS",45,0)\par
 D END\par
"RTN","AHMLDOS",46,0)\par
 Q\par
"RTN","AHMLDOS",47,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS",48,0)\par
ACK(HLMA,HLMTIEN,CODE,ERR,TYPE) ; This sub-routine will handle the Application Errors\par
"RTN","AHMLDOS",49,0)\par
 ;                   (AE) or Rejects (AR) or Accepts (AA) back to the\par
"RTN","AHMLDOS",50,0)\par
 ;                   Hub (Ordering Lab).\par
"RTN","AHMLDOS",51,0)\par
 ;\par
"RTN","AHMLDOS",52,0)\par
 ;    Input:    HLMA - ^HLMA IEN                        [required]\par
"RTN","AHMLDOS",53,0)\par
 ;           HLMTIEN - ^HL(772 IEN                      [required]\par
"RTN","AHMLDOS",54,0)\par
 ;              CODE - AA=Accept, AE=Error, AR=Reject   [optional]\par
"RTN","AHMLDOS",55,0)\par
 ;               ERR - Error Text to be returned.       [optional]\par
"RTN","AHMLDOS",56,0)\par
 ;\par
"RTN","AHMLDOS",57,0)\par
 ;   Output: None.\par
"RTN","AHMLDOS",58,0)\par
 ;\par
"RTN","AHMLDOS",59,0)\par
 N HLEID,HLEIDS,MSA1,PROT,SLOC\par
"RTN","AHMLDOS",60,0)\par
 ;\par
"RTN","AHMLDOS",61,0)\par
 S MSA1=$G(CODE) S:$G(ERR)="" MSA1="AA"     ; acknowledgement code\par
"RTN","AHMLDOS",62,0)\par
 S SLOC=+$P(^HLMA(HLMA,"MSH",1,0),"|",4)    ; sending facility\par
"RTN","AHMLDOS",63,0)\par
 I $G(TYPE)="LAB" S PROT="AHMLDOL "_SLOC_" ORM-O01 EVENT"  ; event protocol\par
"RTN","AHMLDOS",64,0)\par
 I $G(TYPE)="RAD" S PROT="AHMLDOR "_SLOC_" ORM-O01 EVENT"  ;event protocol\par
"RTN","AHMLDOS",65,0)\par
 S HLEID=$O(^ORD(101,"B",PROT,0))           ; event protocol IEN\par
"RTN","AHMLDOS",66,0)\par
 S HL("MID")=$P(^HLMA(HLMA,0),U,2)          ; Message Control ID\par
"RTN","AHMLDOS",67,0)\par
 S HLEIDS=$P(^HLMA(HLMA,0),U,8)             ; Subscriber Protocol\par
"RTN","AHMLDOS",68,0)\par
 ;\par
"RTN","AHMLDOS",69,0)\par
 S HLA("HLS",1)="MSA|"_MSA1_"|"_HL("MID")_$S($G(ERR)]"":"|"_ERR,1:"")\par
"RTN","AHMLDOS",70,0)\par
 ;\par
"RTN","AHMLDOS",71,0)\par
 D GENERATE^HLMA(HLEID,"LM",1,.RESULT,"",.HLP)\par
"RTN","AHMLDOS",72,0)\par
 ;\par
"RTN","AHMLDOS",73,0)\par
 Q\par
"RTN","AHMLDOS",74,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS",75,0)\par
ACTION(REC,ACT,ORN) ;\par
"RTN","AHMLDOS",76,0)\par
 ;                    number, and order action.\par
"RTN","AHMLDOS",77,0)\par
 ;\par
"RTN","AHMLDOS",78,0)\par
 ;    Input: REC - ^HL(772 data                     [required]\par
"RTN","AHMLDOS",79,0)\par
 ;\par
"RTN","AHMLDOS",80,0)\par
 ;   Output: ACT - Order Control (NW=New, CA=Cancel, DC=Discontinue,\par
"RTN","AHMLDOS",81,0)\par
 ;                                HD=Hold, RL=Release/cancel previous\par
"RTN","AHMLDOS",82,0)\par
 ;                                hold, XO=Change/Update)\par
"RTN","AHMLDOS",83,0)\par
 ;           ORN - Ordering Lab Number\par
"RTN","AHMLDOS",84,0)\par
 ;\par
"RTN","AHMLDOS",85,0)\par
 N I,STOP\par
"RTN","AHMLDOS",86,0)\par
 ;\par
"RTN","AHMLDOS",87,0)\par
 S (ACT,I)="",STOP=0\par
"RTN","AHMLDOS",88,0)\par
 ;\par
"RTN","AHMLDOS",89,0)\par
 F  S I=$O(REC(I)) Q:I=""  D  Q:STOP\par
"RTN","AHMLDOS",90,0)\par
 .I $P(REC(I),"|")="ORC" D            ; order segment\par
"RTN","AHMLDOS",91,0)\par
 ..S ORN=+$P(REC(I),"|",3)           ; Ordering Lab Number\par
"RTN","AHMLDOS",92,0)\par
 ..S ACT=$P(REC(I),"|",2)            ; Order Action\par
"RTN","AHMLDOS",93,0)\par
 ..S STOP=1\par
"RTN","AHMLDOS",94,0)\par
 ;\par
"RTN","AHMLDOS",95,0)\par
 Q\par
"RTN","AHMLDOS",96,0)\par
 ;\par
"RTN","AHMLDOS",97,0)\par
TEST(LROROUT,HLMTIEN) ; HLMTIEN=IEN to ^HL(772\par
"RTN","AHMLDOS",98,0)\par
 D EN\par
"RTN","AHMLDOS",99,0)\par
 Q\par
"RTN","AHMLDOS",100,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS",101,0)\par
GTDOM(RR) ; Get the list of performing labs from the "E" cross reference.\par
"RTN","AHMLDOS",102,0)\par
 ;\par
"RTN","AHMLDOS",103,0)\par
 N NME,INST,CNT\par
"RTN","AHMLDOS",104,0)\par
 S NME="AHMLDOID"\par
"RTN","AHMLDOS",105,0)\par
 S (DOM,INST)="",CNT=0\par
"RTN","AHMLDOS",106,0)\par
 Q:'$D(^XTMP(NME))\par
"RTN","AHMLDOS",107,0)\par
 ;\par
"RTN","AHMLDOS",108,0)\par
 F  S CNT=$O(^XTMP(NME,0,CNT)) Q:CNT=""  D\par
"RTN","AHMLDOS",109,0)\par
 .S INST=$G(^XTMP(NME,0,CNT))\par
"RTN","AHMLDOS",110,0)\par
 .S RR(CNT)=INST\par
"RTN","AHMLDOS",111,0)\par
 ;\par
"RTN","AHMLDOS",112,0)\par
 Q\par
"RTN","AHMLDOS",113,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS",114,0)\par
DC(REC,ORID,ORVP,ORNP,ORL,REASON,DCORIG,ISNEWORD) ;\par
"RTN","AHMLDOS",115,0)\par
 N FLG,FLAG,LRSEND,LRODT,LRSN,LRSEND,ORN,LRIEN,LRFILE,LRAA,LRAN,LRAD\par
"RTN","AHMLDOS",116,0)\par
 S (FLG,FLAG)=0,(LRAA,LRAN,LRAD)=""\par
"RTN","AHMLDOS",117,0)\par
 S (DCORIG,ISNEWORD)=0\par
"RTN","AHMLDOS",118,0)\par
 I $G(REASON)'?.N,$D(^ORD(100.03,"B",REASON)) D\par
"RTN","AHMLDOS",119,0)\par
 .S REASIEN="",REASIEN=$O(^ORD(100.03,"B",REASON,REASIEN))\par
"RTN","AHMLDOS",120,0)\par
 I $G(REASIEN)>0 S REASON=REASIEN\par
"RTN","AHMLDOS",121,0)\par
 I $G(REASON)?.N S REASIEN=REASON\par
"RTN","AHMLDOS",122,0)\par
 I $G(REASIEN)="" S REASIEN=6\par
"RTN","AHMLDOS",123,0)\par
 S ORDNUM=+ORID\par
"RTN","AHMLDOS",124,0)\par
 S FILE=100,ORIEN=ORDNUM_","\par
"RTN","AHMLDOS",125,0)\par
 I $$GET1^DIQ(FILE,ORIEN,31,"I") D  Q:FLG\par
"RTN","AHMLDOS",126,0)\par
 .I $$GET1^DIQ(FILE,ORIEN,5,"I")=1 S NDE=$O(^OR(100,ORDNUM,8,9999),-1),REC(1)=ORDNUM_";"_NDE_"^RS" S FLG=1 Q\par
"RTN","AHMLDOS",127,0)\par
 Q:FLG\par
"RTN","AHMLDOS",128,0)\par
 S STATUS=$$GET1^DIQ(100,ORDNUM_",",5,"I")\par
"RTN","AHMLDOS",129,0)\par
 S PTYPE=$$GET1^DIQ(100,ORDNUM_",",12)\par
"RTN","AHMLDOS",130,0)\par
 ;4900 send error msg for a Lab DC try for a completed order\par
"RTN","AHMLDOS",131,0)\par
 I STATUS=2&(PTYPE'["RAD") D  Q\par
"RTN","AHMLDOS",132,0)\par
 .S REC(1)="Warning: Not cancelled. Lab order is already completed."\par
"RTN","AHMLDOS",133,0)\par
 I PTYPE'["RAD" D\par
"RTN","AHMLDOS",134,0)\par
 .S LRFILE=100,LRIEN=ORDNUM_","\par
"RTN","AHMLDOS",135,0)\par
 .S LRDATA=$$GET1^DIQ(LRFILE,LRIEN,33,"I") I LRDATA="" Q\par
"RTN","AHMLDOS",136,0)\par
 .S LRORD=$P(LRDATA,";"),LRODT=$P(LRDATA,";",2),LRSND=$P(LRDATA,";",3)\par
"RTN","AHMLDOS",137,0)\par
 .Q:$G(LRORD)=""\par
"RTN","AHMLDOS",138,0)\par
 .Q:$G(LRODT)=""\par
"RTN","AHMLDOS",139,0)\par
 .Q:$G(LRSND)=""\par
"RTN","AHMLDOS",140,0)\par
 .I '$D(^LRO(69,LRODT,1,LRSND)) Q\par
"RTN","AHMLDOS",141,0)\par
 .I '$D(^LRO(69,LRODT,1,LRSND,2)) Q\par
"RTN","AHMLDOS",142,0)\par
 .S LRSEND=0 F  S LRSEND=$O(^LRO(69,LRODT,1,LRSND,2,LRSEND)) Q:LRSEND'?.N  D\par
"RTN","AHMLDOS",143,0)\par
 ..S LIEN=LRSEND_","_LRSND_","_LRODT_","\par
"RTN","AHMLDOS",144,0)\par
 ..S ORN=$$GET1^DIQ(69,LIEN,7,"I")\par
"RTN","AHMLDOS",145,0)\par
 ..I ORN=ORDNUM D\par
"RTN","AHMLDOS",146,0)\par
 ...S LRSN=LRSND,LRI=LRSEND,ORIFN=ORN\par
"RTN","AHMLDOS",147,0)\par
 ...S LRTEST=$$GET1^DIQ(69,LIEN,.01,"I")\par
"RTN","AHMLDOS",148,0)\par
 ...S LRAA=$$GET1^DIQ(69,LIEN,3,"I")\par
"RTN","AHMLDOS",149,0)\par
 ...S LRAD=$$GET1^DIQ(69,LIEN,2,"I")\par
"RTN","AHMLDOS",150,0)\par
 ...S LRAN=$$GET1^DIQ(69,LIEN,4,"I")\par
"RTN","AHMLDOS",151,0)\par
 ...S LRSS=$$GET1^DIQ(60,LRTEST,4,"I")\par
"RTN","AHMLDOS",152,0)\par
 ...S LIEN=LRSN_","_LRODT_","\par
"RTN","AHMLDOS",153,0)\par
 ...S LRDFN=$$GET1^DIQ(69.01,LIEN,.01,"I")\par
"RTN","AHMLDOS",154,0)\par
 ...S PNM=$$GET1^DIQ(2,ORVP,.01,"I"),LRDPF=2\par
"RTN","AHMLDOS",155,0)\par
 .I LRAA'="",LRAD'="",LRAN'="" S FLAG=1\par
"RTN","AHMLDOS",156,0)\par
 I 'FLAG D\par
"RTN","AHMLDOS",157,0)\par
 .D DC^ORWDXA(.REC,ORID,ORNP,ORL,REASON,DCORIG,ISNEWORD)\par
"RTN","AHMLDOS",158,0)\par
 .D BLDSND^AHMLDOS1(.REC,.ORWREC)\par
"RTN","AHMLDOS",159,0)\par
 .K REC S ES="AA",ORWLST=""\par
"RTN","AHMLDOS",160,0)\par
 .D SEND^ORWDX(.ORWLST,ORVP,ORNP,ORL,ES,.ORWREC)\par
"RTN","AHMLDOS",161,0)\par
 .M REC=ORWLST K ORWLST\par
"RTN","AHMLDOS",162,0)\par
 .D UPDTOR(ORID)\par
"RTN","AHMLDOS",163,0)\par
 ;\par
"RTN","AHMLDOS",164,0)\par
 Q\par
"RTN","AHMLDOS",165,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS",166,0)\par
UPDTOR(ORID) ;\par
"RTN","AHMLDOS",167,0)\par
 N LIEN\par
"RTN","AHMLDOS",168,0)\par
 Q:'$D(^OR(100,+ORID,8,2))\par
"RTN","AHMLDOS",169,0)\par
 S LIEN=2_","_+ORID_","\par
"RTN","AHMLDOS",170,0)\par
 S USR=$$GET1^DIQ(100.008,LIEN,3,"I")\par
"RTN","AHMLDOS",171,0)\par
 S LRFDA(1,100.008,LIEN,5)=USR\par
"RTN","AHMLDOS",172,0)\par
 S LRFDA(1,100.008,LIEN,13)=USR\par
"RTN","AHMLDOS",173,0)\par
 D UPDATE^DIE("","LRFDA(1)","LRMSG")\par
"RTN","AHMLDOS",174,0)\par
 Q\par
"RTN","AHMLDOS",175,0)\par
 ;\par
"RTN","AHMLDOS",176,0)\par
END ;\par
"RTN","AHMLDOS",177,0)\par
 K ACKERR,DOM,ES,FILE,HL,HLA,HLP,LIEN,LOC,LRDATA\par
"RTN","AHMLDOS",178,0)\par
 K LRDFN,LRDPF,LRI,LRORD,LRSEND,LRSND,LRSS,LRTEST,NDE,ORDNUM\par
"RTN","AHMLDOS",179,0)\par
 K ORIEN,ORIFN,ORWREC,PNM,PTYPE,REASIEN,REMOTE,RESULT,STATUS\par
"RTN","AHMLDOS",180,0)\par
 K TYPE,USR,HLMA,HLMTIEN,LRFDA,RMLOC\par
"RTN","AHMLDOS",181,0)\par
 Q\par
"RTN","AHMLDOS",182,0)\par
 ;\par
"RTN","AHMLDOS1")\par
0^2^B244427349\par
"RTN","AHMLDOS1",1,0)\par
AHMLDOS1 ;LEIDOS/TCK; REMOTE ORDERING; 12/14/15 6:09pm ; 2/21/17 11:44am\par
"RTN","AHMLDOS1",2,0)\par
 ;;1.0;Remote orders;**2**;JAN 1, 2016;Build 42\par
"RTN","AHMLDOS1",3,0)\par
 ;\par
"RTN","AHMLDOS1",4,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS1",5,0)\par
EN(REC,TYPE,LOC,HLMA,HLMTIEN,ACKERR,ACT) ; Continuation of EN^AHMLDOS\par
"RTN","AHMLDOS1",6,0)\par
 ;\par
"RTN","AHMLDOS1",7,0)\par
 ;    Input:  REC - ^HL(772 data                     [required]\par
"RTN","AHMLDOS1",8,0)\par
 ;           TYPE - Order type (Lab, Imaging,...)    [required]\par
"RTN","AHMLDOS1",9,0)\par
 ;            LOC - Sending Facility                 [required]\par
"RTN","AHMLDOS1",10,0)\par
 ;\par
"RTN","AHMLDOS1",11,0)\par
 ;   Output: None.\par
"RTN","AHMLDOS1",12,0)\par
 ;\par
"RTN","AHMLDOS1",13,0)\par
 K ORD,OR,OLDOR,ORNUM,ORSSN,ORDOB,ORN\par
"RTN","AHMLDOS1",14,0)\par
 ;\par
"RTN","AHMLDOS1",15,0)\par
 Q:'$D(REC)\par
"RTN","AHMLDOS1",16,0)\par
 ;\par
"RTN","AHMLDOS1",17,0)\par
 S ACKERR=0\par
"RTN","AHMLDOS1",18,0)\par
 ;\par
"RTN","AHMLDOS1",19,0)\par
 I TYPE="LAB" D GTLDATA(.REC,.ORVP,.ORNP,.ORL,.DLG,.ORDG,.ORIT,.ORIFN,.OLDOR,TYPE,.REAS)\par
"RTN","AHMLDOS1",20,0)\par
 Q:ACKERR\par
"RTN","AHMLDOS1",21,0)\par
 ;\par
"RTN","AHMLDOS1",22,0)\par
 I TYPE="RAD" D GTRDATA(.REC,.ORVP,.ORNP,.ORL,.DLG,.ORDG,.ORIT,.ORIFN,.OLDOR,TYPE,.REAS)\par
"RTN","AHMLDOS1",23,0)\par
 Q:ACKERR\par
"RTN","AHMLDOS1",24,0)\par
 ;\par
"RTN","AHMLDOS1",25,0)\par
 I ACT="NW" D\par
"RTN","AHMLDOS1",26,0)\par
 .S PKG=$S(DLG="RA OERR EXAM":"RAD",DLG="LR OTHER LAB TESTS":"LAB")\par
"RTN","AHMLDOS1",27,0)\par
 .Q:'$D(REC)\par
"RTN","AHMLDOS1",28,0)\par
 .D @PKG\par
"RTN","AHMLDOS1",29,0)\par
 .Q:ACKERR\par
"RTN","AHMLDOS1",30,0)\par
 .;I $D(REC) D GTDATA(.REC,.ORVP,.ORNP,.ORL,.DLG,.ORDG,.ORIT,.ORIFN,TYPE)\par
"RTN","AHMLDOS1",31,0)\par
 .S (STS,REAS,ORUSR,ORTYP)=""\par
"RTN","AHMLDOS1",32,0)\par
 .I $D(REC) D SAVE^ORWDX(.REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,.ORDIALOG,STS,REAS,ORUSR,ORTYP)\par
"RTN","AHMLDOS1",33,0)\par
 .Q:'$D(REC)\par
"RTN","AHMLDOS1",34,0)\par
 .D BLDSND(.REC,.ORWREC,.ORNUM)\par
"RTN","AHMLDOS1",35,0)\par
 .Q:ERR\par
"RTN","AHMLDOS1",36,0)\par
 .S ES="AA"\par
"RTN","AHMLDOS1",37,0)\par
 .K REC\par
"RTN","AHMLDOS1",38,0)\par
 .D SEND^ORWDX(.ORWLST,ORVP,ORNP,ORL,ES,.ORWREC)\par
"RTN","AHMLDOS1",39,0)\par
 .M REC=ORWLST K ORWLST\par
"RTN","AHMLDOS1",40,0)\par
 .D UPDTOR(ORNUM,ORNP),BLDXRF(OLDOR,ORNUM)\par
"RTN","AHMLDOS1",41,0)\par
 .D CLNOR(ORNUM)\par
"RTN","AHMLDOS1",42,0)\par
 Q:ACKERR\par
"RTN","AHMLDOS1",43,0)\par
 I (ACT["OC")!(ACT["CA")!(ACT["DC") D\par
"RTN","AHMLDOS1",44,0)\par
 .Q:'$D(^XTMP("AHMLDO",TYPE))\par
"RTN","AHMLDOS1",45,0)\par
 .I $D(^XTMP("AHMLDO",TYPE,OLDOR)) S ORIFN=^XTMP("AHMLDO",TYPE,OLDOR)\par
"RTN","AHMLDOS1",46,0)\par
 .Q:$G(ORIFN)'>0\par
"RTN","AHMLDOS1",47,0)\par
 .S ORID=$G(ORIFN),STAT=$G(STS),(DCORIG,ISNEWORD)=0\par
"RTN","AHMLDOS1",48,0)\par
 .I ORID'="" D\par
"RTN","AHMLDOS1",49,0)\par
 ..; GET ORDER LOCATION\par
"RTN","AHMLDOS1",50,0)\par
 ..S ORL=+$$GET1^DIQ(100,ORID,6,"I")\par
"RTN","AHMLDOS1",51,0)\par
 ..I ORID'[";" S ORID=ORID_";1"\par
"RTN","AHMLDOS1",52,0)\par
 ..D DC^AHMLDOS(.REC,ORID,ORVP,ORNP,ORL,REAS,DCORIG,ISNEWORD)\par
"RTN","AHMLDOS1",53,0)\par
 ;\par
"RTN","AHMLDOS1",54,0)\par
 D END\par
"RTN","AHMLDOS1",55,0)\par
 Q\par
"RTN","AHMLDOS1",56,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS1",57,0)\par
CLNOR(ORNUM) ;\par
"RTN","AHMLDOS1",58,0)\par
 N NCT,LIEN\par
"RTN","AHMLDOS1",59,0)\par
 Q:$G(ORNUM)'>0\par
"RTN","AHMLDOS1",60,0)\par
 S ORNUM=+ORNUM,ORIFN=ORNUM\par
"RTN","AHMLDOS1",61,0)\par
 I $D(^OR(100,ORIFN,8,1,.1)) S NCT=$P(^OR(100,ORIFN,8,1,.1,0),"^",3)\par
"RTN","AHMLDOS1",62,0)\par
 Q:$G(NCT)'>1\par
"RTN","AHMLDOS1",63,0)\par
 S LIEN=NCT_","_1_","_ORIFN_","\par
"RTN","AHMLDOS1",64,0)\par
 S ST=$$GET1^DIQ(100.081,LIEN,.01,"E"),ST=$TR(ST," ","")\par
"RTN","AHMLDOS1",65,0)\par
 I ST[":" D\par
"RTN","AHMLDOS1",66,0)\par
 .S ST=$P(ST,":",2)\par
"RTN","AHMLDOS1",67,0)\par
 .I ST?.A D\par
"RTN","AHMLDOS1",68,0)\par
 ..S $P(^OR(100,ORIFN,8,1,.1,0),"^",3)=NCT-1,$P(^OR(100,ORIFN,8,1,.1,0),"^",4)=NCT-1\par
"RTN","AHMLDOS1",69,0)\par
 ..K ^OR(100,ORIFN,8,1,.1,NCT,0)\par
"RTN","AHMLDOS1",70,0)\par
 ;\par
"RTN","AHMLDOS1",71,0)\par
 Q\par
"RTN","AHMLDOS1",72,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS1",73,0)\par
UPDTOR(ORNUM,ORNP) ;\par
"RTN","AHMLDOS1",74,0)\par
 Q:$G(OR)'>0\par
"RTN","AHMLDOS1",75,0)\par
 S ORNUM=+ORNUM\par
"RTN","AHMLDOS1",76,0)\par
 S LRIENS=1_","_ORNUM_","\par
"RTN","AHMLDOS1",77,0)\par
 S LRFDA(1,100.008,LRIENS,13)=ORNP\par
"RTN","AHMLDOS1",78,0)\par
 D UPDATE^DIE("","LRFDA(1)","LRMSG")\par
"RTN","AHMLDOS1",79,0)\par
 ;\par
"RTN","AHMLDOS1",80,0)\par
 Q\par
"RTN","AHMLDOS1",81,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS1",82,0)\par
BLDXRF(OLDOR,ORNUM) ;\par
"RTN","AHMLDOS1",83,0)\par
 I '$D(^XTMP("AHMLDO",TYPE)) D SETZERO(TYPE)\par
"RTN","AHMLDOS1",84,0)\par
 Q:'$D(^XTMP("AHMLDO",TYPE))\par
"RTN","AHMLDOS1",85,0)\par
 I $D(^XTMP("AHMLDO",TYPE)) D\par
"RTN","AHMLDOS1",86,0)\par
 .S ^XTMP("AHMLDO",TYPE,+OLDOR)=+ORNUM\par
"RTN","AHMLDOS1",87,0)\par
 .S ^XTMP("AHMLDO",TYPE,"B",+ORNUM)=+OLDOR\par
"RTN","AHMLDOS1",88,0)\par
 .S ^XTMP("AHMLDO",TYPE,0,"CNT")=$G(^XTMP("AHMLDO",TYPE,0,"CNT"))+1\par
"RTN","AHMLDOS1",89,0)\par
 I '$D(^XTMP("AHMLDO",TYPE)) D SETZERO(TYPE)\par
"RTN","AHMLDOS1",90,0)\par
 ;\par
"RTN","AHMLDOS1",91,0)\par
 Q\par
"RTN","AHMLDOS1",92,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS1",93,0)\par
SETZERO(TYPE) ;\par
"RTN","AHMLDOS1",94,0)\par
 N X,Y\par
"RTN","AHMLDOS1",95,0)\par
 D NOW^%DTC S X1=$P(%,".",1),X2=365,Y=X1 D C^%DTC\par
"RTN","AHMLDOS1",96,0)\par
 S ^XTMP("AHMLDO",TYPE,0)=X_"^"_Y_" OR XREF FOR REMOTE ORDER"\par
"RTN","AHMLDOS1",97,0)\par
 S ^XTMP("AHMLDO",TYPE,0,"CNT")=0\par
"RTN","AHMLDOS1",98,0)\par
 ;\par
"RTN","AHMLDOS1",99,0)\par
 Q\par
"RTN","AHMLDOS1",100,0)\par
 ;--------------------------------------------------------------------\par
"RTN","AHMLDOS1",101,0)\par
BLDSND(REC,ORWREC,ORNUM) ;\par
"RTN","AHMLDOS1",102,0)\par
 Q:'$D(REC(1))\par
"RTN","AHMLDOS1",103,0)\par
 S ORNUM=$P(REC(1),"^")\par
"RTN","AHMLDOS1",104,0)\par
 S ORNUM=$E(ORNUM,2,99)\par
"RTN","AHMLDOS1",105,0)\par
 S ORWREC(1)=ORNUM_"^"_1_"^"_1_"^"_"E"\par
"RTN","AHMLDOS1",106,0)\par
 ;\par
"RTN","AHMLDOS1",107,0)\par
 Q\par
"RTN","AHMLDOS1",108,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS1",109,0)\par
GTRDATA(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,OLDOR,TYPE,REAS) ;\par
"RTN","AHMLDOS1",110,0)\par
 ;\par
"RTN","AHMLDOS1",111,0)\par
 ;    Input: REC - ^HL(772 data                      [required]\par
"RTN","AHMLDOS1",112,0)\par
 ;           TYPE - Order type = RAD                 [required]\par
"RTN","AHMLDOS1",113,0)\par
 ;\par
"RTN","AHMLDOS1",114,0)\par
 ;    Output: None.\par
"RTN","AHMLDOS1",115,0)\par
 ;\par
"RTN","AHMLDOS1",116,0)\par
 N II,CNT,PNPI,ACTV,NPI\par
"RTN","AHMLDOS1",117,0)\par
 ;\par
"RTN","AHMLDOS1",118,0)\par
 S (ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,PNPI)="",ACTV=1\par
"RTN","AHMLDOS1",119,0)\par
 ;\par
"RTN","AHMLDOS1",120,0)\par
 S DLG="RA OERR EXAM"\par
"RTN","AHMLDOS1",121,0)\par
 S ORIT=$O(^ORD(101.41,"AB",DLG,0))\par
"RTN","AHMLDOS1",122,0)\par
 S ORDG=$O(^ORD(100.98,"B",TYPE,0))\par
"RTN","AHMLDOS1",123,0)\par
 S II="" F  S II=$O(REC(II)) Q:II=""  D  Q:$G(ACKERR)\par
"RTN","AHMLDOS1",124,0)\par
 .S MSGNDE=REC(II),MSGTYP=$P($G(MSGNDE),"|")\par
"RTN","AHMLDOS1",125,0)\par
 .Q:MSGTYP=""\par
"RTN","AHMLDOS1",126,0)\par
 .Q:MSGTYP["BHS"\par
"RTN","AHMLDOS1",127,0)\par
 .I MSGTYP["MSH" D\par
"RTN","AHMLDOS1",128,0)\par
 ..Q:$P(MSGNDE,"|",9)="ORR"\par
"RTN","AHMLDOS1",129,0)\par
 .I MSGTYP["PID" D\par
"RTN","AHMLDOS1",130,0)\par
 ..S DOB=$P(MSGNDE,"|",5),ORVPNME=$P(MSGNDE,"|",6),SSN=$P(MSGNDE,"|",7)\par
"RTN","AHMLDOS1",131,0)\par
 ..I $G(ORVPNME)="" S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",132,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",133,0)\par
 ..I $G(DOB)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",134,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient DOB not found",TYPE)\par
"RTN","AHMLDOS1",135,0)\par
 ..I $G(SSN)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",136,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient SSN not found",TYPE)\par
"RTN","AHMLDOS1",137,0)\par
 ..I '$D(^DPT("SSN",SSN)) S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",138,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",139,0)\par
 ..S ORVP="",ORVP=$O(^DPT("SSN",SSN,ORVP))\par
"RTN","AHMLDOS1",140,0)\par
 ..I $G(ORVP)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",141,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",142,0)\par
 ..S ORNME=$$GET1^DIQ(2,ORVP,.01,"I")\par
"RTN","AHMLDOS1",143,0)\par
 ..I ORNME'=ORVPNME S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",144,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",145,0)\par
 ..S ORDOB=$$GET1^DIQ(2,ORVP,.03,"I")\par
"RTN","AHMLDOS1",146,0)\par
 ..I $G(ORDOB)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",147,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient DOB not found",TYPE)\par
"RTN","AHMLDOS1",148,0)\par
 ..I ORDOB'=DOB S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",149,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",150,0)\par
 ..S ORSSN=$$GET1^DIQ(2,ORVP,.09,"I")\par
"RTN","AHMLDOS1",151,0)\par
 ..I ORSSN'=SSN S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",152,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",153,0)\par
 .Q:ACKERR\par
"RTN","AHMLDOS1",154,0)\par
 .I MSGTYP["PV1" D\par
"RTN","AHMLDOS1",155,0)\par
 ..S ORL=$P(REC(II),"|",4)\par
"RTN","AHMLDOS1",156,0)\par
 ..S CAT=$P(REC(II),"|",3)\par
"RTN","AHMLDOS1",157,0)\par
 .I MSGTYP["ORC" D\par
"RTN","AHMLDOS1",158,0)\par
 ..S OLDOR=+$P(MSGNDE,"|",3)\par
"RTN","AHMLDOS1",159,0)\par
 ..S PNPI=$P($P(MSGNDE,"|",13),"^",3)\par
"RTN","AHMLDOS1",160,0)\par
 ..I $G(PNPI)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",161,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not found",TYPE)\par
"RTN","AHMLDOS1",162,0)\par
 ..S ORNPNME=$P($P(MSGNDE,"|",13),"^",2)\par
"RTN","AHMLDOS1",163,0)\par
 ..I $G(ORNPNME)="" S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",164,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not found",TYPE)\par
"RTN","AHMLDOS1",165,0)\par
 ..S ORNP="",ORNP=$O(^VA(200,"B",ORNPNME,ORNP)),ORUSR=ORNP,DUZ=ORNP\par
"RTN","AHMLDOS1",166,0)\par
 ..I $G(ORNP)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",167,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not found",TYPE)\par
"RTN","AHMLDOS1",168,0)\par
 ..S ORNME=$$GET1^DIQ(200,ORNP,.01,"I")\par
"RTN","AHMLDOS1",169,0)\par
 ..I $G(ORNME)=""!(ORNME'=ORNPNME) S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",170,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not found",TYPE)\par
"RTN","AHMLDOS1",171,0)\par
 ..S ACTV=$$GET1^DIQ(200,ORNP,7,"I") I $G(ACTV)>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",172,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider inactive",TYPE)\par
"RTN","AHMLDOS1",173,0)\par
 ..S XUSQI="Individual_ID",XUSIEN=ORNP,XUSDATE=""\par
"RTN","AHMLDOS1",174,0)\par
 ..S NPI=+$$NPI^XUSNPI(XUSQI,XUSIEN,XUSDATE)\par
"RTN","AHMLDOS1",175,0)\par
 ..I $G(NPI)'>0!(NPI'=PNPI) S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",176,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not found",TYPE)\par
"RTN","AHMLDOS1",177,0)\par
 ..S DTDSIRED=$P($P(MSGNDE,"|",8),"^",4)\par
"RTN","AHMLDOS1",178,0)\par
 ..S URG=$P($P(MSGNDE,"|",8),"^",6)\par
"RTN","AHMLDOS1",179,0)\par
 ..I $G(URG)'="" S URIEN="",URIEN=$O(^ORD(101.42,"C",URG,URIEN))\par
"RTN","AHMLDOS1",180,0)\par
 ..I $G(URIEN)'="" S URG=URIEN\par
"RTN","AHMLDOS1",181,0)\par
 ..S REAS=$P($P(MSGNDE,"|",17),"^",5)\par
"RTN","AHMLDOS1",182,0)\par
 .Q:ACKERR\par
"RTN","AHMLDOS1",183,0)\par
 .I MSGTYP["OBR" D  Q:ACKERR\par
"RTN","AHMLDOS1",184,0)\par
 ..S OBRNDE=REC(II)\par
"RTN","AHMLDOS1",185,0)\par
 ..S PROC=$P($P(OBRNDE,"|",5),"^",4),PROCNME=$P($P(OBRNDE,"|",5),"^",5)\par
"RTN","AHMLDOS1",186,0)\par
 ..I PROCNME="" D  S ACKERR=1 Q\par
"RTN","AHMLDOS1",187,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","RAD PROCEDURE NOT FOUND",TYPE)\par
"RTN","AHMLDOS1",188,0)\par
 ..I '$D(^RAMIS(71,"B",PROCNME)) D  S ACKERR=1 Q\par
"RTN","AHMLDOS1",189,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","RAD PROCEDURE NOT FOUND",TYPE)\par
"RTN","AHMLDOS1",190,0)\par
 ..S ISOL=$P(OBRNDE,"|",13) I ISOL'="" S ISOL=1\par
"RTN","AHMLDOS1",191,0)\par
 ..S PMOD=$P(OBRNDE,"|",19)\par
"RTN","AHMLDOS1",192,0)\par
 ..I $G(PMOD)'["~" D\par
"RTN","AHMLDOS1",193,0)\par
 ...S XX=PMOD\par
"RTN","AHMLDOS1",194,0)\par
 ...Q:XX=""\par
"RTN","AHMLDOS1",195,0)\par
 ...S PTR="",PTR=$O(^RAMIS(71.2,"B",XX,PTR))\par
"RTN","AHMLDOS1",196,0)\par
 ...I PTR'="" S PMOD(1)=PTR\par
"RTN","AHMLDOS1",197,0)\par
 ..I $G(PMOD)["~" D\par
"RTN","AHMLDOS1",198,0)\par
 ...F III=1:1 S XX=$P(PMOD,"~",III)  D  Q:XX=""\par
"RTN","AHMLDOS1",199,0)\par
 ....Q:XX=""\par
"RTN","AHMLDOS1",200,0)\par
 ....S PTR="",PTR=$O(^RAMIS(71.2,"B",XX,PTR))\par
"RTN","AHMLDOS1",201,0)\par
 ....I PTR'="" S PMOD(III)=PTR\par
"RTN","AHMLDOS1",202,0)\par
 ..S MDE=$P(OBRNDE,"|",31),MDE=$E(MDE,1)\par
"RTN","AHMLDOS1",203,0)\par
 ..I REAS="" S REAS=$P($P(OBRNDE,"|",32),"^",2)\par
"RTN","AHMLDOS1",204,0)\par
 ..S LOCNME=$$GET1^DIQ(4,LOC,.01,"E")\par
"RTN","AHMLDOS1",205,0)\par
 ..S SBRQ=+$P(OBRNDE,"|",20)\par
"RTN","AHMLDOS1",206,0)\par
 .Q:ACKERR\par
"RTN","AHMLDOS1",207,0)\par
 .I MSGTYP["OBX" D\par
"RTN","AHMLDOS1",208,0)\par
 ..S OBXNDE=REC(II)\par
"RTN","AHMLDOS1",209,0)\par
 ..S FLD=$P($P(OBXNDE,"|",4),"^",2)\par
"RTN","AHMLDOS1",210,0)\par
 ..I FLD["PRE-OP" D\par
"RTN","AHMLDOS1",211,0)\par
 ...S PREOP=$P(OBXNDE,"|",6),PREOP=$$HL7TFM^XLFDT(PREOP)\par
"RTN","AHMLDOS1",212,0)\par
 ..I FLD["PREG" D\par
"RTN","AHMLDOS1",213,0)\par
 ...S PREG=$P(OBXNDE,"|",6),PREG=$E(PREG,1)\par
"RTN","AHMLDOS1",214,0)\par
 ..I FLD["CLINICAL" D\par
"RTN","AHMLDOS1",215,0)\par
 ...I '$D(BCH) S CNT=1,BCH(CNT)=$P(OBXNDE,"|",6)\par
"RTN","AHMLDOS1",216,0)\par
 ...I $D(BCH) S CNT=$O(BCH(99),-1),CNT=$G(CNT)+1,BCH(CNT)=$P(OBXNDE,"|",6)\par
"RTN","AHMLDOS1",217,0)\par
 W !,"END OF GETRDATA"\par
"RTN","AHMLDOS1",218,0)\par
 ;\par
"RTN","AHMLDOS1",219,0)\par
 Q\par
"RTN","AHMLDOS1",220,0)\par
 ;-----------------------------------------------------------------------\par
"RTN","AHMLDOS1",221,0)\par
GTLDATA(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,OLDOR,TYPE,REAS) ;\par
"RTN","AHMLDOS1",222,0)\par
 ;\par
"RTN","AHMLDOS1",223,0)\par
 ;    Function: get lab data in HL7 MESSAGE\par
"RTN","AHMLDOS1",224,0)\par
 ;       Input:  REC - ^HL(772 data                     [required]\par
"RTN","AHMLDOS1",225,0)\par
 ;              TYPE - Order type = LAB                 [required]\par
"RTN","AHMLDOS1",226,0)\par
 ;\par
"RTN","AHMLDOS1",227,0)\par
 ;   Output: None.\par
"RTN","AHMLDOS1",228,0)\par
 ;\par
"RTN","AHMLDOS1",229,0)\par
 N II,CNT,ACTV\par
"RTN","AHMLDOS1",230,0)\par
 ;\par
"RTN","AHMLDOS1",231,0)\par
 S (ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN)="",ACTV=1\par
"RTN","AHMLDOS1",232,0)\par
 ;\par
"RTN","AHMLDOS1",233,0)\par
 S DLG="LR OTHER LAB TESTS"\par
"RTN","AHMLDOS1",234,0)\par
 ;I TYPE="RAD" S DLG="RA OERR EXAM"\par
"RTN","AHMLDOS1",235,0)\par
 S ORIT=$O(^ORD(101.41,"AB",DLG,0))\par
"RTN","AHMLDOS1",236,0)\par
 S ORDG=$O(^ORD(100.98,"B",TYPE,0))\par
"RTN","AHMLDOS1",237,0)\par
 S II="" F  S II=$O(REC(II)) Q:II=""  D  Q:ACKERR\par
"RTN","AHMLDOS1",238,0)\par
 .S MSGNDE=REC(II),MSGTYP=$P($G(MSGNDE),"|")\par
"RTN","AHMLDOS1",239,0)\par
 .Q:MSGTYP=""\par
"RTN","AHMLDOS1",240,0)\par
 .Q:MSGTYP["BHS"\par
"RTN","AHMLDOS1",241,0)\par
 .I MSGTYP["MSH",$P(MSGNDE,"|",9)="ORR" Q\par
"RTN","AHMLDOS1",242,0)\par
 .I MSGTYP["PID" D\par
"RTN","AHMLDOS1",243,0)\par
 ..S DOB=$P(MSGNDE,"|",5),ORVPNME=$P(MSGNDE,"|",6),SSN=$P(MSGNDE,"|",7)\par
"RTN","AHMLDOS1",244,0)\par
 ..I $G(ORVPNME)="" S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",245,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",246,0)\par
 ..I $G(DOB)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",247,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient DOB not found",TYPE)\par
"RTN","AHMLDOS1",248,0)\par
 ..I $G(SSN)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",249,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient SSN not found",TYPE)\par
"RTN","AHMLDOS1",250,0)\par
 ..I '$D(^DPT("SSN",SSN)) S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",251,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",252,0)\par
 ..S ORVP="",ORVP=$O(^DPT("SSN",SSN,ORVP))\par
"RTN","AHMLDOS1",253,0)\par
 ..I $G(ORVP)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",254,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",255,0)\par
 ..S ORNME=$$GET1^DIQ(2,ORVP,.01,"I")\par
"RTN","AHMLDOS1",256,0)\par
 ..I ORNME'=ORVPNME S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",257,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",258,0)\par
 ..S ORDOB=$$GET1^DIQ(2,ORVP,.03,"I")\par
"RTN","AHMLDOS1",259,0)\par
 ..I $G(ORDOB)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",260,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient DOB not found",TYPE)\par
"RTN","AHMLDOS1",261,0)\par
 ..I ORDOB'=DOB S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",262,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",263,0)\par
 ..S ORSSN=$$GET1^DIQ(2,ORVP,.09,"I")\par
"RTN","AHMLDOS1",264,0)\par
 ..I ORSSN'=SSN S ACKERR=1 D  Q:$G(ACKERR)\par
"RTN","AHMLDOS1",265,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Patient not found",TYPE)\par
"RTN","AHMLDOS1",266,0)\par
 .Q:ACKERR\par
"RTN","AHMLDOS1",267,0)\par
 .I MSGTYP["PV1" D\par
"RTN","AHMLDOS1",268,0)\par
 ..S ORL=$P(REC(II),"|",4)\par
"RTN","AHMLDOS1",269,0)\par
 .I MSGTYP["ORC" D  Q:ACKERR\par
"RTN","AHMLDOS1",270,0)\par
 ..S OLDOR=+$P(MSGNDE,"|",3)\par
"RTN","AHMLDOS1",271,0)\par
 ..S PNPI=$P($P(MSGNDE,"|",13),"^",3)\par
"RTN","AHMLDOS1",272,0)\par
 ..I $G(PNPI)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",273,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not found",TYPE)\par
"RTN","AHMLDOS1",274,0)\par
 ..S ORNPNME=$P($P(MSGNDE,"|",13),"^",2)\par
"RTN","AHMLDOS1",275,0)\par
 ..I $G(ORNPNME)="" S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",276,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not found",TYPE)\par
"RTN","AHMLDOS1",277,0)\par
 ..S ORNP="",ORNP=$O(^VA(200,"B",ORNPNME,ORNP)),DUZ=ORNP,ORUSR=ORNP\par
"RTN","AHMLDOS1",278,0)\par
 ..I $G(ORNP)'>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",279,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not found",TYPE)\par
"RTN","AHMLDOS1",280,0)\par
 ..S ACTV=$$GET1^DIQ(200,ORNP,7,"I") I $G(ACTV)>0 S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",281,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not active",TYPE)\par
"RTN","AHMLDOS1",282,0)\par
 ..S XUSQI="Individual_ID",XUSIEN=ORNP,XUSDATE=""\par
"RTN","AHMLDOS1",283,0)\par
 ..S NPI=+$$NPI^XUSNPI(XUSQI,XUSIEN,XUSDATE)\par
"RTN","AHMLDOS1",284,0)\par
 ..I $G(NPI)<0!(NPI'=PNPI) S ACKERR=1 D  Q\par
"RTN","AHMLDOS1",285,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Provider not found",TYPE)\par
"RTN","AHMLDOS1",286,0)\par
 ..S COL=$P($P(MSGNDE,"|",8),"^",4)\par
"RTN","AHMLDOS1",287,0)\par
 ..S COL=$$HL7TFM^XLFDT(COL,"L")\par
"RTN","AHMLDOS1",288,0)\par
 ..;I $P(COL,".",2)="" S COL="TODAY"\par
"RTN","AHMLDOS1",289,0)\par
 ..S CLDTTM=COL\par
"RTN","AHMLDOS1",290,0)\par
 ..S START=CLDTTM\par
"RTN","AHMLDOS1",291,0)\par
 ..S REAS=$P($P(MSGNDE,"|",17),"^",4)\par
"RTN","AHMLDOS1",292,0)\par
 .I MSGTYP["OBR" D  Q:ACKERR\par
"RTN","AHMLDOS1",293,0)\par
 ..S OBRNDE=REC(II)\par
"RTN","AHMLDOS1",294,0)\par
 ..S TSTNDE=$P(OBRNDE,"|",5)\par
"RTN","AHMLDOS1",295,0)\par
 ..I TSTNDE'="" S TSTNME=$P(TSTNDE,"^",5)\par
"RTN","AHMLDOS1",296,0)\par
 ..I TSTNME="" D  S ACKERR=1 Q\par
"RTN","AHMLDOS1",297,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Lab Test not found",TYPE)\par
"RTN","AHMLDOS1",298,0)\par
 ..I '$D(^LAB(60,"B",TSTNME)) D  S ACKERR=1 Q\par
"RTN","AHMLDOS1",299,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Lab Test not found",TYPE)\par
"RTN","AHMLDOS1",300,0)\par
 ..S LABTEST="",LABTEST=$O(^LAB(60,"B",TSTNME,LABTEST))\par
"RTN","AHMLDOS1",301,0)\par
 ..I LABTEST="" D  S ACKERR=1 Q\par
"RTN","AHMLDOS1",302,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Lab Test not found",TYPE)\par
"RTN","AHMLDOS1",303,0)\par
 ..S SAMPLE=$P(OBRNDE,"|",16),SAMPLE=+$P(SAMPLE,"^",4)\par
"RTN","AHMLDOS1",304,0)\par
 ..S SPECIMEN=$P(OBRNDE,"|",16),SPECIMEN=$P(SPECIMEN,";",4)\par
"RTN","AHMLDOS1",305,0)\par
 ..S COLLECTEDBY="SP",HOWOFTEN=28\par
"RTN","AHMLDOS1",306,0)\par
 ..S URG=$P($P(OBRNDE,"|",28),"^",6),URGENCY=$P(URG,";",2)\par
"RTN","AHMLDOS1",307,0)\par
 Q:ACKERR\par
"RTN","AHMLDOS1",308,0)\par
 S LOCNME=$$GET1^DIQ(4,LOC,.01,"I")\par
"RTN","AHMLDOS1",309,0)\par
 K OR,ORDT,ORD\par
"RTN","AHMLDOS1",310,0)\par
 ;\par
"RTN","AHMLDOS1",311,0)\par
 Q\par
"RTN","AHMLDOS1",312,0)\par
 ;--------------------------------------------------------------------\par
"RTN","AHMLDOS1",313,0)\par
RAD ;\par
"RTN","AHMLDOS1",314,0)\par
 N DA,NDE,TMP,CTYP,CTYPE,OI,JVORD,DD,UR,HL,HO\par
"RTN","AHMLDOS1",315,0)\par
 S ERR=0,(OI,OR)=""\par
"RTN","AHMLDOS1",316,0)\par
 Q:$G(ORIT)'>0\par
"RTN","AHMLDOS1",317,0)\par
 K ORDIALOG D BLDARY(ORIT,.OR,.ORT)\par
"RTN","AHMLDOS1",318,0)\par
 K ORDIALOG\par
"RTN","AHMLDOS1",319,0)\par
 S VAL="" F  S VAL=$O(ORT(VAL)) Q:VAL=""!(ERR)  D  Q:ACKERR\par
"RTN","AHMLDOS1",320,0)\par
 .S (CTYP,CTYPE)=""\par
"RTN","AHMLDOS1",321,0)\par
 .S STRG=VAL\par
"RTN","AHMLDOS1",322,0)\par
 .I $TR(STRG," ")="PROCEDURE" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D  Q:ACKERR\par
"RTN","AHMLDOS1",323,0)\par
 ..Q:$G(PROC)'>0\par
"RTN","AHMLDOS1",324,0)\par
 ..S TEST=PROC_";99RAP"\par
"RTN","AHMLDOS1",325,0)\par
 ..D GETOINUM^ORWDCN32(.OI,TEST)\par
"RTN","AHMLDOS1",326,0)\par
 ..I $G(OI)="" D  S ACKERR=1 Q\par
"RTN","AHMLDOS1",327,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Radiology order number is missing or invalid.")\par
"RTN","AHMLDOS1",328,0)\par
 ..;I $G(OI)="" S ERR=1,LSTN=LSTN+1,REC(LSTN)="Error: Radiology order number is missing or invalid." Q\par
"RTN","AHMLDOS1",329,0)\par
 ..S ORDIALOG(NN,1)=$G(OI)      D\par
"RTN","AHMLDOS1",330,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",331,0)\par
 .I $TR(STRG," ")="MODEOFTRANSPORT" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",332,0)\par
 ..S ORDIALOG(NN,1)=$G(MDE)\par
"RTN","AHMLDOS1",333,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",334,0)\par
 .I $TR(STRG," ")="DATEDESIRED" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",335,0)\par
 ..S DTDSIRED=$$HL7TFM^XLFDT(DTDSIRED)\par
"RTN","AHMLDOS1",336,0)\par
 ..S ORDIALOG(NN,1)=$G(DTDSIRED)\par
"RTN","AHMLDOS1",337,0)\par
 .I $TR(STRG," ")="REASONFORSTUDY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",338,0)\par
 ..S ORDIALOG(NN,1)=$G(REAS)\par
"RTN","AHMLDOS1",339,0)\par
 .I $TR(STRG," ")="PREGNANT" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",340,0)\par
 ..S ORDIALOG(NN,1)=$G(PREG)\par
"RTN","AHMLDOS1",341,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",342,0)\par
 .I $TR(STRG," ")="PRE-OPSCHEDULEDDATE/TIME" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",343,0)\par
 ..S ORDIALOG(NN,1)=$G(PREOP)\par
"RTN","AHMLDOS1",344,0)\par
 .I $TR(STRG," ")="CLINICALHISTORY" S NN="",NN=$O(ORT(STRG,"")) D\par
"RTN","AHMLDOS1",345,0)\par
 ..Q:'$D(BCH)\par
"RTN","AHMLDOS1",346,0)\par
 ..D BLDWP(NN,.BCH)\par
"RTN","AHMLDOS1",347,0)\par
 ..;S ORDIALOG(NN,1)=$G(BCH) D BLDWP(NN,BCH)\par
"RTN","AHMLDOS1",348,0)\par
 .I $TR(STRG," ")="SUBMITREQUESTTO" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",349,0)\par
 ..S ORDIALOG(NN,1)=$G(SBRQ)\par
"RTN","AHMLDOS1",350,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",351,0)\par
 .I $TR(STRG," ")="PROCEDUREMODIFIER" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",352,0)\par
 ..Q:'$D(PMOD(1))\par
"RTN","AHMLDOS1",353,0)\par
 ..S CNT="" F  S CNT=$O(PMOD(CNT)) Q:CNT=""  D\par
"RTN","AHMLDOS1",354,0)\par
 ...Q:$G(CNT)'>0\par
"RTN","AHMLDOS1",355,0)\par
 ...S ORDIALOG(NN,CNT)=$G(PMOD(CNT))\par
"RTN","AHMLDOS1",356,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",357,0)\par
 .I $TR(STRG," ")="CATEGORY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",358,0)\par
 ..S ORDIALOG(NN,1)=$G(CAT)\par
"RTN","AHMLDOS1",359,0)\par
 .I $TR(STRG," ")="URGENCY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",360,0)\par
 ..S ORDIALOG(NN,1)=$G(URG)\par
"RTN","AHMLDOS1",361,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",362,0)\par
 .I $TR(STRG," ")="ORDERINGLOCATION" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",363,0)\par
 ..S ORDIALOG(NN,1)=$G(ORL)\par
"RTN","AHMLDOS1",364,0)\par
 .I $TR(STRG," ")="APPROVINGRAD/NUCMEDPHYS" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",365,0)\par
 ..S ORDIALOG(NN,1)=$G(ORNP)\par
"RTN","AHMLDOS1",366,0)\par
  .I $TR(STRG," ")="ISPATIENTONISOLATIONPROCEDURES?" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",367,0)\par
 ..S ORDIALOG(NN,1)=$G(ISOL)\par
"RTN","AHMLDOS1",368,0)\par
 .I $TR(STRG," ")="LOCATION" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",369,0)\par
 ..S ORDIALOG(NN,1)=$G(LOCNME)\par
"RTN","AHMLDOS1",370,0)\par
 Q\par
"RTN","AHMLDOS1",371,0)\par
 ;\par
"RTN","AHMLDOS1",372,0)\par
LAB ;\par
"RTN","AHMLDOS1",373,0)\par
 N DA,NDE,TMP,CTYP,CTYPE,OI,JVORD,DD,UR,HL,HO\par
"RTN","AHMLDOS1",374,0)\par
 S ERR=0,(OI,OR)=""\par
"RTN","AHMLDOS1",375,0)\par
 Q:$G(ORIT)'>0\par
"RTN","AHMLDOS1",376,0)\par
 K ORDIALOG D BLDARY(ORIT,.OR,.ORT)\par
"RTN","AHMLDOS1",377,0)\par
 K ORDIALOG ;M ORDIALOG=ORD K ORD\par
"RTN","AHMLDOS1",378,0)\par
 S VAL="" F  S VAL=$O(ORT(VAL)) Q:VAL=""!(ERR)  D  Q:ACKERR\par
"RTN","AHMLDOS1",379,0)\par
 .S (CTYP,CTYPE)=""\par
"RTN","AHMLDOS1",380,0)\par
 .S STRG=VAL\par
"RTN","AHMLDOS1",381,0)\par
 .I $TR(STRG," ")="LABTEST" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D  Q:ACKERR\par
"RTN","AHMLDOS1",382,0)\par
 ..Q:$G(LABTEST)'>0\par
"RTN","AHMLDOS1",383,0)\par
 ..S TST=LABTEST_";99LRT"\par
"RTN","AHMLDOS1",384,0)\par
 ..D GETOINUM^ORWDCN32(.OI,TST)\par
"RTN","AHMLDOS1",385,0)\par
 ..I $G(OI)="" D  S ACKERR=1 Q\par
"RTN","AHMLDOS1",386,0)\par
 ...D ACK^AHMLDOS(HLMA,HLMTIEN,"AE","Laboratory order number is missing or invalid.")\par
"RTN","AHMLDOS1",387,0)\par
 ..S ORDIALOG(NN,1)=$G(OI)\par
"RTN","AHMLDOS1",388,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",389,0)\par
 .I $TR(STRG," ")="COLLECTIONDATE/TIME" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",390,0)\par
 ..S ORDIALOG(NN,1)=$G(START)\par
"RTN","AHMLDOS1",391,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",392,0)\par
 ..;I $TR(STRG," ")="COMMENTS" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",393,0)\par
 ..;S ORDIALOG(NN,1)=COMMENT I COMMENT'="" D BLDWP(NN,COMMENT)\par
"RTN","AHMLDOS1",394,0)\par
 .I $TR(STRG," ")="COLLECTEDBY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",395,0)\par
 ..S ORDIALOG(NN,1)="SP"\par
"RTN","AHMLDOS1",396,0)\par
 .I $TR(STRG," ")="HOWOFTEN" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",397,0)\par
 ..S ORDIALOG(NN,1)=28\par
"RTN","AHMLDOS1",398,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",399,0)\par
 .I $TR(STRG," ")="SPECIMEN" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",400,0)\par
 ..S ORDIALOG(NN,1)=SAMPLE\par
"RTN","AHMLDOS1",401,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",402,0)\par
 .I $TR(STRG," ")="COLLECTIONSAMPLE" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",403,0)\par
 ..S ORDIALOG(NN,1)=SPECIMEN\par
"RTN","AHMLDOS1",404,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",405,0)\par
 .I $TR(STRG," ")="URGENCY" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",406,0)\par
 ..S ORDIALOG(NN,1)=$G(URGENCY)\par
"RTN","AHMLDOS1",407,0)\par
 ..K ORT(STRG)\par
"RTN","AHMLDOS1",408,0)\par
 .I $TR(STRG," ")="LOCATION" S NN="",NN=$O(ORT(STRG,"")),ORDIALOG(NN,1)="" D\par
"RTN","AHMLDOS1",409,0)\par
 ..S ORDIALOG(NN,1)=$G(LOCNME)\par
"RTN","AHMLDOS1",410,0)\par
 ;\par
"RTN","AHMLDOS1",411,0)\par
 Q\par
"RTN","AHMLDOS1",412,0)\par
 ;----------------------------------------------------------------------\par
"RTN","AHMLDOS1",413,0)\par
BLDWP(NN,BCH) ;\par
"RTN","AHMLDOS1",414,0)\par
 N I\par
"RTN","AHMLDOS1",415,0)\par
 S CNT=99,CNT=$O(BCH(CNT),-1)\par
"RTN","AHMLDOS1",416,0)\par
 F I=1:1:CNT D\par
"RTN","AHMLDOS1",417,0)\par
 .S ORDIALOG("WP",NN,1,I,0)=$G(BCH(I))\par
"RTN","AHMLDOS1",418,0)\par
 S ORDIALOG(NN,1)="ORDIALOG(""WP"","_NN_",1)"\par
"RTN","AHMLDOS1",419,0)\par
 ;\par
"RTN","AHMLDOS1",420,0)\par
 Q\par
"RTN","AHMLDOS1",421,0)\par
 ;----------------------------------------------------------------------\par
"RTN","AHMLDOS1",422,0)\par
BLDARY(ORIT,OR,ORT) ;\par
"RTN","AHMLDOS1",423,0)\par
 Q:$G(ORIT)'>0\par
"RTN","AHMLDOS1",424,0)\par
 N TXT,TMP,NM\par
"RTN","AHMLDOS1",425,0)\par
 D GETDLG^ORCD(ORIT)\par
"RTN","AHMLDOS1",426,0)\par
 S TXT="" F  S TXT=$O(ORDIALOG("B",TXT)) Q:TXT=""  D\par
"RTN","AHMLDOS1",427,0)\par
 .S TMP=$TR(TXT," "),ORDT("B",TMP)=ORDIALOG("B",TXT)\par
"RTN","AHMLDOS1",428,0)\par
 S TXT="" F  S TXT=$O(ORDT("B",TXT)) Q:TXT=""  D\par
"RTN","AHMLDOS1",429,0)\par
 .I $D(ORDT("B",$TR(TXT," "))) S NM=$P($G(ORDT("B",$TR(TXT," "))),U,2)\par
"RTN","AHMLDOS1",430,0)\par
 .S ORD(NM,1)="" S ORD(NM,1)=ORDT("B",TXT) S ORT(TXT,NM)=""\par
"RTN","AHMLDOS1",431,0)\par
 .S ORT(TXT,NM)=ORD(NM,1)\par
"RTN","AHMLDOS1",432,0)\par
 Q\par
"RTN","AHMLDOS1",433,0)\par
 ;\par
"RTN","AHMLDOS1",434,0)\par
END      ;\par
"RTN","AHMLDOS1",435,0)\par
 K CAT,COL,COLLECTEDBY,CLDTTM,DCORIG,DTDSIRED,DOB,ORNME,SSN\par
"RTN","AHMLDOS1",436,0)\par
 K ERR,ES,FLD,HOWOFTEN,III,ISNEWORD,ISOL,LABTEST,LOCNME,LRFDA\par
"RTN","AHMLDOS1",437,0)\par
 K LRIENS,MDE,MSGNDE,MSGTYP,OBRNDE,OBXNDE,ORID,ORNPNME,ORTYP\par
"RTN","AHMLDOS1",438,0)\par
 K ORUSR,ORVPNME,PKG,PMOD,PREG,PREOP,PROC,PROCNME,PTR,SAMPLE\par
"RTN","AHMLDOS1",439,0)\par
 K SBRQ,SPECIMEN,ST,START,STAT,STRG,STS,TEST,TST,TSTNDE,XUSQI\par
"RTN","AHMLDOS1",440,0)\par
 K TSTNME,URG,URGENCY,URIEN,VAL,XX,X1,X2,Y,%,XUSDATE,XUSIEN\par
"RTN","AHMLDOS1",441,0)\par
 Q\par
"VER")\par
8.0^22.0\par
**END**\par
**END**\par
}
 